<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PHP Functions: Variable Scope</title>
    <link rel="stylesheet" href="/styles/main.css">
    <link rel="icon" href="/favicon.png">
    <script type="module">
      import mermaid from 'https://cdn.jsdelivr.net/npm/mermaid@10/dist/mermaid.esm.min.mjs';
      mermaid.initialize({ startOnLoad: true });
    </script>
</head>
<body>
    <header>
        <h1>PHP Functions: Variable Scope</h1>
        <p><a href="index.html">← Back to Syllabus</a> | <a href="php_default_parameters.html">← Previous Lecture</a></p>
    </header>
    
    <main>
        <section class="intro">
            <h2>Understanding Variable Scope in PHP</h2>
            <p>Welcome to our exploration of variable scope in PHP! Variable scope is a fundamental concept that determines where in your code a variable can be accessed and modified. Understanding scope is crucial for writing maintainable, bug-free PHP code, especially when working with functions and WordPress development.</p>
            
            <p>Think of variable scope as the "visibility" or "lifetime" of variables within your code. Just as different rooms in a building have different access rules, variables in different parts of your code have different accessibility.</p>

            <div class="definition-box">
                <h3>What is Variable Scope?</h3>
                <p>Variable scope defines the region of your code where a variable is accessible. In PHP, variables can have different scopes: global scope, local scope, function parameters, and static variables each have their own rules for how and where they can be accessed.</p>
            </div>
        </section>

        <section class="visual-concept">
            <h2>Variable Scope: A Visual Model</h2>
            
            <div class="svg-container">
                <svg width="650" height="400" xmlns="http://www.w3.org/2000/svg">
                    <!-- PHP Scope Visualization -->
                    <rect x="50" y="30" width="550" height="340" fill="#f5f5f5" stroke="#333" stroke-width="2"/>
                    <text x="325" y="60" text-anchor="middle" font-size="20" font-weight="bold">PHP Variable Scope</text>

                    <!-- Global Scope -->
                    <rect x="70" y="80" width="510" height="270" fill="#e3f2fd" stroke="#0d47a1" stroke-width="2"/>
                    <text x="150" y="110" font-weight="bold" fill="#0d47a1">Global Scope</text>
                    <text x="325" y="110" font-size="14">$globalVar = "I am visible everywhere (with global keyword)";</text>
                    
                    <!-- Function Scope 1 -->
                    <rect x="90" y="130" width="220" height="200" fill="#e8f5e9" stroke="#1b5e20" stroke-width="2"/>
                    <text x="200" y="160" text-anchor="middle" font-weight="bold" fill="#1b5e20">Function A Scope</text>
                    <text x="200" y="190" text-anchor="middle" font-size="14">$localVarA = "Only visible</text>
                    <text x="200" y="210" text-anchor="middle" font-size="14">within Function A";</text>
                    
                    <!-- Function Scope 2 -->
                    <rect x="340" y="130" width="220" height="200" fill="#fff8e1" stroke="#ff6f00" stroke-width="2"/>
                    <text x="450" y="160" text-anchor="middle" font-weight="bold" fill="#ff6f00">Function B Scope</text>
                    <text x="450" y="190" text-anchor="middle" font-size="14">$localVarB = "Only visible</text>
                    <text x="450" y="210" text-anchor="middle" font-size="14">within Function B";</text>
                    
                    <!-- Static variable in Function B -->
                    <rect x="360" y="240" width="180" height="70" fill="#f3e5f5" stroke="#6a1b9a" stroke-width="2" rx="5" ry="5"/>
                    <text x="450" y="270" text-anchor="middle" font-weight="bold" fill="#6a1b9a">static $counter = 0;</text>
                    <text x="450" y="290" text-anchor="middle" font-size="12">"I persist between function calls"</text>
                </svg>
            </div>
            
            <p>Think of variable scope like different rooms in a building:</p>
            <ul>
                <li><strong>Global Scope:</strong> Like a building's lobby - accessible from anywhere (with the right key - the <code>global</code> keyword)</li>
                <li><strong>Local Scope:</strong> Like private offices - variables only accessible within a specific function</li>
                <li><strong>Static Variables:</strong> Like a locker room - the contents remain in place between visits</li>
            </ul>
        </section>

        <section class="local-scope">
            <h2>Local Scope in PHP Functions</h2>
            
            <p>When you declare a variable inside a function, it has local scope. This means the variable is only available inside that function and cannot be accessed from outside it.</p>
            
            <div class="example-box">
                <h3>Local Variable Example</h3>
                <pre><code>function displayWelcomeMessage() {
    $message = "Welcome to our WordPress site!"; // Local variable
    echo $message;
}

displayWelcomeMessage(); // Outputs: Welcome to our WordPress site!

// Attempting to access the variable outside the function
echo $message; // Error: Undefined variable $message</code></pre>
            </div>

            <p>In this example, <code>$message</code> only exists within the <code>displayWelcomeMessage()</code> function. Once the function finishes executing, the variable is destroyed and its memory is freed.</p>
            
            <div class="mermaid-diagram">
                <div class="mermaid">
                    sequenceDiagram
                    participant MS as Main Script
                    participant F as Function
                    participant V as $message Variable
                    
                    MS->>F: Call displayWelcomeMessage()
                    F->>V: Create variable
                    F->>MS: Output message
                    F->>V: Variable destroyed
                    Note over V: Variable no longer exists
                    MS->>MS: Try to access $message
                    Note over MS: Error: Undefined variable
                </div>
            </div>

            <div class="example-box">
                <h3>Function Parameters are Local Variables</h3>
                <pre><code>function formatName($firstName, $lastName) {
    $fullName = $firstName . ' ' . $lastName; // Local variable
    return $fullName;
}

$name = formatName("John", "Doe"); // $name receives the returned value
echo $name; // Outputs: John Doe

// These variables don't exist outside the function
echo $firstName; // Error: Undefined variable
echo $lastName;  // Error: Undefined variable
echo $fullName;  // Error: Undefined variable</code></pre>
            </div>
            
            <p>In this example, <code>$firstName</code>, <code>$lastName</code>, and <code>$fullName</code> only exist within the function. The only way to get data out of the function is via the return value.</p>
            
            <div class="benefits-box">
                <h3>Benefits of Local Scope</h3>
                <ul>
                    <li><strong>Encapsulation:</strong> Variables inside functions are protected from accidental modification by code outside the function</li>
                    <li><strong>Name Collision Prevention:</strong> You can use the same variable names in different functions without conflicts</li>
                    <li><strong>Memory Management:</strong> Local variables are destroyed when the function completes, freeing up memory</li>
                    <li><strong>Code Clarity:</strong> Makes it clear which variables are used by which parts of your code</li>
                </ul>
            </div>
        </section>

        <section class="global-scope">
            <h2>Global Scope in PHP</h2>
            
            <p>Variables declared outside of any function have global scope. However, PHP functions cannot directly access global variables unless explicitly told to do so.</p>
            
            <div class="example-box">
                <h3>Global Variable Example</h3>
                <pre><code>$siteName = "My WordPress Site"; // Global variable

function displaySiteName() {
    echo $siteName; // This will NOT work
}

displaySiteName(); // Warning: Undefined variable $siteName</code></pre>
            </div>

            <p>Contrary to what you might expect, the function cannot access the global variable directly. This is different from some other programming languages!</p>
            
            <div class="example-box">
                <h3>Accessing Global Variables with the <code>global</code> Keyword</h3>
                <pre><code>$siteName = "My WordPress Site"; // Global variable

function displaySiteName() {
    global $siteName; // Tell PHP we want to access the global variable
    echo $siteName; // Now it works!
}

displaySiteName(); // Outputs: My WordPress Site</code></pre>
            </div>
            
            <p>The <code>global</code> keyword tells PHP that, inside the function, <code>$siteName</code> refers to the global variable, not a new local variable.</p>
            
            <div class="example-box">
                <h3>Modifying Global Variables</h3>
                <pre><code>$counter = 0; // Global variable

function incrementCounter() {
    global $counter;
    $counter++; // This modifies the global variable
}

echo $counter; // Outputs: 0
incrementCounter();
echo $counter; // Outputs: 1
incrementCounter();
echo $counter; // Outputs: 2</code></pre>
            </div>
            
            <p>When you use the <code>global</code> keyword, changes to the variable inside the function affect the global variable.</p>
        </section>

        <section class="superglobals">
            <h2>PHP Superglobals: Always Available</h2>
            
            <p>PHP provides several predefined arrays called "superglobals" that are always accessible in any scope without needing the <code>global</code> keyword.</p>
            
            <div class="mermaid-diagram">
                <div class="mermaid">
                    graph TD
                    A[PHP Superglobals] --> B["$_GET - URL Parameters"]
                    A --> C["$_POST - Form Data"]
                    A --> D["$_SESSION - Session Data"]
                    A --> E["$_COOKIE - Cookie Data"]
                    A --> F["$_SERVER - Server/Environment Info"]
                    A --> G["$_FILES - Uploaded Files"]
                    A --> H["$_REQUEST - GET, POST, COOKIE Data"]
                    A --> I["$_ENV - Environment Variables"]
                    
                    style A fill:#f9f,stroke:#333,stroke-width:2px
                </div>
            </div>
            
            <div class="example-box">
                <h3>Using Superglobals in Functions</h3>
                <pre><code>function getUserInput() {
    // Access form submission data with no need for 'global' keyword
    $username = $_POST['username'] ?? '';
    $email = $_POST['email'] ?? '';
    
    return [
        'username' => $username,
        'email' => $email
    ];
}

function getServerInfo() {
    // Access server information with no need for 'global' keyword
    $userAgent = $_SERVER['HTTP_USER_AGENT'] ?? '';
    $ipAddress = $_SERVER['REMOTE_ADDR'] ?? '';
    
    return [
        'user_agent' => $userAgent,
        'ip_address' => $ipAddress
    ];
}</code></pre>
            </div>
            
            <p>In WordPress development, you'll frequently use superglobals to handle form submissions, access user data, and interact with the server environment.</p>
        </section>

        <section class="globals-alternative">
            <h2>Alternative to <code>global</code>: Using Parameters and Return Values</h2>
            
            <p>While the <code>global</code> keyword is available, it's often better to use function parameters and return values instead. This creates more maintainable, testable code.</p>
            
            <div class="example-box">
                <h3>Using global (Not Recommended)</h3>
                <pre><code>$siteName = "My WordPress Site";
$siteDescription = "The best site ever";

function getSiteInfo() {
    global $siteName, $siteDescription;
    return $siteName . " - " . $siteDescription;
}

echo getSiteInfo(); // Outputs: My WordPress Site - The best site ever</code></pre>
            </div>

            <div class="example-box">
                <h3>Using Parameters and Return Values (Recommended)</h3>
                <pre><code>$siteName = "My WordPress Site";
$siteDescription = "The best site ever";

function getSiteInfo($name, $description) {
    return $name . " - " . $description;
}

echo getSiteInfo($siteName, $siteDescription); // Outputs: My WordPress Site - The best site ever</code></pre>
            </div>
            
            <div class="comparison-table">
                <h3>Why Parameters are Better than globals</h3>
                <table>
                    <tr>
                        <th>Using <code>global</code></th>
                        <th>Using Parameters</th>
                    </tr>
                    <tr>
                        <td>Creates hidden dependencies</td>
                        <td>Dependencies are explicit and clear</td>
                    </tr>
                    <tr>
                        <td>Harder to test functions in isolation</td>
                        <td>Easy to test with different inputs</td>
                    </tr>
                    <tr>
                        <td>Can lead to unexpected side effects</td>
                        <td>Function behavior is more predictable</td>
                    </tr>
                    <tr>
                        <td>Makes code harder to understand</td>
                        <td>Makes code more self-documenting</td>
                    </tr>
                </table>
            </div>
        </section>

        <section class="static-variables">
            <h2>Static Variables: Persistent Local Variables</h2>
            
            <p>Static variables provide a unique combination of local scope with persistent values. A static variable is initialized only once, and its value is preserved between function calls.</p>
            
            <div class="mermaid-diagram">
                <div class="mermaid">
                    sequenceDiagram
                    participant MS as Main Script
                    participant F as Function
                    participant S as Static Variable
                    
                    Note over S: Initial value: 0
                    MS->>F: First function call
                    F->>S: Increment to 1
                    F->>MS: Return 1
                    Note over S: Value persists: 1
                    MS->>F: Second function call
                    F->>S: Increment to 2
                    F->>MS: Return 2
                    Note over S: Value persists: 2
                    MS->>F: Third function call
                    F->>S: Increment to 3
                    F->>MS: Return 3
                </div>
            </div>
            
            <div class="example-box">
                <h3>Basic Static Variable Example</h3>
                <pre><code>function countVisits() {
    static $counter = 0; // Initialized only on first call
    $counter++;
    return $counter;
}

echo countVisits(); // Outputs: 1
echo countVisits(); // Outputs: 2
echo countVisits(); // Outputs: 3</code></pre>
            </div>

            <p>In this example, <code>$counter</code> is initialized to 0 only the first time the function is called. On subsequent calls, the initialization is skipped, and the previous value is retained.</p>
            
            <div class="example-box">
                <h3>Practical Static Variable Example</h3>
                <pre><code>function getUniqueID() {
    static $lastID = 0;
    $lastID++;
    return 'ID-' . sprintf('%04d', $lastID);
}

echo getUniqueID(); // Outputs: ID-0001
echo getUniqueID(); // Outputs: ID-0002
echo getUniqueID(); // Outputs: ID-0003</code></pre>
            </div>

            <p>Static variables are useful when you need to maintain state between function calls without resorting to global variables.</p>
        </section>

        <section class="wordpress-scope">
            <h2>Variable Scope in WordPress</h2>
            
            <p>WordPress has its own approach to managing variables and their scope. Understanding how WordPress handles variable scope is crucial for effective plugin and theme development.</p>
            
            <div class="example-box">
                <h3>WordPress Global Variables</h3>
                <pre><code>function my_theme_display_post_info() {
    global $post; // Access WordPress's global post object
    
    if (isset($post)) {
        echo 'Current post: ' . $post->post_title;
        echo 'Published on: ' . get_the_date();
    } else {
        echo 'No post found.';
    }
}

// Usage in a template file
if (have_posts()) :
    while (have_posts()) : the_post();
        my_theme_display_post_info();
    endwhile;
endif;</code></pre>
            </div>

            <p>WordPress uses global variables extensively, such as <code>$post</code>, <code>$wpdb</code> (for database access), and many others. While generally it's best to avoid globals, when working with WordPress, you often need to use the <code>global</code> keyword to access these important objects.</p>
            
            <div class="example-box">
                <h3>WordPress Functions that Set Global Variables</h3>
                <pre><code>// WordPress Loop Example
if (have_posts()) {
    while (have_posts()) {
        the_post(); // This function sets up the global $post variable
        
        // Now we can use functions that rely on the global $post
        the_title();
        the_content();
    }
}</code></pre>
            </div>

            <p>Many WordPress template functions like <code>the_post()</code>, <code>setup_postdata()</code>, and others set up global variables behind the scenes.</p>
        </section>

        <section class="globals-containers">
            <h2>Using Objects and Arrays as Global Containers</h2>
            
            <p>When you need to share data between parts of your application, using a dedicated global container object or array can be more organized than using multiple individual global variables.</p>
            
            <div class="example-box">
                <h3>Global Container Object Example</h3>
                <pre><code>// Create a global application container
class ThemeName_App {
    public $settings = [];
    public $cache = [];
    
    // Singleton pattern to ensure only one instance exists
    private static $instance = null;
    
    public static function get_instance() {
        if (null === self::$instance) {
            self::$instance = new self();
        }
        return self::$instance;
    }
    
    private function __construct() {
        // Set default settings
        $this->settings = [
            'site_color' => '#3498db',
            'show_sidebar' => true,
            'posts_per_page' => 10
        ];
    }
}

// Initialize the global container
function theme_app() {
    return ThemeName_App::get_instance();
}

// Usage in a function
function display_site_color() {
    $app = theme_app();
    echo 'Site color is: ' . $app->settings['site_color'];
}

// Change a setting
theme_app()->settings['site_color'] = '#e74c3c';

// Display the color
display_site_color(); // Outputs: Site color is: #e74c3c</code></pre>
            </div>

            <p>This pattern is commonly used in well-structured WordPress themes and plugins. It provides a clean way to access shared data without littering your code with individual global variables.</p>
        </section>

        <section class="variable-scope-best-practices">
            <h2>Variable Scope Best Practices</h2>
            
            <div class="best-practices">
                <h3>Do's and Don'ts</h3>
                <table>
                    <tr>
                        <th>Do ✅</th>
                        <th>Don't ❌</th>
                    </tr>
                    <tr>
                        <td>Use function parameters and return values to pass data</td>
                        <td>Rely on global variables when alternatives exist</td>
                    </tr>
                    <tr>
                        <td>Keep variables in the narrowest scope possible</td>
                        <td>Use variable names that might conflict with WordPress globals</td>
                    </tr>
                    <tr>
                        <td>Use static variables for maintaining state when appropriate</td>
                        <td>Create unnecessary static variables that could be regular locals</td>
                    </tr>
                    <tr>
                        <td>Document your use of global variables</td>
                        <td>Modify WordPress global variables without understanding implications</td>
                    </tr>
                    <tr>
                        <td>Use container objects or arrays for related globals</td>
                        <td>Create multiple individual global variables with similar purposes</td>
                    </tr>
                </table>
            </div>
            
            <div class="example-box">
                <h3>Good Practice Example</h3>
                <pre><code>/**
 * Get a formatted post title with optional prefix
 *
 * @param int $post_id The post ID (optional, uses current post if not provided)
 * @param string $prefix Optional text to prepend to the title
 * @return string The formatted post title
 */
function my_theme_get_formatted_title($post_id = null, $prefix = '') {
    // Get the post object without using globals
    $post = get_post($post_id);
    
    if (!$post) {
        return '';
    }
    
    $title = $post->post_title;
    
    // Format the title
    if (!empty($prefix)) {
        $title = $prefix . ': ' . $title;
    }
    
    return $title;
}

// Usage
echo my_theme_get_formatted_title(); // Uses current post
echo my_theme_get_formatted_title(123); // Uses post with ID 123
echo my_theme_get_formatted_title(null, 'Featured'); // Uses current post with prefix</code></pre>
            </div>

            <p>This function avoids using the global <code>$post</code> variable by using the <code>get_post()</code> function, which is more flexible and makes the function's dependencies clearer.</p>
        </section>

        <section class="variable-variables">
            <h2>Variable Variables and Dynamic Variable Names</h2>
            
            <p>PHP allows for variable variables, where the name of a variable is determined dynamically. This can be useful in some cases but needs to be used carefully.</p>
            
            <div class="example-box">
                <h3>Variable Variables Example</h3>
                <pre><code>$varName = "message";
$$varName = "Hello, WordPress Developer!";

// Now we can access the variable named "message" in two ways:
echo $message;   // Outputs: Hello, WordPress Developer!
echo $$varName;  // Outputs: Hello, WordPress Developer!</code></pre>
            </div>

            <p>In the context of variable scope, be aware that variable variables follow the same scope rules as regular variables. A variable variable created inside a function is still local to that function unless declared <code>global</code>.</p>
            
            <div class="example-box">
                <h3>Variable Variables in Functions</h3>
                <pre><code>function createDynamicVariables($prefix, $count) {
    for ($i = 1; $i <= $count; $i++) {
        $varName = $prefix . $i;
        $$varName = "Value " . $i;
        echo $varName . ": " . $$varName . "<br>";
    }
    // All these variables are local to the function
}

createDynamicVariables("item", 3);
// Outputs:
// item1: Value 1
// item2: Value 2
// item3: Value 3

// These variables don't exist outside the function
echo $item1 ?? "Variable doesn't exist"; // Outputs: Variable doesn't exist</code></pre>
            </div>

            <p>While variable variables can be powerful, they can also make code harder to understand and maintain. Use them sparingly and with clear documentation.</p>
        </section>

        <section class="closure-scope">
            <h2>Variables in Closures and Anonymous Functions</h2>
            
            <p>PHP closures and anonymous functions have special scope rules, particularly when it comes to accessing variables from the outer scope.</p>
            
            <div class="mermaid-diagram">
                <div class="mermaid">
                    graph TD
                    A[Outer Scope] --> B[Closure]
                    A --> C["$outerVar = 'Hello'"]
                    B --> D["function() use ($outerVar) {...}"]
                    B --> E["Closure's inner scope"]
                    
                    style A fill:#e3f2fd,stroke:#0d47a1,stroke-width:2px
                    style B fill:#fff8e1,stroke:#ff6f00,stroke-width:2px
                    style E fill:#e8f5e9,stroke:#1b5e20,stroke-width:2px
                </div>
            </div>
            
            <div class="example-box">
                <h3>Accessing Outer Variables with <code>use</code></h3>
                <pre><code>$siteName = "My WordPress Site";

$welcomeMessage = function() use ($siteName) {
    return "Welcome to $siteName!";
};

echo $welcomeMessage(); // Outputs: Welcome to My WordPress Site!</code></pre>
            </div>

            <p>The <code>use</code> keyword allows closures to access variables from the parent scope. Without it, the closure would not have access to <code>$siteName</code>.</p>
            
            <div class="example-box">
                <h3>Passing Variables by Reference</h3>
                <pre><code>$counter = 0;

$incrementCounter = function() use (&$counter) {
    $counter++;
    return $counter;
};

echo $incrementCounter(); // Outputs: 1
echo $incrementCounter(); // Outputs: 2
echo $counter;           // Outputs: 2 (the outer variable was modified)</code></pre>
            </div>

            <p>By default, variables are passed to closures by value (as copies). Adding the <code>&</code> symbol passes them by reference, allowing the closure to modify the original variable.</p>
            
            <div class="wordpress-example">
                <h3>Closures in WordPress: Add_filter Example</h3>
                <pre><code>$theme_prefix = 'mytheme_';

// Add a filter that uses the theme prefix in a closure
add_filter('the_title', function($title) use ($theme_prefix) {
    if (is_front_page()) {
        return $theme_prefix . $title;
    }
    return $title;
});

// Another example with multiple outer variables
$show_author = true;
$author_prefix = 'Written by ';

add_filter('the_content', function($content) use ($show_author, $author_prefix) {
    global $post;
    
    if ($show_author && isset($post)) {
        $author = get_the_author_meta('display_name', $post->post_author);
        $author_info = '<p class="author-info">' . $author_prefix . $author . '</p>';
        return $content . $author_info;
    }
    
    return $content;
});</code></pre>
            </div>

            <p>Closures are commonly used in WordPress when adding hooks and filters to customize theme and plugin behavior.</p>
        </section>

        <section class="scope-inheritance">
            <h2>Scope Inheritance and Include Files</h2>
            
            <p>When you include or require files in PHP, the included file inherits the variable scope of the line it was called from.</p>
            
            <div class="example-box">
                <h3>Scope Inheritance Example</h3>
                <pre><code>// In main.php
$color = "blue";

function testScope() {
    $localVar = "inside function";
    include 'included.php'; // The included file inherits function scope
}

include 'included.php'; // The included file inherits global scope

testScope();

// In included.php
echo "Color is: $color<br>";
echo "Local variable: " . (isset($localVar) ? $localVar : "not available") . "<br>";

// Output when included in global scope:
// Color is: blue
// Local variable: not available

// Output when included in function scope:
// Color is:  (empty because $color is not available in function scope)
// Local variable: inside function</code></pre>
            </div>

            <p>This behavior is important to understand when organizing WordPress theme files, as included template parts will have access to variables defined in the parent template.</p>
            
            <div class="wordpress-example">
                <h3>WordPress Template Parts Example</h3>
                <pre><code>// In single.php
$post_class = 'featured-post';
$show_author = true;

// Include template part - variables defined above are available in the included file
get_template_part('template-parts/content', get_post_type());

// In template-parts/content.php
if (isset($post_class)) {
    // $post_class is available because it was defined in the parent template
    echo '&lt;article class="' . esc_attr($post_class) . '"&gt;';
} else {
    echo '&lt;article&gt;';
}

the_title();
the_content();

if (isset($show_author) && $show_author) {
    echo '&lt;div class="author-bio"&gt;';
    the_author_meta('description');
    echo '&lt;/div&gt;';
}

echo '&lt;/article&gt;';</code></pre>
            </div>

            <p>When designing WordPress themes, you can use this scope inheritance to pass variables to included template parts.</p>
        </section>

        <section class="debugging-scope">
            <h2>Debugging Scope Issues</h2>
            
            <p>Scope-related bugs can be tricky to identify and fix. Here are some common issues and techniques for debugging them.</p>
            
            <div class="example-box">
                <h3>Common Scope-Related Bugs</h3>
                <pre><code>// Bug 1: Forgetting to use the global keyword
$settings = ['color' => 'blue', 'size' => 'large'];

function updateSettings() {
    // Intended to modify the global variable, but creates a new local variable instead
    $settings['color'] = 'red';
}

updateSettings();
echo $settings['color']; // Still outputs: blue

// Fix: Use the global keyword
function fixedUpdateSettings() {
    global $settings;
    $settings['color'] = 'red';
}

// Bug 2: Scope confusion in included files
function loadTemplate() {
    $showHeader = true;
    include 'header.php'; // header.php tries to use $showHeader
}

// In a different function
function processTemplate() {
    include 'header.php'; // header.php tries to use $showHeader but it doesn't exist here
}

// Fix: Pass variables explicitly or use function parameters</code></pre>
            </div>

            <div class="debugging-tools">
                <h3>Debugging Tools and Techniques</h3>
                <ul>
                    <li><strong>Using var_dump() and print_r():</strong> To inspect variable contents and see if they have the expected values</li>
                    <li><strong>isset() and empty():</strong> To check if variables exist or have values</li>
                    <li><strong>Debug backtrace:</strong> To see the function call chain and locate where variables might be defined</li>
                    <li><strong>WordPress debug mode:</strong> Setting WP_DEBUG to true to catch more warnings and notices</li>
                </ul>
                <pre><code>// Debugging variable existence and content
function debugFunction() {
    // Check if a global variable exists and show its value
    if (isset($GLOBALS['wp_query'])) {
        echo "wp_query exists in global scope<br>";
        echo "Current post count: " . $GLOBALS['wp_query']->post_count;
    } else {
        echo "wp_query does not exist in global scope";
    }
    
    // See all available global variables
    echo "<pre>";
    print_r(array_keys($GLOBALS));
    echo "</pre>";
}

// Using debug backtrace to understand scope chain
function whereAmI() {
    $trace = debug_backtrace();
    echo "<pre>";
    print_r($trace);
    echo "</pre>";
}</code></pre>
            </div>
        </section>

        <section class="practical-examples">
            <h2>Real-World WordPress Scope Examples</h2>
            
            <div class="example-box">
                <h3>Theme Options Manager</h3>
                <pre><code>/**
 * Theme Options Manager with proper scope handling
 */
class MyTheme_Options {
    // Static property to store the single instance
    private static $instance = null;
    
    // Private property to store options
    private $options = [];
    
    /**
     * Get the single instance or create it
     */
    public static function get_instance() {
        if (null === self::$instance) {
            self::$instance = new self();
        }
        return self::$instance;
    }
    
    /**
     * Private constructor to enforce singleton pattern
     */
    private function __construct() {
        // Load options from database
        $this->options = get_option('mytheme_options', []);
    }
    
    /**
     * Get an option value
     */
    public function get($key, $default = null) {
        return isset($this->options[$key]) ? $this->options[$key] : $default;
    }
    
    /**
     * Set an option value
     */
    public function set($key, $value) {
        $this->options[$key] = $value;
        return $this;
    }
    
    /**
     * Save all options to database
     */
    public function save() {
        return update_option('mytheme_options', $this->options);
    }
}

// Helper function to get the options instance
function mytheme_options() {
    return MyTheme_Options::get_instance();
}

// Usage examples
function display_theme_color() {
    $color = mytheme_options()->get('primary_color', '#3498db');
    echo "Theme color: $color";
}

function save_theme_settings() {
    // Update option and save
    mytheme_options()
        ->set('primary_color', '#2980b9')
        ->set('show_sidebar', true)
        ->save();
}</code></pre>
            </div>

            <div class="example-box">
                <h3>WordPress Widget with Static Counter</h3>
                <pre><code>/**
 * Example widget using static variables for counting instances
 */
class MyTheme_Recent_Posts_Widget extends WP_Widget {
    // Static counter to track widget instances
    private static $instance_count = 0;
    
    /**
     * Widget constructor
     */
    public function __construct() {
        // Increment static counter
        self::$instance_count++;
        
        parent::__construct(
            'mytheme_recent_posts',
            'MyTheme Recent Posts',
            ['description' => 'Displays recent posts with custom formatting.']
        );
    }
    
    /**
     * Widget frontend display
     */
    public function widget($args, $instance) {
        // Get widget instance number
        $widget_id = self::$instance_count;
        
        echo $args['before_widget'];
        
        if (!empty($instance['title'])) {
            echo $args['before_title'] . apply_filters('widget_title', $instance['title']) . $args['after_title'];
        }
        
        // Number of posts to show
        $number = !empty($instance['number']) ? absint($instance['number']) : 5;
        
        // Query recent posts
        $recent_posts = new WP_Query([
            'posts_per_page' => $number,
            'post_status' => 'publish',
            'ignore_sticky_posts' => true
        ]);
        
        if ($recent_posts->have_posts()) {
            echo '&lt;ul class="mytheme-recent-posts mytheme-recent-posts-' . $widget_id . '"&gt;';
            
            while ($recent_posts->have_posts()) {
                $recent_posts->the_post();
                echo '&lt;li&gt;';
                echo '&lt;a href="' . get_permalink() . '"&gt;' . get_the_title() . '&lt;/a&gt;';
                echo '&lt;/li&gt;';
            }
            
            echo '&lt;/ul&gt;';
            
            // Restore original post data
            wp_reset_postdata();
        }
        
        echo $args['after_widget'];
    }
    
    /**
     * Widget admin form
     */
    public function form($instance) {
        $title = !empty($instance['title']) ? $instance['title'] : 'Recent Posts';
        $number = !empty($instance['number']) ? absint($instance['number']) : 5;
        
        // Widget form fields
        // ...
    }
    
    /**
     * Widget update/save
     */
    public function update($new_instance, $old_instance) {
        $instance = [];
        $instance['title'] = sanitize_text_field($new_instance['title']);
        $instance['number'] = absint($new_instance['number']);
        
        return $instance;
    }
}</code></pre>
            </div>
        </section>

        <section class="practice-exercises">
            <h2>Practice Exercises</h2>
            
            <div class="exercise">
                <h3>Exercise 1: Function Scope Understanding</h3>
                <p>Look at the following code and predict the output. Then write and test the code to verify your answer.</p>
                <pre><code>$message = "Hello World";

function modifyMessage() {
    $message = "Hello PHP";
    echo "Inside function: $message\n";
}

modifyMessage();
echo "Outside function: $message\n";</code></pre>
            </div>
            
            <div class="exercise">
                <h3>Exercise 2: WordPress Post Counter</h3>
                <p>Create a function that uses a static variable to count how many times a specific post has been displayed during the current page load. The function should:</p>
                <ul>
                    <li>Accept a post ID parameter</li>
                    <li>Keep track of how many times each post ID has been counted</li>
                    <li>Return the current count for the given post ID</li>
                </ul>
            </div>
            
            <div class="exercise">
                <h3>Exercise 3: Theme Settings Manager</h3>
                <p>Create a simple theme settings manager class that:</p>
                <ul>
                    <li>Follows the singleton pattern to ensure only one instance exists</li>
                    <li>Provides methods to get and set theme settings</li>
                    <li>Has a proper scope encapsulation (using private/protected properties)</li>
                    <li>Includes a helper function to access the manager from any WordPress template</li>
                </ul>
            </div>
        </section>

        <section class="further-reading">
            <h2>Further Reading</h2>
            
            <ul>
                <li><a href="https://www.php.net/manual/en/language.variables.scope.php">PHP Manual: Variable Scope</a></li>
                <li><a href="https://www.php.net/manual/en/language.variables.variable.php">PHP Manual: Variable Variables</a></li>
                <li><a href="https://developer.wordpress.org/reference/functions/get_post/">WordPress Function Reference: get_post()</a></li>
                <li><a href="https://developer.wordpress.org/reference/functions/get_query_var/">WordPress Function Reference: get_query_var()</a></li>
            </ul>
        </section>

        <section class="next-topics">
            <h2>Coming Up Next</h2>
            
            <p>In our next lecture, we'll explore anonymous functions and closures in PHP - powerful features for creating flexible, reusable code in your WordPress development.</p>
            
            <div class="preview-topics">
                <ul>
                    <li>Creating and using anonymous functions</li>
                    <li>Closures and variable capture</li>
                    <li>Using anonymous functions with WordPress hooks</li>
                    <li>Practical applications in WordPress development</li>
                </ul>
            </div>
        </section>
    </main>
    
    <footer>
        <p>&copy; 2025 PHP WordPress Development Course</p>
   
    </footer>
</body>
</html>
