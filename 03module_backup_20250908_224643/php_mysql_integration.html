<!DOCTYPE html>
<html lang="en">
 <head>
  <meta charset="utf-8"/>
  <meta content="width=device-width, initial-scale=1.0" name="viewport"/>
  <meta content="ie=edge" http-equiv="X-UA-Compatible"/>
  <!-- SEO Meta Tags -->
  <title>PHP MySQL Integration - PDO vs MySQLi - PHP WordPress Course</title>
  <meta content="Master PHP MySQL integration with PDO and MySQLi, prepared statements, security best practices, and connection management" name="description"/>
  <meta content="PHP, MySQL, PDO, MySQLi, prepared statements, SQL injection, database security" name="keywords"/>
  <meta content="PHP WordPress Course" name="author"/>
  <link href="/assets/css/main.css" rel="stylesheet"/>
  <link href="/assets/css/sidebar-enhanced.css" rel="stylesheet"/>
  <link href="/assets/css/sidebar-toggle.css" rel="stylesheet"/>
  <!-- Favicon -->
  <link href="/favicon.png" rel="icon" type="image/png"/>
  <link href="/favicon.png" rel="apple-touch-icon"/>
  <!-- CSS -->
  <link href="/assets/css/sidebar-enhanced.css" rel="stylesheet"/>
  <link href="/assets/css/sidebar-toggle.css" rel="stylesheet"/>
 </head>
 <body>
  <!-- Skip to main content -->
  <a class="sr-only" href="#main-content">Skip to main content</a>
  <div class="page-wrapper">
   <!-- Header -->
   <header class="site-header" role="banner">
    <div class="header-container">
     <div class="site-branding">
      <a class="site-logo" href="/">
       <h1 class="site-title">PHP WordPress Development</h1>
      </a>
     </div>
     <nav aria-label="Main navigation" class="main-navigation" role="navigation">
      <button aria-expanded="false" aria-label="Toggle navigation" class="mobile-menu-btn">
       <span>
       </span>
       <span>
       </span>
       <span>
       </span>
      </button>
      <div class="nav-menu">
       <ul class="nav-list">
        <li class="nav-item">
         <a class="nav-link" href="/">Home</a>
        </li>
        <li class="nav-item dropdown">
         <button aria-haspopup="true" class="nav-link dropdown-toggle active">Modules</button>
         <div class="dropdown-menu">
          <a class="dropdown-item" href="/module1.html">Module 1: Web Fundamentals</a>
          <a class="dropdown-item" href="/module2.html">Module 2: PHP Fundamentals</a>
          <a class="dropdown-item active" href="/module3.html">Module 3: MySQL Database</a>
          <a class="dropdown-item" href="/module4.html">Module 4: WordPress &amp; Docker</a>
          <a class="dropdown-item" href="/module5.html">Module 5: Theme Development</a>
          <a class="dropdown-item" href="/module6.html">Module 6: Plugin Development</a>
          <a class="dropdown-item" href="/module7.html">Module 7: Advanced WordPress</a>
          <a class="dropdown-item" href="/module8.html">Module 8: Deployment</a>
          <a class="dropdown-item" href="/module9.html">Module 9: Final Project</a>
         </div>
        </li>
        <li class="nav-item">
         <a class="nav-link" href="/resources.html">Resources</a>
        </li>
        <li class="nav-item">
         <a class="nav-link" href="/about.html">About</a>
        </li>
       </ul>
      </div>
     </nav>
     <div class="search-container">
      <div class="search-input-wrapper">
       <svg class="search-icon" fill="currentColor" height="20" viewbox="0 0 20 20" width="20">
        <path clip-rule="evenodd" d="M8 4a4 4 0 100 8 4 4 0 000-8zM2 8a6 6 0 1110.89 3.476l4.817 4.817a1 1 0 01-1.414 1.414l-4.816-4.816A6 6 0 012 8z" fill-rule="evenodd">
        </path>
       </svg>
       <input aria-label="Search" class="search-input" placeholder="Search lessons..." type="search"/>
      </div>
      <div class="search-results">
      </div>
     </div>
    </div>
   </header>
   <!-- Progress Bar -->
   <div class="progress-container">
    <div class="progress-header">
     <h2 class="progress-title">Course Progress</h2>
     <span class="progress-text">Loading...</span>
    </div>
    <div class="progress-bar">
     <div class="progress-bar-fill">
      <span class="progress-bar-text">
      </span>
     </div>
    </div>
   </div>
   <!-- Breadcrumb -->
   <nav aria-label="Breadcrumb" class="breadcrumb container">
    <ol class="breadcrumb-list">
     <li class="breadcrumb-item">
      <a href="/">Home</a>
      <span class="breadcrumb-separator">/</span>
     </li>
     <li class="breadcrumb-item">
      <a href="/module3.html">Module 3</a>
      <span class="breadcrumb-separator">/</span>
     </li>
     <li class="breadcrumb-item">
      <span aria-current="page">PHP MySQL Integration</span>
     </li>
    </ol>
   </nav>
   <!-- Main Content -->
   <main class="main-content" id="main-content" role="main">
    <div class="container">
     <div class="content-with-sidebar">
      <!-- Sidebar -->
      <aside class="sidebar">
       <div class="sidebar-nav">
        <h3 class="sidebar-title">Module 3: MySQL Database</h3>
        <div class="sidebar-section">
         <h4 class="sidebar-section-title">Session 1: Introduction to Databases</h4>
         <ul class="sidebar-menu">
          <li>
           <a class="sidebar-link" href="/03module/database_concepts_terminology.html">Database concepts and terminology</a>
          </li>
          <li>
           <a class="sidebar-link" href="/03module/types_of_databases.html">Types of databases (relational vs. non-relational)</a>
          </li>
          <li>
           <a class="sidebar-link" href="/03module/introduction_to_mysql.html">Introduction to MySQL</a>
          </li>
          <li>
           <a class="sidebar-link" href="/03module/mysql_xampp_mamp.html">MySQL in XAMPP/MAMP environment</a>
          </li>
          <li>
           <a class="sidebar-link" href="/03module/using_phpmyadmin.html">Using phpMyAdmin</a>
          </li>
          <li>
           <a class="sidebar-link" href="/03module/creating_databases_tables.html">Creating databases and tables</a>
          </li>
          <li>
           <a class="sidebar-link" href="/03module/homework_database_schema.html">Homework: Create a database schema for a simple application</a>
          </li>
         </ul>
        </div>
        <div class="sidebar-section">
         <h4 class="sidebar-section-title">Session 2: Database Design</h4>
         <ul class="sidebar-menu">
          <li>
           <a class="sidebar-link" href="/03module/data_modeling_concepts.html">Data modeling concepts</a>
          </li>
          <li>
           <a class="sidebar-link" href="/03module/entity_relationship_diagrams.html">Entity-Relationship diagrams</a>
          </li>
          <li>
           <a class="sidebar-link" href="/03module/normalization_principles.html">Normalization principles (1NF, 2NF, 3NF)</a>
          </li>
          <li>
           <a class="sidebar-link" href="/03module/primary_foreign_keys.html">Primary keys and foreign keys</a>
          </li>
          <li>
           <a class="sidebar-link" href="/03module/indexes_importance.html">Indexes and their importance</a>
          </li>
          <li>
           <a class="sidebar-link" href="/03module/database_constraints.html">Database constraints</a>
          </li>
          <li>
           <a class="sidebar-link" href="/03module/homework_database_design.html">Homework: Design a normalized database for an e-commerce website</a>
          </li>
         </ul>
        </div>
        <div class="sidebar-section">
         <h4 class="sidebar-section-title">Session 3: SQL Fundamentals</h4>
         <ul class="sidebar-menu">
          <li>
           <a class="sidebar-link" href="/03module/sql_syntax_conventions.html">SQL syntax and conventions</a>
          </li>
          <li>
           <a class="sidebar-link" href="/03module/mysql_data_types.html">Data types in MySQL</a>
          </li>
          <li>
           <a class="sidebar-link" href="/03module/database_structure_ddl.html">Creating and modifying database structures (CREATE, ALTER, DROP)</a>
          </li>
          <li>
           <a class="sidebar-link" href="/03module/insert_update_delete.html">Basic data manipulation (INSERT, UPDATE, DELETE)</a>
          </li>
          <li>
           <a class="sidebar-link" href="/03module/select_queries.html">Simple queries with SELECT</a>
          </li>
          <li>
           <a class="sidebar-link" href="/03module/where_filtering.html">Filtering data with WHERE</a>
          </li>
          <li>
           <a class="sidebar-link" href="/03module/order_by_sorting.html">Sorting results with ORDER BY</a>
          </li>
          <li>
           <a class="sidebar-link" href="/03module/homework_sql_queries.html">Homework: Write SQL queries to manipulate data in your database</a>
          </li>
         </ul>
        </div>
        <div class="sidebar-section">
         <h4 class="sidebar-section-title">Session 4: Advanced SQL</h4>
         <ul class="sidebar-menu">
          <li>
           <a class="sidebar-link" href="/03module/sql_joins.html">Joins (INNER, LEFT, RIGHT, FULL)</a>
          </li>
          <li>
           <a class="sidebar-link" href="/03module/aggregate_functions.html">Aggregating data (COUNT, SUM, AVG, MIN, MAX)</a>
          </li>
          <li>
           <a class="sidebar-link" href="/03module/group_by_having.html">Grouping data with GROUP BY</a>
          </li>
          <li>
           <a class="sidebar-link" href="/03module/having_deep_dive.html">Filtering groups with HAVING</a>
          </li>
          <li>
           <a class="sidebar-link" href="/03module/subqueries.html">Subqueries</a>
          </li>
          <li>
           <a class="sidebar-link" href="/03module/views.html">Views</a>
          </li>
          <li>
           <a class="sidebar-link" href="/03module/transactions.html">Transactions</a>
          </li>
          <li>
           <a class="sidebar-link" href="/03module/stored_procedures.html">Stored procedures and functions</a>
          </li>
          <li>
           <a class="sidebar-link" href="/03module/homework_sql_queries.html">Homework: Write complex SQL queries with joins and aggregations</a>
          </li>
         </ul>
        </div>
        <div class="sidebar-section">
         <h4 class="sidebar-section-title">Session 5: PHP and MySQL Integration</h4>
         <ul class="sidebar-menu">
          <li>
           <a class="sidebar-link" href="/03module/connecting_mysql.html">Connecting to MySQL with PHP</a>
          </li>
          <li>
           <a class="sidebar-link" href="/03module/executing_queries.html">Executing SQL queries through PHP</a>
          </li>
          <li>
           <a class="sidebar-link" href="/03module/prepared_statements.html">Prepared statements and security concerns</a>
          </li>
          <li>
           <a class="sidebar-link" href="/03module/crud_operations.html">CRUD operations in PHP applications</a>
          </li>
          <li>
           <a class="sidebar-link" href="/03module/result_sets.html">Handling results sets</a>
          </li>
          <li>
           <a class="sidebar-link" href="/03module/error_debugging.html">Error handling and debugging</a>
          </li>
          <li class="active">
           <a class="sidebar-link active" href="/03module/php_mysql_integration.html">Final Project: Build a complete data-driven PHP application with MySQL backend</a>
          </li>
         </ul>
        </div>
        <div class="sidebar-section">
         <h4 class="sidebar-section-title">Quick Links</h4>
         <ul class="sidebar-menu">
          <li>
           <a class="sidebar-link" href="/module3.html">Module Overview</a>
          </li>
          <li>
           <a class="sidebar-link prev-session" href="/module2.html">← Prev: Module 2</a>
          </li>
          <li>
           <a class="sidebar-link next-session" href="/module4.html">Next: Module 4 →</a>
          </li>
          <li>
           <a class="sidebar-link" href="/resources.html">Resources</a>
          </li>
         </ul>
        </div>
       </div>
      </aside>
      <!-- Main Lesson Content -->
      <article class="lesson-content">
       <header class="lesson-header">
        <h1>PHP and MySQL Integration</h1>
        <div class="lesson-meta">
         <div class="lesson-meta-item">
          <svg fill="currentColor" height="20" width="20">
           <path d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z">
           </path>
          </svg>
          <span>Duration: 95 minutes</span>
         </div>
         <div class="lesson-meta-item">
          <svg fill="currentColor" height="20" width="20">
           <path d="M12 14l9-5-9-5-9 5 9 5z">
           </path>
          </svg>
          <span>Module 3: Session 5</span>
         </div>
        </div>
       </header>
       <!-- Learning Objectives -->
       <div class="lesson-objectives">
        <h2>Learning Objectives</h2>
        <ul>
         <li>Understand PDO vs MySQLi differences and use cases</li>
         <li>Establish secure database connections</li>
         <li>Execute queries safely with prepared statements</li>
         <li>Handle database errors and exceptions</li>
         <li>Implement transaction management in PHP</li>
         <li>Prevent SQL injection attacks</li>
         <li>Manage connection pooling and performance</li>
         <li>Build database abstraction layers</li>
        </ul>
       </div>
       <!-- Lesson Body -->
       <div class="lesson-body">
        <section>
         <h2>PDO vs MySQLi Comparison</h2>
         <p class="lead">PHP offers two main ways to connect to MySQL: PDO (PHP Data Objects) and MySQLi. Let's understand their differences! 🔌</p>
         <canvas height="450" id="comparisonCanvas" width="600">
         </canvas>
         <script>const ctx = document.getElementById('comparisonCanvas').getContext('2d');
                                    
                                    // Title
                                    ctx.font = 'bold 18px Arial';
                                    ctx.fillStyle = '#1f2937';
                                    ctx.fillText('PDO vs MySQLi Comparison', 180, 30);
                                    
                                    // PDO box
                                    ctx.fillStyle = '#dbeafe';
                                    ctx.fillRect(50, 60, 250, 200);
                                    ctx.strokeStyle = '#2563eb';
                                    ctx.lineWidth = 2;
                                    ctx.strokeRect(50, 60, 250, 200);
                                    
                                    ctx.fillStyle = '#1e40af';
                                    ctx.font = 'bold 14px Arial';
                                    ctx.fillText('PDO', 160, 85);
                                    ctx.fillText('(PHP Data Objects)', 105, 100);
                                    
                                    ctx.fillStyle = '#059669';
                                    ctx.font = '11px Arial';
                                    ctx.fillText('✓ Multiple databases', 60, 125);
                                    ctx.fillText('✓ Named parameters', 60, 145);
                                    ctx.fillText('✓ Object-oriented only', 60, 165);
                                    ctx.fillText('✓ Better error handling', 60, 185);
                                    ctx.fillText('✓ Prepared statements', 60, 205);
                                    ctx.fillText('✓ Fetch into objects', 60, 225);
                                    ctx.fillStyle = '#dc2626';
                                    ctx.fillText('✗ Slightly slower', 60, 245);
                                    
                                    // MySQLi box
                                    ctx.fillStyle = '#dcfce7';
                                    ctx.fillRect(320, 60, 250, 200);
                                    ctx.strokeStyle = '#16a34a';
                                    ctx.strokeRect(320, 60, 250, 200);
                                    
                                    ctx.fillStyle = '#166534';
                                    ctx.font = 'bold 14px Arial';
                                    ctx.fillText('MySQLi', 415, 85);
                                    ctx.fillText('(MySQL Improved)', 375, 100);
                                    
                                    ctx.fillStyle = '#059669';
                                    ctx.font = '11px Arial';
                                    ctx.fillText('✓ MySQL specific', 330, 125);
                                    ctx.fillText('✓ Slightly faster', 330, 145);
                                    ctx.fillText('✓ Procedural & OOP', 330, 165);
                                    ctx.fillText('✓ Async queries', 330, 185);
                                    ctx.fillText('✓ Prepared statements', 330, 205);
                                    ctx.fillText('✓ Store procedures', 330, 225);
                                    ctx.fillStyle = '#dc2626';
                                    ctx.fillText('✗ MySQL only', 330, 245);
                                    
                                    // Recommendation box
                                    ctx.fillStyle = '#fef3c7';
                                    ctx.fillRect(50, 280, 520, 150);
                                    ctx.strokeStyle = '#ca8a04';
                                    ctx.strokeRect(50, 280, 520, 150);
                                    
                                    ctx.fillStyle = '#92400e';
                                    ctx.font = 'bold 14px Arial';
                                    ctx.fillText('Recommendations', 250, 305);
                                    
                                    ctx.fillStyle = '#374151';
                                    ctx.font = '11px Arial';
                                    
                                    ctx.fillText('Use PDO when:', 60, 330);
                                    ctx.fillText('• You might switch databases', 60, 345);
                                    ctx.fillText('• You prefer consistent API', 60, 360);
                                    ctx.fillText('• Working with multiple databases', 60, 375);
                                    ctx.fillText('• Building portable applications', 60, 390);
                                    
                                    ctx.fillText('Use MySQLi when:', 330, 330);
                                    ctx.fillText('• MySQL-specific features needed', 330, 345);
                                    ctx.fillText('• Performance is critical', 330, 360);
                                    ctx.fillText('• Legacy code compatibility', 330, 375);
                                    ctx.fillText('• Async operations required', 330, 390);
                                    
                                    ctx.fillStyle = '#dc2626';
                                    ctx.font = 'bold 12px Arial';
                                    ctx.fillText('⚠️ Never use deprecated mysql_* functions!', 150, 415);</script>
         <div class="alert alert-info">
          <div class="alert-icon">💡</div>
          <div class="alert-content">
           <div class="alert-title">Quick Decision Guide</div>
           <div class="alert-message">
            <ul>
             <li>
              <strong>PDO:</strong>Better for new projects, portable code, multiple databases</li>
             <li>
              <strong>MySQLi:</strong>Better for MySQL-specific features, slight performance edge</li>
             <li>Both support prepared statements (essential for security)</li>
             <li>WordPress uses its own $wpdb abstraction (based on MySQLi)</li>
            </ul>
           </div>
          </div>
         </div>
        </section>
        <section>
         <h2>PDO Connection and Basic Operations</h2>
         <div class="mermaid">graph TB
                                        CONNECT[Connect to DB] --&gt; PREPARE[Prepare Statement]
                                        PREPARE --&gt; BIND[Bind Parameters]
                                        BIND --&gt; EXECUTE[Execute Query]
                                        EXECUTE --&gt; FETCH[Fetch Results]
                                        FETCH --&gt; CLOSE[Close Connection]
                                        
                                        EXECUTE --&gt; ERROR[Handle Errors]
                                        ERROR --&gt; LOG[Log Error]
                                        
                                        style CONNECT fill:#dcfce7
                                        style PREPARE fill:#dbeafe
                                        style EXECUTE fill:#fef3c7
                                        style ERROR fill:#fee2e2</div>
         <div class="real_world_example">
          <h3>PDO Examples</h3>
          <pre><code class="language-php">&lt;?php
// ========================================
// PDO CONNECTION
// ========================================

// Configuration
$config = [
    'host' =&gt; 'localhost',
    'dbname' =&gt; 'myapp',
    'username' =&gt; 'dbuser',
    'password' =&gt; 'securepass123',
    'charset' =&gt; 'utf8mb4'
];

try {
    // Create connection
    $dsn = "mysql:host={$config['host']};dbname={$config['dbname']};charset={$config['charset']}";
    
    $options = [
        PDO::ATTR_ERRMODE =&gt; PDO::ERRMODE_EXCEPTION,
        PDO::ATTR_DEFAULT_FETCH_MODE =&gt; PDO::FETCH_ASSOC,
        PDO::ATTR_EMULATE_PREPARES =&gt; false,
    ];
    
    $pdo = new PDO($dsn, $config['username'], $config['password'], $options);
    
} catch (PDOException $e) {
    // Log error (don't expose details to users)
    error_log("Connection failed: " . $e-&gt;getMessage());
    die("Database connection error");
}

// ========================================
// SELECT QUERY WITH PREPARED STATEMENTS
// ========================================

try {
    // Prepare statement with named parameters
    $sql = "SELECT * FROM users WHERE email = :email AND status = :status";
    $stmt = $pdo-&gt;prepare($sql);
    
    // Bind and execute
    $stmt-&gt;execute([
        ':email' =&gt; 'user@example.com',
        ':status' =&gt; 'active'
    ]);
    
    // Fetch single row
    $user = $stmt-&gt;fetch();
    
    // Or fetch all rows
    $users = $stmt-&gt;fetchAll();
    
    // Fetch column
    $sql = "SELECT COUNT(*) FROM users WHERE status = :status";
    $stmt = $pdo-&gt;prepare($sql);
    $stmt-&gt;execute([':status' =&gt; 'active']);
    $count = $stmt-&gt;fetchColumn();
    
} catch (PDOException $e) {
    error_log("Query failed: " . $e-&gt;getMessage());
}

// ========================================
// INSERT WITH PREPARED STATEMENTS
// ========================================

try {
    $sql = "INSERT INTO users (username, email, password_hash, created_at) 
            VALUES (:username, :email, :password, NOW())";
    
    $stmt = $pdo-&gt;prepare($sql);
    
    $result = $stmt-&gt;execute([
        ':username' =&gt; 'johndoe',
        ':email' =&gt; 'john@example.com',
        ':password' =&gt; password_hash('secret123', PASSWORD_DEFAULT)
    ]);
    
    if ($result) {
        $userId = $pdo-&gt;lastInsertId();
        echo "User created with ID: " . $userId;
    }
    
} catch (PDOException $e) {
    error_log("Insert failed: " . $e-&gt;getMessage());
}

// ========================================
// UPDATE WITH PREPARED STATEMENTS
// ========================================

try {
    $sql = "UPDATE users 
            SET last_login = NOW(), login_count = login_count + 1 
            WHERE id = :id";
    
    $stmt = $pdo-&gt;prepare($sql);
    $stmt-&gt;execute([':id' =&gt; $userId]);
    
    $affectedRows = $stmt-&gt;rowCount();
    echo "Updated $affectedRows rows";
    
} catch (PDOException $e) {
    error_log("Update failed: " . $e-&gt;getMessage());
}

// ========================================
// TRANSACTIONS
// ========================================

try {
    $pdo-&gt;beginTransaction();
    
    // Debit account
    $stmt = $pdo-&gt;prepare("UPDATE accounts SET balance = balance - :amount WHERE id = :id");
    $stmt-&gt;execute([':amount' =&gt; 100, ':id' =&gt; 1]);
    
    // Credit account
    $stmt = $pdo-&gt;prepare("UPDATE accounts SET balance = balance + :amount WHERE id = :id");
    $stmt-&gt;execute([':amount' =&gt; 100, ':id' =&gt; 2]);
    
    // Log transaction
    $stmt = $pdo-&gt;prepare("INSERT INTO transactions (from_id, to_id, amount) VALUES (?, ?, ?)");
    $stmt-&gt;execute([1, 2, 100]);
    
    $pdo-&gt;commit();
    echo "Transaction successful";
    
} catch (Exception $e) {
    $pdo-&gt;rollBack();
    error_log("Transaction failed: " . $e-&gt;getMessage());
}

// ========================================
// FETCH MODES
// ========================================

// Fetch as object
$stmt = $pdo-&gt;prepare("SELECT * FROM users WHERE id = ?");
$stmt-&gt;execute([$userId]);
$user = $stmt-&gt;fetch(PDO::FETCH_OBJ);
echo $user-&gt;email;  // Object property access

// Fetch into class
class User {
    public $id;
    public $username;
    public $email;
}

$stmt-&gt;setFetchMode(PDO::FETCH_CLASS, 'User');
$user = $stmt-&gt;fetch();

// Fetch key-value pairs
$sql = "SELECT id, username FROM users";
$users = $pdo-&gt;query($sql)-&gt;fetchAll(PDO::FETCH_KEY_PAIR);</code></pre>
         </div>
        </section>
        <section>
         <h2>MySQLi Connection and Operations</h2>
         <div class="best_practice">
          <h3>MySQLi Examples</h3>
          <pre><code class="language-php">&lt;?php
// ========================================
// MYSQLI CONNECTION (OBJECT-ORIENTED)
// ========================================

$mysqli = new mysqli('localhost', 'username', 'password', 'database');

// Check connection
if ($mysqli-&gt;connect_error) {
    die("Connection failed: " . $mysqli-&gt;connect_error);
}

// Set charset
$mysqli-&gt;set_charset("utf8mb4");

// ========================================
// MYSQLI PREPARED STATEMENTS
// ========================================

// SELECT query
$sql = "SELECT id, username, email FROM users WHERE status = ? AND role = ?";
$stmt = $mysqli-&gt;prepare($sql);

if ($stmt) {
    // Bind parameters (s = string, i = integer, d = double, b = blob)
    $status = 'active';
    $role = 'admin';
    $stmt-&gt;bind_param("ss", $status, $role);
    
    // Execute
    $stmt-&gt;execute();
    
    // Bind result variables
    $stmt-&gt;bind_result($id, $username, $email);
    
    // Fetch results
    while ($stmt-&gt;fetch()) {
        echo "User: $username ($email)\n";
    }
    
    $stmt-&gt;close();
}

// ========================================
// INSERT WITH MYSQLI
// ========================================

$sql = "INSERT INTO users (username, email, password_hash) VALUES (?, ?, ?)";
$stmt = $mysqli-&gt;prepare($sql);

if ($stmt) {
    $username = 'johndoe';
    $email = 'john@example.com';
    $password = password_hash('secret123', PASSWORD_DEFAULT);
    
    $stmt-&gt;bind_param("sss", $username, $email, $password);
    
    if ($stmt-&gt;execute()) {
        $userId = $mysqli-&gt;insert_id;
        echo "User created with ID: " . $userId;
    } else {
        echo "Error: " . $stmt-&gt;error;
    }
    
    $stmt-&gt;close();
}

// ========================================
// MYSQLI TRANSACTIONS
// ========================================

// Start transaction
$mysqli-&gt;autocommit(FALSE);

try {
    // Multiple queries
    $mysqli-&gt;query("UPDATE accounts SET balance = balance - 100 WHERE id = 1");
    $mysqli-&gt;query("UPDATE accounts SET balance = balance + 100 WHERE id = 2");
    
    // Check for errors
    if ($mysqli-&gt;error) {
        throw new Exception($mysqli-&gt;error);
    }
    
    // Commit transaction
    $mysqli-&gt;commit();
    echo "Transaction successful";
    
} catch (Exception $e) {
    // Rollback on error
    $mysqli-&gt;rollback();
    echo "Transaction failed: " . $e-&gt;getMessage();
}

// Reset autocommit
$mysqli-&gt;autocommit(TRUE);

// ========================================
// PROCEDURAL STYLE
// ========================================

$connection = mysqli_connect('localhost', 'username', 'password', 'database');

if (!$connection) {
    die("Connection failed: " . mysqli_connect_error());
}

// Query
$result = mysqli_query($connection, "SELECT * FROM users");

// Fetch results
while ($row = mysqli_fetch_assoc($result)) {
    echo $row['username'] . "\n";
}

// Free result
mysqli_free_result($result);

// Close connection
mysqli_close($connection);

// ========================================
// CALLING STORED PROCEDURES
// ========================================

// Call procedure with OUT parameters
$stmt = $mysqli-&gt;prepare("CALL GetUserStats(?, @total_orders, @total_spent)");
$userId = 123;
$stmt-&gt;bind_param("i", $userId);
$stmt-&gt;execute();

// Get OUT parameters
$result = $mysqli-&gt;query("SELECT @total_orders, @total_spent");
$row = $result-&gt;fetch_row();
echo "Orders: {$row[0]}, Spent: {$row[1]}";

// ========================================
// MULTI-QUERY
// ========================================

$sql = "SELECT * FROM users; SELECT * FROM orders";

if ($mysqli-&gt;multi_query($sql)) {
    do {
        // Process result set
        if ($result = $mysqli-&gt;store_result()) {
            while ($row = $result-&gt;fetch_assoc()) {
                // Process row
            }
            $result-&gt;free();
        }
    } while ($mysqli-&gt;next_result());
}</code></pre>
         </div>
        </section>
        <section>
         <h2>Security Best Practices</h2>
         <canvas height="400" id="securityCanvas" width="600">
         </canvas>
         <script>const sCtx = document.getElementById('securityCanvas').getContext('2d');
                                    
                                    // Title
                                    sCtx.font = 'bold 16px Arial';
                                    sCtx.fillStyle = '#1f2937';
                                    sCtx.fillText('SQL Injection Prevention', 220, 30);
                                    
                                    // Bad practice
                                    sCtx.fillStyle = '#fee2e2';
                                    sCtx.fillRect(50, 60, 250, 120);
                                    sCtx.strokeStyle = '#dc2626';
                                    sCtx.lineWidth = 2;
                                    sCtx.strokeRect(50, 60, 250, 120);
                                    
                                    sCtx.fillStyle = '#991b1b';
                                    sCtx.font = 'bold 12px Arial';
                                    sCtx.fillText('❌ NEVER DO THIS', 120, 80);
                                    
                                    sCtx.fillStyle = '#374151';
                                    sCtx.font = '10px Courier';
                                    sCtx.fillText('$id = $_GET["id"];', 60, 105);
                                    sCtx.fillText('$sql = "SELECT * FROM users', 60, 120);
                                    sCtx.fillText('        WHERE id = $id";', 60, 135);
                                    sCtx.fillText('// SQL Injection vulnerable!', 60, 155);
                                    
                                    // Good practice
                                    sCtx.fillStyle = '#dcfce7';
                                    sCtx.fillRect(320, 60, 250, 120);
                                    sCtx.strokeStyle = '#16a34a';
                                    sCtx.strokeRect(320, 60, 250, 120);
                                    
                                    sCtx.fillStyle = '#166534';
                                    sCtx.font = 'bold 12px Arial';
                                    sCtx.fillText('✅ ALWAYS DO THIS', 380, 80);
                                    
                                    sCtx.fillStyle = '#374151';
                                    sCtx.font = '10px Courier';
                                    sCtx.fillText('$stmt = $pdo->prepare(', 330, 105);
                                    sCtx.fillText('  "SELECT * FROM users', 330, 120);
                                    sCtx.fillText('   WHERE id = :id");', 330, 135);
                                    sCtx.fillText('$stmt->execute(["id" =>$id]);', 330, 155);
                                    
                                    // Security checklist
                                    sCtx.fillStyle = '#fef3c7';
                                    sCtx.fillRect(50, 200, 520, 180);
                                    sCtx.strokeStyle = '#ca8a04';
                                    sCtx.strokeRect(50, 200, 520, 180);
                                    
                                    sCtx.fillStyle = '#92400e';
                                    sCtx.font = 'bold 12px Arial';
                                    sCtx.fillText('Security Checklist', 250, 220);
                                    
                                    sCtx.fillStyle = '#374151';
                                    sCtx.font = '11px Arial';
                                    
                                    const checklist = [
                                        '✓ Always use prepared statements',
                                        '✓ Never concatenate user input into queries',
                                        '✓ Validate and sanitize all input',
                                        '✓ Use least privilege database users',
                                        '✓ Store passwords hashed (password_hash())',
                                        '✓ Use HTTPS for sensitive data',
                                        '✓ Implement rate limiting',
                                        '✓ Log suspicious activities',
                                        '✓ Keep software updated',
                                        '✓ Use parameterized stored procedures'
                                    ];
                                    
                                    checklist.forEach((item, i) =>{
                                        const x = i< 5 ? 60 : 320;
                                        const y = 245 + ((i % 5) * 20);
                                        sCtx.fillText(item, x, y);
                                    });</script>
         <div class="homework">
          <h3>Security Implementation</h3>
          <pre><code class="language-php">&lt;?php
// ========================================
// INPUT VALIDATION AND SANITIZATION
// ========================================

class DatabaseSecurity {
    private $pdo;
    
    public function __construct(PDO $pdo) {
        $this-&gt;pdo = $pdo;
    }
    
    /**
     * Safe user authentication
     */
    public function authenticateUser($email, $password) {
        // Validate email
        if (!filter_var($email, FILTER_VALIDATE_EMAIL)) {
            return false;
        }
        
        // Prepare statement
        $stmt = $this-&gt;pdo-&gt;prepare(
            "SELECT id, username, password_hash 
             FROM users 
             WHERE email = :email 
             AND status = 'active'
             LIMIT 1"
        );
        
        $stmt-&gt;execute([':email' =&gt; $email]);
        $user = $stmt-&gt;fetch();
        
        // Verify password
        if ($user &amp;&amp; password_verify($password, $user['password_hash'])) {
            // Update last login
            $this-&gt;updateLastLogin($user['id']);
            
            // Return user data (exclude password)
            unset($user['password_hash']);
            return $user;
        }
        
        // Log failed attempt
        $this-&gt;logFailedLogin($email);
        return false;
    }
    
    /**
     * Prevent SQL injection in dynamic queries
     */
    public function safeSearch($searchTerm, $category = null) {
        // Base query
        $sql = "SELECT * FROM products WHERE 1=1";
        $params = [];
        
        // Add search condition
        if (!empty($searchTerm)) {
            // Sanitize for LIKE query
            $searchTerm = str_replace(['%', '_'], ['\%', '\_'], $searchTerm);
            $sql .= " AND (name LIKE :search OR description LIKE :search)";
            $params[':search'] = "%{$searchTerm}%";
        }
        
        // Add category filter
        if ($category !== null) {
            // Validate category is integer
            if (!is_numeric($category)) {
                throw new InvalidArgumentException("Invalid category");
            }
            $sql .= " AND category_id = :category";
            $params[':category'] = (int)$category;
        }
        
        // Execute safely
        $stmt = $this-&gt;pdo-&gt;prepare($sql);
        $stmt-&gt;execute($params);
        
        return $stmt-&gt;fetchAll();
    }
    
    /**
     * Safe dynamic ORDER BY
     */
    public function getUsers($orderBy = 'id', $direction = 'ASC') {
        // Whitelist allowed columns
        $allowedColumns = ['id', 'username', 'email', 'created_at'];
        $allowedDirections = ['ASC', 'DESC'];
        
        // Validate input
        if (!in_array($orderBy, $allowedColumns)) {
            $orderBy = 'id';
        }
        
        if (!in_array(strtoupper($direction), $allowedDirections)) {
            $direction = 'ASC';
        }
        
        // Safe to use now (not from user input directly)
        $sql = "SELECT * FROM users ORDER BY {$orderBy} {$direction}";
        
        return $this-&gt;pdo-&gt;query($sql)-&gt;fetchAll();
    }
    
    /**
     * Prevent mass assignment
     */
    public function updateUser($userId, array $data) {
        // Whitelist allowed fields
        $allowedFields = ['username', 'email', 'phone'];
        
        // Filter data
        $filtered = array_intersect_key(
            $data,
            array_flip($allowedFields)
        );
        
        // Build UPDATE query
        $fields = [];
        foreach ($filtered as $key =&gt; $value) {
            $fields[] = "{$key} = :{$key}";
        }
        
        if (empty($fields)) {
            return false;
        }
        
        $sql = "UPDATE users SET " . implode(', ', $fields) . 
               " WHERE id = :id";
        
        $filtered['id'] = $userId;
        
        $stmt = $this-&gt;pdo-&gt;prepare($sql);
        return $stmt-&gt;execute($filtered);
    }
    
    /**
     * Rate limiting
     */
    private function checkRateLimit($identifier) {
        $stmt = $this-&gt;pdo-&gt;prepare(
            "SELECT COUNT(*) FROM login_attempts 
             WHERE ip_address = :ip 
             AND attempted_at &gt; DATE_SUB(NOW(), INTERVAL 15 MINUTE)"
        );
        
        $stmt-&gt;execute([':ip' =&gt; $identifier]);
        $attempts = $stmt-&gt;fetchColumn();
        
        if ($attempts &gt; 5) {
            throw new Exception("Too many attempts. Please try later.");
        }
    }
    
    /**
     * Log security events
     */
    private function logSecurityEvent($event, $details) {
        $stmt = $this-&gt;pdo-&gt;prepare(
            "INSERT INTO security_log (event_type, details, ip_address, created_at)
             VALUES (:event, :details, :ip, NOW())"
        );
        
        $stmt-&gt;execute([
            ':event' =&gt; $event,
            ':details' =&gt; json_encode($details),
            ':ip' =&gt; $_SERVER['REMOTE_ADDR'] ?? 'unknown'
        ]);
    }
}

// ========================================
// CONNECTION SECURITY
// ========================================

// Store credentials outside web root
// config/database.php (above public_html)
return [
    'host' =&gt; getenv('DB_HOST'),
    'dbname' =&gt; getenv('DB_NAME'),
    'username' =&gt; getenv('DB_USER'),
    'password' =&gt; getenv('DB_PASS'),
    'options' =&gt; [
        PDO::ATTR_ERRMODE =&gt; PDO::ERRMODE_EXCEPTION,
        PDO::ATTR_DEFAULT_FETCH_MODE =&gt; PDO::FETCH_ASSOC,
        PDO::ATTR_EMULATE_PREPARES =&gt; false,
        PDO::MYSQL_ATTR_SSL_CA =&gt; '/path/to/ca-cert.pem',
    ]
];

// ========================================
// ERROR HANDLING
// ========================================

class DatabaseConnection {
    private static $instance = null;
    private $pdo;
    
    private function __construct() {
        try {
            $config = require '../config/database.php';
            
            $dsn = "mysql:host={$config['host']};dbname={$config['dbname']};charset=utf8mb4";
            
            $this-&gt;pdo = new PDO(
                $dsn,
                $config['username'],
                $config['password'],
                $config['options']
            );
            
        } catch (PDOException $e) {
            // Log error, don't expose details
            error_log("Database connection failed: " . $e-&gt;getMessage());
            
            // Show user-friendly error
            if (PHP_SAPI === 'cli') {
                die("Database connection error\n");
            } else {
                http_response_code(500);
                include '../templates/error-500.php';
                exit;
            }
        }
    }
    
    public static function getInstance() {
        if (self::$instance === null) {
            self::$instance = new self();
        }
        return self::$instance-&gt;pdo;
    }
    
    // Prevent cloning
    private function __clone() {}
    
    // Prevent unserialization
    public function __wakeup() {
        throw new Exception("Cannot unserialize singleton");
    }
}</code></pre>
         </div>
        </section>
        <!-- Practice Exercise -->
        <section>
         <h2>Practice Exercise</h2>
         <div class="alert alert-success">
          <div class="alert-icon">💻</div>
          <div class="alert-content">
           <div class="alert-title">PHP MySQL Integration Challenges</div>
           <div class="alert-message">Build these PHP applications:<ol>
             <li>Create a secure user registration and login system</li>
             <li>Build a CRUD application with PDO</li>
             <li>Implement a shopping cart with transactions</li>
             <li>Create a search system with pagination</li>
             <li>Build an admin panel with role-based access</li>
             <li>Implement database backup and restore</li>
             <li>Create an API with database integration</li>
             <li>Build a database migration system</li>
            </ol>
           </div>
          </div>
         </div>
        </section>
        <!-- Resources -->
        <section class="resources">
         <h2>Additional Resources</h2>
         <ul>
          <li>
           <a href="https://www.php.net/manual/en/book.pdo.php" target="_blank">PHP PDO Documentation</a>
          </li>
          <li>
           <a href="https://www.php.net/manual/en/book.mysqli.php" target="_blank">PHP MySQLi Documentation</a>
          </li>
          <li>
           <a href="https://phpdelusions.net/pdo" target="_blank">PDO Tutorial</a>
          </li>
          <li>
           <a href="https://owasp.org/www-community/attacks/SQL_Injection" target="_blank">OWASP SQL Injection</a>
          </li>
         </ul>
        </section>
       </div>
       <!-- Lesson Navigation -->
       <div class="lesson-navigation">
        <a class="lesson-nav-button prev" href="/03module/stored_procedures.html">
         <svg fill="currentColor" height="20" viewbox="0 0 20 20" width="20">
          <path d="M12.707 5.293a1 1 0 010 1.414L9.414 10l3.293 3.293a1 1 0 01-1.414 1.414l-4-4a1 1 0 010-1.414l4-4a1 1 0 011.414 0z">
          </path>
         </svg>
         <span>
          <small>Previous</small>
          <br/>Stored Procedures</span>
        </a>
        <button class="complete-lesson-btn">Mark as Complete</button>
        <a class="lesson-nav-button next" href="/module4.html">
         <span>
          <small>Next Module</small>
          <br/>WordPress &amp; Docker</span>
         <svg fill="currentColor" height="20" viewbox="0 0 20 20" width="20">
          <path d="M7.293 14.707a1 1 0 010-1.414L10.586 10 7.293 6.707a1 1 0 011.414-1.414l4 4a1 1 0 010 1.414l-4 4a1 1 0 01-1.414 0z">
          </path>
         </svg>
        </a>
       </div>
      </article>
     </div>
    </div>
   </main>
   <!-- Footer -->
   <footer class="site-footer" role="contentinfo">
    <div class="footer-container">
     <div class="footer-content">
      <div class="footer-section footer-about">
       <h3>PHP WordPress Development</h3>
       <p>Complete Web Development Course</p>
      </div>
      <div class="footer-section">
       <h4>Quick Links</h4>
       <ul class="footer-links">
        <li>
         <a href="/">Home</a>
        </li>
        <li>
         <a class="active" href="/module3.html">Module 3</a>
        </li>
        <li>
         <a href="/resources.html">Resources</a>
        </li>
       </ul>
      </div>
      <div class="footer-section">
       <h4>Support</h4>
       <ul class="footer-links">
        <li>
         <a href="/help.html">Help Center</a>
        </li>
        <li>
         <a href="/faq.html">FAQ</a>
        </li>
        <li>
         <a href="/contact.html">Contact</a>
        </li>
       </ul>
      </div>
     </div>
     <div class="footer-bottom">
      <div class="footer-bottom-content">
       <p class="copyright">© 2025 PHP WordPress Development Course</p>
       <nav class="footer-bottom-links">
        <a href="/privacy.html">Privacy</a>
        <span class="separator">|</span>
        <a href="/terms.html">Terms</a>
       </nav>
      </div>
     </div>
    </div>
   </footer>
  </div>
  <!-- Back to Top -->
  <button aria-label="Back to top" class="back-to-top" id="back-to-top">
   <svg fill="none" height="24" stroke="currentColor" stroke-width="2" viewbox="0 0 24 24" width="24">
    <path d="M12 19V5M12 5l-7 7M12 5l7 7">
    </path>
   </svg>
  </button>
  <!-- JavaScript -->
  <script src="/assets/js/navigation.js">
  </script>
  <script src="/assets/js/site-config.js">
  </script>
  <script src="/assets/js/sidebar-toggle.js">
  </script>
  <!-- Universal Mermaid Fix (Enhanced) -->
  <!-- Universal Mermaid Fix -->
  <script src="/assets/js/mermaid-universal-fix.js">
  </script>
 </body>
</html>
