<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    
    <!-- SEO Meta Tags -->
    <title>Creating Custom Blocks - PHP WordPress Course</title>
    <meta name="description" content="Learn to create custom Gutenberg blocks from scratch. Master block attributes, controls, and saving mechanisms.">
    <meta name="keywords" content="WordPress, Gutenberg, custom blocks, block development, React">
    <meta name="author" content="PHP WordPress Course">
    
    <!-- Open Graph Tags -->
    <meta property="og:title" content="Creating Custom Blocks">
    <meta property="og:description" content="Build powerful custom blocks for WordPress">
    <meta property="og:type" content="article">
    
    <!-- Favicon -->
    <link rel="icon" type="image/png" href="/favicon.png">
    <link rel="apple-touch-icon" href="/favicon.png">
    
    <!-- CSS -->
    <link rel="stylesheet" href="/assets/css/main.css">
    
    <!-- Prism.js for syntax highlighting -->
    <link href="/assets/css/prism.css" rel="stylesheet">
</head>
<body>
    <!-- Skip to main content -->
    <a href="#main-content" class="sr-only">Skip to main content</a>
    
    <div class="page-wrapper">
        <!-- Header -->
        <header class="site-header" role="banner">
            <div class="header-container">
                <div class="site-branding">
                    <a href="/" class="site-logo">
                        <h1 class="site-title">PHP WordPress Development</h1>
                    </a>
                </div>
                
                <nav class="main-navigation" role="navigation" aria-label="Main navigation">
                    <button class="mobile-menu-btn" aria-label="Toggle navigation" aria-expanded="false">
                        <span></span>
                        <span></span>
                        <span></span>
                    </button>
                    
                    <div class="nav-menu">
                        <ul class="nav-list">
                            <li class="nav-item"><a href="/" class="nav-link">Home</a></li>
                            <li class="nav-item dropdown">
                                <button class="nav-link dropdown-toggle active" aria-haspopup="true">Modules</button>
                                <div class="dropdown-menu">
                                    <a href="/module1.html" class="dropdown-item">Module 1: Web Fundamentals</a>
                                    <a href="/module2.html" class="dropdown-item">Module 2: PHP Fundamentals</a>
                                    <a href="/module3.html" class="dropdown-item">Module 3: MySQL Database</a>
                                    <a href="/module4.html" class="dropdown-item">Module 4: WordPress & Docker</a>
                                    <a href="/module5.html" class="dropdown-item">Module 5: Theme Development</a>
                                    <a href="/module6.html" class="dropdown-item">Module 6: Plugin Development</a>
                                    <a href="/module7.html" class="dropdown-item active">Module 7: Advanced WordPress</a>
                                    <a href="/module8.html" class="dropdown-item">Module 8: Deployment</a>
                                    <a href="/module9.html" class="dropdown-item">Module 9: Final Project</a>
                                </div>
                            </li>
                            <li class="nav-item"><a href="/resources.html" class="nav-link">Resources</a></li>
                            <li class="nav-item"><a href="/about.html" class="nav-link">About</a></li>
                        </ul>
                    </div>
                </nav>
                
                <div class="search-container">
                    <div class="search-input-wrapper">
                        <svg class="search-icon" width="20" height="20" viewBox="0 0 20 20" fill="currentColor">
                            <path fill-rule="evenodd" d="M8 4a4 4 0 100 8 4 4 0 000-8zM2 8a6 6 0 1110.89 3.476l4.817 4.817a1 1 0 01-1.414 1.414l-4.816-4.816A6 6 0 012 8z" clip-rule="evenodd" />
                        </svg>
                        <input type="search" class="search-input" placeholder="Search lessons..." aria-label="Search">
                    </div>
                    <div class="search-results"></div>
                </div>
            </div>
        </header>
        
        <!-- Progress Bar -->
        <div class="progress-container">
            <div class="progress-header">
                <h2 class="progress-title">Course Progress</h2>
                <span class="progress-text">Loading...</span>
            </div>
            <div class="progress-bar">
                <div class="progress-bar-fill">
                    <span class="progress-bar-text"></span>
                </div>
            </div>
        </div>
        
        <!-- Breadcrumb -->
        <nav class="breadcrumb container" aria-label="Breadcrumb">
            <ol class="breadcrumb-list">
                <li class="breadcrumb-item">
                    <a href="/">Home</a>
                    <span class="breadcrumb-separator">/</span>
                </li>
                <li class="breadcrumb-item">
                    <a href="/module7.html">Module 7</a>
                    <span class="breadcrumb-separator">/</span>
                </li>
                <li class="breadcrumb-item">
                    <span aria-current="page">Creating Custom Blocks</span>
                </li>
            </ol>
        </nav>
        
        <!-- Main Content -->
        <main id="main-content" class="main-content" role="main">
            <div class="container">
                <!-- Lesson Header -->
                <div class="lesson-header">
                    <h1 class="lesson-title">Creating Custom Blocks</h1>
                    <p class="lesson-subtitle">Build powerful, reusable blocks for the WordPress editor</p>
                </div>
                
                <!-- Learning Objectives -->
                <div class="lesson-objectives">
                    <h2>Learning Objectives</h2>
                    <p>By the end of this lesson, you will be able to:</p>
                    <ul>
                        <li>Create static and dynamic blocks</li>
                        <li>Work with block attributes and controls</li>
                        <li>Implement RichText and MediaUpload components</li>
                        <li>Build blocks with InnerBlocks</li>
                        <li>Create server-side rendered blocks</li>
                        <li>Handle block validation and migration</li>
                    </ul>
                </div>
                
                <!-- Lesson Body -->
                <div class="lesson-body">
                    <!-- Basic Block Creation -->
                    <section>
                        <h2>Basic Block Structure</h2>
                        
                        <h3>Simple Static Block</h3>
                        <pre><code class="language-javascript">
/**
 * Simple custom block with basic functionality
 */
import { registerBlockType } from '@wordpress/blocks';
import { __ } from '@wordpress/i18n';
import { useBlockProps, RichText, BlockControls, AlignmentToolbar } from '@wordpress/block-editor';
import './editor.scss';
import './style.scss';

registerBlockType('myplugin/simple-block', {
    title: __('Simple Block', 'myplugin'),
    description: __('A simple custom block', 'myplugin'),
    category: 'common',
    icon: 'smiley',
    keywords: [
        __('simple', 'myplugin'),
        __('custom', 'myplugin')
    ],
    
    attributes: {
        content: {
            type: 'string',
            source: 'html',
            selector: 'p'
        },
        alignment: {
            type: 'string',
            default: 'none'
        }
    },
    
    example: {
        attributes: {
            content: __('This is an example of the simple block', 'myplugin'),
            alignment: 'center'
        }
    },
    
    edit: ({ attributes, setAttributes }) => {
        const { content, alignment } = attributes;
        const blockProps = useBlockProps({
            className: alignment ? `has-text-align-${alignment}` : ''
        });
        
        return (
            <>
                <BlockControls>
                    <AlignmentToolbar
                        value={alignment}
                        onChange={(newAlignment) => 
                            setAttributes({ 
                                alignment: newAlignment === undefined ? 'none' : newAlignment 
                            })
                        }
                    />
                </BlockControls>
                
                <div {...blockProps}>
                    <RichText
                        tagName="p"
                        value={content}
                        onChange={(newContent) => setAttributes({ content: newContent })}
                        placeholder={__('Write your content...', 'myplugin')}
                    />
                </div>
            </>
        );
    },
    
    save: ({ attributes }) => {
        const { content, alignment } = attributes;
        const blockProps = useBlockProps.save({
            className: alignment ? `has-text-align-${alignment}` : ''
        });
        
        return (
            <div {...blockProps}>
                <RichText.Content tagName="p" value={content} />
            </div>
        );
    }
});
                        </code></pre>
                    </section>
                    
                    <!-- Advanced Block with Controls -->
                    <section>
                        <h2>Advanced Block with Inspector Controls</h2>
                        
                        <h3>Feature-Rich Block</h3>
                        <pre><code class="language-javascript">
/**
 * Advanced block with multiple controls and settings
 */
import { registerBlockType } from '@wordpress/blocks';
import { __ } from '@wordpress/i18n';
import {
    useBlockProps,
    RichText,
    InspectorControls,
    BlockControls,
    AlignmentToolbar,
    MediaUpload,
    MediaUploadCheck,
    PanelColorSettings,
    ContrastChecker,
    withColors,
    getColorClassName
} from '@wordpress/block-editor';
import {
    PanelBody,
    TextControl,
    ToggleControl,
    RangeControl,
    SelectControl,
    Button,
    ButtonGroup,
    Icon,
    ResponsiveWrapper,
    ToolbarGroup,
    ToolbarButton
} from '@wordpress/components';
import { compose } from '@wordpress/compose';
import { useState, useEffect } from '@wordpress/element';

const AdvancedBlock = ({
    attributes,
    setAttributes,
    backgroundColor,
    textColor,
    setBackgroundColor,
    setTextColor,
    className
}) => {
    const {
        title,
        content,
        mediaId,
        mediaUrl,
        mediaAlt,
        alignment,
        showTitle,
        titleLevel,
        columns,
        spacing,
        borderRadius,
        hasDropCap
    } = attributes;
    
    const [isEditingURL, setIsEditingURL] = useState(false);
    
    const blockProps = useBlockProps({
        className: `${className} columns-${columns}`,
        style: {
            backgroundColor: backgroundColor.color,
            color: textColor.color,
            padding: `${spacing}px`,
            borderRadius: `${borderRadius}px`
        }
    });
    
    const onSelectMedia = (media) => {
        setAttributes({
            mediaId: media.id,
            mediaUrl: media.url,
            mediaAlt: media.alt
        });
    };
    
    const removeMedia = () => {
        setAttributes({
            mediaId: 0,
            mediaUrl: '',
            mediaAlt: ''
        });
    };
    
    const TitleTag = `h${titleLevel}`;
    
    return (
        <>
            <BlockControls>
                <ToolbarGroup>
                    <AlignmentToolbar
                        value={alignment}
                        onChange={(newAlignment) => setAttributes({ alignment: newAlignment })}
                    />
                </ToolbarGroup>
                <ToolbarGroup>
                    <ToolbarButton
                        icon="edit"
                        title={__('Edit Media', 'myplugin')}
                        onClick={() => setIsEditingURL(true)}
                        isActive={isEditingURL}
                    />
                </ToolbarGroup>
            </BlockControls>
            
            <InspectorControls>
                <PanelBody title={__('Block Settings', 'myplugin')} initialOpen={true}>
                    <ToggleControl
                        label={__('Show Title', 'myplugin')}
                        checked={showTitle}
                        onChange={(value) => setAttributes({ showTitle: value })}
                    />
                    
                    {showTitle && (
                        <RangeControl
                            label={__('Title Level', 'myplugin')}
                            value={titleLevel}
                            onChange={(value) => setAttributes({ titleLevel: value })}
                            min={1}
                            max={6}
                        />
                    )}
                    
                    <RangeControl
                        label={__('Columns', 'myplugin')}
                        value={columns}
                        onChange={(value) => setAttributes({ columns: value })}
                        min={1}
                        max={4}
                    />
                    
                    <ToggleControl
                        label={__('Drop Cap', 'myplugin')}
                        checked={hasDropCap}
                        onChange={(value) => setAttributes({ hasDropCap: value })}
                    />
                </PanelBody>
                
                <PanelBody title={__('Spacing', 'myplugin')} initialOpen={false}>
                    <RangeControl
                        label={__('Padding', 'myplugin')}
                        value={spacing}
                        onChange={(value) => setAttributes({ spacing: value })}
                        min={0}
                        max={100}
                    />
                    
                    <RangeControl
                        label={__('Border Radius', 'myplugin')}
                        value={borderRadius}
                        onChange={(value) => setAttributes({ borderRadius: value })}
                        min={0}
                        max={50}
                    />
                </PanelBody>
                
                <PanelColorSettings
                    title={__('Color Settings', 'myplugin')}
                    colorSettings={[
                        {
                            value: backgroundColor.color,
                            onChange: setBackgroundColor,
                            label: __('Background Color', 'myplugin')
                        },
                        {
                            value: textColor.color,
                            onChange: setTextColor,
                            label: __('Text Color', 'myplugin')
                        }
                    ]}
                >
                    <ContrastChecker
                        backgroundColor={backgroundColor.color}
                        textColor={textColor.color}
                    />
                </PanelColorSettings>
            </InspectorControls>
            
            <div {...blockProps}>
                {showTitle && (
                    <RichText
                        tagName={TitleTag}
                        value={title}
                        onChange={(value) => setAttributes({ title: value })}
                        placeholder={__('Enter title...', 'myplugin')}
                        className="block-title"
                    />
                )}
                
                <div className="block-media">
                    <MediaUploadCheck>
                        <MediaUpload
                            onSelect={onSelectMedia}
                            allowedTypes={['image']}
                            value={mediaId}
                            render={({ open }) => (
                                <>
                                    {!mediaId && (
                                        <Button
                                            className="block-media-button"
                                            onClick={open}
                                            variant="secondary"
                                        >
                                            <Icon icon="format-image" />
                                            {__('Add Image', 'myplugin')}
                                        </Button>
                                    )}
                                    {mediaId && (
                                        <div className="block-media-wrapper">
                                            <img
                                                src={mediaUrl}
                                                alt={mediaAlt}
                                                className="block-media-image"
                                            />
                                            <Button
                                                onClick={removeMedia}
                                                variant="link"
                                                isDestructive
                                                className="block-media-remove"
                                            >
                                                {__('Remove Image', 'myplugin')}
                                            </Button>
                                        </div>
                                    )}
                                </>
                            )}
                        />
                    </MediaUploadCheck>
                </div>
                
                <RichText
                    tagName="div"
                    value={content}
                    onChange={(value) => setAttributes({ content: value })}
                    placeholder={__('Write content...', 'myplugin')}
                    className={`block-content ${hasDropCap ? 'has-drop-cap' : ''}`}
                    multiline="p"
                />
            </div>
        </>
    );
};

const AdvancedBlockEdit = compose([
    withColors('backgroundColor', 'textColor')
])(AdvancedBlock);

registerBlockType('myplugin/advanced-block', {
    title: __('Advanced Block', 'myplugin'),
    description: __('An advanced block with multiple features', 'myplugin'),
    category: 'widgets',
    icon: 'admin-customizer',
    supports: {
        html: false,
        anchor: true,
        customClassName: true,
        align: ['wide', 'full']
    },
    
    attributes: {
        title: {
            type: 'string',
            source: 'html',
            selector: '.block-title'
        },
        content: {
            type: 'string',
            source: 'html',
            selector: '.block-content'
        },
        mediaId: {
            type: 'number',
            default: 0
        },
        mediaUrl: {
            type: 'string',
            default: ''
        },
        mediaAlt: {
            type: 'string',
            default: ''
        },
        alignment: {
            type: 'string',
            default: 'none'
        },
        showTitle: {
            type: 'boolean',
            default: true
        },
        titleLevel: {
            type: 'number',
            default: 2
        },
        columns: {
            type: 'number',
            default: 1
        },
        spacing: {
            type: 'number',
            default: 20
        },
        borderRadius: {
            type: 'number',
            default: 0
        },
        hasDropCap: {
            type: 'boolean',
            default: false
        },
        backgroundColor: {
            type: 'string'
        },
        textColor: {
            type: 'string'
        },
        customBackgroundColor: {
            type: 'string'
        },
        customTextColor: {
            type: 'string'
        }
    },
    
    edit: AdvancedBlockEdit,
    
    save: ({ attributes }) => {
        const {
            title,
            content,
            mediaUrl,
            mediaAlt,
            alignment,
            showTitle,
            titleLevel,
            columns,
            spacing,
            borderRadius,
            hasDropCap,
            backgroundColor,
            textColor,
            customBackgroundColor,
            customTextColor
        } = attributes;
        
        const TitleTag = `h${titleLevel}`;
        
        const backgroundClass = getColorClassName('background-color', backgroundColor);
        const textClass = getColorClassName('color', textColor);
        
        const blockProps = useBlockProps.save({
            className: `columns-${columns} ${backgroundClass || ''} ${textClass || ''}`,
            style: {
                backgroundColor: !backgroundClass ? customBackgroundColor : undefined,
                color: !textClass ? customTextColor : undefined,
                padding: `${spacing}px`,
                borderRadius: `${borderRadius}px`,
                textAlign: alignment !== 'none' ? alignment : undefined
            }
        });
        
        return (
            <div {...blockProps}>
                {showTitle && title && (
                    <RichText.Content
                        tagName={TitleTag}
                        value={title}
                        className="block-title"
                    />
                )}
                
                {mediaUrl && (
                    <div className="block-media">
                        <img src={mediaUrl} alt={mediaAlt} className="block-media-image" />
                    </div>
                )}
                
                <RichText.Content
                    tagName="div"
                    value={content}
                    className={`block-content ${hasDropCap ? 'has-drop-cap' : ''}`}
                />
            </div>
        );
    }
});
                        </code></pre>
                    </section>
                    
                    <!-- Dynamic Block -->
                    <section>
                        <h2>Dynamic Server-Side Rendered Block</h2>
                        
                        <h3>Dynamic Posts Block</h3>
                        <pre><code class="language-javascript">
/**
 * Dynamic block that renders on the server
 */
import { registerBlockType } from '@wordpress/blocks';
import { __ } from '@wordpress/i18n';
import {
    useBlockProps,
    InspectorControls
} from '@wordpress/block-editor';
import {
    PanelBody,
    RangeControl,
    SelectControl,
    ToggleControl,
    TextControl,
    QueryControls
} from '@wordpress/components';
import { useSelect } from '@wordpress/data';
import ServerSideRender from '@wordpress/server-side-render';
import { useState, useEffect } from '@wordpress/element';
import apiFetch from '@wordpress/api-fetch';
import { addQueryArgs } from '@wordpress/url';

const DynamicPostsEdit = ({ attributes, setAttributes }) => {
    const {
        postsToShow,
        displayPostContent,
        displayPostDate,
        displayFeaturedImage,
        postLayout,
        columns,
        order,
        orderBy,
        categories,
        selectedAuthor,
        excerptLength
    } = attributes;
    
    const [categoriesList, setCategoriesList] = useState([]);
    const [authorsList, setAuthorsList] = useState([]);
    
    const blockProps = useBlockProps();
    
    // Fetch categories
    useEffect(() => {
        apiFetch({
            path: '/wp/v2/categories?per_page=-1'
        }).then((cats) => {
            const categoryOptions = cats.map((cat) => ({
                label: cat.name,
                value: cat.id
            }));
            setCategoriesList(categoryOptions);
        });
    }, []);
    
    // Fetch authors
    useEffect(() => {
        apiFetch({
            path: '/wp/v2/users?who=authors'
        }).then((users) => {
            const authorOptions = users.map((user) => ({
                label: user.name,
                value: user.id
            }));
            setAuthorsList(authorOptions);
        });
    }, []);
    
    // Get posts for preview count
    const posts = useSelect((select) => {
        const { getEntityRecords } = select('core');
        const query = {
            per_page: postsToShow,
            order,
            orderby: orderBy,
            _embed: true
        };
        
        if (categories && categories.length) {
            query.categories = categories;
        }
        
        if (selectedAuthor) {
            query.author = selectedAuthor;
        }
        
        return getEntityRecords('postType', 'post', query);
    }, [postsToShow, order, orderBy, categories, selectedAuthor]);
    
    return (
        <>
            <InspectorControls>
                <PanelBody title={__('Post Settings', 'myplugin')}>
                    <QueryControls
                        numberOfItems={postsToShow}
                        onNumberOfItemsChange={(value) => 
                            setAttributes({ postsToShow: value })
                        }
                        order={order}
                        onOrderChange={(value) => setAttributes({ order: value })}
                        orderBy={orderBy}
                        onOrderByChange={(value) => setAttributes({ orderBy: value })}
                        categoriesList={categoriesList}
                        selectedCategoryId={categories}
                        onCategoryChange={(value) => 
                            setAttributes({ categories: value ? [value] : [] })
                        }
                        authorList={authorsList}
                        selectedAuthorId={selectedAuthor}
                        onAuthorChange={(value) => 
                            setAttributes({ selectedAuthor: value })
                        }
                    />
                    
                    <RangeControl
                        label={__('Excerpt Length', 'myplugin')}
                        value={excerptLength}
                        onChange={(value) => setAttributes({ excerptLength: value })}
                        min={10}
                        max={100}
                    />
                </PanelBody>
                
                <PanelBody title={__('Display Settings', 'myplugin')}>
                    <ToggleControl
                        label={__('Display Featured Image', 'myplugin')}
                        checked={displayFeaturedImage}
                        onChange={(value) => 
                            setAttributes({ displayFeaturedImage: value })
                        }
                    />
                    
                    <ToggleControl
                        label={__('Display Post Content', 'myplugin')}
                        checked={displayPostContent}
                        onChange={(value) => 
                            setAttributes({ displayPostContent: value })
                        }
                    />
                    
                    <ToggleControl
                        label={__('Display Post Date', 'myplugin')}
                        checked={displayPostDate}
                        onChange={(value) => 
                            setAttributes({ displayPostDate: value })
                        }
                    />
                    
                    <SelectControl
                        label={__('Layout', 'myplugin')}
                        value={postLayout}
                        options={[
                            { label: __('List', 'myplugin'), value: 'list' },
                            { label: __('Grid', 'myplugin'), value: 'grid' }
                        ]}
                        onChange={(value) => setAttributes({ postLayout: value })}
                    />
                    
                    {postLayout === 'grid' && (
                        <RangeControl
                            label={__('Columns', 'myplugin')}
                            value={columns}
                            onChange={(value) => setAttributes({ columns: value })}
                            min={2}
                            max={6}
                        />
                    )}
                </PanelBody>
            </InspectorControls>
            
            <div {...blockProps}>
                <ServerSideRender
                    block="myplugin/dynamic-posts"
                    attributes={attributes}
                />
            </div>
        </>
    );
};

registerBlockType('myplugin/dynamic-posts', {
    title: __('Dynamic Posts', 'myplugin'),
    description: __('Display posts dynamically', 'myplugin'),
    category: 'widgets',
    icon: 'list-view',
    supports: {
        align: ['wide', 'full'],
        html: false
    },
    
    attributes: {
        postsToShow: {
            type: 'number',
            default: 5
        },
        displayPostContent: {
            type: 'boolean',
            default: false
        },
        displayPostDate: {
            type: 'boolean',
            default: true
        },
        displayFeaturedImage: {
            type: 'boolean',
            default: true
        },
        postLayout: {
            type: 'string',
            default: 'list'
        },
        columns: {
            type: 'number',
            default: 3
        },
        order: {
            type: 'string',
            default: 'desc'
        },
        orderBy: {
            type: 'string',
            default: 'date'
        },
        categories: {
            type: 'array',
            default: []
        },
        selectedAuthor: {
            type: 'number'
        },
        excerptLength: {
            type: 'number',
            default: 55
        }
    },
    
    edit: DynamicPostsEdit,
    save: () => null // Dynamic block - rendered server-side
});
                        </code></pre>
                        
                        <h3>PHP Render Callback</h3>
                        <pre><code class="language-php">
&lt;?php
/**
 * Register dynamic block and render callback
 */
class Dynamic_Posts_Block {
    
    public function __construct() {
        add_action('init', [$this, 'register_block']);
    }
    
    public function register_block() {
        register_block_type('myplugin/dynamic-posts', [
            'render_callback' => [$this, 'render_dynamic_posts'],
            'attributes' => [
                'postsToShow' => [
                    'type' => 'number',
                    'default' => 5
                ],
                'displayPostContent' => [
                    'type' => 'boolean',
                    'default' => false
                ],
                'displayPostDate' => [
                    'type' => 'boolean',
                    'default' => true
                ],
                'displayFeaturedImage' => [
                    'type' => 'boolean',
                    'default' => true
                ],
                'postLayout' => [
                    'type' => 'string',
                    'default' => 'list'
                ],
                'columns' => [
                    'type' => 'number',
                    'default' => 3
                ],
                'order' => [
                    'type' => 'string',
                    'default' => 'desc'
                ],
                'orderBy' => [
                    'type' => 'string',
                    'default' => 'date'
                ],
                'categories' => [
                    'type' => 'array',
                    'default' => []
                ],
                'selectedAuthor' => [
                    'type' => 'number'
                ],
                'excerptLength' => [
                    'type' => 'number',
                    'default' => 55
                ]
            ]
        ]);
    }
    
    public function render_dynamic_posts($attributes, $content) {
        $args = [
            'posts_per_page' => $attributes['postsToShow'],
            'post_status' => 'publish',
            'order' => $attributes['order'],
            'orderby' => $attributes['orderBy'],
            'suppress_filters' => false
        ];
        
        if (!empty($attributes['categories'])) {
            $args['category__in'] = $attributes['categories'];
        }
        
        if (!empty($attributes['selectedAuthor'])) {
            $args['author'] = $attributes['selectedAuthor'];
        }
        
        $recent_posts = get_posts($args);
        
        if (empty($recent_posts)) {
            return '<p>' . __('No posts found.', 'myplugin') . '</p>';
        }
        
        $class = 'wp-block-myplugin-dynamic-posts';
        if ($attributes['postLayout'] === 'grid') {
            $class .= ' is-grid columns-' . $attributes['columns'];
        }
        
        $output = '<div class="' . esc_attr($class) . '">';
        
        foreach ($recent_posts as $post) {
            $output .= $this->render_post_item($post, $attributes);
        }
        
        $output .= '</div>';
        
        return $output;
    }
    
    private function render_post_item($post, $attributes) {
        $output = '<article class="post-item">';
        
        // Featured image
        if ($attributes['displayFeaturedImage'] && has_post_thumbnail($post->ID)) {
            $output .= '<div class="post-thumbnail">';
            $output .= '<a href="' . esc_url(get_permalink($post->ID)) . '">';
            $output .= get_the_post_thumbnail($post->ID, 'medium');
            $output .= '</a>';
            $output .= '</div>';
        }
        
        $output .= '<div class="post-content">';
        
        // Title
        $output .= '<h3 class="post-title">';
        $output .= '<a href="' . esc_url(get_permalink($post->ID)) . '">';
        $output .= esc_html($post->post_title);
        $output .= '</a>';
        $output .= '</h3>';
        
        // Date
        if ($attributes['displayPostDate']) {
            $output .= '<time class="post-date" datetime="' . esc_attr(get_the_date('c', $post)) . '">';
            $output .= esc_html(get_the_date('', $post));
            $output .= '</time>';
        }
        
        // Content/Excerpt
        if ($attributes['displayPostContent']) {
            $excerpt = wp_trim_words(
                $post->post_excerpt ?: $post->post_content,
                $attributes['excerptLength']
            );
            $output .= '<div class="post-excerpt">' . wp_kses_post($excerpt) . '</div>';
        }
        
        $output .= '</div>'; // .post-content
        $output .= '</article>';
        
        return $output;
    }
}

new Dynamic_Posts_Block();
                        </code></pre>
                    </section>
                    
                    <!-- Block with InnerBlocks -->
                    <section>
                        <h2>Block with InnerBlocks</h2>
                        
                        <h3>Container Block with InnerBlocks</h3>
                        <pre><code class="language-javascript">
/**
 * Container block using InnerBlocks for nested content
 */
import { registerBlockType } from '@wordpress/blocks';
import { __ } from '@wordpress/i18n';
import {
    useBlockProps,
    InnerBlocks,
    InspectorControls,
    PanelColorSettings,
    useInnerBlocksProps,
    __experimentalBlockVariationPicker as BlockVariationPicker,
    store as blockEditorStore
} from '@wordpress/block-editor';
import {
    PanelBody,
    RangeControl,
    SelectControl,
    ToggleControl
} from '@wordpress/components';
import { useSelect, useDispatch } from '@wordpress/data';
import { createBlocksFromInnerBlocksTemplate } from '@wordpress/blocks';

const ALLOWED_BLOCKS = [
    'core/paragraph',
    'core/heading',
    'core/image',
    'core/list',
    'core/button',
    'core/separator'
];

const TEMPLATE = [
    ['core/heading', { level: 2, placeholder: 'Add heading...' }],
    ['core/paragraph', { placeholder: 'Add content...' }]
];

const VARIATIONS = [
    {
        name: 'two-columns',
        title: __('Two Columns', 'myplugin'),
        icon: 'columns',
        innerBlocks: [
            ['core/column', {}, [
                ['core/heading', { level: 3, placeholder: 'Column 1 Heading' }],
                ['core/paragraph', { placeholder: 'Column 1 content...' }]
            ]],
            ['core/column', {}, [
                ['core/heading', { level: 3, placeholder: 'Column 2 Heading' }],
                ['core/paragraph', { placeholder: 'Column 2 content...' }]
            ]]
        ],
        scope: ['block']
    },
    {
        name: 'hero-section',
        title: __('Hero Section', 'myplugin'),
        icon: 'cover',
        innerBlocks: [
            ['core/heading', { level: 1, placeholder: 'Hero Title' }],
            ['core/paragraph', { placeholder: 'Hero description...' }],
            ['core/buttons', {}, [
                ['core/button', { text: 'Get Started' }],
                ['core/button', { text: 'Learn More', className: 'is-style-outline' }]
            ]]
        ],
        scope: ['block']
    },
    {
        name: 'card',
        title: __('Card', 'myplugin'),
        icon: 'id',
        innerBlocks: [
            ['core/image', {}],
            ['core/heading', { level: 3, placeholder: 'Card Title' }],
            ['core/paragraph', { placeholder: 'Card content...' }],
            ['core/button', { text: 'Read More' }]
        ],
        scope: ['block']
    }
];

const ContainerEdit = ({ attributes, setAttributes, clientId }) => {
    const {
        containerWidth,
        paddingSize,
        backgroundColor,
        hasBackground,
        borderStyle,
        borderWidth,
        borderColor,
        borderRadius
    } = attributes;
    
    const { replaceInnerBlocks } = useDispatch(blockEditorStore);
    
    const hasInnerBlocks = useSelect(
        (select) => {
            const { getBlocks } = select(blockEditorStore);
            return getBlocks(clientId).length > 0;
        },
        [clientId]
    );
    
    const blockProps = useBlockProps({
        className: `container-width-${containerWidth}`,
        style: {
            backgroundColor: hasBackground ? backgroundColor : undefined,
            padding: `${paddingSize}px`,
            border: borderStyle !== 'none' 
                ? `${borderWidth}px ${borderStyle} ${borderColor}`
                : undefined,
            borderRadius: `${borderRadius}px`
        }
    });
    
    const innerBlocksProps = useInnerBlocksProps(blockProps, {
        allowedBlocks: ALLOWED_BLOCKS,
        template: TEMPLATE,
        templateLock: false,
        renderAppender: InnerBlocks.ButtonBlockAppender
    });
    
    // Show variation picker if no inner blocks
    if (!hasInnerBlocks) {
        return (
            <div {...blockProps}>
                <BlockVariationPicker
                    variations={VARIATIONS}
                    onSelect={(variation) => {
                        if (variation.innerBlocks) {
                            replaceInnerBlocks(
                                clientId,
                                createBlocksFromInnerBlocksTemplate(variation.innerBlocks)
                            );
                        }
                    }}
                />
            </div>
        );
    }
    
    return (
        <>
            <InspectorControls>
                <PanelBody title={__('Container Settings', 'myplugin')}>
                    <SelectControl
                        label={__('Width', 'myplugin')}
                        value={containerWidth}
                        options={[
                            { label: __('Default', 'myplugin'), value: 'default' },
                            { label: __('Wide', 'myplugin'), value: 'wide' },
                            { label: __('Full', 'myplugin'), value: 'full' },
                            { label: __('Narrow', 'myplugin'), value: 'narrow' }
                        ]}
                        onChange={(value) => setAttributes({ containerWidth: value })}
                    />
                    
                    <RangeControl
                        label={__('Padding', 'myplugin')}
                        value={paddingSize}
                        onChange={(value) => setAttributes({ paddingSize: value })}
                        min={0}
                        max={100}
                    />
                    
                    <ToggleControl
                        label={__('Has Background', 'myplugin')}
                        checked={hasBackground}
                        onChange={(value) => setAttributes({ hasBackground: value })}
                    />
                </PanelBody>
                
                {hasBackground && (
                    <PanelColorSettings
                        title={__('Background', 'myplugin')}
                        colorSettings={[
                            {
                                value: backgroundColor,
                                onChange: (value) => 
                                    setAttributes({ backgroundColor: value }),
                                label: __('Background Color', 'myplugin')
                            }
                        ]}
                    />
                )}
                
                <PanelBody title={__('Border', 'myplugin')} initialOpen={false}>
                    <SelectControl
                        label={__('Style', 'myplugin')}
                        value={borderStyle}
                        options={[
                            { label: __('None', 'myplugin'), value: 'none' },
                            { label: __('Solid', 'myplugin'), value: 'solid' },
                            { label: __('Dashed', 'myplugin'), value: 'dashed' },
                            { label: __('Dotted', 'myplugin'), value: 'dotted' }
                        ]}
                        onChange={(value) => setAttributes({ borderStyle: value })}
                    />
                    
                    {borderStyle !== 'none' && (
                        <>
                            <RangeControl
                                label={__('Width', 'myplugin')}
                                value={borderWidth}
                                onChange={(value) => 
                                    setAttributes({ borderWidth: value })}
                                min={1}
                                max={10}
                            />
                            
                            <PanelColorSettings
                                title={__('Border Color', 'myplugin')}
                                colorSettings={[
                                    {
                                        value: borderColor,
                                        onChange: (value) => 
                                            setAttributes({ borderColor: value }),
                                        label: __('Color', 'myplugin')
                                    }
                                ]}
                            />
                        </>
                    )}
                    
                    <RangeControl
                        label={__('Border Radius', 'myplugin')}
                        value={borderRadius}
                        onChange={(value) => setAttributes({ borderRadius: value })}
                        min={0}
                        max={50}
                    />
                </PanelBody>
            </InspectorControls>
            
            <div {...innerBlocksProps} />
        </>
    );
};

registerBlockType('myplugin/container', {
    title: __('Container', 'myplugin'),
    description: __('A container for other blocks', 'myplugin'),
    category: 'design',
    icon: 'editor-table',
    supports: {
        align: ['wide', 'full'],
        anchor: true,
        html: false
    },
    
    attributes: {
        containerWidth: {
            type: 'string',
            default: 'default'
        },
        paddingSize: {
            type: 'number',
            default: 20
        },
        backgroundColor: {
            type: 'string',
            default: '#ffffff'
        },
        hasBackground: {
            type: 'boolean',
            default: false
        },
        borderStyle: {
            type: 'string',
            default: 'none'
        },
        borderWidth: {
            type: 'number',
            default: 1
        },
        borderColor: {
            type: 'string',
            default: '#000000'
        },
        borderRadius: {
            type: 'number',
            default: 0
        }
    },
    
    variations: VARIATIONS,
    
    edit: ContainerEdit,
    
    save: ({ attributes }) => {
        const {
            containerWidth,
            paddingSize,
            backgroundColor,
            hasBackground,
            borderStyle,
            borderWidth,
            borderColor,
            borderRadius
        } = attributes;
        
        const blockProps = useBlockProps.save({
            className: `container-width-${containerWidth}`,
            style: {
                backgroundColor: hasBackground ? backgroundColor : undefined,
                padding: `${paddingSize}px`,
                border: borderStyle !== 'none' 
                    ? `${borderWidth}px ${borderStyle} ${borderColor}`
                    : undefined,
                borderRadius: `${borderRadius}px`
            }
        });
        
        return (
            <div {...blockProps}>
                <InnerBlocks.Content />
            </div>
        );
    }
});
                        </code></pre>
                    </section>
                    
                    <!-- Block Patterns -->
                    <section>
                        <h2>Block Patterns</h2>
                        
                        <h3>Registering Block Patterns</h3>
                        <pre><code class="language-php">
&lt;?php
/**
 * Register block patterns
 */
class Block_Patterns {
    
    public function __construct() {
        add_action('init', [$this, 'register_pattern_categories']);
        add_action('init', [$this, 'register_patterns']);
    }
    
    public function register_pattern_categories() {
        register_block_pattern_category('myplugin-patterns', [
            'label' => __('My Plugin Patterns', 'myplugin')
        ]);
    }
    
    public function register_patterns() {
        // Hero Pattern
        register_block_pattern(
            'myplugin/hero-section',
            [
                'title' => __('Hero Section', 'myplugin'),
                'description' => __('A hero section with heading, text, and buttons', 'myplugin'),
                'categories' => ['myplugin-patterns', 'featured'],
                'keywords' => ['hero', 'header', 'cta'],
                'viewportWidth' => 1200,
                'content' => '
                    <!-- wp:group {"align":"full","backgroundColor":"primary","textColor":"white"} -->
                    <div class="wp-block-group alignfull has-primary-background-color has-white-color has-text-color has-background">
                        <!-- wp:spacer {"height":"100px"} -->
                        <div style="height:100px" aria-hidden="true" class="wp-block-spacer"></div>
                        <!-- /wp:spacer -->
                        
                        <!-- wp:heading {"textAlign":"center","level":1} -->
                        <h1 class="has-text-align-center">Welcome to Our Site</h1>
                        <!-- /wp:heading -->
                        
                        <!-- wp:paragraph {"align":"center","fontSize":"large"} -->
                        <p class="has-text-align-center has-large-font-size">
                            Discover amazing products and services
                        </p>
                        <!-- /wp:paragraph -->
                        
                        <!-- wp:buttons {"layout":{"type":"flex","justifyContent":"center"}} -->
                        <div class="wp-block-buttons">
                            <!-- wp:button -->
                            <div class="wp-block-button">
                                <a class="wp-block-button__link">Get Started</a>
                            </div>
                            <!-- /wp:button -->
                            
                            <!-- wp:button {"className":"is-style-outline"} -->
                            <div class="wp-block-button is-style-outline">
                                <a class="wp-block-button__link">Learn More</a>
                            </div>
                            <!-- /wp:button -->
                        </div>
                        <!-- /wp:buttons -->
                        
                        <!-- wp:spacer {"height":"100px"} -->
                        <div style="height:100px" aria-hidden="true" class="wp-block-spacer"></div>
                        <!-- /wp:spacer -->
                    </div>
                    <!-- /wp:group -->
                '
            ]
        );
        
        // Features Grid Pattern
        register_block_pattern(
            'myplugin/features-grid',
            [
                'title' => __('Features Grid', 'myplugin'),
                'description' => __('A grid of feature cards', 'myplugin'),
                'categories' => ['myplugin-patterns'],
                'keywords' => ['features', 'grid', 'cards'],
                'content' => $this->get_features_grid_content()
            ]
        );
    }
    
    private function get_features_grid_content() {
        return '
            <!-- wp:columns {"align":"wide"} -->
            <div class="wp-block-columns alignwide">
                <!-- wp:column -->
                <div class="wp-block-column">
                    <!-- wp:group {"style":{"spacing":{"padding":{"top":"30px","right":"30px","bottom":"30px","left":"30px"}}},"backgroundColor":"light-gray"} -->
                    <div class="wp-block-group has-light-gray-background-color has-background" style="padding-top:30px;padding-right:30px;padding-bottom:30px;padding-left:30px">
                        <!-- wp:image {"align":"center","width":60,"height":60} -->
                        <figure class="wp-block-image aligncenter is-resized">
                            <img src="' . plugin_dir_url(__FILE__) . 'assets/icon-1.svg" alt="" width="60" height="60"/>
                        </figure>
                        <!-- /wp:image -->
                        
                        <!-- wp:heading {"textAlign":"center","level":3} -->
                        <h3 class="has-text-align-center">Feature One</h3>
                        <!-- /wp:heading -->
                        
                        <!-- wp:paragraph {"align":"center"} -->
                        <p class="has-text-align-center">Description of the first feature goes here.</p>
                        <!-- /wp:paragraph -->
                    </div>
                    <!-- /wp:group -->
                </div>
                <!-- /wp:column -->
                
                <!-- Repeat for other columns... -->
            </div>
            <!-- /wp:columns -->
        ';
    }
}

new Block_Patterns();
                        </code></pre>
                    </section>
                    
                    <!-- Summary -->
                    <section>
                        <h2>Summary</h2>
                        
                        <div class="summary-box">
                            <h3>Key Takeaways</h3>
                            <ul>
                                <li>Blocks have edit and save components</li>
                                <li>Attributes store block data</li>
                                <li>Inspector controls provide settings UI</li>
                                <li>Dynamic blocks render server-side</li>
                                <li>InnerBlocks enable nested content</li>
                                <li>Block patterns provide pre-built layouts</li>
                            </ul>
                        </div>
                        
                        <div class="best-practices">
                            <h3>Block Development Best Practices</h3>
                            <ul>
                                <li>Always provide meaningful defaults</li>
                                <li>Use semantic HTML in save function</li>
                                <li>Implement proper validation</li>
                                <li>Handle deprecations gracefully</li>
                                <li>Optimize for performance</li>
                                <li>Follow accessibility guidelines</li>
                                <li>Test across different themes</li>
                            </ul>
                        </div>
                    </section>
                    
                    <!-- Additional Resources -->
                    <section class="resources">
                        <h2>Additional Resources</h2>
                        <ul>
                            <li><a href="https://developer.wordpress.org/block-editor/how-to-guides/block-tutorial/" target="_blank">Block Tutorial</a></li>
                            <li><a href="https://developer.wordpress.org/block-editor/reference-guides/block-api/" target="_blank">Block API Reference</a></li>
                            <li><a href="https://github.com/WordPress/gutenberg-examples" target="_blank">Gutenberg Examples</a></li>
                            <li><a href="https://developer.wordpress.org/block-editor/reference-guides/components/" target="_blank">Components Reference</a></li>
                        </ul>
                    </section>
                </div>
                
                <!-- Lesson Navigation -->
                <div class="lesson-navigation">
                    <a href="/07module/block_development_environment.html" class="lesson-nav-button prev">
                        <svg width="20" height="20" viewBox="0 0 20 20" fill="currentColor">
                            <path d="M12.707 5.293a1 1 0 010 1.414L9.414 10l3.293 3.293a1 1 0 01-1.414 1.414l-4-4a1 1 0 010-1.414l4-4a1 1 0 011.414 0z"/>
                        </svg>
                        <span>
                            <small>Previous</small><br>
                            Development Environment
                        </span>
                    </a>
                    
                    <button class="complete-lesson-btn">
                        Mark as Complete
                    </button>
                    
                    <a href="/07module/block_attributes_controls.html" class="lesson-nav-button next">
                        <span>
                            <small>Next</small><br>
                            Block Attributes & Controls
                        </span>
                        <svg width="20" height="20" viewBox="0 0 20 20" fill="currentColor">
                            <path d="M7.293 14.707a1 1 0 010-1.414L10.586 10 7.293 6.707a1 1 0 011.414-1.414l4 4a1 1 0 010 1.414l-4 4a1 1 0 01-1.414 0z"/>
                        </svg>
                    </a>
                </div>
            </div>
        </main>
        
        <!-- Footer -->
        <footer class="site-footer" role="contentinfo">
            <div class="footer-container">
                <div class="footer-content">
                    <div class="footer-section footer-about">
                        <h3>PHP WordPress Development</h3>
                        <p>Complete Web Development Course - From HTML to WordPress</p>
                    </div>
                    
                    <div class="footer-section">
                        <h4>Quick Links</h4>
                        <ul class="footer-links">
                            <li><a href="/">Home</a></li>
                            <li><a href="/module7.html">Module 7</a></li>
                            <li><a href="/resources.html">Resources</a></li>
                            <li><a href="/about.html">About</a></li>
                        </ul>
                    </div>
                </div>
                
                <div class="footer-bottom">
                    <p>&copy; 2025 PHP WordPress Development Course. All rights reserved.</p>
                </div>
            </div>
        </footer>
    </div>
    
    <!-- JavaScript -->
    <script src="/assets/js/prism.js"></script>
    <script src="/assets/js/main.js"></script>
    <script src="/assets/js/lesson.js"></script>
</body>
</html>