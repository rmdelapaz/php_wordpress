<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    
    <!-- SEO Meta Tags -->
    <title>WordPress Debugging Tools - PHP WordPress Course</title>
    <meta name="description" content="Master WordPress debugging tools and techniques including error logging, profiling, and troubleshooting.">
    <meta name="keywords" content="WordPress, debugging, error logging, profiling, troubleshooting">
    <meta name="author" content="PHP WordPress Course">
    
    <!-- Open Graph Tags -->
    <meta property="og:title" content="WordPress Debugging Tools">
    <meta property="og:description" content="Learn professional debugging techniques for WordPress">
    <meta property="og:type" content="article">
    
    <!-- Favicon -->
    <link rel="icon" type="image/png" href="/favicon.png">
    <link rel="apple-touch-icon" href="/favicon.png">
    
    <!-- CSS -->
    <link rel="stylesheet" href="/assets/css/main.css">
    
    <!-- Prism.js for syntax highlighting -->
    <link href="/assets/css/prism.css" rel="stylesheet">
</head>
<body>
    <!-- Skip to main content -->
    <a href="#main-content" class="sr-only">Skip to main content</a>
    
    <div class="page-wrapper">
        <!-- Header -->
        <header class="site-header" role="banner">
            <div class="header-container">
                <div class="site-branding">
                    <a href="/" class="site-logo">
                        <h1 class="site-title">PHP WordPress Development</h1>
                    </a>
                </div>
                
                <nav class="main-navigation" role="navigation" aria-label="Main navigation">
                    <button class="mobile-menu-btn" aria-label="Toggle navigation" aria-expanded="false">
                        <span></span>
                        <span></span>
                        <span></span>
                    </button>
                    
                    <div class="nav-menu">
                        <ul class="nav-list">
                            <li class="nav-item"><a href="/" class="nav-link">Home</a></li>
                            <li class="nav-item dropdown">
                                <button class="nav-link dropdown-toggle active" aria-haspopup="true">Modules</button>
                                <div class="dropdown-menu">
                                    <a href="/module1.html" class="dropdown-item">Module 1: Web Fundamentals</a>
                                    <a href="/module2.html" class="dropdown-item">Module 2: PHP Fundamentals</a>
                                    <a href="/module3.html" class="dropdown-item">Module 3: MySQL Database</a>
                                    <a href="/module4.html" class="dropdown-item">Module 4: WordPress & Docker</a>
                                    <a href="/module5.html" class="dropdown-item">Module 5: Theme Development</a>
                                    <a href="/module6.html" class="dropdown-item">Module 6: Plugin Development</a>
                                    <a href="/module7.html" class="dropdown-item active">Module 7: Advanced WordPress</a>
                                    <a href="/module8.html" class="dropdown-item">Module 8: Deployment</a>
                                    <a href="/module9.html" class="dropdown-item">Module 9: Final Project</a>
                                </div>
                            </li>
                            <li class="nav-item"><a href="/resources.html" class="nav-link">Resources</a></li>
                            <li class="nav-item"><a href="/about.html" class="nav-link">About</a></li>
                        </ul>
                    </div>
                </nav>
                
                <div class="search-container">
                    <div class="search-input-wrapper">
                        <svg class="search-icon" width="20" height="20" viewBox="0 0 20 20" fill="currentColor">
                            <path fill-rule="evenodd" d="M8 4a4 4 0 100 8 4 4 0 000-8zM2 8a6 6 0 1110.89 3.476l4.817 4.817a1 1 0 01-1.414 1.414l-4.816-4.816A6 6 0 012 8z" clip-rule="evenodd" />
                        </svg>
                        <input type="search" class="search-input" placeholder="Search lessons..." aria-label="Search">
                    </div>
                    <div class="search-results"></div>
                </div>
            </div>
        </header>
        
        <!-- Progress Bar -->
        <div class="progress-container">
            <div class="progress-header">
                <h2 class="progress-title">Course Progress</h2>
                <span class="progress-text">Loading...</span>
            </div>
            <div class="progress-bar">
                <div class="progress-bar-fill">
                    <span class="progress-bar-text"></span>
                </div>
            </div>
        </div>
        
        <!-- Breadcrumb -->
        <nav class="breadcrumb container" aria-label="Breadcrumb">
            <ol class="breadcrumb-list">
                <li class="breadcrumb-item">
                    <a href="/">Home</a>
                    <span class="breadcrumb-separator">/</span>
                </li>
                <li class="breadcrumb-item">
                    <a href="/module7.html">Module 7</a>
                    <span class="breadcrumb-separator">/</span>
                </li>
                <li class="breadcrumb-item">
                    <span aria-current="page">Debugging Tools</span>
                </li>
            </ol>
        </nav>
        
        <!-- Main Content -->
        <main id="main-content" class="main-content" role="main">
            <div class="container">
                <!-- Lesson Header -->
                <div class="lesson-header">
                    <h1 class="lesson-title">WordPress Debugging Tools</h1>
                    <p class="lesson-subtitle">Professional debugging and troubleshooting techniques</p>
                </div>
                
                <!-- Learning Objectives -->
                <div class="lesson-objectives">
                    <h2>Learning Objectives</h2>
                    <p>By the end of this lesson, you will be able to:</p>
                    <ul>
                        <li>Configure WordPress debugging environment</li>
                        <li>Use advanced debugging tools and plugins</li>
                        <li>Implement custom error logging</li>
                        <li>Profile and trace code execution</li>
                        <li>Debug AJAX and REST API calls</li>
                        <li>Troubleshoot common WordPress issues</li>
                    </ul>
                </div>
                
                <!-- Lesson Body -->
                <div class="lesson-body">
                    <!-- Advanced Debug Configuration -->
                    <section>
                        <h2>Advanced Debug Configuration</h2>
                        
                        <h3>Complete wp-config.php Debug Settings</h3>
                        <pre><code class="language-php">
&lt;?php
/**
 * Advanced WordPress Debug Configuration
 */

// Enable debug mode
define('WP_DEBUG', true);

// Display errors on screen (development only)
define('WP_DEBUG_DISPLAY', false);

// Log errors to wp-content/debug.log
define('WP_DEBUG_LOG', true);

// Use development versions of scripts
define('SCRIPT_DEBUG', true);

// Save database queries for analysis
define('SAVEQUERIES', true);

// Disable concatenation of scripts
define('CONCATENATE_SCRIPTS', false);

// Enable error reporting
error_reporting(E_ALL);
ini_set('display_errors', 0);
ini_set('log_errors', 1);
ini_set('error_log', WP_CONTENT_DIR . '/debug.log');

// Custom error handler
if (!function_exists('wp_custom_error_handler')) {
    function wp_custom_error_handler($errno, $errstr, $errfile, $errline) {
        $error_types = [
            E_ERROR => 'ERROR',
            E_WARNING => 'WARNING',
            E_PARSE => 'PARSE',
            E_NOTICE => 'NOTICE',
            E_CORE_ERROR => 'CORE_ERROR',
            E_CORE_WARNING => 'CORE_WARNING',
            E_COMPILE_ERROR => 'COMPILE_ERROR',
            E_COMPILE_WARNING => 'COMPILE_WARNING',
            E_USER_ERROR => 'USER_ERROR',
            E_USER_WARNING => 'USER_WARNING',
            E_USER_NOTICE => 'USER_NOTICE',
            E_STRICT => 'STRICT',
            E_RECOVERABLE_ERROR => 'RECOVERABLE_ERROR',
            E_DEPRECATED => 'DEPRECATED',
            E_USER_DEPRECATED => 'USER_DEPRECATED'
        ];
        
        $type = isset($error_types[$errno]) ? $error_types[$errno] : 'UNKNOWN';
        
        $message = sprintf(
            "[%s] %s: %s in %s on line %d",
            date('Y-m-d H:i:s'),
            $type,
            $errstr,
            $errfile,
            $errline
        );
        
        error_log($message);
        
        // Send critical errors to admin
        if (in_array($errno, [E_ERROR, E_PARSE, E_CORE_ERROR, E_COMPILE_ERROR])) {
            wp_mail(
                get_option('admin_email'),
                'Critical Error on ' . get_bloginfo('name'),
                $message
            );
        }
        
        // Don't execute PHP internal error handler
        return true;
    }
    
    set_error_handler('wp_custom_error_handler');
}

// Custom exception handler
if (!function_exists('wp_custom_exception_handler')) {
    function wp_custom_exception_handler($exception) {
        $message = sprintf(
            "[%s] Uncaught Exception: %s in %s on line %d\nStack trace:\n%s",
            date('Y-m-d H:i:s'),
            $exception->getMessage(),
            $exception->getFile(),
            $exception->getLine(),
            $exception->getTraceAsString()
        );
        
        error_log($message);
        
        // Display user-friendly error page
        if (!is_admin()) {
            wp_die(
                'An error occurred. Please try again later.',
                'Error',
                ['response' => 500]
            );
        }
    }
    
    set_exception_handler('wp_custom_exception_handler');
}

// Memory and execution time limits for debugging
ini_set('memory_limit', '256M');
ini_set('max_execution_time', 300);

// XDebug settings (if available)
if (extension_loaded('xdebug')) {
    ini_set('xdebug.var_display_max_depth', 10);
    ini_set('xdebug.var_display_max_children', 256);
    ini_set('xdebug.var_display_max_data', 1024);
}
                        </code></pre>
                    </section>
                    
                    <!-- Custom Debug Logger -->
                    <section>
                        <h2>Custom Debug Logger System</h2>
                        
                        <h3>Advanced WordPress Logger</h3>
                        <pre><code class="language-php">
&lt;?php
/**
 * Advanced WordPress Debug Logger
 */
class WP_Debug_Logger {
    
    private static $instance = null;
    private $log_file;
    private $log_levels = [
        'DEBUG' => 0,
        'INFO' => 1,
        'NOTICE' => 2,
        'WARNING' => 3,
        'ERROR' => 4,
        'CRITICAL' => 5,
        'ALERT' => 6,
        'EMERGENCY' => 7
    ];
    private $current_level = 'DEBUG';
    private $log_rotation_size = 10485760; // 10MB
    private $max_log_files = 5;
    
    public static function get_instance() {
        if (null === self::$instance) {
            self::$instance = new self();
        }
        return self::$instance;
    }
    
    private function __construct() {
        $this->log_file = WP_CONTENT_DIR . '/debug.log';
        
        // Rotate logs if needed
        $this->rotate_logs();
        
        // Register shutdown function for fatal errors
        register_shutdown_function([$this, 'check_for_fatal']);
        
        // Add admin bar debug menu
        add_action('admin_bar_menu', [$this, 'add_debug_menu'], 999);
        
        // AJAX handler for live log viewing
        add_action('wp_ajax_get_debug_log', [$this, 'ajax_get_log']);
    }
    
    /**
     * Log message with context
     */
    public function log($message, $level = 'INFO', $context = []) {
        // Check if should log based on level
        if ($this->log_levels[$level] < $this->log_levels[$this->current_level]) {
            return;
        }
        
        $timestamp = date('Y-m-d H:i:s');
        $memory = size_format(memory_get_usage(true));
        $peak_memory = size_format(memory_get_peak_usage(true));
        
        // Get backtrace for context
        $backtrace = debug_backtrace(DEBUG_BACKTRACE_IGNORE_ARGS, 3);
        $caller = isset($backtrace[1]) ? $backtrace[1] : [];
        
        $log_entry = [
            'timestamp' => $timestamp,
            'level' => $level,
            'message' => $message,
            'context' => $context,
            'memory' => $memory,
            'peak_memory' => $peak_memory,
            'file' => $caller['file'] ?? 'unknown',
            'line' => $caller['line'] ?? 0,
            'function' => $caller['function'] ?? 'unknown',
            'class' => $caller['class'] ?? '',
            'request_uri' => $_SERVER['REQUEST_URI'] ?? '',
            'user_id' => get_current_user_id(),
            'ip' => $_SERVER['REMOTE_ADDR'] ?? ''
        ];
        
        // Format log entry
        $formatted = $this->format_log_entry($log_entry);
        
        // Write to log file
        error_log($formatted, 3, $this->log_file);
        
        // Trigger action for external loggers
        do_action('wp_debug_log', $log_entry);
        
        // Send to browser console if in debug mode
        if (WP_DEBUG && WP_DEBUG_DISPLAY) {
            $this->send_to_console($log_entry);
        }
    }
    
    /**
     * Format log entry
     */
    private function format_log_entry($entry) {
        $format = "[%s] [%s] %s | Memory: %s (Peak: %s) | %s:%d | %s\n";
        
        $message = sprintf(
            $format,
            $entry['timestamp'],
            $entry['level'],
            $entry['message'],
            $entry['memory'],
            $entry['peak_memory'],
            basename($entry['file']),
            $entry['line'],
            !empty($entry['context']) ? json_encode($entry['context']) : ''
        );
        
        return $message;
    }
    
    /**
     * Send log to browser console
     */
    private function send_to_console($entry) {
        static $console_logs = [];
        
        $console_logs[] = $entry;
        
        add_action('wp_footer', function() use ($console_logs) {
            if (empty($console_logs)) {
                return;
            }
            
            echo '<script>';
            echo 'if (console && console.log) {';
            
            foreach ($console_logs as $log) {
                $js_log = json_encode($log);
                $method = strtolower($log['level']) === 'error' ? 'error' : 'log';
                echo "console.{$method}('WP Debug:', {$js_log});";
            }
            
            echo '}';
            echo '</script>';
        });
    }
    
    /**
     * Check for fatal errors
     */
    public function check_for_fatal() {
        $error = error_get_last();
        
        if ($error && in_array($error['type'], [E_ERROR, E_PARSE, E_CORE_ERROR, E_COMPILE_ERROR])) {
            $this->log(
                'Fatal Error: ' . $error['message'],
                'EMERGENCY',
                [
                    'file' => $error['file'],
                    'line' => $error['line'],
                    'type' => $error['type']
                ]
            );
        }
    }
    
    /**
     * Rotate log files
     */
    private function rotate_logs() {
        if (!file_exists($this->log_file)) {
            return;
        }
        
        $size = filesize($this->log_file);
        
        if ($size > $this->log_rotation_size) {
            // Rotate existing logs
            for ($i = $this->max_log_files - 1; $i > 0; $i--) {
                $old_file = $this->log_file . '.' . $i;
                $new_file = $this->log_file . '.' . ($i + 1);
                
                if (file_exists($old_file)) {
                    if ($i === $this->max_log_files - 1) {
                        unlink($old_file);
                    } else {
                        rename($old_file, $new_file);
                    }
                }
            }
            
            // Move current log to .1
            rename($this->log_file, $this->log_file . '.1');
            
            // Create new log file
            touch($this->log_file);
        }
    }
    
    /**
     * Add debug menu to admin bar
     */
    public function add_debug_menu($wp_admin_bar) {
        if (!current_user_can('manage_options')) {
            return;
        }
        
        // Get current debug stats
        $errors = $this->count_log_levels();
        
        $wp_admin_bar->add_node([
            'id' => 'debug-logger',
            'title' => sprintf(
                '🐛 Debug (%d errors)',
                $errors['ERROR'] ?? 0
            ),
            'href' => '#',
            'meta' => ['class' => 'debug-logger-menu']
        ]);
        
        // Add log viewer
        $wp_admin_bar->add_node([
            'parent' => 'debug-logger',
            'id' => 'view-logs',
            'title' => 'View Logs',
            'href' => admin_url('tools.php?page=debug-logs')
        ]);
        
        // Add clear logs option
        $wp_admin_bar->add_node([
            'parent' => 'debug-logger',
            'id' => 'clear-logs',
            'title' => 'Clear Logs',
            'href' => wp_nonce_url(
                admin_url('admin-post.php?action=clear_debug_logs'),
                'clear_debug_logs'
            )
        ]);
        
        // Add debug info
        global $wpdb;
        
        $wp_admin_bar->add_node([
            'parent' => 'debug-logger',
            'id' => 'debug-info',
            'title' => sprintf(
                'Queries: %d | Memory: %s',
                $wpdb->num_queries,
                size_format(memory_get_peak_usage(true))
            )
        ]);
    }
    
    /**
     * Count log levels
     */
    private function count_log_levels() {
        if (!file_exists($this->log_file)) {
            return [];
        }
        
        $counts = [];
        $handle = fopen($this->log_file, 'r');
        
        if ($handle) {
            while (($line = fgets($handle)) !== false) {
                foreach ($this->log_levels as $level => $priority) {
                    if (strpos($line, "[$level]") !== false) {
                        if (!isset($counts[$level])) {
                            $counts[$level] = 0;
                        }
                        $counts[$level]++;
                        break;
                    }
                }
            }
            fclose($handle);
        }
        
        return $counts;
    }
}

// Initialize logger
$GLOBALS['wp_debug_logger'] = WP_Debug_Logger::get_instance();

// Helper function
function wp_debug_log($message, $level = 'INFO', $context = []) {
    global $wp_debug_logger;
    $wp_debug_logger->log($message, $level, $context);
}
                        </code></pre>
                    </section>
                    
                    <!-- Query Monitor -->
                    <section>
                        <h2>Query and Hook Monitor</h2>
                        
                        <h3>WordPress Query Profiler</h3>
                        <pre><code class="language-php">
&lt;?php
/**
 * WordPress Query and Hook Monitor
 */
class WP_Query_Monitor {
    
    private $queries = [];
    private $hooks = [];
    private $start_time;
    private $query_threshold = 0.05; // 50ms
    
    public function __construct() {
        $this->start_time = microtime(true);
        
        // Monitor queries
        if (defined('SAVEQUERIES') && SAVEQUERIES) {
            add_action('shutdown', [$this, 'analyze_queries'], 0);
        }
        
        // Monitor hooks
        add_action('all', [$this, 'monitor_hooks']);
        
        // Monitor HTTP requests
        add_filter('pre_http_request', [$this, 'monitor_http_start'], 10, 3);
        add_action('http_api_debug', [$this, 'monitor_http_end'], 10, 5);
        
        // Display results
        add_action('wp_footer', [$this, 'display_monitor'], 999);
        add_action('admin_footer', [$this, 'display_monitor'], 999);
    }
    
    /**
     * Analyze database queries
     */
    public function analyze_queries() {
        global $wpdb;
        
        if (!isset($wpdb->queries)) {
            return;
        }
        
        foreach ($wpdb->queries as $query_data) {
            list($query, $elapsed, $caller) = $query_data;
            
            $this->queries[] = [
                'sql' => $query,
                'time' => $elapsed,
                'caller' => $caller,
                'slow' => $elapsed > $this->query_threshold,
                'type' => $this->get_query_type($query)
            ];
        }
        
        // Sort by time
        usort($this->queries, function($a, $b) {
            return $b['time'] <=> $a['time'];
        });
    }
    
    /**
     * Get query type
     */
    private function get_query_type($query) {
        $query = trim($query);
        $type = strtoupper(substr($query, 0, strpos($query, ' ')));
        
        return in_array($type, ['SELECT', 'INSERT', 'UPDATE', 'DELETE', 'SHOW', 'DESCRIBE']) 
            ? $type : 'OTHER';
    }
    
    /**
     * Monitor hooks
     */
    public function monitor_hooks($hook_name) {
        global $wp_filter;
        
        if (!isset($this->hooks[$hook_name])) {
            $this->hooks[$hook_name] = [
                'count' => 0,
                'callbacks' => [],
                'time' => 0
            ];
        }
        
        $this->hooks[$hook_name]['count']++;
        
        // Get callbacks
        if (isset($wp_filter[$hook_name])) {
            foreach ($wp_filter[$hook_name]->callbacks as $priority => $callbacks) {
                foreach ($callbacks as $callback) {
                    $this->hooks[$hook_name]['callbacks'][] = [
                        'priority' => $priority,
                        'function' => $this->get_callback_name($callback['function'])
                    ];
                }
            }
        }
    }
    
    /**
     * Get callback name
     */
    private function get_callback_name($callback) {
        if (is_string($callback)) {
            return $callback;
        }
        
        if (is_array($callback)) {
            if (is_object($callback[0])) {
                return get_class($callback[0]) . '::' . $callback[1];
            }
            return implode('::', $callback);
        }
        
        if (is_object($callback)) {
            return get_class($callback);
        }
        
        return 'Unknown';
    }
    
    /**
     * Display monitor results
     */
    public function display_monitor() {
        if (!current_user_can('manage_options')) {
            return;
        }
        
        $total_time = microtime(true) - $this->start_time;
        $memory = memory_get_peak_usage(true);
        
        ?>
        <style>
            #wp-query-monitor {
                position: fixed;
                bottom: 0;
                right: 0;
                width: 400px;
                max-height: 400px;
                background: #23282d;
                color: #fff;
                font-family: monospace;
                font-size: 12px;
                z-index: 99999;
                box-shadow: 0 0 10px rgba(0,0,0,0.5);
            }
            #wp-query-monitor-header {
                background: #0073aa;
                padding: 10px;
                cursor: pointer;
            }
            #wp-query-monitor-content {
                padding: 10px;
                overflow-y: auto;
                max-height: 350px;
            }
            #wp-query-monitor table {
                width: 100%;
                border-collapse: collapse;
            }
            #wp-query-monitor th,
            #wp-query-monitor td {
                padding: 5px;
                border-bottom: 1px solid #444;
                text-align: left;
            }
            #wp-query-monitor .slow {
                color: #ff6b6b;
            }
            #wp-query-monitor .tabs {
                display: flex;
                background: #32373c;
            }
            #wp-query-monitor .tab {
                padding: 10px;
                cursor: pointer;
                border-right: 1px solid #23282d;
            }
            #wp-query-monitor .tab.active {
                background: #23282d;
            }
            #wp-query-monitor .tab-content {
                display: none;
            }
            #wp-query-monitor .tab-content.active {
                display: block;
            }
        </style>
        
        <div id="wp-query-monitor">
            <div id="wp-query-monitor-header" onclick="this.parentElement.style.display='none'">
                Query Monitor | 
                Time: <?php echo number_format($total_time, 3); ?>s | 
                Memory: <?php echo size_format($memory); ?> | 
                Queries: <?php echo count($this->queries); ?>
            </div>
            
            <div class="tabs">
                <div class="tab active" onclick="switchTab('queries')">Queries</div>
                <div class="tab" onclick="switchTab('hooks')">Hooks</div>
                <div class="tab" onclick="switchTab('http')">HTTP</div>
            </div>
            
            <div id="wp-query-monitor-content">
                <!-- Queries Tab -->
                <div id="queries-tab" class="tab-content active">
                    <h4>Database Queries</h4>
                    <table>
                        <thead>
                            <tr>
                                <th>Time</th>
                                <th>Type</th>
                                <th>Query</th>
                                <th>Caller</th>
                            </tr>
                        </thead>
                        <tbody>
                            <?php foreach (array_slice($this->queries, 0, 20) as $query): ?>
                                <tr class="<?php echo $query['slow'] ? 'slow' : ''; ?>">
                                    <td><?php echo number_format($query['time'], 4); ?>s</td>
                                    <td><?php echo esc_html($query['type']); ?></td>
                                    <td title="<?php echo esc_attr($query['sql']); ?>">
                                        <?php echo esc_html(substr($query['sql'], 0, 50)); ?>...
                                    </td>
                                    <td><?php echo esc_html($query['caller']); ?></td>
                                </tr>
                            <?php endforeach; ?>
                        </tbody>
                    </table>
                </div>
                
                <!-- Hooks Tab -->
                <div id="hooks-tab" class="tab-content">
                    <h4>Hooks Fired</h4>
                    <table>
                        <thead>
                            <tr>
                                <th>Hook</th>
                                <th>Count</th>
                                <th>Callbacks</th>
                            </tr>
                        </thead>
                        <tbody>
                            <?php 
                            $sorted_hooks = $this->hooks;
                            uasort($sorted_hooks, function($a, $b) {
                                return $b['count'] <=> $a['count'];
                            });
                            
                            foreach (array_slice($sorted_hooks, 0, 20) as $hook => $data): 
                            ?>
                                <tr>
                                    <td><?php echo esc_html($hook); ?></td>
                                    <td><?php echo $data['count']; ?></td>
                                    <td><?php echo count($data['callbacks']); ?></td>
                                </tr>
                            <?php endforeach; ?>
                        </tbody>
                    </table>
                </div>
                
                <!-- HTTP Tab -->
                <div id="http-tab" class="tab-content">
                    <h4>HTTP Requests</h4>
                    <p>HTTP request monitoring data will appear here</p>
                </div>
            </div>
        </div>
        
        <script>
        function switchTab(tab) {
            document.querySelectorAll('#wp-query-monitor .tab').forEach(function(el) {
                el.classList.remove('active');
            });
            document.querySelectorAll('#wp-query-monitor .tab-content').forEach(function(el) {
                el.classList.remove('active');
            });
            
            event.target.classList.add('active');
            document.getElementById(tab + '-tab').classList.add('active');
        }
        </script>
        <?php
    }
}

// Initialize query monitor
if (WP_DEBUG) {
    new WP_Query_Monitor();
}
                        </code></pre>
                    </section>
                    
                    <!-- AJAX Debugger -->
                    <section>
                        <h2>AJAX and REST API Debugger</h2>
                        
                        <h3>AJAX Request Monitor</h3>
                        <pre><code class="language-php">
&lt;?php
/**
 * AJAX and REST API Debugger
 */
class WP_AJAX_Debugger {
    
    private $ajax_requests = [];
    private $rest_requests = [];
    
    public function __construct() {
        // Monitor AJAX requests
        add_action('wp_ajax_nopriv_debug_ajax', [$this, 'handle_ajax_debug']);
        add_action('wp_ajax_debug_ajax', [$this, 'handle_ajax_debug']);
        
        // Intercept all AJAX actions
        add_action('init', [$this, 'intercept_ajax']);
        
        // Monitor REST API
        add_filter('rest_pre_dispatch', [$this, 'rest_pre_dispatch'], 10, 3);
        add_filter('rest_post_dispatch', [$this, 'rest_post_dispatch'], 10, 3);
        
        // Add debug panel
        add_action('wp_footer', [$this, 'add_ajax_debug_panel']);
        add_action('admin_footer', [$this, 'add_ajax_debug_panel']);
    }
    
    /**
     * Intercept AJAX requests
     */
    public function intercept_ajax() {
        if (!defined('DOING_AJAX') || !DOING_AJAX) {
            return;
        }
        
        // Log AJAX request
        $action = $_REQUEST['action'] ?? 'unknown';
        
        $this->ajax_requests[] = [
            'action' => $action,
            'method' => $_SERVER['REQUEST_METHOD'],
            'data' => $_REQUEST,
            'time' => microtime(true),
            'memory' => memory_get_usage(true)
        ];
        
        // Add debug headers
        header('X-WP-Ajax-Action: ' . $action);
        header('X-WP-Ajax-Time: ' . microtime(true));
    }
    
    /**
     * REST API pre-dispatch
     */
    public function rest_pre_dispatch($result, $server, $request) {
        $this->rest_requests[] = [
            'route' => $request->get_route(),
            'method' => $request->get_method(),
            'params' => $request->get_params(),
            'headers' => $request->get_headers(),
            'start_time' => microtime(true),
            'start_memory' => memory_get_usage(true)
        ];
        
        return $result;
    }
    
    /**
     * REST API post-dispatch
     */
    public function rest_post_dispatch($result, $server, $request) {
        $last_request = &$this->rest_requests[count($this->rest_requests) - 1];
        
        $last_request['end_time'] = microtime(true);
        $last_request['end_memory'] = memory_get_usage(true);
        $last_request['duration'] = $last_request['end_time'] - $last_request['start_time'];
        $last_request['memory_used'] = $last_request['end_memory'] - $last_request['start_memory'];
        $last_request['response'] = $result;
        
        // Log to debug
        wp_debug_log('REST API Request', 'INFO', [
            'route' => $last_request['route'],
            'duration' => $last_request['duration'],
            'memory' => size_format($last_request['memory_used'])
        ]);
        
        return $result;
    }
    
    /**
     * Add AJAX debug panel
     */
    public function add_ajax_debug_panel() {
        if (!current_user_can('manage_options')) {
            return;
        }
        
        ?>
        <style>
            #ajax-debug-panel {
                position: fixed;
                bottom: 50px;
                left: 10px;
                width: 500px;
                max-height: 400px;
                background: #fff;
                border: 1px solid #ccc;
                box-shadow: 0 2px 5px rgba(0,0,0,0.2);
                z-index: 99998;
                display: none;
            }
            #ajax-debug-header {
                background: #23282d;
                color: #fff;
                padding: 10px;
                cursor: move;
            }
            #ajax-debug-content {
                padding: 10px;
                overflow-y: auto;
                max-height: 350px;
            }
            .ajax-request {
                border-bottom: 1px solid #eee;
                padding: 10px 0;
            }
            .ajax-request-header {
                font-weight: bold;
                cursor: pointer;
            }
            .ajax-request-details {
                display: none;
                margin-top: 10px;
                padding-left: 20px;
            }
            .ajax-request-details pre {
                background: #f5f5f5;
                padding: 10px;
                overflow-x: auto;
            }
        </style>
        
        <div id="ajax-debug-panel">
            <div id="ajax-debug-header">
                AJAX Debug Panel
                <button onclick="document.getElementById('ajax-debug-panel').style.display='none'" style="float:right">×</button>
            </div>
            <div id="ajax-debug-content">
                <div id="ajax-requests-list"></div>
            </div>
        </div>
        
        <script>
        (function() {
            // Store original jQuery.ajax
            if (typeof jQuery !== 'undefined') {
                var originalAjax = jQuery.ajax;
                var ajaxRequests = [];
                
                jQuery.ajax = function(options) {
                    var startTime = performance.now();
                    
                    // Create request object
                    var request = {
                        url: options.url || '',
                        type: options.type || 'GET',
                        data: options.data || {},
                        startTime: startTime
                    };
                    
                    // Override success callback
                    var originalSuccess = options.success;
                    options.success = function(data, status, xhr) {
                        request.endTime = performance.now();
                        request.duration = request.endTime - request.startTime;
                        request.status = xhr.status;
                        request.response = data;
                        
                        logAjaxRequest(request);
                        
                        if (originalSuccess) {
                            originalSuccess.apply(this, arguments);
                        }
                    };
                    
                    // Override error callback
                    var originalError = options.error;
                    options.error = function(xhr, status, error) {
                        request.endTime = performance.now();
                        request.duration = request.endTime - request.startTime;
                        request.status = xhr.status;
                        request.error = error;
                        
                        logAjaxRequest(request);
                        
                        if (originalError) {
                            originalError.apply(this, arguments);
                        }
                    };
                    
                    return originalAjax.call(this, options);
                };
                
                function logAjaxRequest(request) {
                    ajaxRequests.push(request);
                    
                    // Update debug panel
                    var panel = document.getElementById('ajax-requests-list');
                    if (panel) {
                        var html = '<div class="ajax-request">';
                        html += '<div class="ajax-request-header" onclick="toggleDetails(this)">';
                        html += request.type + ' ' + request.url + ' (' + request.duration.toFixed(2) + 'ms)';
                        html += '</div>';
                        html += '<div class="ajax-request-details">';
                        html += '<strong>Status:</strong> ' + request.status + '<br>';
                        html += '<strong>Duration:</strong> ' + request.duration.toFixed(2) + 'ms<br>';
                        
                        if (request.data) {
                            html += '<strong>Request Data:</strong>';
                            html += '<pre>' + JSON.stringify(request.data, null, 2) + '</pre>';
                        }
                        
                        if (request.response) {
                            html += '<strong>Response:</strong>';
                            html += '<pre>' + JSON.stringify(request.response, null, 2) + '</pre>';
                        }
                        
                        if (request.error) {
                            html += '<strong>Error:</strong> ' + request.error;
                        }
                        
                        html += '</div>';
                        html += '</div>';
                        
                        panel.innerHTML = html + panel.innerHTML;
                    }
                    
                    // Log to console
                    console.group('AJAX Request: ' + request.type + ' ' + request.url);
                    console.log('Duration:', request.duration.toFixed(2) + 'ms');
                    console.log('Status:', request.status);
                    if (request.data) console.log('Data:', request.data);
                    if (request.response) console.log('Response:', request.response);
                    if (request.error) console.error('Error:', request.error);
                    console.groupEnd();
                }
            }
            
            // Toggle request details
            window.toggleDetails = function(element) {
                var details = element.nextElementSibling;
                details.style.display = details.style.display === 'none' ? 'block' : 'none';
            };
            
            // Show debug panel on key press
            document.addEventListener('keydown', function(e) {
                if (e.ctrlKey && e.shiftKey && e.key === 'D') {
                    var panel = document.getElementById('ajax-debug-panel');
                    if (panel) {
                        panel.style.display = panel.style.display === 'none' ? 'block' : 'none';
                    }
                }
            });
        })();
        </script>
        <?php
    }
}

// Initialize AJAX debugger
if (WP_DEBUG) {
    new WP_AJAX_Debugger();
}
                        </code></pre>
                    </section>
                    
                    <!-- Error Recovery -->
                    <section>
                        <h2>Error Recovery System</h2>
                        
                        <h3>Automated Error Recovery</h3>
                        <pre><code class="language-php">
&lt;?php
/**
 * WordPress Error Recovery System
 */
class WP_Error_Recovery {
    
    private $error_threshold = 5;
    private $recovery_mode = false;
    
    public function __construct() {
        // Check for recovery mode
        $this->check_recovery_mode();
        
        // Register error handlers
        register_shutdown_function([$this, 'handle_fatal_error']);
        set_error_handler([$this, 'handle_error']);
        set_exception_handler([$this, 'handle_exception']);
        
        // Plugin/theme error protection
        add_filter('wp_fatal_error_handler_enabled', '__return_true');
        add_action('wp_fatal_error_handler', [$this, 'fatal_error_handler']);
        
        // Safe mode
        if ($this->recovery_mode) {
            $this->enter_safe_mode();
        }
    }
    
    /**
     * Check if should enter recovery mode
     */
    private function check_recovery_mode() {
        $error_count = get_transient('wp_fatal_error_count');
        
        if ($error_count >= $this->error_threshold) {
            $this->recovery_mode = true;
        }
        
        // Check for recovery parameter
        if (isset($_GET['wp_recovery_mode']) && $_GET['wp_recovery_mode'] === get_option('recovery_mode_key')) {
            $this->recovery_mode = true;
        }
    }
    
    /**
     * Enter safe mode
     */
    private function enter_safe_mode() {
        // Disable all plugins
        add_filter('option_active_plugins', function() {
            return [];
        });
        
        // Switch to default theme
        add_filter('template', function() {
            return WP_DEFAULT_THEME;
        });
        
        add_filter('stylesheet', function() {
            return WP_DEFAULT_THEME;
        });
        
        // Add admin notice
        add_action('admin_notices', function() {
            ?>
            <div class="notice notice-warning">
                <p><strong>Recovery Mode Active:</strong> The site is running in safe mode due to errors. 
                   All plugins have been temporarily disabled.</p>
                <p><a href="<?php echo admin_url('plugins.php'); ?>">Manage Plugins</a> | 
                   <a href="<?php echo wp_nonce_url(admin_url('admin-post.php?action=exit_recovery_mode'), 'exit_recovery'); ?>">Exit Recovery Mode</a></p>
            </div>
            <?php
        });
    }
    
    /**
     * Handle fatal errors
     */
    public function handle_fatal_error() {
        $error = error_get_last();
        
        if ($error && $this->is_fatal($error['type'])) {
            // Log error
            $this->log_error($error);
            
            // Increment error counter
            $count = get_transient('wp_fatal_error_count') ?: 0;
            set_transient('wp_fatal_error_count', $count + 1, HOUR_IN_SECONDS);
            
            // Attempt recovery
            $this->attempt_recovery($error);
        }
    }
    
    /**
     * Attempt to recover from error
     */
    private function attempt_recovery($error) {
        // Identify problematic plugin/theme
        $culprit = $this->identify_culprit($error['file']);
        
        if ($culprit) {
            // Disable problematic component
            $this->disable_component($culprit);
            
            // Send recovery email
            $this->send_recovery_email($error, $culprit);
            
            // Generate recovery link
            $recovery_key = wp_generate_password(20, false);
            update_option('recovery_mode_key', $recovery_key);
            
            $recovery_url = add_query_arg([
                'wp_recovery_mode' => $recovery_key
            ], admin_url());
            
            // Display recovery message
            wp_die(
                sprintf(
                    'A critical error occurred. The site administrator has been notified. 
                     <a href="%s">Enter Recovery Mode</a>',
                    esc_url($recovery_url)
                ),
                'Critical Error',
                ['response' => 500]
            );
        }
    }
    
    /**
     * Identify culprit plugin/theme
     */
    private function identify_culprit($file) {
        // Check if in plugin
        if (strpos($file, WP_PLUGIN_DIR) !== false) {
            $plugin_dir = str_replace(WP_PLUGIN_DIR . '/', '', $file);
            $plugin_dir = substr($plugin_dir, 0, strpos($plugin_dir, '/'));
            
            return ['type' => 'plugin', 'name' => $plugin_dir];
        }
        
        // Check if in theme
        if (strpos($file, get_theme_root()) !== false) {
            $theme = get_option('stylesheet');
            return ['type' => 'theme', 'name' => $theme];
        }
        
        return null;
    }
    
    /**
     * Disable problematic component
     */
    private function disable_component($culprit) {
        if ($culprit['type'] === 'plugin') {
            // Add to disabled plugins list
            $disabled = get_option('disabled_plugins_recovery', []);
            $disabled[] = $culprit['name'];
            update_option('disabled_plugins_recovery', $disabled);
            
            // Remove from active plugins
            $active = get_option('active_plugins', []);
            $active = array_filter($active, function($plugin) use ($culprit) {
                return strpos($plugin, $culprit['name'] . '/') !== 0;
            });
            update_option('active_plugins', $active);
        } elseif ($culprit['type'] === 'theme') {
            // Switch to default theme
            update_option('template', WP_DEFAULT_THEME);
            update_option('stylesheet', WP_DEFAULT_THEME);
        }
    }
    
    /**
     * Check if error is fatal
     */
    private function is_fatal($type) {
        return in_array($type, [
            E_ERROR,
            E_PARSE,
            E_CORE_ERROR,
            E_COMPILE_ERROR,
            E_USER_ERROR
        ]);
    }
    
    /**
     * Log error
     */
    private function log_error($error) {
        $log_entry = sprintf(
            "[%s] Fatal Error: %s in %s on line %d",
            date('Y-m-d H:i:s'),
            $error['message'],
            $error['file'],
            $error['line']
        );
        
        error_log($log_entry, 3, WP_CONTENT_DIR . '/fatal-errors.log');
    }
}

// Initialize error recovery
new WP_Error_Recovery();
                        </code></pre>
                    </section>
                    
                    <!-- Summary -->
                    <section>
                        <h2>Summary</h2>
                        
                        <div class="summary-box">
                            <h3>Key Takeaways</h3>
                            <ul>
                                <li>Proper debug configuration is essential</li>
                                <li>Custom logging provides detailed insights</li>
                                <li>Query monitoring identifies performance issues</li>
                                <li>AJAX debugging helps with dynamic content</li>
                                <li>Error recovery prevents site downtime</li>
                                <li>Use appropriate tools for different issues</li>
                            </ul>
                        </div>
                        
                        <div class="best-practices">
                            <h3>Debugging Best Practices</h3>
                            <ul>
                                <li>Always use version control</li>
                                <li>Debug in staging environment</li>
                                <li>Log errors without displaying them</li>
                                <li>Use structured logging</li>
                                <li>Monitor performance metrics</li>
                                <li>Implement error recovery</li>
                                <li>Document debugging procedures</li>
                            </ul>
                        </div>
                    </section>
                    
                    <!-- Additional Resources -->
                    <section class="resources">
                        <h2>Additional Resources</h2>
                        <ul>
                            <li><a href="https://wordpress.org/plugins/query-monitor/" target="_blank">Query Monitor Plugin</a></li>
                            <li><a href="https://wordpress.org/plugins/debug-bar/" target="_blank">Debug Bar Plugin</a></li>
                            <li><a href="https://xdebug.org/" target="_blank">Xdebug Documentation</a></li>
                            <li><a href="https://developer.wordpress.org/advanced-administration/debug/debug-wordpress/" target="_blank">WordPress Debugging Guide</a></li>
                        </ul>
                    </section>
                </div>
                
                <!-- Lesson Navigation -->
                <div class="lesson-navigation">
                    <a href="/07module/code_optimization.html" class="lesson-nav-button prev">
                        <svg width="20" height="20" viewBox="0 0 20 20" fill="currentColor">
                            <path d="M12.707 5.293a1 1 0 010 1.414L9.414 10l3.293 3.293a1 1 0 01-1.414 1.414l-4-4a1 1 0 010-1.414l4-4a1 1 0 011.414 0z"/>
                        </svg>
                        <span>
                            <small>Previous</small><br>
                            Code Optimization
                        </span>
                    </a>
                    
                    <button class="complete-lesson-btn">
                        Mark as Complete
                    </button>
                    
                    <a href="/07module/homework_optimization.html" class="lesson-nav-button next">
                        <span>
                            <small>Next</small><br>
                            Homework Project
                        </span>
                        <svg width="20" height="20" viewBox="0 0 20 20" fill="currentColor">
                            <path d="M7.293 14.707a1 1 0 010-1.414L10.586 10 7.293 6.707a1 1 0 011.414-1.414l4 4a1 1 0 010 1.414l-4 4a1 1 0 01-1.414 0z"/>
                        </svg>
                    </a>
                </div>
            </div>
        </main>
        
        <!-- Footer -->
        <footer class="site-footer" role="contentinfo">
            <div class="footer-container">
                <div class="footer-content">
                    <div class="footer-section footer-about">
                        <h3>PHP WordPress Development</h3>
                        <p>Complete Web Development Course - From HTML to WordPress</p>
                    </div>
                    
                    <div class="footer-section">
                        <h4>Quick Links</h4>
                        <ul class="footer-links">
                            <li><a href="/">Home</a></li>
                            <li><a href="/module7.html">Module 7</a></li>
                            <li><a href="/resources.html">Resources</a></li>
                            <li><a href="/about.html">About</a></li>
                        </ul>
                    </div>
                </div>
                
                <div class="footer-bottom">
                    <p>&copy; 2025 PHP WordPress Development Course. All rights reserved.</p>
                </div>
            </div>
        </footer>
    </div>
    
    <!-- JavaScript -->
    <script src="/assets/js/prism.js"></script>
    <script src="/assets/js/main.js"></script>
    <script src="/assets/js/lesson.js"></script>
</body>
</html>