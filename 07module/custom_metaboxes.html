<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    
    <!-- SEO Meta Tags -->
    <title>Custom Metaboxes Without Plugins - PHP WordPress Course</title>
    <meta name="description" content="Learn to create custom metaboxes in WordPress without plugins. Build native WordPress metaboxes with PHP, save data, and create complex interfaces.">
    <meta name="keywords" content="WordPress, metaboxes, custom fields, native WordPress, PHP">
    <meta name="author" content="PHP WordPress Course">
    
    <!-- Open Graph Tags -->
    <meta property="og:title" content="Custom Metaboxes Without Plugins">
    <meta property="og:description" content="Build native WordPress metaboxes without dependencies">
    <meta property="og:type" content="article">
    
    <!-- Favicon -->
    <link rel="icon" type="image/png" href="/favicon.png">
    <link rel="apple-touch-icon" href="/favicon.png">
    
    <!-- CSS -->
    <link rel="stylesheet" href="/assets/css/main.css">
    
    <!-- Prism.js for syntax highlighting -->
    <link href="/assets/css/prism.css" rel="stylesheet">
</head>
<body>
    <!-- Skip to main content -->
    <a href="#main-content" class="sr-only">Skip to main content</a>
    
    <div class="page-wrapper">
        <!-- Header -->
        <header class="site-header" role="banner">
            <div class="header-container">
                <div class="site-branding">
                    <a href="/" class="site-logo">
                        <h1 class="site-title">PHP WordPress Development</h1>
                    </a>
                </div>
                
                <nav class="main-navigation" role="navigation" aria-label="Main navigation">
                    <button class="mobile-menu-btn" aria-label="Toggle navigation" aria-expanded="false">
                        <span></span>
                        <span></span>
                        <span></span>
                    </button>
                    
                    <div class="nav-menu">
                        <ul class="nav-list">
                            <li class="nav-item"><a href="/" class="nav-link">Home</a></li>
                            <li class="nav-item dropdown">
                                <button class="nav-link dropdown-toggle active" aria-haspopup="true">Modules</button>
                                <div class="dropdown-menu">
                                    <a href="/module1.html" class="dropdown-item">Module 1: Web Fundamentals</a>
                                    <a href="/module2.html" class="dropdown-item">Module 2: PHP Fundamentals</a>
                                    <a href="/module3.html" class="dropdown-item">Module 3: MySQL Database</a>
                                    <a href="/module4.html" class="dropdown-item">Module 4: WordPress & Docker</a>
                                    <a href="/module5.html" class="dropdown-item">Module 5: Theme Development</a>
                                    <a href="/module6.html" class="dropdown-item">Module 6: Plugin Development</a>
                                    <a href="/module7.html" class="dropdown-item active">Module 7: Advanced WordPress</a>
                                    <a href="/module8.html" class="dropdown-item">Module 8: Deployment</a>
                                    <a href="/module9.html" class="dropdown-item">Module 9: Final Project</a>
                                </div>
                            </li>
                            <li class="nav-item"><a href="/resources.html" class="nav-link">Resources</a></li>
                            <li class="nav-item"><a href="/about.html" class="nav-link">About</a></li>
                        </ul>
                    </div>
                </nav>
                
                <div class="search-container">
                    <div class="search-input-wrapper">
                        <svg class="search-icon" width="20" height="20" viewBox="0 0 20 20" fill="currentColor">
                            <path fill-rule="evenodd" d="M8 4a4 4 0 100 8 4 4 0 000-8zM2 8a6 6 0 1110.89 3.476l4.817 4.817a1 1 0 01-1.414 1.414l-4.816-4.816A6 6 0 012 8z" clip-rule="evenodd" />
                        </svg>
                        <input type="search" class="search-input" placeholder="Search lessons..." aria-label="Search">
                    </div>
                    <div class="search-results"></div>
                </div>
            </div>
        </header>
        
        <!-- Progress Bar -->
        <div class="progress-container">
            <div class="progress-header">
                <h2 class="progress-title">Course Progress</h2>
                <span class="progress-text">Loading...</span>
            </div>
            <div class="progress-bar">
                <div class="progress-bar-fill">
                    <span class="progress-bar-text"></span>
                </div>
            </div>
        </div>
        
        <!-- Breadcrumb -->
        <nav class="breadcrumb container" aria-label="Breadcrumb">
            <ol class="breadcrumb-list">
                <li class="breadcrumb-item">
                    <a href="/">Home</a>
                    <span class="breadcrumb-separator">/</span>
                </li>
                <li class="breadcrumb-item">
                    <a href="/module7.html">Module 7</a>
                    <span class="breadcrumb-separator">/</span>
                </li>
                <li class="breadcrumb-item">
                    <span aria-current="page">Custom Metaboxes</span>
                </li>
            </ol>
        </nav>
        
        <!-- Main Content -->
        <main id="main-content" class="main-content" role="main">
            <div class="container">
                <!-- Lesson Header -->
                <div class="lesson-header">
                    <h1 class="lesson-title">Custom Metaboxes Without Plugins</h1>
                    <p class="lesson-subtitle">Build native WordPress metaboxes with pure PHP</p>
                </div>
                
                <!-- Learning Objectives -->
                <div class="lesson-objectives">
                    <h2>Learning Objectives</h2>
                    <p>By the end of this lesson, you will be able to:</p>
                    <ul>
                        <li>Create custom metaboxes using WordPress APIs</li>
                        <li>Save and retrieve metabox data</li>
                        <li>Implement security with nonces and sanitization</li>
                        <li>Build complex field types</li>
                        <li>Create repeatable fields</li>
                        <li>Style metaboxes with CSS and JavaScript</li>
                    </ul>
                </div>
                
                <!-- Lesson Body -->
                <div class="lesson-body">
                    <!-- Introduction to Metaboxes -->
                    <section>
                        <h2>Understanding WordPress Metaboxes</h2>
                        
                        <p>Metaboxes are the draggable boxes you see on post edit screens in WordPress. They provide a way to add custom fields and functionality to your content editing experience.</p>
                        
                        <div class="info-box">
                            <h3>When to Use Native Metaboxes</h3>
                            <ul>
                                <li><strong>No plugin dependency:</strong> Full control over your code</li>
                                <li><strong>Lightweight:</strong> No extra plugin overhead</li>
                                <li><strong>Custom requirements:</strong> Specific functionality needs</li>
                                <li><strong>Learning:</strong> Understanding WordPress internals</li>
                                <li><strong>Client restrictions:</strong> When plugins are not allowed</li>
                            </ul>
                        </div>
                    </section>
                    
                    <!-- Basic Metabox Creation -->
                    <section>
                        <h2>Creating a Basic Metabox</h2>
                        
                        <h3>Registering a Metabox</h3>
                        <pre><code class="language-php">
// Hook into the add_meta_boxes action
add_action('add_meta_boxes', 'register_custom_metaboxes');

function register_custom_metaboxes() {
    add_meta_box(
        'custom_product_details',           // Unique ID
        'Product Details',                  // Box title
        'render_product_details_metabox',   // Content callback
        'product',                          // Post type
        'normal',                           // Context (normal, side, advanced)
        'high',                             // Priority (high, low, default)
        null                               // Callback args
    );
}

// Render the metabox content
function render_product_details_metabox($post) {
    // Add nonce for security
    wp_nonce_field('product_details_nonce', 'product_details_nonce_field');
    
    // Get existing values
    $price = get_post_meta($post->ID, '_product_price', true);
    $sku = get_post_meta($post->ID, '_product_sku', true);
    $stock = get_post_meta($post->ID, '_product_stock', true);
    
    ?>
    &lt;div class="custom-metabox"&gt;
        &lt;p&gt;
            &lt;label for="product_price"&gt;Price:&lt;/label&gt;
            &lt;input type="number" 
                   id="product_price" 
                   name="product_price" 
                   value="&lt;?php echo esc_attr($price); ?&gt;" 
                   step="0.01" 
                   min="0" /&gt;
        &lt;/p&gt;
        
        &lt;p&gt;
            &lt;label for="product_sku"&gt;SKU:&lt;/label&gt;
            &lt;input type="text" 
                   id="product_sku" 
                   name="product_sku" 
                   value="&lt;?php echo esc_attr($sku); ?&gt;" /&gt;
        &lt;/p&gt;
        
        &lt;p&gt;
            &lt;label for="product_stock"&gt;Stock Quantity:&lt;/label&gt;
            &lt;input type="number" 
                   id="product_stock" 
                   name="product_stock" 
                   value="&lt;?php echo esc_attr($stock); ?&gt;" 
                   min="0" /&gt;
        &lt;/p&gt;
    &lt;/div&gt;
    
    &lt;style&gt;
        .custom-metabox label {
            display: inline-block;
            width: 150px;
            font-weight: bold;
        }
        .custom-metabox input[type="text"],
        .custom-metabox input[type="number"] {
            width: 250px;
        }
    &lt;/style&gt;
    &lt;?php
}
                        </code></pre>
                        
                        <h3>Saving Metabox Data</h3>
                        <pre><code class="language-php">
// Hook into save_post to save metabox data
add_action('save_post', 'save_product_details_metabox');

function save_product_details_metabox($post_id) {
    // Check if nonce is set
    if (!isset($_POST['product_details_nonce_field'])) {
        return;
    }
    
    // Verify nonce
    if (!wp_verify_nonce($_POST['product_details_nonce_field'], 'product_details_nonce')) {
        return;
    }
    
    // Check autosave
    if (defined('DOING_AUTOSAVE') && DOING_AUTOSAVE) {
        return;
    }
    
    // Check user permissions
    if (!current_user_can('edit_post', $post_id)) {
        return;
    }
    
    // Sanitize and save the data
    if (isset($_POST['product_price'])) {
        $price = sanitize_text_field($_POST['product_price']);
        update_post_meta($post_id, '_product_price', $price);
    }
    
    if (isset($_POST['product_sku'])) {
        $sku = sanitize_text_field($_POST['product_sku']);
        update_post_meta($post_id, '_product_sku', $sku);
    }
    
    if (isset($_POST['product_stock'])) {
        $stock = intval($_POST['product_stock']);
        update_post_meta($post_id, '_product_stock', $stock);
    }
}
                        </code></pre>
                    </section>
                    
                    <!-- Complex Field Types -->
                    <section>
                        <h2>Complex Field Types</h2>
                        
                        <h3>Creating Different Field Types</h3>
                        <pre><code class="language-php">
// Metabox with various field types
function render_advanced_fields_metabox($post) {
    wp_nonce_field('advanced_fields_nonce', 'advanced_fields_nonce_field');
    
    // Get saved values
    $text_field = get_post_meta($post->ID, '_text_field', true);
    $textarea_field = get_post_meta($post->ID, '_textarea_field', true);
    $select_field = get_post_meta($post->ID, '_select_field', true);
    $checkbox_field = get_post_meta($post->ID, '_checkbox_field', true);
    $radio_field = get_post_meta($post->ID, '_radio_field', true);
    $date_field = get_post_meta($post->ID, '_date_field', true);
    $color_field = get_post_meta($post->ID, '_color_field', true);
    $file_field = get_post_meta($post->ID, '_file_field', true);
    
    ?>
    &lt;table class="form-table"&gt;
        &lt;!-- Text Field --&gt;
        &lt;tr&gt;
            &lt;th&gt;&lt;label for="text_field"&gt;Text Field&lt;/label&gt;&lt;/th&gt;
            &lt;td&gt;
                &lt;input type="text" 
                       id="text_field" 
                       name="text_field" 
                       value="&lt;?php echo esc_attr($text_field); ?&gt;" 
                       class="regular-text" /&gt;
                &lt;p class="description"&gt;Enter some text&lt;/p&gt;
            &lt;/td&gt;
        &lt;/tr&gt;
        
        &lt;!-- Textarea Field --&gt;
        &lt;tr&gt;
            &lt;th&gt;&lt;label for="textarea_field"&gt;Textarea&lt;/label&gt;&lt;/th&gt;
            &lt;td&gt;
                &lt;textarea id="textarea_field" 
                          name="textarea_field" 
                          rows="5" 
                          cols="50"&gt;&lt;?php echo esc_textarea($textarea_field); ?&gt;&lt;/textarea&gt;
            &lt;/td&gt;
        &lt;/tr&gt;
        
        &lt;!-- Select Field --&gt;
        &lt;tr&gt;
            &lt;th&gt;&lt;label for="select_field"&gt;Select Field&lt;/label&gt;&lt;/th&gt;
            &lt;td&gt;
                &lt;select id="select_field" name="select_field"&gt;
                    &lt;option value=""&gt;Select an option&lt;/option&gt;
                    &lt;option value="option1" &lt;?php selected($select_field, 'option1'); ?&gt;&gt;Option 1&lt;/option&gt;
                    &lt;option value="option2" &lt;?php selected($select_field, 'option2'); ?&gt;&gt;Option 2&lt;/option&gt;
                    &lt;option value="option3" &lt;?php selected($select_field, 'option3'); ?&gt;&gt;Option 3&lt;/option&gt;
                &lt;/select&gt;
            &lt;/td&gt;
        &lt;/tr&gt;
        
        &lt;!-- Checkbox Field --&gt;
        &lt;tr&gt;
            &lt;th&gt;&lt;label for="checkbox_field"&gt;Checkbox&lt;/label&gt;&lt;/th&gt;
            &lt;td&gt;
                &lt;input type="checkbox" 
                       id="checkbox_field" 
                       name="checkbox_field" 
                       value="1" 
                       &lt;?php checked($checkbox_field, '1'); ?&gt; /&gt;
                &lt;label for="checkbox_field"&gt;Check this box&lt;/label&gt;
            &lt;/td&gt;
        &lt;/tr&gt;
        
        &lt;!-- Radio Field --&gt;
        &lt;tr&gt;
            &lt;th&gt;Radio Options&lt;/th&gt;
            &lt;td&gt;
                &lt;fieldset&gt;
                    &lt;label&gt;
                        &lt;input type="radio" 
                               name="radio_field" 
                               value="yes" 
                               &lt;?php checked($radio_field, 'yes'); ?&gt; /&gt;
                        Yes
                    &lt;/label&gt;&lt;br&gt;
                    &lt;label&gt;
                        &lt;input type="radio" 
                               name="radio_field" 
                               value="no" 
                               &lt;?php checked($radio_field, 'no'); ?&gt; /&gt;
                        No
                    &lt;/label&gt;&lt;br&gt;
                    &lt;label&gt;
                        &lt;input type="radio" 
                               name="radio_field" 
                               value="maybe" 
                               &lt;?php checked($radio_field, 'maybe'); ?&gt; /&gt;
                        Maybe
                    &lt;/label&gt;
                &lt;/fieldset&gt;
            &lt;/td&gt;
        &lt;/tr&gt;
        
        &lt;!-- Date Field --&gt;
        &lt;tr&gt;
            &lt;th&gt;&lt;label for="date_field"&gt;Date&lt;/label&gt;&lt;/th&gt;
            &lt;td&gt;
                &lt;input type="date" 
                       id="date_field" 
                       name="date_field" 
                       value="&lt;?php echo esc_attr($date_field); ?&gt;" /&gt;
            &lt;/td&gt;
        &lt;/tr&gt;
        
        &lt;!-- Color Picker --&gt;
        &lt;tr&gt;
            &lt;th&gt;&lt;label for="color_field"&gt;Color&lt;/label&gt;&lt;/th&gt;
            &lt;td&gt;
                &lt;input type="text" 
                       id="color_field" 
                       name="color_field" 
                       value="&lt;?php echo esc_attr($color_field); ?&gt;" 
                       class="color-picker" /&gt;
            &lt;/td&gt;
        &lt;/tr&gt;
        
        &lt;!-- File Upload --&gt;
        &lt;tr&gt;
            &lt;th&gt;&lt;label for="file_field"&gt;File Upload&lt;/label&gt;&lt;/th&gt;
            &lt;td&gt;
                &lt;input type="hidden" 
                       id="file_field" 
                       name="file_field" 
                       value="&lt;?php echo esc_attr($file_field); ?&gt;" /&gt;
                &lt;input type="button" 
                       id="upload_file_button" 
                       class="button" 
                       value="Upload File" /&gt;
                &lt;span id="file_preview"&gt;
                    &lt;?php if ($file_field): ?&gt;
                        &lt;a href="&lt;?php echo esc_url(wp_get_attachment_url($file_field)); ?&gt;" target="_blank"&gt;
                            View File
                        &lt;/a&gt;
                    &lt;?php endif; ?&gt;
                &lt;/span&gt;
            &lt;/td&gt;
        &lt;/tr&gt;
    &lt;/table&gt;
    &lt;?php
}
                        </code></pre>
                        
                        <h3>Media Upload JavaScript</h3>
                        <pre><code class="language-javascript">
// Enqueue media uploader and custom scripts
add_action('admin_enqueue_scripts', 'enqueue_metabox_scripts');

function enqueue_metabox_scripts($hook) {
    global $post;
    
    // Only load on post edit screens
    if (!in_array($hook, ['post.php', 'post-new.php'])) {
        return;
    }
    
    // Enqueue WordPress media scripts
    wp_enqueue_media();
    
    // Enqueue color picker
    wp_enqueue_style('wp-color-picker');
    wp_enqueue_script('wp-color-picker');
    
    // Custom metabox script
    wp_enqueue_script(
        'custom-metabox-script',
        get_template_directory_uri() . '/js/metabox.js',
        ['jquery', 'wp-color-picker'],
        '1.0.0',
        true
    );
}

// metabox.js
jQuery(document).ready(function($) {
    
    // Initialize color picker
    $('.color-picker').wpColorPicker();
    
    // Media upload
    $('#upload_file_button').click(function(e) {
        e.preventDefault();
        
        var fileUploader = wp.media({
            title: 'Select File',
            button: {
                text: 'Use this file'
            },
            multiple: false
        });
        
        fileUploader.on('select', function() {
            var attachment = fileUploader.state().get('selection').first().toJSON();
            $('#file_field').val(attachment.id);
            $('#file_preview').html('&lt;a href="' + attachment.url + '" target="_blank"&gt;View File&lt;/a&gt;');
        });
        
        fileUploader.open();
    });
});
                        </code></pre>
                    </section>
                    
                    <!-- Repeatable Fields -->
                    <section>
                        <h2>Repeatable Fields</h2>
                        
                        <h3>Creating Repeater Fields</h3>
                        <pre><code class="language-php">
// Repeatable field metabox
function render_repeatable_metabox($post) {
    wp_nonce_field('repeatable_meta_nonce', 'repeatable_meta_nonce_field');
    
    $repeatable_fields = get_post_meta($post->ID, '_repeatable_fields', true);
    
    ?>
    &lt;div id="repeatable-fieldset-wrapper"&gt;
        &lt;table id="repeatable-fieldset" class="wp-list-table"&gt;
            &lt;thead&gt;
                &lt;tr&gt;
                    &lt;th width="3%"&gt;&lt;/th&gt;
                    &lt;th width="30%"&gt;Name&lt;/th&gt;
                    &lt;th width="30%"&gt;Email&lt;/th&gt;
                    &lt;th width="30%"&gt;Phone&lt;/th&gt;
                    &lt;th width="7%"&gt;&lt;/th&gt;
                &lt;/tr&gt;
            &lt;/thead&gt;
            &lt;tbody&gt;
                &lt;?php
                if ($repeatable_fields) {
                    foreach ($repeatable_fields as $field) {
                        ?>
                        &lt;tr&gt;
                            &lt;td&gt;&lt;span class="sort dashicons dashicons-menu"&gt;&lt;/span&gt;&lt;/td&gt;
                            &lt;td&gt;
                                &lt;input type="text" 
                                       name="repeatable_name[]" 
                                       value="&lt;?php echo esc_attr($field['name'] ?? ''); ?&gt;" 
                                       class="regular-text" /&gt;
                            &lt;/td&gt;
                            &lt;td&gt;
                                &lt;input type="email" 
                                       name="repeatable_email[]" 
                                       value="&lt;?php echo esc_attr($field['email'] ?? ''); ?&gt;" 
                                       class="regular-text" /&gt;
                            &lt;/td&gt;
                            &lt;td&gt;
                                &lt;input type="text" 
                                       name="repeatable_phone[]" 
                                       value="&lt;?php echo esc_attr($field['phone'] ?? ''); ?&gt;" 
                                       class="regular-text" /&gt;
                            &lt;/td&gt;
                            &lt;td&gt;
                                &lt;button class="remove-row button"&gt;Remove&lt;/button&gt;
                            &lt;/td&gt;
                        &lt;/tr&gt;
                        &lt;?php
                    }
                } else {
                    // Show empty row
                    ?>
                    &lt;tr&gt;
                        &lt;td&gt;&lt;span class="sort dashicons dashicons-menu"&gt;&lt;/span&gt;&lt;/td&gt;
                        &lt;td&gt;&lt;input type="text" name="repeatable_name[]" class="regular-text" /&gt;&lt;/td&gt;
                        &lt;td&gt;&lt;input type="email" name="repeatable_email[]" class="regular-text" /&gt;&lt;/td&gt;
                        &lt;td&gt;&lt;input type="text" name="repeatable_phone[]" class="regular-text" /&gt;&lt;/td&gt;
                        &lt;td&gt;&lt;button class="remove-row button"&gt;Remove&lt;/button&gt;&lt;/td&gt;
                    &lt;/tr&gt;
                    &lt;?php
                }
                ?&gt;
                
                &lt;!-- Empty hidden row for cloning --&gt;
                &lt;tr class="empty-row screen-reader-text"&gt;
                    &lt;td&gt;&lt;span class="sort dashicons dashicons-menu"&gt;&lt;/span&gt;&lt;/td&gt;
                    &lt;td&gt;&lt;input type="text" name="repeatable_name[]" class="regular-text" /&gt;&lt;/td&gt;
                    &lt;td&gt;&lt;input type="email" name="repeatable_email[]" class="regular-text" /&gt;&lt;/td&gt;
                    &lt;td&gt;&lt;input type="text" name="repeatable_phone[]" class="regular-text" /&gt;&lt;/td&gt;
                    &lt;td&gt;&lt;button class="remove-row button"&gt;Remove&lt;/button&gt;&lt;/td&gt;
                &lt;/tr&gt;
            &lt;/tbody&gt;
        &lt;/table&gt;
        
        &lt;p&gt;&lt;button id="add-row" class="button button-primary"&gt;Add Row&lt;/button&gt;&lt;/p&gt;
    &lt;/div&gt;
    
    &lt;script&gt;
    jQuery(document).ready(function($) {
        // Add row
        $('#add-row').on('click', function(e) {
            e.preventDefault();
            var row = $('.empty-row.screen-reader-text').clone(true);
            row.removeClass('empty-row screen-reader-text');
            row.insertBefore('.empty-row');
            return false;
        });
        
        // Remove row
        $('.remove-row').on('click', function(e) {
            e.preventDefault();
            $(this).closest('tr').remove();
            return false;
        });
        
        // Make sortable
        $('#repeatable-fieldset tbody').sortable({
            handle: '.sort',
            opacity: 0.6,
            cursor: 'move',
            axis: 'y'
        });
    });
    &lt;/script&gt;
    
    &lt;style&gt;
        #repeatable-fieldset .sort {
            cursor: move;
        }
        .screen-reader-text {
            display: none;
        }
    &lt;/style&gt;
    &lt;?php
}

// Save repeatable fields
function save_repeatable_metabox($post_id) {
    if (!isset($_POST['repeatable_meta_nonce_field']) || 
        !wp_verify_nonce($_POST['repeatable_meta_nonce_field'], 'repeatable_meta_nonce')) {
        return;
    }
    
    if (defined('DOING_AUTOSAVE') && DOING_AUTOSAVE) {
        return;
    }
    
    if (!current_user_can('edit_post', $post_id)) {
        return;
    }
    
    $old = get_post_meta($post_id, '_repeatable_fields', true);
    $new = [];
    
    $names = $_POST['repeatable_name'] ?? [];
    $emails = $_POST['repeatable_email'] ?? [];
    $phones = $_POST['repeatable_phone'] ?? [];
    
    $count = count($names);
    
    for ($i = 0; $i < $count; $i++) {
        if ($names[$i] != '') {
            $new[$i]['name'] = sanitize_text_field($names[$i]);
            $new[$i]['email'] = sanitize_email($emails[$i]);
            $new[$i]['phone'] = sanitize_text_field($phones[$i]);
        }
    }
    
    if (!empty($new) && $new != $old) {
        update_post_meta($post_id, '_repeatable_fields', $new);
    } elseif (empty($new) && $old) {
        delete_post_meta($post_id, '_repeatable_fields', $old);
    }
}
                        </code></pre>
                    </section>
                    
                    <!-- WYSIWYG Editor in Metabox -->
                    <section>
                        <h2>WYSIWYG Editor in Metabox</h2>
                        
                        <pre><code class="language-php">
// Adding WordPress editor to metabox
function render_editor_metabox($post) {
    wp_nonce_field('editor_metabox_nonce', 'editor_metabox_nonce_field');
    
    $content = get_post_meta($post->ID, '_custom_editor_content', true);
    $additional_content = get_post_meta($post->ID, '_additional_content', true);
    
    ?>
    &lt;div class="custom-editor-wrapper"&gt;
        &lt;h4&gt;Main Content Editor&lt;/h4&gt;
        &lt;?php
        // WordPress editor settings
        $editor_settings = [
            'textarea_name' => 'custom_editor_content',
            'textarea_rows' => 10,
            'media_buttons' => true,
            'teeny' => false,
            'tinymce' => [
                'toolbar1' => 'formatselect,bold,italic,underline,bullist,numlist,blockquote,alignleft,aligncenter,alignright,link,unlink,wp_more,spellchecker,fullscreen,wp_adv',
                'toolbar2' => 'strikethrough,hr,forecolor,pastetext,removeformat,charmap,outdent,indent,undo,redo,wp_help'
            ],
            'quicktags' => true
        ];
        
        wp_editor($content, 'custom_editor_content', $editor_settings);
        ?&gt;
        
        &lt;h4 style="margin-top: 20px;"&gt;Additional Content&lt;/h4&gt;
        &lt;?php
        // Simplified editor
        $simple_settings = [
            'textarea_name' => 'additional_content',
            'textarea_rows' => 5,
            'media_buttons' => false,
            'teeny' => true,
            'tinymce' => [
                'toolbar1' => 'bold,italic,underline,bullist,numlist,link,unlink'
            ],
            'quicktags' => false
        ];
        
        wp_editor($additional_content, 'additional_content', $simple_settings);
        ?&gt;
    &lt;/div&gt;
    &lt;?php
}

// Save WYSIWYG content
function save_editor_metabox($post_id) {
    if (!isset($_POST['editor_metabox_nonce_field']) || 
        !wp_verify_nonce($_POST['editor_metabox_nonce_field'], 'editor_metabox_nonce')) {
        return;
    }
    
    if (isset($_POST['custom_editor_content'])) {
        $content = wp_kses_post($_POST['custom_editor_content']);
        update_post_meta($post_id, '_custom_editor_content', $content);
    }
    
    if (isset($_POST['additional_content'])) {
        $additional = wp_kses_post($_POST['additional_content']);
        update_post_meta($post_id, '_additional_content', $additional);
    }
}
                        </code></pre>
                    </section>
                    
                    <!-- Conditional Metaboxes -->
                    <section>
                        <h2>Conditional Metaboxes</h2>
                        
                        <h3>Show/Hide Based on Page Template</h3>
                        <pre><code class="language-javascript">
// Show metabox only for specific page template
jQuery(document).ready(function($) {
    
    // Function to check page template
    function checkPageTemplate() {
        var template = $('#page_template').val();
        
        if (template === 'template-landing.php') {
            $('#landing_page_settings').show();
        } else {
            $('#landing_page_settings').hide();
        }
    }
    
    // Check on load
    checkPageTemplate();
    
    // Check on template change
    $('#page_template').on('change', checkPageTemplate);
    
    // Show/hide fields based on other field values
    $('input[name="product_type"]').on('change', function() {
        var type = $(this).val();
        
        if (type === 'digital') {
            $('.physical-product-fields').hide();
            $('.digital-product-fields').show();
        } else if (type === 'physical') {
            $('.physical-product-fields').show();
            $('.digital-product-fields').hide();
        }
    });
});
                        </code></pre>
                        
                        <h3>Dynamic Metabox Registration</h3>
                        <pre><code class="language-php">
// Register metaboxes conditionally
add_action('add_meta_boxes', 'conditional_metabox_registration');

function conditional_metabox_registration() {
    global $post;
    
    // Only add for specific page template
    if ($post && get_page_template_slug($post->ID) === 'template-landing.php') {
        add_meta_box(
            'landing_page_settings',
            'Landing Page Settings',
            'render_landing_settings_metabox',
            'page',
            'normal',
            'high'
        );
    }
    
    // Only add for users with specific capabilities
    if (current_user_can('manage_options')) {
        add_meta_box(
            'admin_only_settings',
            'Advanced Settings',
            'render_admin_settings_metabox',
            'post',
            'side',
            'low'
        );
    }
    
    // Add based on post meta
    if ($post) {
        $post_type = get_post_meta($post->ID, '_custom_post_type', true);
        
        if ($post_type === 'special') {
            add_meta_box(
                'special_fields',
                'Special Fields',
                'render_special_fields_metabox',
                'post',
                'normal',
                'default'
            );
        }
    }
}
                        </code></pre>
                    </section>
                    
                    <!-- Metabox Class -->
                    <section>
                        <h2>Reusable Metabox Class</h2>
                        
                        <pre><code class="language-php">
// Reusable metabox class
class Custom_Metabox {
    
    private $id;
    private $title;
    private $post_types;
    private $context;
    private $priority;
    private $fields;
    
    public function __construct($id, $title, $post_types = ['post'], $context = 'normal', $priority = 'default') {
        $this->id = $id;
        $this->title = $title;
        $this->post_types = $post_types;
        $this->context = $context;
        $this->priority = $priority;
        $this->fields = [];
        
        add_action('add_meta_boxes', [$this, 'register']);
        add_action('save_post', [$this, 'save']);
    }
    
    public function add_field($args) {
        $defaults = [
            'id' => '',
            'label' => '',
            'type' => 'text',
            'default' => '',
            'description' => '',
            'options' => [],
            'sanitize_callback' => 'sanitize_text_field'
        ];
        
        $field = wp_parse_args($args, $defaults);
        $this->fields[] = $field;
        
        return $this;
    }
    
    public function register() {
        foreach ($this->post_types as $post_type) {
            add_meta_box(
                $this->id,
                $this->title,
                [$this, 'render'],
                $post_type,
                $this->context,
                $this->priority
            );
        }
    }
    
    public function render($post) {
        wp_nonce_field($this->id . '_nonce', $this->id . '_nonce_field');
        
        echo '&lt;table class="form-table"&gt;';
        
        foreach ($this->fields as $field) {
            $value = get_post_meta($post->ID, '_' . $field['id'], true);
            if (empty($value)) {
                $value = $field['default'];
            }
            
            echo '&lt;tr&gt;';
            echo '&lt;th&gt;&lt;label for="' . esc_attr($field['id']) . '"&gt;' . esc_html($field['label']) . '&lt;/label&gt;&lt;/th&gt;';
            echo '&lt;td&gt;';
            
            $this->render_field($field, $value);
            
            if ($field['description']) {
                echo '&lt;p class="description"&gt;' . esc_html($field['description']) . '&lt;/p&gt;';
            }
            
            echo '&lt;/td&gt;';
            echo '&lt;/tr&gt;';
        }
        
        echo '&lt;/table&gt;';
    }
    
    private function render_field($field, $value) {
        switch ($field['type']) {
            case 'text':
            case 'email':
            case 'url':
            case 'number':
                echo '&lt;input type="' . esc_attr($field['type']) . '" ';
                echo 'id="' . esc_attr($field['id']) . '" ';
                echo 'name="' . esc_attr($field['id']) . '" ';
                echo 'value="' . esc_attr($value) . '" ';
                echo 'class="regular-text" /&gt;';
                break;
                
            case 'textarea':
                echo '&lt;textarea ';
                echo 'id="' . esc_attr($field['id']) . '" ';
                echo 'name="' . esc_attr($field['id']) . '" ';
                echo 'rows="5" cols="50"&gt;';
                echo esc_textarea($value);
                echo '&lt;/textarea&gt;';
                break;
                
            case 'select':
                echo '&lt;select id="' . esc_attr($field['id']) . '" name="' . esc_attr($field['id']) . '"&gt;';
                foreach ($field['options'] as $key => $label) {
                    echo '&lt;option value="' . esc_attr($key) . '" ' . selected($value, $key, false) . '&gt;';
                    echo esc_html($label);
                    echo '&lt;/option&gt;';
                }
                echo '&lt;/select&gt;';
                break;
                
            case 'checkbox':
                echo '&lt;input type="checkbox" ';
                echo 'id="' . esc_attr($field['id']) . '" ';
                echo 'name="' . esc_attr($field['id']) . '" ';
                echo 'value="1" ';
                echo checked($value, '1', false) . ' /&gt;';
                break;
                
            case 'radio':
                foreach ($field['options'] as $key => $label) {
                    echo '&lt;label style="margin-right: 15px;"&gt;';
                    echo '&lt;input type="radio" ';
                    echo 'name="' . esc_attr($field['id']) . '" ';
                    echo 'value="' . esc_attr($key) . '" ';
                    echo checked($value, $key, false) . ' /&gt; ';
                    echo esc_html($label);
                    echo '&lt;/label&gt;';
                }
                break;
        }
    }
    
    public function save($post_id) {
        // Verify nonce
        if (!isset($_POST[$this->id . '_nonce_field']) || 
            !wp_verify_nonce($_POST[$this->id . '_nonce_field'], $this->id . '_nonce')) {
            return;
        }
        
        // Check autosave
        if (defined('DOING_AUTOSAVE') && DOING_AUTOSAVE) {
            return;
        }
        
        // Check permissions
        if (!current_user_can('edit_post', $post_id)) {
            return;
        }
        
        // Save fields
        foreach ($this->fields as $field) {
            if (isset($_POST[$field['id']])) {
                $value = $_POST[$field['id']];
                
                // Sanitize based on field type or callback
                if (is_callable($field['sanitize_callback'])) {
                    $value = call_user_func($field['sanitize_callback'], $value);
                }
                
                update_post_meta($post_id, '_' . $field['id'], $value);
            } elseif ($field['type'] === 'checkbox') {
                // Checkbox not checked
                delete_post_meta($post_id, '_' . $field['id']);
            }
        }
    }
}

// Usage example
$product_metabox = new Custom_Metabox('product_details', 'Product Details', ['product']);

$product_metabox
    ->add_field([
        'id' => 'product_price',
        'label' => 'Price',
        'type' => 'number',
        'description' => 'Enter the product price',
        'sanitize_callback' => 'floatval'
    ])
    ->add_field([
        'id' => 'product_sku',
        'label' => 'SKU',
        'type' => 'text',
        'description' => 'Stock Keeping Unit'
    ])
    ->add_field([
        'id' => 'product_status',
        'label' => 'Status',
        'type' => 'select',
        'options' => [
            'in_stock' => 'In Stock',
            'out_of_stock' => 'Out of Stock',
            'backordered' => 'Backordered'
        ],
        'default' => 'in_stock'
    ])
    ->add_field([
        'id' => 'product_featured',
        'label' => 'Featured Product',
        'type' => 'checkbox',
        'description' => 'Check to feature this product'
    ]);
                        </code></pre>
                    </section>
                    
                    <!-- Gutenberg Compatibility -->
                    <section>
                        <h2>Gutenberg Compatibility</h2>
                        
                        <pre><code class="language-php">
// Make metaboxes work with Gutenberg
add_filter('use_block_editor_for_post_type', 'enable_gutenberg_with_metaboxes', 10, 2);

function enable_gutenberg_with_metaboxes($use_block_editor, $post_type) {
    // Keep Gutenberg enabled but show metaboxes
    return $use_block_editor;
}

// Register metabox for Gutenberg sidebar
add_action('init', 'register_gutenberg_metabox');

function register_gutenberg_metabox() {
    register_meta('post', '_sidebar_meta_key', [
        'show_in_rest' => true,
        'single' => true,
        'type' => 'string',
        'auth_callback' => function() {
            return current_user_can('edit_posts');
        }
    ]);
}

// Add REST API support for custom fields
add_action('rest_api_init', 'register_custom_meta_rest');

function register_custom_meta_rest() {
    register_rest_field('post', 'custom_fields', [
        'get_callback' => function($post) {
            return [
                'field1' => get_post_meta($post['id'], '_field1', true),
                'field2' => get_post_meta($post['id'], '_field2', true)
            ];
        },
        'update_callback' => function($value, $post) {
            update_post_meta($post->ID, '_field1', $value['field1']);
            update_post_meta($post->ID, '_field2', $value['field2']);
        },
        'schema' => [
            'type' => 'object',
            'properties' => [
                'field1' => ['type' => 'string'],
                'field2' => ['type' => 'string']
            ]
        ]
    ]);
}
                        </code></pre>
                    </section>
                    
                    <!-- Summary -->
                    <section>
                        <h2>Summary</h2>
                        
                        <div class="summary-box">
                            <h3>Key Takeaways</h3>
                            <ul>
                                <li>Native metaboxes provide full control without plugin dependencies</li>
                                <li>Always use nonces and proper sanitization for security</li>
                                <li>Complex field types can be built with HTML and JavaScript</li>
                                <li>Repeatable fields require custom JavaScript</li>
                                <li>WordPress editors can be embedded in metaboxes</li>
                                <li>Conditional logic enhances user experience</li>
                                <li>Reusable classes improve code organization</li>
                            </ul>
                        </div>
                        
                        <div class="best-practices">
                            <h3>Metabox Best Practices</h3>
                            <ul>
                                <li>Always verify nonces and check permissions</li>
                                <li>Sanitize all input data appropriately</li>
                                <li>Use WordPress functions like <code>selected()</code> and <code>checked()</code></li>
                                <li>Prefix meta keys with underscore to hide from custom fields</li>
                                <li>Enqueue scripts and styles properly</li>
                                <li>Consider Gutenberg compatibility</li>
                                <li>Test metaboxes with different user roles</li>
                            </ul>
                        </div>
                    </section>
                    
                    <!-- Additional Resources -->
                    <section class="resources">
                        <h2>Additional Resources</h2>
                        <ul>
                            <li><a href="https://developer.wordpress.org/plugins/metadata/custom-meta-boxes/" target="_blank">WordPress Meta Boxes Documentation</a></li>
                            <li><a href="https://developer.wordpress.org/reference/functions/add_meta_box/" target="_blank">add_meta_box() Reference</a></li>
                            <li><a href="https://developer.wordpress.org/reference/functions/wp_nonce_field/" target="_blank">WordPress Nonces</a></li>
                            <li><a href="https://github.com/CMB2/CMB2" target="_blank">CMB2 - Custom Metaboxes 2</a></li>
                        </ul>
                    </section>
                </div>
                
                <!-- Lesson Navigation -->
                <div class="lesson-navigation">
                    <a href="/07module/programmatic_acf.html" class="lesson-nav-button prev">
                        <svg width="20" height="20" viewBox="0 0 20 20" fill="currentColor">
                            <path d="M12.707 5.293a1 1 0 010 1.414L9.414 10l3.293 3.293a1 1 0 01-1.414 1.414l-4-4a1 1 0 010-1.414l4-4a1 1 0 011.414 0z"/>
                        </svg>
                        <span>
                            <small>Previous</small><br>
                            Programmatic ACF
                        </span>
                    </a>
                    
                    <button class="complete-lesson-btn">
                        Mark as Complete
                    </button>
                    
                    <a href="/07module/cmb2_metaboxes.html" class="lesson-nav-button next">
                        <span>
                            <small>Next</small><br>
                            CMB2 for Metaboxes
                        </span>
                        <svg width="20" height="20" viewBox="0 0 20 20" fill="currentColor">
                            <path d="M7.293 14.707a1 1 0 010-1.414L10.586 10 7.293 6.707a1 1 0 011.414-1.414l4 4a1 1 0 010 1.414l-4 4a1 1 0 01-1.414 0z"/>
                        </svg>
                    </a>
                </div>
            </div>
        </main>
        
        <!-- Footer -->
        <footer class="site-footer" role="contentinfo">
            <div class="footer-container">
                <div class="footer-content">
                    <div class="footer-section footer-about">
                        <h3>PHP WordPress Development</h3>
                        <p>Complete Web Development Course - From HTML to WordPress</p>
                    </div>
                    
                    <div class="footer-section">
                        <h4>Quick Links</h4>
                        <ul class="footer-links">
                            <li><a href="/">Home</a></li>
                            <li><a href="/module7.html">Module 7</a></li>
                            <li><a href="/resources.html">Resources</a></li>
                            <li><a href="/about.html">About</a></li>
                        </ul>
                    </div>
                </div>
                
                <div class="footer-bottom">
                    <p>&copy; 2025 PHP WordPress Development Course. All rights reserved.</p>
                </div>
            </div>
        </footer>
    </div>
    
    <!-- JavaScript -->
    <script src="/assets/js/prism.js"></script>
    <script src="/assets/js/main.js"></script>
    <script src="/assets/js/lesson.js"></script>
</body>
</html>