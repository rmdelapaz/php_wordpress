<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    
    <!-- SEO Meta Tags -->
    <title>Advanced CPT Registration Options - PHP WordPress Course</title>
    <meta name="description" content="Learn advanced techniques for registering custom post types in WordPress. Master CPT capabilities, rewrite rules, and advanced configuration options.">
    <meta name="keywords" content="WordPress, Custom Post Types, CPT, advanced registration, WordPress development">
    <meta name="author" content="PHP WordPress Course">
    
    <!-- Open Graph Tags -->
    <meta property="og:title" content="Advanced CPT Registration Options">
    <meta property="og:description" content="Master advanced custom post type registration in WordPress">
    <meta property="og:type" content="article">
    
    <!-- Favicon -->
    <link rel="icon" type="image/png" href="/favicon.png">
    <link rel="apple-touch-icon" href="/favicon.png">
    
    <!-- CSS -->
    <link rel="stylesheet" href="/assets/css/main.css">
    
    <!-- Prism.js for syntax highlighting -->
    <link href="/assets/css/prism.css" rel="stylesheet">
</head>
<body>
    <!-- Skip to main content -->
    <a href="#main-content" class="sr-only">Skip to main content</a>
    
    <div class="page-wrapper">
        <!-- Header -->
        <header class="site-header" role="banner">
            <div class="header-container">
                <div class="site-branding">
                    <a href="/" class="site-logo">
                        <h1 class="site-title">PHP WordPress Development</h1>
                    </a>
                </div>
                
                <nav class="main-navigation" role="navigation" aria-label="Main navigation">
                    <button class="mobile-menu-btn" aria-label="Toggle navigation" aria-expanded="false">
                        <span></span>
                        <span></span>
                        <span></span>
                    </button>
                    
                    <div class="nav-menu">
                        <ul class="nav-list">
                            <li class="nav-item"><a href="/" class="nav-link">Home</a></li>
                            <li class="nav-item dropdown">
                                <button class="nav-link dropdown-toggle active" aria-haspopup="true">Modules</button>
                                <div class="dropdown-menu">
                                    <a href="/module1.html" class="dropdown-item">Module 1: Web Fundamentals</a>
                                    <a href="/module2.html" class="dropdown-item">Module 2: PHP Fundamentals</a>
                                    <a href="/module3.html" class="dropdown-item">Module 3: MySQL Database</a>
                                    <a href="/module4.html" class="dropdown-item">Module 4: WordPress & Docker</a>
                                    <a href="/module5.html" class="dropdown-item">Module 5: Theme Development</a>
                                    <a href="/module6.html" class="dropdown-item">Module 6: Plugin Development</a>
                                    <a href="/module7.html" class="dropdown-item active">Module 7: Advanced WordPress</a>
                                    <a href="/module8.html" class="dropdown-item">Module 8: Deployment</a>
                                    <a href="/module9.html" class="dropdown-item">Module 9: Final Project</a>
                                </div>
                            </li>
                            <li class="nav-item"><a href="/resources.html" class="nav-link">Resources</a></li>
                            <li class="nav-item"><a href="/about.html" class="nav-link">About</a></li>
                        </ul>
                    </div>
                </nav>
                
                <div class="search-container">
                    <div class="search-input-wrapper">
                        <svg class="search-icon" width="20" height="20" viewBox="0 0 20 20" fill="currentColor">
                            <path fill-rule="evenodd" d="M8 4a4 4 0 100 8 4 4 0 000-8zM2 8a6 6 0 1110.89 3.476l4.817 4.817a1 1 0 01-1.414 1.414l-4.816-4.816A6 6 0 012 8z" clip-rule="evenodd" />
                        </svg>
                        <input type="search" class="search-input" placeholder="Search lessons..." aria-label="Search">
                    </div>
                    <div class="search-results"></div>
                </div>
            </div>
        </header>
        
        <!-- Progress Bar -->
        <div class="progress-container">
            <div class="progress-header">
                <h2 class="progress-title">Course Progress</h2>
                <span class="progress-text">Loading...</span>
            </div>
            <div class="progress-bar">
                <div class="progress-bar-fill">
                    <span class="progress-bar-text"></span>
                </div>
            </div>
        </div>
        
        <!-- Breadcrumb -->
        <nav class="breadcrumb container" aria-label="Breadcrumb">
            <ol class="breadcrumb-list">
                <li class="breadcrumb-item">
                    <a href="/">Home</a>
                    <span class="breadcrumb-separator">/</span>
                </li>
                <li class="breadcrumb-item">
                    <a href="/module7.html">Module 7</a>
                    <span class="breadcrumb-separator">/</span>
                </li>
                <li class="breadcrumb-item">
                    <span aria-current="page">Advanced CPT Registration</span>
                </li>
            </ol>
        </nav>
        
        <!-- Main Content -->
        <main id="main-content" class="main-content" role="main">
            <div class="container">
                <!-- Lesson Header -->
                <div class="lesson-header">
                    <h1 class="lesson-title">Advanced CPT Registration Options</h1>
                    <p class="lesson-subtitle">Master advanced techniques for custom post type registration</p>
                </div>
                
                <!-- Learning Objectives -->
                <div class="lesson-objectives">
                    <h2>Learning Objectives</h2>
                    <p>By the end of this lesson, you will be able to:</p>
                    <ul>
                        <li>Configure advanced CPT registration parameters</li>
                        <li>Implement custom capabilities and permissions</li>
                        <li>Set up complex rewrite rules</li>
                        <li>Create hierarchical post types</li>
                        <li>Configure archive pages and feeds</li>
                        <li>Optimize CPT performance</li>
                    </ul>
                </div>
                
                <!-- Lesson Body -->
                <div class="lesson-body">
                    <!-- Complete CPT Registration -->
                    <section>
                        <h2>Complete CPT Registration Parameters</h2>
                        
                        <h3>All Available Arguments</h3>
                        <pre><code class="language-php">
// Complete CPT registration with all parameters
function register_advanced_cpt() {
    $labels = [
        'name'                  => _x('Products', 'Post type general name', 'textdomain'),
        'singular_name'         => _x('Product', 'Post type singular name', 'textdomain'),
        'menu_name'             => _x('Products', 'Admin Menu text', 'textdomain'),
        'name_admin_bar'        => _x('Product', 'Add New on Toolbar', 'textdomain'),
        'add_new'               => __('Add New', 'textdomain'),
        'add_new_item'          => __('Add New Product', 'textdomain'),
        'new_item'              => __('New Product', 'textdomain'),
        'edit_item'             => __('Edit Product', 'textdomain'),
        'view_item'             => __('View Product', 'textdomain'),
        'all_items'             => __('All Products', 'textdomain'),
        'search_items'          => __('Search Products', 'textdomain'),
        'parent_item_colon'     => __('Parent Products:', 'textdomain'),
        'not_found'             => __('No products found.', 'textdomain'),
        'not_found_in_trash'    => __('No products found in Trash.', 'textdomain'),
        'featured_image'        => _x('Product Cover Image', 'Overrides the "Featured Image" phrase', 'textdomain'),
        'set_featured_image'    => _x('Set cover image', 'Overrides the "Set featured image" phrase', 'textdomain'),
        'remove_featured_image' => _x('Remove cover image', 'Overrides the "Remove featured image" phrase', 'textdomain'),
        'use_featured_image'    => _x('Use as cover image', 'Overrides the "Use as featured image" phrase', 'textdomain'),
        'archives'              => _x('Product archives', 'The post type archive label', 'textdomain'),
        'insert_into_item'      => _x('Insert into product', 'Overrides the "Insert into post" phrase', 'textdomain'),
        'uploaded_to_this_item' => _x('Uploaded to this product', 'Overrides the "Uploaded to this post" phrase', 'textdomain'),
        'filter_items_list'     => _x('Filter products list', 'Screen reader text', 'textdomain'),
        'items_list_navigation' => _x('Products list navigation', 'Screen reader text', 'textdomain'),
        'items_list'            => _x('Products list', 'Screen reader text', 'textdomain'),
        'attributes'            => __('Product Attributes', 'textdomain'),
        'item_published'        => __('Product published', 'textdomain'),
        'item_published_privately' => __('Product published privately', 'textdomain'),
        'item_reverted_to_draft'   => __('Product reverted to draft', 'textdomain'),
        'item_scheduled'        => __('Product scheduled', 'textdomain'),
        'item_updated'          => __('Product updated', 'textdomain'),
    ];
    
    $args = [
        'labels'                => $labels,
        'description'           => __('Product custom post type', 'textdomain'),
        'public'                => true,
        'publicly_queryable'    => true,
        'show_ui'               => true,
        'show_in_menu'          => true,
        'query_var'             => true,
        'rewrite'               => [
            'slug'              => 'products',
            'with_front'        => false,
            'pages'             => true,
            'feeds'             => true,
            'ep_mask'           => EP_PERMALINK
        ],
        'capability_type'       => 'product',
        'capabilities'          => [
            'edit_post'          => 'edit_product',
            'read_post'          => 'read_product',
            'delete_post'        => 'delete_product',
            'edit_posts'         => 'edit_products',
            'edit_others_posts'  => 'edit_others_products',
            'publish_posts'      => 'publish_products',
            'read_private_posts' => 'read_private_products',
            'create_posts'       => 'create_products',
        ],
        'map_meta_cap'          => true,
        'has_archive'           => 'products',
        'hierarchical'          => false,
        'menu_position'         => 5,
        'menu_icon'             => 'dashicons-products',
        'supports'              => [
            'title',
            'editor',
            'author',
            'thumbnail',
            'excerpt',
            'trackbacks',
            'custom-fields',
            'comments',
            'revisions',
            'page-attributes',
            'post-formats'
        ],
        'taxonomies'            => ['category', 'post_tag'],
        'show_in_rest'          => true,
        'rest_base'             => 'products',
        'rest_controller_class' => 'WP_REST_Posts_Controller',
        'rest_namespace'        => 'wp/v2',
        'exclude_from_search'   => false,
        'can_export'            => true,
        'delete_with_user'      => false,
        'template'              => [
            ['core/paragraph', ['placeholder' => 'Add product description...']],
            ['core/heading', ['level' => 2, 'content' => 'Product Features']],
            ['core/list'],
            ['core/separator'],
            ['core/columns', [], [
                ['core/column', [], [
                    ['core/heading', ['level' => 3, 'content' => 'Specifications']],
                    ['core/paragraph']
                ]],
                ['core/column', [], [
                    ['core/heading', ['level' => 3, 'content' => 'Pricing']],
                    ['core/paragraph']
                ]]
            ]]
        ],
        'template_lock'         => false, // false, 'all', or 'insert'
    ];
    
    register_post_type('product', $args);
}
add_action('init', 'register_advanced_cpt', 0);
                        </code></pre>
                    </section>
                    
                    <!-- Custom Capabilities -->
                    <section>
                        <h2>Custom Capabilities and Permissions</h2>
                        
                        <h3>Setting Up Custom Capabilities</h3>
                        <pre><code class="language-php">
// Create custom capabilities for CPT
class CPT_Capabilities {
    
    public static function init() {
        add_action('init', [__CLASS__, 'register_cpt_with_capabilities']);
        add_action('admin_init', [__CLASS__, 'add_capabilities_to_roles']);
    }
    
    public static function register_cpt_with_capabilities() {
        register_post_type('document', [
            'labels' => self::get_labels(),
            'public' => true,
            'capability_type' => ['document', 'documents'],
            'capabilities' => [
                // Mapping capabilities
                'edit_post'              => 'edit_document',
                'read_post'              => 'read_document',
                'delete_post'            => 'delete_document',
                'edit_posts'             => 'edit_documents',
                'edit_others_posts'      => 'edit_others_documents',
                'edit_private_posts'     => 'edit_private_documents',
                'edit_published_posts'   => 'edit_published_documents',
                'publish_posts'          => 'publish_documents',
                'read_private_posts'     => 'read_private_documents',
                'delete_posts'           => 'delete_documents',
                'delete_private_posts'   => 'delete_private_documents',
                'delete_published_posts' => 'delete_published_documents',
                'delete_others_posts'    => 'delete_others_documents',
                'create_posts'           => 'create_documents',
            ],
            'map_meta_cap' => true,
        ]);
    }
    
    public static function add_capabilities_to_roles() {
        // Only run once
        if (get_option('cpt_capabilities_added')) {
            return;
        }
        
        // Administrator gets all capabilities
        $admin = get_role('administrator');
        $admin->add_cap('edit_document');
        $admin->add_cap('read_document');
        $admin->add_cap('delete_document');
        $admin->add_cap('edit_documents');
        $admin->add_cap('edit_others_documents');
        $admin->add_cap('edit_private_documents');
        $admin->add_cap('edit_published_documents');
        $admin->add_cap('publish_documents');
        $admin->add_cap('read_private_documents');
        $admin->add_cap('delete_documents');
        $admin->add_cap('delete_private_documents');
        $admin->add_cap('delete_published_documents');
        $admin->add_cap('delete_others_documents');
        $admin->add_cap('create_documents');
        
        // Editor gets most capabilities
        $editor = get_role('editor');
        $editor->add_cap('edit_document');
        $editor->add_cap('read_document');
        $editor->add_cap('delete_document');
        $editor->add_cap('edit_documents');
        $editor->add_cap('edit_others_documents');
        $editor->add_cap('edit_published_documents');
        $editor->add_cap('publish_documents');
        $editor->add_cap('delete_documents');
        $editor->add_cap('delete_published_documents');
        $editor->add_cap('create_documents');
        
        // Author gets limited capabilities
        $author = get_role('author');
        $author->add_cap('edit_document');
        $author->add_cap('read_document');
        $author->add_cap('delete_document');
        $author->add_cap('edit_documents');
        $author->add_cap('edit_published_documents');
        $author->add_cap('publish_documents');
        $author->add_cap('delete_documents');
        $author->add_cap('create_documents');
        
        // Create custom role
        add_role('document_manager', 'Document Manager', [
            'read'                      => true,
            'edit_document'             => true,
            'read_document'             => true,
            'delete_document'           => true,
            'edit_documents'            => true,
            'edit_others_documents'     => true,
            'edit_private_documents'    => true,
            'edit_published_documents'  => true,
            'publish_documents'         => true,
            'read_private_documents'    => true,
            'delete_documents'          => true,
            'delete_private_documents'  => true,
            'delete_published_documents'=> true,
            'delete_others_documents'   => true,
            'create_documents'          => true,
            'upload_files'              => true,
        ]);
        
        update_option('cpt_capabilities_added', true);
    }
    
    private static function get_labels() {
        return [
            'name'               => 'Documents',
            'singular_name'      => 'Document',
            'add_new'            => 'Add New',
            'add_new_item'       => 'Add New Document',
            'edit_item'          => 'Edit Document',
            'new_item'           => 'New Document',
            'view_item'          => 'View Document',
            'search_items'       => 'Search Documents',
            'not_found'          => 'No documents found',
            'not_found_in_trash' => 'No documents found in trash',
        ];
    }
}

CPT_Capabilities::init();
                        </code></pre>
                        
                        <h3>Dynamic Capability Checking</h3>
                        <pre><code class="language-php">
// Check capabilities dynamically
function can_user_manage_document($post_id = null) {
    if (!is_user_logged_in()) {
        return false;
    }
    
    $user = wp_get_current_user();
    
    // Check general capability
    if (!$user->has_cap('edit_documents')) {
        return false;
    }
    
    // Check specific post capability
    if ($post_id) {
        $post = get_post($post_id);
        
        // Check if user is author
        if ($post->post_author == $user->ID) {
            return $user->has_cap('edit_document', $post_id);
        }
        
        // Check if user can edit others' posts
        return $user->has_cap('edit_others_documents');
    }
    
    return true;
}

// Use in templates
if (can_user_manage_document(get_the_ID())) {
    echo '<a href="' . get_edit_post_link() . '">Edit Document</a>';
}
                        </code></pre>
                    </section>
                    
                    <!-- Advanced Rewrite Rules -->
                    <section>
                        <h2>Advanced Rewrite Rules</h2>
                        
                        <h3>Complex URL Structures</h3>
                        <pre><code class="language-php">
// Advanced rewrite rules for CPT
class Advanced_CPT_Rewrites {
    
    public static function init() {
        add_action('init', [__CLASS__, 'register_cpt_with_rewrites']);
        add_filter('post_type_link', [__CLASS__, 'custom_post_type_link'], 10, 2);
        add_action('init', [__CLASS__, 'add_rewrite_rules']);
    }
    
    public static function register_cpt_with_rewrites() {
        register_post_type('product', [
            'labels' => self::get_labels(),
            'public' => true,
            'rewrite' => [
                'slug' => 'shop/%product_category%',
                'with_front' => false,
                'pages' => true,
                'feeds' => true,
            ],
            'has_archive' => 'shop',
            'supports' => ['title', 'editor', 'thumbnail'],
        ]);
        
        // Register taxonomy with specific rewrite
        register_taxonomy('product_category', 'product', [
            'labels' => self::get_taxonomy_labels(),
            'hierarchical' => true,
            'rewrite' => [
                'slug' => 'shop/category',
                'with_front' => false,
                'hierarchical' => true,
            ],
        ]);
    }
    
    public static function custom_post_type_link($permalink, $post) {
        if ($post->post_type !== 'product') {
            return $permalink;
        }
        
        // Get the product category
        $terms = wp_get_object_terms($post->ID, 'product_category');
        
        if (!empty($terms) && !is_wp_error($terms)) {
            // Use the first category
            $term = $terms[0];
            
            // Build the hierarchy
            $category_slug = $term->slug;
            
            // If it has a parent, build the full path
            if ($term->parent) {
                $ancestors = get_ancestors($term->term_id, 'product_category');
                foreach ($ancestors as $ancestor) {
                    $ancestor_term = get_term($ancestor, 'product_category');
                    $category_slug = $ancestor_term->slug . '/' . $category_slug;
                }
            }
            
            $permalink = str_replace('%product_category%', $category_slug, $permalink);
        } else {
            // No category, use a default
            $permalink = str_replace('%product_category%', 'uncategorized', $permalink);
        }
        
        return $permalink;
    }
    
    public static function add_rewrite_rules() {
        // Add custom rewrite rules for filtering
        add_rewrite_rule(
            'shop/([^/]+)/page/?([0-9]{1,})/?$',
            'index.php?product_category=$matches[1]&paged=$matches[2]',
            'top'
        );
        
        // Year/Month archives for products
        add_rewrite_rule(
            'shop/([0-9]{4})/([0-9]{1,2})/?$',
            'index.php?post_type=product&year=$matches[1]&monthnum=$matches[2]',
            'top'
        );
        
        // Custom endpoints
        add_rewrite_endpoint('specifications', EP_PERMALINK);
        add_rewrite_endpoint('reviews', EP_PERMALINK);
        add_rewrite_endpoint('compare', EP_PERMALINK);
    }
    
    private static function get_labels() {
        return [
            'name' => 'Products',
            'singular_name' => 'Product',
            // ... other labels
        ];
    }
    
    private static function get_taxonomy_labels() {
        return [
            'name' => 'Product Categories',
            'singular_name' => 'Product Category',
            // ... other labels
        ];
    }
}

Advanced_CPT_Rewrites::init();

// Flush rewrite rules on activation
register_activation_hook(__FILE__, function() {
    Advanced_CPT_Rewrites::init();
    flush_rewrite_rules();
});
                        </code></pre>
                    </section>
                    
                    <!-- Hierarchical CPTs -->
                    <section>
                        <h2>Hierarchical Custom Post Types</h2>
                        
                        <h3>Creating Page-like CPTs</h3>
                        <pre><code class="language-php">
// Hierarchical CPT like pages
function register_hierarchical_cpt() {
    register_post_type('documentation', [
        'labels' => [
            'name' => 'Documentation',
            'singular_name' => 'Doc Page',
            'add_new' => 'Add New Page',
            'add_new_item' => 'Add New Documentation Page',
            'edit_item' => 'Edit Documentation Page',
            'parent_item_colon' => 'Parent Page:',
        ],
        'public' => true,
        'hierarchical' => true, // This makes it hierarchical
        'supports' => [
            'title',
            'editor',
            'page-attributes', // Important for hierarchy
            'thumbnail',
            'excerpt',
            'custom-fields',
            'revisions'
        ],
        'rewrite' => [
            'slug' => 'docs',
            'with_front' => false,
        ],
        'menu_icon' => 'dashicons-book',
        'show_in_rest' => true,
    ]);
}
add_action('init', 'register_hierarchical_cpt');

// Display breadcrumbs for hierarchical CPT
function display_doc_breadcrumbs() {
    if (!is_singular('documentation')) {
        return;
    }
    
    global $post;
    $ancestors = array_reverse(get_post_ancestors($post->ID));
    
    echo '<nav class="breadcrumbs">';
    echo '<a href="' . get_post_type_archive_link('documentation') . '">Documentation</a>';
    
    foreach ($ancestors as $ancestor) {
        echo ' / <a href="' . get_permalink($ancestor) . '">' . get_the_title($ancestor) . '</a>';
    }
    
    echo ' / <span>' . get_the_title() . '</span>';
    echo '</nav>';
}

// Get children pages
function get_doc_children($parent_id = 0) {
    $args = [
        'post_type' => 'documentation',
        'post_parent' => $parent_id,
        'posts_per_page' => -1,
        'orderby' => 'menu_order',
        'order' => 'ASC',
    ];
    
    return get_posts($args);
}

// Display table of contents
function display_doc_toc($post_id = null) {
    if (!$post_id) {
        $post_id = get_the_ID();
    }
    
    $children = get_doc_children($post_id);
    
    if (empty($children)) {
        return;
    }
    
    echo '<div class="doc-toc">';
    echo '<h3>Table of Contents</h3>';
    echo '<ul>';
    
    foreach ($children as $child) {
        echo '<li>';
        echo '<a href="' . get_permalink($child->ID) . '">' . $child->post_title . '</a>';
        
        // Recursive for sub-children
        $subchildren = get_doc_children($child->ID);
        if (!empty($subchildren)) {
            echo '<ul>';
            foreach ($subchildren as $subchild) {
                echo '<li><a href="' . get_permalink($subchild->ID) . '">' . $subchild->post_title . '</a></li>';
            }
            echo '</ul>';
        }
        
        echo '</li>';
    }
    
    echo '</ul>';
    echo '</div>';
}
                        </code></pre>
                    </section>
                    
                    <!-- Archive Configuration -->
                    <section>
                        <h2>Archive Pages and Feeds</h2>
                        
                        <h3>Custom Archive Configuration</h3>
                        <pre><code class="language-php">
// Configure CPT archives
class CPT_Archive_Config {
    
    public static function init() {
        add_action('init', [__CLASS__, 'register_cpt']);
        add_action('pre_get_posts', [__CLASS__, 'modify_archive_query']);
        add_filter('get_the_archive_title', [__CLASS__, 'custom_archive_title']);
        add_filter('document_title_parts', [__CLASS__, 'custom_document_title']);
    }
    
    public static function register_cpt() {
        register_post_type('portfolio', [
            'labels' => self::get_labels(),
            'public' => true,
            'has_archive' => [
                'slug' => 'work', // Custom archive slug
            ],
            'rewrite' => [
                'slug' => 'project',
                'feeds' => true, // Enable feeds
            ],
            'supports' => ['title', 'editor', 'thumbnail', 'excerpt'],
        ]);
    }
    
    public static function modify_archive_query($query) {
        if (!is_admin() && $query->is_main_query()) {
            // Modify portfolio archive
            if (is_post_type_archive('portfolio')) {
                $query->set('posts_per_page', 12);
                $query->set('orderby', 'menu_order');
                $query->set('order', 'ASC');
                
                // Add meta query if needed
                if (isset($_GET['featured'])) {
                    $query->set('meta_query', [
                        [
                            'key' => 'is_featured',
                            'value' => 'yes',
                            'compare' => '='
                        ]
                    ]);
                }
            }
            
            // Include CPT in home/feed
            if (is_home() || is_feed()) {
                $post_types = $query->get('post_type');
                if (empty($post_types)) {
                    $post_types = ['post'];
                }
                $post_types[] = 'portfolio';
                $query->set('post_type', $post_types);
            }
            
            // Add CPT to author archives
            if (is_author()) {
                $query->set('post_type', ['post', 'portfolio']);
            }
        }
    }
    
    public static function custom_archive_title($title) {
        if (is_post_type_archive('portfolio')) {
            $title = 'Our Work';
            
            // Add filter info
            if (isset($_GET['featured'])) {
                $title .= ' - Featured Projects';
            }
        }
        return $title;
    }
    
    public static function custom_document_title($title) {
        if (is_post_type_archive('portfolio')) {
            $title['title'] = 'Portfolio';
            $title['tagline'] = 'Our Latest Work';
        }
        return $title;
    }
    
    private static function get_labels() {
        return [
            'name' => 'Portfolio',
            'singular_name' => 'Project',
            'archives' => 'Portfolio Archive',
            // ... other labels
        ];
    }
}

CPT_Archive_Config::init();

// Custom archive template handling
add_filter('archive_template', function($template) {
    if (is_post_type_archive('portfolio')) {
        $new_template = locate_template(['archive-portfolio.php']);
        if ($new_template) {
            return $new_template;
        }
    }
    return $template;
});
                        </code></pre>
                        
                        <h3>RSS Feed Customization</h3>
                        <pre><code class="language-php">
// Customize CPT feeds
class CPT_Feed_Customization {
    
    public static function init() {
        add_action('init', [__CLASS__, 'add_cpt_feeds']);
        add_filter('request', [__CLASS__, 'feed_request']);
        add_filter('the_content_feed', [__CLASS__, 'customize_feed_content']);
        add_action('rss2_item', [__CLASS__, 'add_custom_feed_fields']);
    }
    
    public static function add_cpt_feeds() {
        // Add feed support to CPT
        add_feed('products', [__CLASS__, 'render_products_feed']);
        add_feed('products-json', [__CLASS__, 'render_products_json_feed']);
    }
    
    public static function feed_request($qv) {
        if (isset($qv['feed']) && !isset($qv['post_type'])) {
            // Include CPT in main feed
            if ($qv['feed'] == 'rss2' || $qv['feed'] == 'feed') {
                $qv['post_type'] = ['post', 'product'];
            }
            
            // Custom feed for products only
            if ($qv['feed'] == 'products') {
                $qv['post_type'] = 'product';
            }
        }
        return $qv;
    }
    
    public static function render_products_feed() {
        load_template(get_template_directory() . '/feeds/feed-products.php');
    }
    
    public static function render_products_json_feed() {
        header('Content-Type: application/json; charset=' . get_option('blog_charset'), true);
        
        $products = get_posts([
            'post_type' => 'product',
            'posts_per_page' => 20,
            'post_status' => 'publish'
        ]);
        
        $feed_data = [
            'version' => 'https://jsonfeed.org/version/1',
            'title' => get_bloginfo('name') . ' Products',
            'home_page_url' => home_url(),
            'feed_url' => home_url('/feed/products-json/'),
            'items' => []
        ];
        
        foreach ($products as $product) {
            $feed_data['items'][] = [
                'id' => $product->ID,
                'url' => get_permalink($product),
                'title' => $product->post_title,
                'content_html' => apply_filters('the_content', $product->post_content),
                'summary' => get_the_excerpt($product),
                'date_published' => get_the_date('c', $product),
                'date_modified' => get_the_modified_date('c', $product),
                'author' => [
                    'name' => get_the_author_meta('display_name', $product->post_author)
                ],
                'tags' => wp_get_post_terms($product->ID, 'product_tag', ['fields' => 'names'])
            ];
        }
        
        echo json_encode($feed_data, JSON_PRETTY_PRINT | JSON_UNESCAPED_UNICODE);
        exit;
    }
    
    public static function customize_feed_content($content) {
        global $post;
        
        if ($post->post_type == 'product') {
            // Add product-specific content to feed
            $price = get_post_meta($post->ID, 'price', true);
            if ($price) {
                $content .= '<p>Price: $' . esc_html($price) . '</p>';
            }
        }
        
        return $content;
    }
    
    public static function add_custom_feed_fields() {
        global $post;
        
        if ($post->post_type == 'product') {
            $sku = get_post_meta($post->ID, 'sku', true);
            if ($sku) {
                echo '<sku>' . esc_html($sku) . '</sku>' . "\n";
            }
        }
    }
}

CPT_Feed_Customization::init();
                        </code></pre>
                    </section>
                    
                    <!-- Performance Optimization -->
                    <section>
                        <h2>CPT Performance Optimization</h2>
                        
                        <h3>Optimizing Queries</h3>
                        <pre><code class="language-php">
// Optimize CPT queries
class CPT_Performance {
    
    public static function init() {
        add_action('pre_get_posts', [__CLASS__, 'optimize_queries']);
        add_filter('posts_fields', [__CLASS__, 'limit_post_fields'], 10, 2);
        add_filter('posts_clauses', [__CLASS__, 'optimize_clauses'], 10, 2);
    }
    
    public static function optimize_queries($query) {
        if (is_admin() || !$query->is_main_query()) {
            return;
        }
        
        // Optimize archive pages
        if (is_post_type_archive('product')) {
            // Disable unnecessary queries
            $query->set('no_found_rows', true);
            $query->set('update_post_meta_cache', false);
            $query->set('update_post_term_cache', false);
            
            // Only get necessary fields
            $query->set('fields', 'ids');
        }
    }
    
    public static function limit_post_fields($fields, $query) {
        if (!is_admin() && $query->is_post_type_archive('product')) {
            global $wpdb;
            $fields = "$wpdb->posts.ID, $wpdb->posts.post_title, $wpdb->posts.post_name";
        }
        return $fields;
    }
    
    public static function optimize_clauses($clauses, $query) {
        if (!is_admin() && $query->is_post_type_archive('product')) {
            // Remove unnecessary JOINs
            if (empty($query->meta_query->queries)) {
                $clauses['join'] = '';
            }
        }
        return $clauses;
    }
}

CPT_Performance::init();

// Cache expensive CPT queries
function get_cached_products($args = []) {
    $cache_key = 'products_' . md5(serialize($args));
    $products = wp_cache_get($cache_key, 'product_queries');
    
    if (false === $products) {
        $default_args = [
            'post_type' => 'product',
            'posts_per_page' => 10,
            'post_status' => 'publish',
            'fields' => 'ids' // Get only IDs for performance
        ];
        
        $args = wp_parse_args($args, $default_args);
        $query = new WP_Query($args);
        $products = $query->posts;
        
        // Cache for 1 hour
        wp_cache_set($cache_key, $products, 'product_queries', HOUR_IN_SECONDS);
    }
    
    return $products;
}

// Clear cache on post save
add_action('save_post_product', function($post_id) {
    wp_cache_delete('product_queries');
});
                        </code></pre>
                    </section>
                    
                    <!-- Summary -->
                    <section>
                        <h2>Summary</h2>
                        
                        <div class="summary-box">
                            <h3>Key Takeaways</h3>
                            <ul>
                                <li>CPT registration offers extensive customization options</li>
                                <li>Custom capabilities provide granular permission control</li>
                                <li>Rewrite rules enable complex URL structures</li>
                                <li>Hierarchical CPTs work like pages with parent/child relationships</li>
                                <li>Archive and feed configuration enhances content distribution</li>
                                <li>Performance optimization is crucial for large datasets</li>
                            </ul>
                        </div>
                        
                        <div class="best-practices">
                            <h3>Best Practices</h3>
                            <ul>
                                <li>Always flush rewrite rules after changing CPT registration</li>
                                <li>Use capability mapping for secure access control</li>
                                <li>Implement proper labels for better UX</li>
                                <li>Consider REST API integration from the start</li>
                                <li>Optimize queries for performance</li>
                                <li>Plan URL structure before implementation</li>
                                <li>Test hierarchical relationships thoroughly</li>
                            </ul>
                        </div>
                    </section>
                    
                    <!-- Additional Resources -->
                    <section class="resources">
                        <h2>Additional Resources</h2>
                        <ul>
                            <li><a href="https://developer.wordpress.org/reference/functions/register_post_type/" target="_blank">register_post_type() Documentation</a></li>
                            <li><a href="https://developer.wordpress.org/plugins/post-types/" target="_blank">WordPress Post Types Handbook</a></li>
                            <li><a href="https://developer.wordpress.org/reference/functions/add_rewrite_rule/" target="_blank">Rewrite API Reference</a></li>
                            <li><a href="https://www.billerickson.net/wordpress-custom-post-types/" target="_blank">Complete Guide to Custom Post Types</a></li>
                        </ul>
                    </section>
                </div>
                
                <!-- Lesson Navigation -->
                <div class="lesson-navigation">
                    <a href="/07module/homework_complex_acf.html" class="lesson-nav-button prev">
                        <svg width="20" height="20" viewBox="0 0 20 20" fill="currentColor">
                            <path d="M12.707 5.293a1 1 0 010 1.414L9.414 10l3.293 3.293a1 1 0 01-1.414 1.414l-4-4a1 1 0 010-1.414l4-4a1 1 0 011.414 0z"/>
                        </svg>
                        <span>
                            <small>Previous</small><br>
                            Homework: Complex ACF
                        </span>
                    </a>
                    
                    <button class="complete-lesson-btn">
                        Mark as Complete
                    </button>
                    
                    <a href="/07module/rest_api_cpt.html" class="lesson-nav-button next">
                        <span>
                            <small>Next</small><br>
                            REST API for CPTs
                        </span>
                        <svg width="20" height="20" viewBox="0 0 20 20" fill="currentColor">
                            <path d="M7.293 14.707a1 1 0 010-1.414L10.586 10 7.293 6.707a1 1 0 011.414-1.414l4 4a1 1 0 010 1.414l-4 4a1 1 0 01-1.414 0z"/>
                        </svg>
                    </a>
                </div>
            </div>
        </main>
        
        <!-- Footer -->
        <footer class="site-footer" role="contentinfo">
            <div class="footer-container">
                <div class="footer-content">
                    <div class="footer-section footer-about">
                        <h3>PHP WordPress Development</h3>
                        <p>Complete Web Development Course - From HTML to WordPress</p>
                    </div>
                    
                    <div class="footer-section">
                        <h4>Quick Links</h4>
                        <ul class="footer-links">
                            <li><a href="/">Home</a></li>
                            <li><a href="/module7.html">Module 7</a></li>
                            <li><a href="/resources.html">Resources</a></li>
                            <li><a href="/about.html">About</a></li>
                        </ul>
                    </div>
                </div>
                
                <div class="footer-bottom">
                    <p>&copy; 2025 PHP WordPress Development Course. All rights reserved.</p>
                </div>
            </div>
        </footer>
    </div>
    
    <!-- JavaScript -->
    <script src="/assets/js/prism.js"></script>
    <script src="/assets/js/main.js"></script>
    <script src="/assets/js/lesson.js"></script>
</body>
</html>