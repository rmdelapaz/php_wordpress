<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    
    <!-- SEO Meta Tags -->
    <title>Custom Admin Columns and Filters - PHP WordPress Course</title>
    <meta name="description" content="Learn how to customize WordPress admin columns and filters for custom post types. Add sortable columns, inline editing, and advanced filtering.">
    <meta name="keywords" content="WordPress, admin columns, custom filters, admin UI, WordPress development">
    <meta name="author" content="PHP WordPress Course">
    
    <!-- Open Graph Tags -->
    <meta property="og:title" content="Custom Admin Columns and Filters">
    <meta property="og:description" content="Enhance WordPress admin with custom columns and filters">
    <meta property="og:type" content="article">
    
    <!-- Favicon -->
    <link rel="icon" type="image/png" href="/favicon.png">
    <link rel="apple-touch-icon" href="/favicon.png">
    
    <!-- CSS -->
    <link rel="stylesheet" href="/assets/css/main.css">
    
    <!-- Prism.js for syntax highlighting -->
    <link href="/assets/css/prism.css" rel="stylesheet">
</head>
<body>
    <!-- Skip to main content -->
    <a href="#main-content" class="sr-only">Skip to main content</a>
    
    <div class="page-wrapper">
        <!-- Header -->
        <header class="site-header" role="banner">
            <div class="header-container">
                <div class="site-branding">
                    <a href="/" class="site-logo">
                        <h1 class="site-title">PHP WordPress Development</h1>
                    </a>
                </div>
                
                <nav class="main-navigation" role="navigation" aria-label="Main navigation">
                    <button class="mobile-menu-btn" aria-label="Toggle navigation" aria-expanded="false">
                        <span></span>
                        <span></span>
                        <span></span>
                    </button>
                    
                    <div class="nav-menu">
                        <ul class="nav-list">
                            <li class="nav-item"><a href="/" class="nav-link">Home</a></li>
                            <li class="nav-item dropdown">
                                <button class="nav-link dropdown-toggle active" aria-haspopup="true">Modules</button>
                                <div class="dropdown-menu">
                                    <a href="/module1.html" class="dropdown-item">Module 1: Web Fundamentals</a>
                                    <a href="/module2.html" class="dropdown-item">Module 2: PHP Fundamentals</a>
                                    <a href="/module3.html" class="dropdown-item">Module 3: MySQL Database</a>
                                    <a href="/module4.html" class="dropdown-item">Module 4: WordPress & Docker</a>
                                    <a href="/module5.html" class="dropdown-item">Module 5: Theme Development</a>
                                    <a href="/module6.html" class="dropdown-item">Module 6: Plugin Development</a>
                                    <a href="/module7.html" class="dropdown-item active">Module 7: Advanced WordPress</a>
                                    <a href="/module8.html" class="dropdown-item">Module 8: Deployment</a>
                                    <a href="/module9.html" class="dropdown-item">Module 9: Final Project</a>
                                </div>
                            </li>
                            <li class="nav-item"><a href="/resources.html" class="nav-link">Resources</a></li>
                            <li class="nav-item"><a href="/about.html" class="nav-link">About</a></li>
                        </ul>
                    </div>
                </nav>
                
                <div class="search-container">
                    <div class="search-input-wrapper">
                        <svg class="search-icon" width="20" height="20" viewBox="0 0 20 20" fill="currentColor">
                            <path fill-rule="evenodd" d="M8 4a4 4 0 100 8 4 4 0 000-8zM2 8a6 6 0 1110.89 3.476l4.817 4.817a1 1 0 01-1.414 1.414l-4.816-4.816A6 6 0 012 8z" clip-rule="evenodd" />
                        </svg>
                        <input type="search" class="search-input" placeholder="Search lessons..." aria-label="Search">
                    </div>
                    <div class="search-results"></div>
                </div>
            </div>
        </header>
        
        <!-- Progress Bar -->
        <div class="progress-container">
            <div class="progress-header">
                <h2 class="progress-title">Course Progress</h2>
                <span class="progress-text">Loading...</span>
            </div>
            <div class="progress-bar">
                <div class="progress-bar-fill">
                    <span class="progress-bar-text"></span>
                </div>
            </div>
        </div>
        
        <!-- Breadcrumb -->
        <nav class="breadcrumb container" aria-label="Breadcrumb">
            <ol class="breadcrumb-list">
                <li class="breadcrumb-item">
                    <a href="/">Home</a>
                    <span class="breadcrumb-separator">/</span>
                </li>
                <li class="breadcrumb-item">
                    <a href="/module7.html">Module 7</a>
                    <span class="breadcrumb-separator">/</span>
                </li>
                <li class="breadcrumb-item">
                    <span aria-current="page">Admin Columns & Filters</span>
                </li>
            </ol>
        </nav>
        
        <!-- Main Content -->
        <main id="main-content" class="main-content" role="main">
            <div class="container">
                <!-- Lesson Header -->
                <div class="lesson-header">
                    <h1 class="lesson-title">Custom Admin Columns and Filters</h1>
                    <p class="lesson-subtitle">Enhance the WordPress admin interface with custom columns and filtering</p>
                </div>
                
                <!-- Learning Objectives -->
                <div class="lesson-objectives">
                    <h2>Learning Objectives</h2>
                    <p>By the end of this lesson, you will be able to:</p>
                    <ul>
                        <li>Add custom columns to admin post lists</li>
                        <li>Make columns sortable and searchable</li>
                        <li>Implement inline editing functionality</li>
                        <li>Create custom filters and dropdowns</li>
                        <li>Add bulk actions for custom post types</li>
                        <li>Customize the admin UI for better UX</li>
                    </ul>
                </div>
                
                <!-- Lesson Body -->
                <div class="lesson-body">
                    <!-- Basic Custom Columns -->
                    <section>
                        <h2>Adding Custom Columns</h2>
                        
                        <h3>Basic Column Implementation</h3>
                        <pre><code class="language-php">
// Add custom columns to CPT admin
class Product_Admin_Columns {
    
    public function __construct() {
        // For 'product' post type
        add_filter('manage_product_posts_columns', [$this, 'add_columns']);
        add_action('manage_product_posts_custom_column', [$this, 'render_columns'], 10, 2);
        
        // Make columns sortable
        add_filter('manage_edit-product_sortable_columns', [$this, 'sortable_columns']);
        
        // Handle sorting
        add_action('pre_get_posts', [$this, 'sort_columns']);
    }
    
    public function add_columns($columns) {
        // Remove unwanted columns
        unset($columns['author']);
        unset($columns['comments']);
        
        // Add new columns
        $new_columns = [];
        
        foreach ($columns as $key => $value) {
            $new_columns[$key] = $value;
            
            // Add after title column
            if ($key === 'title') {
                $new_columns['sku'] = __('SKU', 'textdomain');
                $new_columns['price'] = __('Price', 'textdomain');
            }
        }
        
        // Add more columns at the end
        $new_columns['stock'] = __('Stock', 'textdomain');
        $new_columns['featured_image'] = __('Image', 'textdomain');
        $new_columns['status'] = __('Status', 'textdomain');
        
        return $new_columns;
    }
    
    public function render_columns($column, $post_id) {
        switch ($column) {
            case 'sku':
                $sku = get_post_meta($post_id, '_sku', true);
                echo $sku ?: '—';
                break;
                
            case 'price':
                $price = get_post_meta($post_id, '_price', true);
                if ($price) {
                    echo '$' . number_format($price, 2);
                } else {
                    echo '—';
                }
                break;
                
            case 'stock':
                $stock = get_post_meta($post_id, '_stock', true);
                $stock_status = $this->get_stock_status($stock);
                
                echo '<span class="stock-status ' . $stock_status['class'] . '">';
                echo $stock . ' ' . $stock_status['label'];
                echo '</span>';
                break;
                
            case 'featured_image':
                if (has_post_thumbnail($post_id)) {
                    echo get_the_post_thumbnail($post_id, [50, 50]);
                } else {
                    echo '<span class="dashicons dashicons-format-image"></span>';
                }
                break;
                
            case 'status':
                $is_featured = get_post_meta($post_id, '_is_featured', true);
                $is_sale = get_post_meta($post_id, '_is_sale', true);
                
                $badges = [];
                if ($is_featured) {
                    $badges[] = '<span class="badge badge-featured">Featured</span>';
                }
                if ($is_sale) {
                    $badges[] = '<span class="badge badge-sale">On Sale</span>';
                }
                
                echo !empty($badges) ? implode(' ', $badges) : '—';
                break;
        }
    }
    
    public function sortable_columns($columns) {
        $columns['sku'] = 'sku';
        $columns['price'] = 'price';
        $columns['stock'] = 'stock';
        
        return $columns;
    }
    
    public function sort_columns($query) {
        if (!is_admin() || !$query->is_main_query()) {
            return;
        }
        
        $orderby = $query->get('orderby');
        
        switch ($orderby) {
            case 'sku':
                $query->set('meta_key', '_sku');
                $query->set('orderby', 'meta_value');
                break;
                
            case 'price':
                $query->set('meta_key', '_price');
                $query->set('orderby', 'meta_value_num');
                break;
                
            case 'stock':
                $query->set('meta_key', '_stock');
                $query->set('orderby', 'meta_value_num');
                break;
        }
    }
    
    private function get_stock_status($stock) {
        if ($stock <= 0) {
            return [
                'label' => 'Out of Stock',
                'class' => 'out-of-stock'
            ];
        } elseif ($stock <= 5) {
            return [
                'label' => 'Low Stock',
                'class' => 'low-stock'
            ];
        } else {
            return [
                'label' => 'In Stock',
                'class' => 'in-stock'
            ];
        }
    }
}

new Product_Admin_Columns();

// Add custom CSS for admin columns
add_action('admin_head', function() {
    ?>
    <style>
        .column-featured_image { width: 60px; }
        .column-sku { width: 100px; }
        .column-price { width: 80px; }
        .column-stock { width: 100px; }
        
        .stock-status {
            padding: 2px 8px;
            border-radius: 3px;
            font-size: 12px;
        }
        .stock-status.in-stock {
            background: #d4edda;
            color: #155724;
        }
        .stock-status.low-stock {
            background: #fff3cd;
            color: #856404;
        }
        .stock-status.out-of-stock {
            background: #f8d7da;
            color: #721c24;
        }
        
        .badge {
            display: inline-block;
            padding: 2px 6px;
            border-radius: 3px;
            font-size: 11px;
            font-weight: bold;
        }
        .badge-featured {
            background: #007cba;
            color: white;
        }
        .badge-sale {
            background: #d63638;
            color: white;
        }
    </style>
    <?php
});
                        </code></pre>
                    </section>
                    
                    <!-- Inline Editing -->
                    <section>
                        <h2>Inline Editing</h2>
                        
                        <h3>Quick Edit Implementation</h3>
                        <pre><code class="language-php">
// Add inline editing capability
class Inline_Edit_Products {
    
    public function __construct() {
        // Add custom fields to quick edit
        add_action('quick_edit_custom_box', [$this, 'quick_edit_fields'], 10, 2);
        
        // Save quick edit data
        add_action('save_post', [$this, 'save_quick_edit']);
        
        // Add JavaScript for quick edit
        add_action('admin_footer', [$this, 'quick_edit_javascript']);
        
        // AJAX handler for getting post data
        add_action('wp_ajax_get_quick_edit_data', [$this, 'get_quick_edit_data']);
    }
    
    public function quick_edit_fields($column_name, $post_type) {
        if ($post_type !== 'product') {
            return;
        }
        
        switch ($column_name) {
            case 'sku':
                ?>
                <fieldset class="inline-edit-col-left">
                    <div class="inline-edit-col">
                        <label>
                            <span class="title">SKU</span>
                            <span class="input-text-wrap">
                                <input type="text" name="product_sku" class="ptitle" value="">
                            </span>
                        </label>
                    </div>
                </fieldset>
                <?php
                break;
                
            case 'price':
                ?>
                <fieldset class="inline-edit-col-left">
                    <div class="inline-edit-col">
                        <label>
                            <span class="title">Price</span>
                            <span class="input-text-wrap">
                                <input type="number" name="product_price" step="0.01" min="0" value="">
                            </span>
                        </label>
                    </div>
                </fieldset>
                <?php
                break;
                
            case 'stock':
                ?>
                <fieldset class="inline-edit-col-left">
                    <div class="inline-edit-col">
                        <label>
                            <span class="title">Stock</span>
                            <span class="input-text-wrap">
                                <input type="number" name="product_stock" min="0" value="">
                            </span>
                        </label>
                        <label>
                            <input type="checkbox" name="product_featured" value="1">
                            <span class="checkbox-title">Featured Product</span>
                        </label>
                    </div>
                </fieldset>
                <?php
                break;
        }
    }
    
    public function save_quick_edit($post_id) {
        // Security checks
        if (defined('DOING_AUTOSAVE') && DOING_AUTOSAVE) {
            return;
        }
        
        if (!current_user_can('edit_post', $post_id)) {
            return;
        }
        
        if (get_post_type($post_id) !== 'product') {
            return;
        }
        
        // Save SKU
        if (isset($_POST['product_sku'])) {
            update_post_meta($post_id, '_sku', sanitize_text_field($_POST['product_sku']));
        }
        
        // Save Price
        if (isset($_POST['product_price'])) {
            update_post_meta($post_id, '_price', floatval($_POST['product_price']));
        }
        
        // Save Stock
        if (isset($_POST['product_stock'])) {
            update_post_meta($post_id, '_stock', intval($_POST['product_stock']));
        }
        
        // Save Featured
        if (isset($_POST['product_featured'])) {
            update_post_meta($post_id, '_is_featured', 'yes');
        } else {
            update_post_meta($post_id, '_is_featured', 'no');
        }
    }
    
    public function quick_edit_javascript() {
        global $current_screen;
        
        if ($current_screen->post_type !== 'product') {
            return;
        }
        ?>
        <script type="text/javascript">
        jQuery(document).ready(function($) {
            // Populate quick edit fields
            $('#the-list').on('click', '.editinline', function() {
                var post_id = $(this).closest('tr').attr('id');
                post_id = post_id.replace('post-', '');
                
                // Get current values via AJAX
                $.post(ajaxurl, {
                    action: 'get_quick_edit_data',
                    post_id: post_id,
                    _ajax_nonce: '<?php echo wp_create_nonce('quick_edit_nonce'); ?>'
                }, function(response) {
                    if (response.success) {
                        $('input[name="product_sku"]').val(response.data.sku);
                        $('input[name="product_price"]').val(response.data.price);
                        $('input[name="product_stock"]').val(response.data.stock);
                        $('input[name="product_featured"]').prop('checked', response.data.featured === 'yes');
                    }
                });
            });
        });
        </script>
        <?php
    }
    
    public function get_quick_edit_data() {
        check_ajax_referer('quick_edit_nonce');
        
        $post_id = intval($_POST['post_id']);
        
        $data = [
            'sku' => get_post_meta($post_id, '_sku', true),
            'price' => get_post_meta($post_id, '_price', true),
            'stock' => get_post_meta($post_id, '_stock', true),
            'featured' => get_post_meta($post_id, '_is_featured', true),
        ];
        
        wp_send_json_success($data);
    }
}

new Inline_Edit_Products();
                        </code></pre>
                    </section>
                    
                    <!-- Custom Filters -->
                    <section>
                        <h2>Custom Filters and Dropdowns</h2>
                        
                        <h3>Adding Filter Dropdowns</h3>
                        <pre><code class="language-php">
// Add custom filters to admin
class Product_Admin_Filters {
    
    public function __construct() {
        // Add filter dropdowns
        add_action('restrict_manage_posts', [$this, 'add_filters']);
        
        // Apply filters to query
        add_filter('parse_query', [$this, 'apply_filters']);
        
        // Add custom views
        add_filter('views_edit-product', [$this, 'add_custom_views']);
        
        // Add search functionality
        add_filter('posts_search', [$this, 'extend_search'], 10, 2);
    }
    
    public function add_filters() {
        global $typenow;
        
        if ($typenow !== 'product') {
            return;
        }
        
        // Stock status filter
        $this->render_stock_filter();
        
        // Price range filter
        $this->render_price_filter();
        
        // Featured filter
        $this->render_featured_filter();
        
        // Date range filter
        $this->render_date_filter();
    }
    
    private function render_stock_filter() {
        $selected = $_GET['stock_status'] ?? '';
        ?>
        <select name="stock_status">
            <option value="">All Stock Status</option>
            <option value="in_stock" <?php selected($selected, 'in_stock'); ?>>In Stock</option>
            <option value="low_stock" <?php selected($selected, 'low_stock'); ?>>Low Stock (≤5)</option>
            <option value="out_of_stock" <?php selected($selected, 'out_of_stock'); ?>>Out of Stock</option>
        </select>
        <?php
    }
    
    private function render_price_filter() {
        $min_price = $_GET['min_price'] ?? '';
        $max_price = $_GET['max_price'] ?? '';
        ?>
        <input type="number" 
               name="min_price" 
               placeholder="Min Price" 
               value="<?php echo esc_attr($min_price); ?>" 
               style="width: 100px;">
        <input type="number" 
               name="max_price" 
               placeholder="Max Price" 
               value="<?php echo esc_attr($max_price); ?>" 
               style="width: 100px;">
        <?php
    }
    
    private function render_featured_filter() {
        $selected = $_GET['featured'] ?? '';
        ?>
        <select name="featured">
            <option value="">All Products</option>
            <option value="yes" <?php selected($selected, 'yes'); ?>>Featured Only</option>
            <option value="no" <?php selected($selected, 'no'); ?>>Non-Featured</option>
        </select>
        <?php
    }
    
    private function render_date_filter() {
        $date_from = $_GET['date_from'] ?? '';
        $date_to = $_GET['date_to'] ?? '';
        ?>
        <input type="date" 
               name="date_from" 
               placeholder="From Date" 
               value="<?php echo esc_attr($date_from); ?>">
        <input type="date" 
               name="date_to" 
               placeholder="To Date" 
               value="<?php echo esc_attr($date_to); ?>">
        <?php
    }
    
    public function apply_filters($query) {
        global $pagenow, $typenow;
        
        if ($pagenow !== 'edit.php' || $typenow !== 'product') {
            return $query;
        }
        
        $meta_query = [];
        
        // Stock status filter
        if (!empty($_GET['stock_status'])) {
            switch ($_GET['stock_status']) {
                case 'in_stock':
                    $meta_query[] = [
                        'key' => '_stock',
                        'value' => 5,
                        'compare' => '>',
                        'type' => 'NUMERIC'
                    ];
                    break;
                    
                case 'low_stock':
                    $meta_query[] = [
                        'relation' => 'AND',
                        [
                            'key' => '_stock',
                            'value' => 0,
                            'compare' => '>',
                            'type' => 'NUMERIC'
                        ],
                        [
                            'key' => '_stock',
                            'value' => 5,
                            'compare' => '<=',
                            'type' => 'NUMERIC'
                        ]
                    ];
                    break;
                    
                case 'out_of_stock':
                    $meta_query[] = [
                        'key' => '_stock',
                        'value' => 0,
                        'compare' => '<=',
                        'type' => 'NUMERIC'
                    ];
                    break;
            }
        }
        
        // Price range filter
        if (!empty($_GET['min_price'])) {
            $meta_query[] = [
                'key' => '_price',
                'value' => floatval($_GET['min_price']),
                'compare' => '>=',
                'type' => 'NUMERIC'
            ];
        }
        
        if (!empty($_GET['max_price'])) {
            $meta_query[] = [
                'key' => '_price',
                'value' => floatval($_GET['max_price']),
                'compare' => '<=',
                'type' => 'NUMERIC'
            ];
        }
        
        // Featured filter
        if (!empty($_GET['featured'])) {
            $meta_query[] = [
                'key' => '_is_featured',
                'value' => $_GET['featured'],
                'compare' => '='
            ];
        }
        
        // Apply meta query
        if (!empty($meta_query)) {
            $query->set('meta_query', $meta_query);
        }
        
        // Date range filter
        if (!empty($_GET['date_from'])) {
            $query->set('date_query', [
                [
                    'after' => $_GET['date_from'],
                    'inclusive' => true,
                ]
            ]);
        }
        
        if (!empty($_GET['date_to'])) {
            $date_query = $query->get('date_query') ?: [];
            $date_query[] = [
                'before' => $_GET['date_to'],
                'inclusive' => true,
            ];
            $query->set('date_query', $date_query);
        }
        
        return $query;
    }
    
    public function add_custom_views($views) {
        global $wpdb;
        
        // Add "Featured" view
        $featured_count = $wpdb->get_var($wpdb->prepare("
            SELECT COUNT(*) 
            FROM {$wpdb->posts} p
            JOIN {$wpdb->postmeta} pm ON p.ID = pm.post_id
            WHERE p.post_type = %s 
            AND p.post_status = 'publish'
            AND pm.meta_key = '_is_featured' 
            AND pm.meta_value = 'yes'
        ", 'product'));
        
        $class = (isset($_GET['featured']) && $_GET['featured'] === 'yes') ? 'current' : '';
        $views['featured'] = sprintf(
            '<a href="%s" class="%s">Featured <span class="count">(%d)</span></a>',
            add_query_arg(['featured' => 'yes'], admin_url('edit.php?post_type=product')),
            $class,
            $featured_count
        );
        
        // Add "Out of Stock" view
        $out_of_stock_count = $wpdb->get_var($wpdb->prepare("
            SELECT COUNT(*) 
            FROM {$wpdb->posts} p
            JOIN {$wpdb->postmeta} pm ON p.ID = pm.post_id
            WHERE p.post_type = %s 
            AND p.post_status = 'publish'
            AND pm.meta_key = '_stock' 
            AND CAST(pm.meta_value AS SIGNED) <= 0
        ", 'product'));
        
        $class = (isset($_GET['stock_status']) && $_GET['stock_status'] === 'out_of_stock') ? 'current' : '';
        $views['out_of_stock'] = sprintf(
            '<a href="%s" class="%s">Out of Stock <span class="count">(%d)</span></a>',
            add_query_arg(['stock_status' => 'out_of_stock'], admin_url('edit.php?post_type=product')),
            $class,
            $out_of_stock_count
        );
        
        return $views;
    }
    
    public function extend_search($search, $wp_query) {
        global $wpdb;
        
        if (!is_admin() || !$wp_query->is_main_query() || !$wp_query->is_search()) {
            return $search;
        }
        
        if ($wp_query->get('post_type') !== 'product') {
            return $search;
        }
        
        $search_term = $wp_query->get('s');
        
        if (empty($search_term)) {
            return $search;
        }
        
        // Also search in SKU and other meta fields
        $search = preg_replace(
            "/\(\s*{$wpdb->posts}.post_title\s+LIKE\s*(\'[^\']+\')\s*\)/",
            "({$wpdb->posts}.post_title LIKE $1) OR 
             EXISTS (
                SELECT * FROM {$wpdb->postmeta} 
                WHERE {$wpdb->postmeta}.post_id = {$wpdb->posts}.ID
                AND {$wpdb->postmeta}.meta_key IN ('_sku', '_barcode')
                AND {$wpdb->postmeta}.meta_value LIKE $1
             )",
            $search
        );
        
        return $search;
    }
}

new Product_Admin_Filters();
                        </code></pre>
                    </section>
                    
                    <!-- Bulk Actions -->
                    <section>
                        <h2>Custom Bulk Actions</h2>
                        
                        <h3>Adding Bulk Actions</h3>
                        <pre><code class="language-php">
// Add custom bulk actions
class Product_Bulk_Actions {
    
    public function __construct() {
        // Add bulk actions
        add_filter('bulk_actions-edit-product', [$this, 'register_bulk_actions']);
        
        // Handle bulk actions
        add_filter('handle_bulk_actions-edit-product', [$this, 'handle_bulk_actions'], 10, 3);
        
        // Show admin notices
        add_action('admin_notices', [$this, 'bulk_action_notices']);
    }
    
    public function register_bulk_actions($bulk_actions) {
        $bulk_actions['mark_featured'] = __('Mark as Featured', 'textdomain');
        $bulk_actions['unmark_featured'] = __('Remove from Featured', 'textdomain');
        $bulk_actions['set_in_stock'] = __('Set as In Stock', 'textdomain');
        $bulk_actions['set_out_of_stock'] = __('Set as Out of Stock', 'textdomain');
        $bulk_actions['apply_discount'] = __('Apply 10% Discount', 'textdomain');
        $bulk_actions['export_csv'] = __('Export to CSV', 'textdomain');
        
        return $bulk_actions;
    }
    
    public function handle_bulk_actions($redirect_to, $action, $post_ids) {
        switch ($action) {
            case 'mark_featured':
                foreach ($post_ids as $post_id) {
                    update_post_meta($post_id, '_is_featured', 'yes');
                }
                $redirect_to = add_query_arg('bulk_featured', count($post_ids), $redirect_to);
                break;
                
            case 'unmark_featured':
                foreach ($post_ids as $post_id) {
                    update_post_meta($post_id, '_is_featured', 'no');
                }
                $redirect_to = add_query_arg('bulk_unfeatured', count($post_ids), $redirect_to);
                break;
                
            case 'set_in_stock':
                foreach ($post_ids as $post_id) {
                    update_post_meta($post_id, '_stock', 100); // Default stock
                }
                $redirect_to = add_query_arg('bulk_in_stock', count($post_ids), $redirect_to);
                break;
                
            case 'set_out_of_stock':
                foreach ($post_ids as $post_id) {
                    update_post_meta($post_id, '_stock', 0);
                }
                $redirect_to = add_query_arg('bulk_out_of_stock', count($post_ids), $redirect_to);
                break;
                
            case 'apply_discount':
                foreach ($post_ids as $post_id) {
                    $price = get_post_meta($post_id, '_price', true);
                    if ($price) {
                        $discounted_price = $price * 0.9; // 10% discount
                        update_post_meta($post_id, '_price', $discounted_price);
                        update_post_meta($post_id, '_original_price', $price);
                        update_post_meta($post_id, '_is_sale', 'yes');
                    }
                }
                $redirect_to = add_query_arg('bulk_discount', count($post_ids), $redirect_to);
                break;
                
            case 'export_csv':
                $this->export_to_csv($post_ids);
                break;
        }
        
        return $redirect_to;
    }
    
    public function bulk_action_notices() {
        if (!empty($_REQUEST['bulk_featured'])) {
            $count = intval($_REQUEST['bulk_featured']);
            printf(
                '<div class="notice notice-success is-dismissible"><p>' .
                _n('%s product marked as featured.', '%s products marked as featured.', $count, 'textdomain') .
                '</p></div>',
                $count
            );
        }
        
        if (!empty($_REQUEST['bulk_unfeatured'])) {
            $count = intval($_REQUEST['bulk_unfeatured']);
            printf(
                '<div class="notice notice-success is-dismissible"><p>' .
                _n('%s product removed from featured.', '%s products removed from featured.', $count, 'textdomain') .
                '</p></div>',
                $count
            );
        }
        
        if (!empty($_REQUEST['bulk_in_stock'])) {
            $count = intval($_REQUEST['bulk_in_stock']);
            printf(
                '<div class="notice notice-success is-dismissible"><p>' .
                _n('%s product set as in stock.', '%s products set as in stock.', $count, 'textdomain') .
                '</p></div>',
                $count
            );
        }
        
        if (!empty($_REQUEST['bulk_out_of_stock'])) {
            $count = intval($_REQUEST['bulk_out_of_stock']);
            printf(
                '<div class="notice notice-warning is-dismissible"><p>' .
                _n('%s product set as out of stock.', '%s products set as out of stock.', $count, 'textdomain') .
                '</p></div>',
                $count
            );
        }
        
        if (!empty($_REQUEST['bulk_discount'])) {
            $count = intval($_REQUEST['bulk_discount']);
            printf(
                '<div class="notice notice-success is-dismissible"><p>' .
                _n('10%% discount applied to %s product.', '10%% discount applied to %s products.', $count, 'textdomain') .
                '</p></div>',
                $count
            );
        }
    }
    
    private function export_to_csv($post_ids) {
        // Set headers for CSV download
        header('Content-Type: text/csv');
        header('Content-Disposition: attachment; filename="products-export-' . date('Y-m-d') . '.csv"');
        
        // Open output stream
        $output = fopen('php://output', 'w');
        
        // Add CSV headers
        fputcsv($output, ['ID', 'Title', 'SKU', 'Price', 'Stock', 'Status', 'Date']);
        
        // Add data rows
        foreach ($post_ids as $post_id) {
            $post = get_post($post_id);
            
            $row = [
                $post->ID,
                $post->post_title,
                get_post_meta($post_id, '_sku', true),
                get_post_meta($post_id, '_price', true),
                get_post_meta($post_id, '_stock', true),
                $post->post_status,
                $post->post_date
            ];
            
            fputcsv($output, $row);
        }
        
        fclose($output);
        exit;
    }
}

new Product_Bulk_Actions();
                        </code></pre>
                    </section>
                    
                    <!-- Advanced UI Customization -->
                    <section>
                        <h2>Advanced Admin UI Customization</h2>
                        
                        <h3>Row Actions and States</h3>
                        <pre><code class="language-php">
// Customize row actions and post states
class Advanced_Admin_UI {
    
    public function __construct() {
        // Customize row actions
        add_filter('post_row_actions', [$this, 'custom_row_actions'], 10, 2);
        
        // Add post states
        add_filter('display_post_states', [$this, 'custom_post_states'], 10, 2);
        
        // Add custom admin CSS and JS
        add_action('admin_enqueue_scripts', [$this, 'enqueue_admin_assets']);
        
        // AJAX handlers
        add_action('wp_ajax_toggle_featured', [$this, 'ajax_toggle_featured']);
        add_action('wp_ajax_update_stock', [$this, 'ajax_update_stock']);
    }
    
    public function custom_row_actions($actions, $post) {
        if ($post->post_type !== 'product') {
            return $actions;
        }
        
        // Add custom actions
        $is_featured = get_post_meta($post->ID, '_is_featured', true);
        $featured_text = $is_featured === 'yes' ? 'Unmark Featured' : 'Mark Featured';
        
        $actions['toggle_featured'] = sprintf(
            '<a href="#" class="toggle-featured" data-post-id="%d" data-nonce="%s">%s</a>',
            $post->ID,
            wp_create_nonce('toggle_featured_' . $post->ID),
            $featured_text
        );
        
        $actions['duplicate'] = sprintf(
            '<a href="%s">Duplicate</a>',
            wp_nonce_url(
                add_query_arg([
                    'action' => 'duplicate_product',
                    'post' => $post->ID
                ], admin_url('admin.php')),
                'duplicate_product_' . $post->ID
            )
        );
        
        $actions['view_analytics'] = sprintf(
            '<a href="%s">Analytics</a>',
            add_query_arg([
                'page' => 'product-analytics',
                'product_id' => $post->ID
            ], admin_url('admin.php'))
        );
        
        // Remove unwanted actions
        unset($actions['inline hide-if-no-js']);
        
        return $actions;
    }
    
    public function custom_post_states($post_states, $post) {
        if ($post->post_type !== 'product') {
            return $post_states;
        }
        
        // Add featured state
        if (get_post_meta($post->ID, '_is_featured', true) === 'yes') {
            $post_states['featured'] = '<span class="featured">Featured</span>';
        }
        
        // Add sale state
        if (get_post_meta($post->ID, '_is_sale', true) === 'yes') {
            $post_states['sale'] = '<span class="on-sale">On Sale</span>';
        }
        
        // Add stock state
        $stock = get_post_meta($post->ID, '_stock', true);
        if ($stock <= 0) {
            $post_states['out_of_stock'] = '<span class="out-of-stock">Out of Stock</span>';
        } elseif ($stock <= 5) {
            $post_states['low_stock'] = '<span class="low-stock">Low Stock</span>';
        }
        
        return $post_states;
    }
    
    public function enqueue_admin_assets($hook) {
        if ($hook !== 'edit.php' || get_post_type() !== 'product') {
            return;
        }
        
        // Enqueue custom CSS
        wp_enqueue_style(
            'product-admin-styles',
            get_template_directory_uri() . '/assets/css/product-admin.css',
            [],
            '1.0.0'
        );
        
        // Enqueue custom JS
        wp_enqueue_script(
            'product-admin-scripts',
            get_template_directory_uri() . '/assets/js/product-admin.js',
            ['jquery'],
            '1.0.0',
            true
        );
        
        wp_localize_script('product-admin-scripts', 'productAdmin', [
            'ajaxurl' => admin_url('admin-ajax.php'),
            'nonce' => wp_create_nonce('product_admin_nonce')
        ]);
    }
    
    public function ajax_toggle_featured() {
        $post_id = intval($_POST['post_id']);
        
        if (!wp_verify_nonce($_POST['nonce'], 'toggle_featured_' . $post_id)) {
            wp_die('Security check failed');
        }
        
        if (!current_user_can('edit_post', $post_id)) {
            wp_die('Permission denied');
        }
        
        $is_featured = get_post_meta($post_id, '_is_featured', true);
        $new_status = $is_featured === 'yes' ? 'no' : 'yes';
        
        update_post_meta($post_id, '_is_featured', $new_status);
        
        wp_send_json_success([
            'status' => $new_status,
            'message' => $new_status === 'yes' ? 'Product marked as featured' : 'Product unmarked as featured'
        ]);
    }
    
    public function ajax_update_stock() {
        $post_id = intval($_POST['post_id']);
        $stock = intval($_POST['stock']);
        
        if (!wp_verify_nonce($_POST['nonce'], 'product_admin_nonce')) {
            wp_die('Security check failed');
        }
        
        if (!current_user_can('edit_post', $post_id)) {
            wp_die('Permission denied');
        }
        
        update_post_meta($post_id, '_stock', $stock);
        
        wp_send_json_success([
            'stock' => $stock,
            'status' => $this->get_stock_status($stock)
        ]);
    }
    
    private function get_stock_status($stock) {
        if ($stock <= 0) {
            return 'out_of_stock';
        } elseif ($stock <= 5) {
            return 'low_stock';
        } else {
            return 'in_stock';
        }
    }
}

new Advanced_Admin_UI();
                        </code></pre>
                        
                        <h3>JavaScript for Admin Enhancements</h3>
                        <pre><code class="language-javascript">
// product-admin.js
jQuery(document).ready(function($) {
    
    // Toggle featured status
    $('.toggle-featured').on('click', function(e) {
        e.preventDefault();
        
        var $link = $(this);
        var postId = $link.data('post-id');
        var nonce = $link.data('nonce');
        
        $.post(productAdmin.ajaxurl, {
            action: 'toggle_featured',
            post_id: postId,
            nonce: nonce
        }, function(response) {
            if (response.success) {
                var newText = response.data.status === 'yes' ? 'Unmark Featured' : 'Mark Featured';
                $link.text(newText);
                
                // Update visual indicator
                var $row = $link.closest('tr');
                if (response.data.status === 'yes') {
                    $row.addClass('featured-product');
                } else {
                    $row.removeClass('featured-product');
                }
                
                // Show notification
                showNotification(response.data.message, 'success');
            }
        });
    });
    
    // Inline stock update
    $('.column-stock').on('dblclick', function() {
        var $cell = $(this);
        var currentStock = parseInt($cell.text()) || 0;
        var postId = $cell.closest('tr').attr('id').replace('post-', '');
        
        var $input = $('<input type="number" min="0" value="' + currentStock + '">');
        $cell.html($input);
        $input.focus().select();
        
        $input.on('blur keypress', function(e) {
            if (e.type === 'blur' || e.which === 13) {
                var newStock = parseInt($input.val()) || 0;
                
                $.post(productAdmin.ajaxurl, {
                    action: 'update_stock',
                    post_id: postId,
                    stock: newStock,
                    nonce: productAdmin.nonce
                }, function(response) {
                    if (response.success) {
                        $cell.html(newStock + ' ' + getStockLabel(response.data.status));
                        $cell.removeClass('out-of-stock low-stock in-stock');
                        $cell.addClass(response.data.status.replace('_', '-'));
                    }
                });
            }
        });
    });
    
    // Enhanced filtering
    $('#filter-submit').before(
        '<button type="button" id="clear-filters" class="button">Clear Filters</button> '
    );
    
    $('#clear-filters').on('click', function() {
        $('select[name="stock_status"]').val('');
        $('select[name="featured"]').val('');
        $('input[name="min_price"]').val('');
        $('input[name="max_price"]').val('');
        $('input[name="date_from"]').val('');
        $('input[name="date_to"]').val('');
        $('#post-search-input').val('');
        $('#filter-submit').click();
    });
    
    // Show active filters
    var activeFilters = [];
    $('select, input').each(function() {
        if ($(this).val() && $(this).attr('name') && 
            !['action', 'action2', 'post_type'].includes($(this).attr('name'))) {
            activeFilters.push($(this).attr('name'));
        }
    });
    
    if (activeFilters.length > 0) {
        $('.tablenav.top').prepend(
            '<div class="notice notice-info inline">' +
            '<p>Active filters: ' + activeFilters.join(', ') + '</p>' +
            '</div>'
        );
    }
    
    function showNotification(message, type) {
        var $notice = $('<div class="notice notice-' + type + ' is-dismissible">' +
                       '<p>' + message + '</p>' +
                       '<button type="button" class="notice-dismiss"></button>' +
                       '</div>');
        
        $('.wp-header-end').after($notice);
        
        setTimeout(function() {
            $notice.fadeOut(function() {
                $(this).remove();
            });
        }, 3000);
    }
    
    function getStockLabel(status) {
        switch(status) {
            case 'out_of_stock':
                return 'Out of Stock';
            case 'low_stock':
                return 'Low Stock';
            case 'in_stock':
                return 'In Stock';
            default:
                return '';
        }
    }
});
                        </code></pre>
                    </section>
                    
                    <!-- Summary -->
                    <section>
                        <h2>Summary</h2>
                        
                        <div class="summary-box">
                            <h3>Key Takeaways</h3>
                            <ul>
                                <li>Custom columns improve data visibility in admin</li>
                                <li>Sortable columns enable quick data organization</li>
                                <li>Inline editing speeds up content management</li>
                                <li>Custom filters help find specific content quickly</li>
                                <li>Bulk actions enable efficient batch operations</li>
                                <li>Admin UI customization improves user experience</li>
                            </ul>
                        </div>
                        
                        <div class="best-practices">
                            <h3>Best Practices</h3>
                            <ul>
                                <li>Keep column widths appropriate for content</li>
                                <li>Use visual indicators for status and states</li>
                                <li>Implement proper security checks for AJAX operations</li>
                                <li>Cache expensive queries for better performance</li>
                                <li>Provide clear feedback for user actions</li>
                                <li>Make the UI intuitive and consistent</li>
                                <li>Test with different user roles and permissions</li>
                            </ul>
                        </div>
                    </section>
                    
                    <!-- Additional Resources -->
                    <section class="resources">
                        <h2>Additional Resources</h2>
                        <ul>
                            <li><a href="https://developer.wordpress.org/reference/hooks/manage_posts_columns/" target="_blank">manage_posts_columns Hook</a></li>
                            <li><a href="https://developer.wordpress.org/reference/hooks/manage_posts_custom_column/" target="_blank">manage_posts_custom_column Hook</a></li>
                            <li><a href="https://developer.wordpress.org/reference/hooks/bulk_actions/" target="_blank">Bulk Actions Documentation</a></li>
                            <li><a href="https://developer.wordpress.org/reference/hooks/restrict_manage_posts/" target="_blank">restrict_manage_posts Hook</a></li>
                        </ul>
                    </section>
                </div>
                
                <!-- Lesson Navigation -->
                <div class="lesson-navigation">
                    <a href="/07module/rest_api_cpt.html" class="lesson-nav-button prev">
                        <svg width="20" height="20" viewBox="0 0 20 20" fill="currentColor">
                            <path d="M12.707 5.293a1 1 0 010 1.414L9.414 10l3.293 3.293a1 1 0 01-1.414 1.414l-4-4a1 1 0 010-1.414l4-4a1 1 0 011.414 0z"/>
                        </svg>
                        <span>
                            <small>Previous</small><br>
                            REST API for CPTs
                        </span>
                    </a>
                    
                    <button class="complete-lesson-btn">
                        Mark as Complete
                    </button>
                    
                    <a href="/07module/advanced_taxonomy_relationships.html" class="lesson-nav-button next">
                        <span>
                            <small>Next</small><br>
                            Advanced Taxonomies
                        </span>
                        <svg width="20" height="20" viewBox="0 0 20 20" fill="currentColor">
                            <path d="M7.293 14.707a1 1 0 010-1.414L10.586 10 7.293 6.707a1 1 0 011.414-1.414l4 4a1 1 0 010 1.414l-4 4a1 1 0 01-1.414 0z"/>
                        </svg>
                    </a>
                </div>
            </div>
        </main>
        
        <!-- Footer -->
        <footer class="site-footer" role="contentinfo">
            <div class="footer-container">
                <div class="footer-content">
                    <div class="footer-section footer-about">
                        <h3>PHP WordPress Development</h3>
                        <p>Complete Web Development Course - From HTML to WordPress</p>
                    </div>
                    
                    <div class="footer-section">
                        <h4>Quick Links</h4>
                        <ul class="footer-links">
                            <li><a href="/">Home</a></li>
                            <li><a href="/module7.html">Module 7</a></li>
                            <li><a href="/resources.html">Resources</a></li>
                            <li><a href="/about.html">About</a></li>
                        </ul>
                    </div>
                </div>
                
                <div class="footer-bottom">
                    <p>&copy; 2025 PHP WordPress Development Course. All rights reserved.</p>
                </div>
            </div>
        </footer>
    </div>
    
    <!-- JavaScript -->
    <script src="/assets/js/prism.js"></script>
    <script src="/assets/js/main.js"></script>
    <script src="/assets/js/lesson.js"></script>
</body>
</html>