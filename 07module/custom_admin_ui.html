<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    
    <!-- SEO Meta Tags -->
    <title>Custom Admin UI for Taxonomies - PHP WordPress Course</title>
    <meta name="description" content="Learn how to create custom admin interfaces for taxonomies in WordPress. Build enhanced taxonomy management screens with custom fields and layouts.">
    <meta name="keywords" content="WordPress, admin UI, taxonomies, custom interfaces, WordPress development">
    <meta name="author" content="PHP WordPress Course">
    
    <!-- Open Graph Tags -->
    <meta property="og:title" content="Custom Admin UI for Taxonomies">
    <meta property="og:description" content="Create custom admin interfaces for taxonomy management">
    <meta property="og:type" content="article">
    
    <!-- Favicon -->
    <link rel="icon" type="image/png" href="/favicon.png">
    <link rel="apple-touch-icon" href="/favicon.png">
    
    <!-- CSS -->
    <link rel="stylesheet" href="/assets/css/main.css">
    
    <!-- Prism.js for syntax highlighting -->
    <link href="/assets/css/prism.css" rel="stylesheet">
</head>
<body>
    <!-- Skip to main content -->
    <a href="#main-content" class="sr-only">Skip to main content</a>
    
    <div class="page-wrapper">
        <!-- Header -->
        <header class="site-header" role="banner">
            <div class="header-container">
                <div class="site-branding">
                    <a href="/" class="site-logo">
                        <h1 class="site-title">PHP WordPress Development</h1>
                    </a>
                </div>
                
                <nav class="main-navigation" role="navigation" aria-label="Main navigation">
                    <button class="mobile-menu-btn" aria-label="Toggle navigation" aria-expanded="false">
                        <span></span>
                        <span></span>
                        <span></span>
                    </button>
                    
                    <div class="nav-menu">
                        <ul class="nav-list">
                            <li class="nav-item"><a href="/" class="nav-link">Home</a></li>
                            <li class="nav-item dropdown">
                                <button class="nav-link dropdown-toggle active" aria-haspopup="true">Modules</button>
                                <div class="dropdown-menu">
                                    <a href="/module1.html" class="dropdown-item">Module 1: Web Fundamentals</a>
                                    <a href="/module2.html" class="dropdown-item">Module 2: PHP Fundamentals</a>
                                    <a href="/module3.html" class="dropdown-item">Module 3: MySQL Database</a>
                                    <a href="/module4.html" class="dropdown-item">Module 4: WordPress & Docker</a>
                                    <a href="/module5.html" class="dropdown-item">Module 5: Theme Development</a>
                                    <a href="/module6.html" class="dropdown-item">Module 6: Plugin Development</a>
                                    <a href="/module7.html" class="dropdown-item active">Module 7: Advanced WordPress</a>
                                    <a href="/module8.html" class="dropdown-item">Module 8: Deployment</a>
                                    <a href="/module9.html" class="dropdown-item">Module 9: Final Project</a>
                                </div>
                            </li>
                            <li class="nav-item"><a href="/resources.html" class="nav-link">Resources</a></li>
                            <li class="nav-item"><a href="/about.html" class="nav-link">About</a></li>
                        </ul>
                    </div>
                </nav>
                
                <div class="search-container">
                    <div class="search-input-wrapper">
                        <svg class="search-icon" width="20" height="20" viewBox="0 0 20 20" fill="currentColor">
                            <path fill-rule="evenodd" d="M8 4a4 4 0 100 8 4 4 0 000-8zM2 8a6 6 0 1110.89 3.476l4.817 4.817a1 1 0 01-1.414 1.414l-4.816-4.816A6 6 0 012 8z" clip-rule="evenodd" />
                        </svg>
                        <input type="search" class="search-input" placeholder="Search lessons..." aria-label="Search">
                    </div>
                    <div class="search-results"></div>
                </div>
            </div>
        </header>
        
        <!-- Progress Bar -->
        <div class="progress-container">
            <div class="progress-header">
                <h2 class="progress-title">Course Progress</h2>
                <span class="progress-text">Loading...</span>
            </div>
            <div class="progress-bar">
                <div class="progress-bar-fill">
                    <span class="progress-bar-text"></span>
                </div>
            </div>
        </div>
        
        <!-- Breadcrumb -->
        <nav class="breadcrumb container" aria-label="Breadcrumb">
            <ol class="breadcrumb-list">
                <li class="breadcrumb-item">
                    <a href="/">Home</a>
                    <span class="breadcrumb-separator">/</span>
                </li>
                <li class="breadcrumb-item">
                    <a href="/module7.html">Module 7</a>
                    <span class="breadcrumb-separator">/</span>
                </li>
                <li class="breadcrumb-item">
                    <span aria-current="page">Custom Taxonomy Admin UI</span>
                </li>
            </ol>
        </nav>
        
        <!-- Main Content -->
        <main id="main-content" class="main-content" role="main">
            <div class="container">
                <!-- Lesson Header -->
                <div class="lesson-header">
                    <h1 class="lesson-title">Custom Admin UI for Taxonomies</h1>
                    <p class="lesson-subtitle">Build enhanced admin interfaces for managing custom taxonomies</p>
                </div>
                
                <!-- Learning Objectives -->
                <div class="lesson-objectives">
                    <h2>Learning Objectives</h2>
                    <p>By the end of this lesson, you will be able to:</p>
                    <ul>
                        <li>Create custom taxonomy management pages</li>
                        <li>Build enhanced term editing interfaces</li>
                        <li>Implement drag-and-drop term ordering</li>
                        <li>Add bulk term management features</li>
                        <li>Create visual term selectors</li>
                        <li>Build custom term relationship managers</li>
                    </ul>
                </div>
                
                <!-- Lesson Body -->
                <div class="lesson-body">
                    <!-- Custom Taxonomy Page -->
                    <section>
                        <h2>Custom Taxonomy Management Page</h2>
                        
                        <h3>Creating a Custom Admin Page</h3>
                        <pre><code class="language-php">
// Create custom taxonomy management interface
class Custom_Taxonomy_Admin {
    
    private $taxonomy = 'product_category';
    
    public function __construct() {
        add_action('admin_menu', [$this, 'add_admin_pages']);
        add_action('admin_enqueue_scripts', [$this, 'enqueue_admin_assets']);
        add_action('wp_ajax_save_term_order', [$this, 'ajax_save_term_order']);
        add_action('wp_ajax_bulk_edit_terms', [$this, 'ajax_bulk_edit_terms']);
    }
    
    public function add_admin_pages() {
        // Main taxonomy manager page
        add_menu_page(
            'Taxonomy Manager',
            'Taxonomy Manager',
            'manage_categories',
            'taxonomy-manager',
            [$this, 'render_manager_page'],
            'dashicons-category',
            30
        );
        
        // Visual term selector
        add_submenu_page(
            'taxonomy-manager',
            'Visual Term Selector',
            'Visual Selector',
            'manage_categories',
            'visual-term-selector',
            [$this, 'render_visual_selector']
        );
        
        // Term relationships
        add_submenu_page(
            'taxonomy-manager',
            'Term Relationships',
            'Relationships',
            'manage_categories',
            'term-relationships',
            [$this, 'render_relationships_page']
        );
        
        // Bulk operations
        add_submenu_page(
            'taxonomy-manager',
            'Bulk Operations',
            'Bulk Operations',
            'manage_categories',
            'bulk-term-operations',
            [$this, 'render_bulk_operations']
        );
    }
    
    public function render_manager_page() {
        $terms = get_terms([
            'taxonomy' => $this->taxonomy,
            'hide_empty' => false,
            'parent' => 0,
            'meta_key' => 'term_order',
            'orderby' => 'meta_value_num',
            'order' => 'ASC',
        ]);
        ?>
        <div class="wrap taxonomy-manager">
            <h1>Taxonomy Manager</h1>
            
            <div class="taxonomy-manager-container">
                <div class="taxonomy-tree">
                    <h2>Category Hierarchy</h2>
                    <div class="tree-actions">
                        <button class="button expand-all">Expand All</button>
                        <button class="button collapse-all">Collapse All</button>
                        <button class="button button-primary save-order">Save Order</button>
                    </div>
                    
                    <ul id="term-tree" class="sortable">
                        <?php $this->render_term_tree($terms); ?>
                    </ul>
                </div>
                
                <div class="term-details">
                    <h2>Term Details</h2>
                    <div id="term-details-content">
                        <p>Select a term to view details</p>
                    </div>
                </div>
                
                <div class="quick-stats">
                    <h2>Statistics</h2>
                    <?php $this->render_taxonomy_stats(); ?>
                </div>
            </div>
        </div>
        
        <script type="text/template" id="term-details-template">
            <div class="term-info">
                <h3><%- name %></h3>
                <div class="term-meta">
                    <p><strong>Slug:</strong> <%- slug %></p>
                    <p><strong>Posts:</strong> <%- count %></p>
                    <p><strong>Description:</strong> <%- description || 'No description' %></p>
                </div>
                
                <div class="term-actions">
                    <a href="<%- editLink %>" class="button">Edit Term</a>
                    <a href="<%- viewLink %>" class="button" target="_blank">View Archive</a>
                    <button class="button delete-term" data-term-id="<%- termId %>">Delete</button>
                </div>
                
                <div class="term-custom-fields">
                    <h4>Custom Fields</h4>
                    <form id="term-meta-form">
                        <input type="hidden" name="term_id" value="<%- termId %>">
                        
                        <label>
                            Featured
                            <input type="checkbox" name="featured" <% if (featured) { %>checked<% } %>>
                        </label>
                        
                        <label>
                            Color
                            <input type="text" name="color" value="<%- color %>" class="color-picker">
                        </label>
                        
                        <label>
                            Icon
                            <input type="text" name="icon" value="<%- icon %>" placeholder="dashicons-star">
                        </label>
                        
                        <button type="submit" class="button button-primary">Save Meta</button>
                    </form>
                </div>
            </div>
        </script>
        <?php
    }
    
    private function render_term_tree($terms, $parent_id = 0) {
        foreach ($terms as $term) {
            $children = get_terms([
                'taxonomy' => $this->taxonomy,
                'hide_empty' => false,
                'parent' => $term->term_id,
                'meta_key' => 'term_order',
                'orderby' => 'meta_value_num',
                'order' => 'ASC',
            ]);
            
            $has_children = !empty($children);
            ?>
            <li class="term-item" data-term-id="<?php echo $term->term_id; ?>">
                <div class="term-row">
                    <?php if ($has_children): ?>
                        <span class="toggle-children dashicons dashicons-arrow-down-alt2"></span>
                    <?php else: ?>
                        <span class="no-children"></span>
                    <?php endif; ?>
                    
                    <span class="drag-handle dashicons dashicons-move"></span>
                    
                    <span class="term-name"><?php echo esc_html($term->name); ?></span>
                    <span class="term-count">(<?php echo $term->count; ?>)</span>
                    
                    <div class="term-actions">
                        <a href="#" class="view-details" data-term-id="<?php echo $term->term_id; ?>">
                            <span class="dashicons dashicons-visibility"></span>
                        </a>
                        <a href="<?php echo get_edit_term_link($term->term_id, $this->taxonomy); ?>">
                            <span class="dashicons dashicons-edit"></span>
                        </a>
                        <a href="#" class="add-child" data-parent-id="<?php echo $term->term_id; ?>">
                            <span class="dashicons dashicons-plus"></span>
                        </a>
                    </div>
                </div>
                
                <?php if ($has_children): ?>
                    <ul class="children sortable">
                        <?php $this->render_term_tree($children, $term->term_id); ?>
                    </ul>
                <?php endif; ?>
            </li>
            <?php
        }
    }
    
    private function render_taxonomy_stats() {
        global $wpdb;
        
        $total_terms = wp_count_terms($this->taxonomy, ['hide_empty' => false]);
        $empty_terms = $wpdb->get_var($wpdb->prepare("
            SELECT COUNT(DISTINCT t.term_id)
            FROM {$wpdb->terms} t
            INNER JOIN {$wpdb->term_taxonomy} tt ON t.term_id = tt.term_id
            WHERE tt.taxonomy = %s
            AND tt.count = 0
        ", $this->taxonomy));
        
        $most_used = get_terms([
            'taxonomy' => $this->taxonomy,
            'orderby' => 'count',
            'order' => 'DESC',
            'number' => 5,
        ]);
        ?>
        <div class="stats-grid">
            <div class="stat-card">
                <h4>Total Terms</h4>
                <p class="stat-number"><?php echo $total_terms; ?></p>
            </div>
            
            <div class="stat-card">
                <h4>Empty Terms</h4>
                <p class="stat-number"><?php echo $empty_terms; ?></p>
            </div>
            
            <div class="stat-card">
                <h4>Most Used Terms</h4>
                <ul class="most-used-list">
                    <?php foreach ($most_used as $term): ?>
                        <li>
                            <?php echo esc_html($term->name); ?> 
                            <span class="count">(<?php echo $term->count; ?>)</span>
                        </li>
                    <?php endforeach; ?>
                </ul>
            </div>
        </div>
        <?php
    }
    
    public function enqueue_admin_assets($hook) {
        if (strpos($hook, 'taxonomy-manager') === false && 
            strpos($hook, 'visual-term-selector') === false &&
            strpos($hook, 'term-relationships') === false) {
            return;
        }
        
        // Enqueue jQuery UI for sortable
        wp_enqueue_script('jquery-ui-sortable');
        wp_enqueue_script('jquery-ui-droppable');
        
        // Enqueue Underscore for templates
        wp_enqueue_script('underscore');
        
        // Color picker
        wp_enqueue_style('wp-color-picker');
        wp_enqueue_script('wp-color-picker');
        
        // Custom admin script
        wp_enqueue_script(
            'taxonomy-admin',
            get_template_directory_uri() . '/assets/js/taxonomy-admin.js',
            ['jquery', 'jquery-ui-sortable', 'underscore', 'wp-color-picker'],
            '1.0.0',
            true
        );
        
        wp_localize_script('taxonomy-admin', 'taxonomyAdmin', [
            'ajaxurl' => admin_url('admin-ajax.php'),
            'nonce' => wp_create_nonce('taxonomy_admin_nonce'),
            'taxonomy' => $this->taxonomy,
        ]);
        
        // Custom admin styles
        wp_add_inline_style('wp-admin', $this->get_admin_styles());
    }
    
    private function get_admin_styles() {
        return '
        .taxonomy-manager-container {
            display: grid;
            grid-template-columns: 2fr 1fr;
            gap: 20px;
            margin-top: 20px;
        }
        
        .taxonomy-tree {
            background: white;
            padding: 20px;
            border: 1px solid #ccd0d4;
            border-radius: 4px;
        }
        
        .term-details {
            background: white;
            padding: 20px;
            border: 1px solid #ccd0d4;
            border-radius: 4px;
        }
        
        .quick-stats {
            grid-column: 1 / -1;
            background: white;
            padding: 20px;
            border: 1px solid #ccd0d4;
            border-radius: 4px;
        }
        
        #term-tree {
            list-style: none;
            padding: 0;
            margin: 20px 0;
        }
        
        .term-item {
            margin: 5px 0;
            border: 1px solid #ddd;
            background: #f9f9f9;
            border-radius: 3px;
        }
        
        .term-item.ui-sortable-helper {
            opacity: 0.8;
            background: #fff;
            box-shadow: 0 2px 5px rgba(0,0,0,0.2);
        }
        
        .term-row {
            display: flex;
            align-items: center;
            padding: 10px;
            cursor: move;
        }
        
        .toggle-children {
            cursor: pointer;
            margin-right: 10px;
            transition: transform 0.3s;
        }
        
        .toggle-children.collapsed {
            transform: rotate(-90deg);
        }
        
        .drag-handle {
            margin-right: 10px;
            color: #999;
        }
        
        .term-name {
            flex: 1;
            font-weight: 500;
        }
        
        .term-count {
            color: #666;
            margin-right: 10px;
        }
        
        .term-actions {
            display: flex;
            gap: 5px;
        }
        
        .term-actions a {
            color: #666;
            text-decoration: none;
        }
        
        .term-actions a:hover {
            color: #0073aa;
        }
        
        .children {
            list-style: none;
            padding-left: 40px;
            margin: 0;
            display: none;
        }
        
        .children.expanded {
            display: block;
        }
        
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
        }
        
        .stat-card {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 4px;
            border: 1px solid #e1e4e8;
        }
        
        .stat-card h4 {
            margin: 0 0 10px 0;
            color: #555;
        }
        
        .stat-number {
            font-size: 32px;
            font-weight: bold;
            color: #0073aa;
            margin: 0;
        }
        
        .most-used-list {
            list-style: none;
            padding: 0;
            margin: 0;
        }
        
        .most-used-list li {
            padding: 5px 0;
            border-bottom: 1px solid #e1e4e8;
        }
        
        .most-used-list li:last-child {
            border-bottom: none;
        }
        
        .tree-actions {
            margin-bottom: 15px;
        }
        
        .tree-actions .button {
            margin-right: 5px;
        }
        ';
    }
}

new Custom_Taxonomy_Admin();
                        </code></pre>
                    </section>
                    
                    <!-- Visual Term Selector -->
                    <section>
                        <h2>Visual Term Selector</h2>
                        
                        <h3>Creating a Visual Interface</h3>
                        <pre><code class="language-php">
// Visual term selector interface
class Visual_Term_Selector {
    
    public function render_visual_selector() {
        $taxonomies = get_taxonomies(['public' => true], 'objects');
        $selected_taxonomy = $_GET['taxonomy'] ?? 'category';
        ?>
        <div class="wrap visual-term-selector">
            <h1>Visual Term Selector</h1>
            
            <div class="selector-toolbar">
                <label for="taxonomy-select">Select Taxonomy:</label>
                <select id="taxonomy-select" name="taxonomy">
                    <?php foreach ($taxonomies as $tax): ?>
                        <option value="<?php echo $tax->name; ?>" 
                                <?php selected($selected_taxonomy, $tax->name); ?>>
                            <?php echo $tax->label; ?>
                        </option>
                    <?php endforeach; ?>
                </select>
                
                <div class="view-toggles">
                    <button class="view-toggle active" data-view="grid">
                        <span class="dashicons dashicons-grid-view"></span> Grid
                    </button>
                    <button class="view-toggle" data-view="list">
                        <span class="dashicons dashicons-list-view"></span> List
                    </button>
                    <button class="view-toggle" data-view="tree">
                        <span class="dashicons dashicons-networking"></span> Tree
                    </button>
                </div>
                
                <div class="search-box">
                    <input type="search" id="term-search" placeholder="Search terms...">
                </div>
            </div>
            
            <div id="visual-selector-container" class="grid-view">
                <?php $this->render_terms_grid($selected_taxonomy); ?>
            </div>
            
            <div class="selected-terms-panel">
                <h3>Selected Terms</h3>
                <ul id="selected-terms-list"></ul>
                <button class="button button-primary" id="apply-selection">Apply Selection</button>
            </div>
        </div>
        <?php
    }
    
    private function render_terms_grid($taxonomy) {
        $terms = get_terms([
            'taxonomy' => $taxonomy,
            'hide_empty' => false,
            'parent' => 0,
        ]);
        ?>
        <div class="terms-grid">
            <?php foreach ($terms as $term): ?>
                <?php $this->render_term_card($term, $taxonomy); ?>
            <?php endforeach; ?>
        </div>
        <?php
    }
    
    private function render_term_card($term, $taxonomy) {
        $image = get_term_meta($term->term_id, 'category_image', true);
        $color = get_term_meta($term->term_id, 'category_color', true);
        $icon = get_term_meta($term->term_id, 'category_icon', true);
        $children = get_term_children($term->term_id, $taxonomy);
        ?>
        <div class="term-card" data-term-id="<?php echo $term->term_id; ?>">
            <div class="term-card-header" style="background-color: <?php echo $color ?: '#f0f0f0'; ?>">
                <?php if ($image): ?>
                    <?php echo wp_get_attachment_image($image, 'thumbnail', false, ['class' => 'term-image']); ?>
                <?php elseif ($icon): ?>
                    <span class="term-icon dashicons <?php echo esc_attr($icon); ?>"></span>
                <?php else: ?>
                    <span class="term-icon dashicons dashicons-category"></span>
                <?php endif; ?>
            </div>
            
            <div class="term-card-body">
                <h4><?php echo esc_html($term->name); ?></h4>
                <p class="term-stats">
                    <span><?php echo $term->count; ?> posts</span>
                    <?php if (!empty($children)): ?>
                        <span><?php echo count($children); ?> children</span>
                    <?php endif; ?>
                </p>
                
                <?php if ($term->description): ?>
                    <p class="term-description"><?php echo wp_trim_words($term->description, 10); ?></p>
                <?php endif; ?>
            </div>
            
            <div class="term-card-footer">
                <button class="button select-term">Select</button>
                <a href="<?php echo get_term_link($term); ?>" class="button" target="_blank">View</a>
                <?php if (!empty($children)): ?>
                    <button class="button expand-children">Children</button>
                <?php endif; ?>
            </div>
            
            <?php if (!empty($children)): ?>
                <div class="term-children" style="display: none;">
                    <?php foreach ($children as $child_id): ?>
                        <?php
                        $child = get_term($child_id, $taxonomy);
                        if ($child && !is_wp_error($child)):
                        ?>
                            <div class="child-term" data-term-id="<?php echo $child->term_id; ?>">
                                <span><?php echo esc_html($child->name); ?></span>
                                <button class="button button-small select-child">+</button>
                            </div>
                        <?php endif; ?>
                    <?php endforeach; ?>
                </div>
            <?php endif; ?>
        </div>
        <?php
    }
}
                        </code></pre>
                    </section>
                    
                    <!-- Term Relationships Manager -->
                    <section>
                        <h2>Term Relationships Manager</h2>
                        
                        <h3>Managing Complex Relationships</h3>
                        <pre><code class="language-php">
// Term relationships management interface
class Term_Relationships_Manager {
    
    public function render_relationships_page() {
        ?>
        <div class="wrap term-relationships">
            <h1>Term Relationships Manager</h1>
            
            <div class="relationship-builder">
                <div class="source-terms">
                    <h2>Source Terms</h2>
                    <select id="source-taxonomy">
                        <option value="">Select Taxonomy</option>
                        <?php
                        $taxonomies = get_taxonomies(['public' => true], 'objects');
                        foreach ($taxonomies as $tax):
                        ?>
                            <option value="<?php echo $tax->name; ?>">
                                <?php echo $tax->label; ?>
                            </option>
                        <?php endforeach; ?>
                    </select>
                    
                    <div id="source-terms-list" class="terms-list"></div>
                </div>
                
                <div class="relationship-controls">
                    <h3>Relationship Type</h3>
                    <select id="relationship-type">
                        <option value="parent-child">Parent-Child</option>
                        <option value="related">Related</option>
                        <option value="synonym">Synonym</option>
                        <option value="opposite">Opposite</option>
                        <option value="custom">Custom</option>
                    </select>
                    
                    <input type="text" id="custom-relationship" 
                           placeholder="Custom relationship name" 
                           style="display: none;">
                    
                    <div class="relationship-actions">
                        <button class="button button-primary" id="create-relationship">
                            Create Relationship →
                        </button>
                        <button class="button" id="remove-relationship">
                            Remove Relationship
                        </button>
                    </div>
                </div>
                
                <div class="target-terms">
                    <h2>Target Terms</h2>
                    <select id="target-taxonomy">
                        <option value="">Select Taxonomy</option>
                        <?php foreach ($taxonomies as $tax): ?>
                            <option value="<?php echo $tax->name; ?>">
                                <?php echo $tax->label; ?>
                            </option>
                        <?php endforeach; ?>
                    </select>
                    
                    <div id="target-terms-list" class="terms-list"></div>
                </div>
            </div>
            
            <div class="existing-relationships">
                <h2>Existing Relationships</h2>
                <div id="relationships-table">
                    <?php $this->render_relationships_table(); ?>
                </div>
            </div>
            
            <div class="relationship-graph">
                <h2>Relationship Visualization</h2>
                <div id="relationship-canvas"></div>
            </div>
        </div>
        <?php
    }
    
    private function render_relationships_table() {
        global $wpdb;
        
        $table_name = $wpdb->prefix . 'term_relationships_custom';
        $relationships = $wpdb->get_results("
            SELECT r.*, 
                   t1.name as parent_name, 
                   t2.name as child_name,
                   tt1.taxonomy as parent_tax,
                   tt2.taxonomy as child_tax
            FROM $table_name r
            LEFT JOIN {$wpdb->terms} t1 ON r.parent_term_id = t1.term_id
            LEFT JOIN {$wpdb->terms} t2 ON r.child_term_id = t2.term_id
            LEFT JOIN {$wpdb->term_taxonomy} tt1 ON t1.term_id = tt1.term_id
            LEFT JOIN {$wpdb->term_taxonomy} tt2 ON t2.term_id = tt2.term_id
            ORDER BY r.created_at DESC
            LIMIT 50
        ");
        ?>
        <table class="wp-list-table widefat fixed striped">
            <thead>
                <tr>
                    <th>Source Term</th>
                    <th>Source Taxonomy</th>
                    <th>Relationship</th>
                    <th>Target Term</th>
                    <th>Target Taxonomy</th>
                    <th>Created</th>
                    <th>Actions</th>
                </tr>
            </thead>
            <tbody>
                <?php foreach ($relationships as $rel): ?>
                    <tr data-relationship-id="<?php echo $rel->id; ?>">
                        <td><?php echo esc_html($rel->parent_name); ?></td>
                        <td><?php echo esc_html($rel->parent_tax); ?></td>
                        <td>
                            <span class="relationship-type">
                                <?php echo esc_html($rel->relationship_type); ?>
                            </span>
                        </td>
                        <td><?php echo esc_html($rel->child_name); ?></td>
                        <td><?php echo esc_html($rel->child_tax); ?></td>
                        <td><?php echo date('Y-m-d', strtotime($rel->created_at)); ?></td>
                        <td>
                            <button class="button button-small delete-relationship" 
                                    data-id="<?php echo $rel->id; ?>">
                                Delete
                            </button>
                        </td>
                    </tr>
                <?php endforeach; ?>
            </tbody>
        </table>
        <?php
    }
}
                        </code></pre>
                    </section>
                    
                    <!-- Bulk Operations -->
                    <section>
                        <h2>Bulk Term Operations</h2>
                        
                        <h3>Bulk Management Interface</h3>
                        <pre><code class="language-php">
// Bulk term operations
class Bulk_Term_Operations {
    
    public function render_bulk_operations() {
        ?>
        <div class="wrap bulk-operations">
            <h1>Bulk Term Operations</h1>
            
            <div class="operation-tabs">
                <button class="tab-button active" data-tab="merge">Merge Terms</button>
                <button class="tab-button" data-tab="split">Split Terms</button>
                <button class="tab-button" data-tab="convert">Convert Taxonomy</button>
                <button class="tab-button" data-tab="import">Import Terms</button>
                <button class="tab-button" data-tab="export">Export Terms</button>
            </div>
            
            <div class="tab-content active" id="merge-tab">
                <h2>Merge Terms</h2>
                <form id="merge-terms-form">
                    <div class="merge-container">
                        <div class="source-terms">
                            <h3>Terms to Merge</h3>
                            <select id="merge-taxonomy">
                                <?php $this->render_taxonomy_options(); ?>
                            </select>
                            
                            <div id="mergeable-terms" class="term-checkboxes">
                                <!-- Terms loaded via AJAX -->
                            </div>
                        </div>
                        
                        <div class="merge-arrow">→</div>
                        
                        <div class="target-term">
                            <h3>Merge Into</h3>
                            <select id="merge-target">
                                <option value="">Select target term</option>
                            </select>
                            
                            <div class="merge-options">
                                <label>
                                    <input type="checkbox" name="delete_merged" checked>
                                    Delete merged terms
                                </label>
                                <label>
                                    <input type="checkbox" name="redirect_merged">
                                    Create redirects for merged terms
                                </label>
                                <label>
                                    <input type="checkbox" name="combine_meta">
                                    Combine term meta
                                </label>
                            </div>
                        </div>
                    </div>
                    
                    <button type="submit" class="button button-primary">Merge Terms</button>
                </form>
            </div>
            
            <div class="tab-content" id="split-tab">
                <h2>Split Terms</h2>
                <form id="split-terms-form">
                    <div class="split-container">
                        <div class="term-to-split">
                            <h3>Term to Split</h3>
                            <select id="split-taxonomy">
                                <?php $this->render_taxonomy_options(); ?>
                            </select>
                            
                            <select id="split-term">
                                <option value="">Select term</option>
                            </select>
                        </div>
                        
                        <div class="split-rules">
                            <h3>Split Rules</h3>
                            <div id="split-rules-container">
                                <div class="split-rule">
                                    <input type="text" name="new_term_name[]" 
                                           placeholder="New term name">
                                    <textarea name="split_condition[]" 
                                              placeholder="Condition (e.g., post contains 'keyword')"></textarea>
                                    <button type="button" class="remove-rule">Remove</button>
                                </div>
                            </div>
                            <button type="button" id="add-split-rule" class="button">
                                Add Rule
                            </button>
                        </div>
                    </div>
                    
                    <button type="submit" class="button button-primary">Split Term</button>
                </form>
            </div>
            
            <div class="tab-content" id="convert-tab">
                <h2>Convert Taxonomy</h2>
                <form id="convert-taxonomy-form">
                    <div class="convert-container">
                        <div class="from-taxonomy">
                            <h3>From Taxonomy</h3>
                            <select id="from-taxonomy">
                                <?php $this->render_taxonomy_options(); ?>
                            </select>
                            
                            <div id="terms-to-convert" class="term-checkboxes">
                                <!-- Terms loaded via AJAX -->
                            </div>
                        </div>
                        
                        <div class="to-taxonomy">
                            <h3>To Taxonomy</h3>
                            <select id="to-taxonomy">
                                <?php $this->render_taxonomy_options(); ?>
                            </select>
                            
                            <div class="convert-options">
                                <label>
                                    <input type="checkbox" name="maintain_hierarchy" checked>
                                    Maintain hierarchy
                                </label>
                                <label>
                                    <input type="checkbox" name="convert_meta">
                                    Convert term meta
                                </label>
                                <label>
                                    <input type="checkbox" name="create_if_not_exists" checked>
                                    Create terms if they don't exist
                                </label>
                            </div>
                        </div>
                    </div>
                    
                    <button type="submit" class="button button-primary">Convert Terms</button>
                </form>
            </div>
            
            <div class="tab-content" id="import-tab">
                <h2>Import Terms</h2>
                <form id="import-terms-form" enctype="multipart/form-data">
                    <div class="import-container">
                        <div class="import-source">
                            <h3>Import Source</h3>
                            <label>
                                <input type="radio" name="import_type" value="csv" checked>
                                CSV File
                            </label>
                            <label>
                                <input type="radio" name="import_type" value="json">
                                JSON File
                            </label>
                            <label>
                                <input type="radio" name="import_type" value="xml">
                                XML File
                            </label>
                            
                            <input type="file" name="import_file" accept=".csv,.json,.xml">
                        </div>
                        
                        <div class="import-mapping">
                            <h3>Field Mapping</h3>
                            <table class="field-mapping-table">
                                <tr>
                                    <td>Term Name</td>
                                    <td><input type="text" name="map_name" value="name"></td>
                                </tr>
                                <tr>
                                    <td>Slug</td>
                                    <td><input type="text" name="map_slug" value="slug"></td>
                                </tr>
                                <tr>
                                    <td>Description</td>
                                    <td><input type="text" name="map_description" value="description"></td>
                                </tr>
                                <tr>
                                    <td>Parent</td>
                                    <td><input type="text" name="map_parent" value="parent"></td>
                                </tr>
                            </table>
                        </div>
                        
                        <div class="import-options">
                            <h3>Import Options</h3>
                            <select name="target_taxonomy">
                                <?php $this->render_taxonomy_options(); ?>
                            </select>
                            
                            <label>
                                <input type="checkbox" name="update_existing">
                                Update existing terms
                            </label>
                            <label>
                                <input type="checkbox" name="import_meta">
                                Import term meta
                            </label>
                        </div>
                    </div>
                    
                    <button type="submit" class="button button-primary">Import Terms</button>
                </form>
            </div>
            
            <div class="tab-content" id="export-tab">
                <h2>Export Terms</h2>
                <form id="export-terms-form">
                    <div class="export-container">
                        <div class="export-selection">
                            <h3>Select Terms to Export</h3>
                            <select id="export-taxonomy">
                                <?php $this->render_taxonomy_options(); ?>
                            </select>
                            
                            <div id="exportable-terms" class="term-checkboxes">
                                <!-- Terms loaded via AJAX -->
                            </div>
                            
                            <button type="button" id="select-all-export">Select All</button>
                            <button type="button" id="select-none-export">Select None</button>
                        </div>
                        
                        <div class="export-options">
                            <h3>Export Format</h3>
                            <label>
                                <input type="radio" name="export_format" value="csv" checked>
                                CSV
                            </label>
                            <label>
                                <input type="radio" name="export_format" value="json">
                                JSON
                            </label>
                            <label>
                                <input type="radio" name="export_format" value="xml">
                                XML
                            </label>
                            
                            <h3>Include Fields</h3>
                            <label>
                                <input type="checkbox" name="include_meta" checked>
                                Term Meta
                            </label>
                            <label>
                                <input type="checkbox" name="include_count" checked>
                                Post Count
                            </label>
                            <label>
                                <input type="checkbox" name="include_hierarchy" checked>
                                Hierarchy Information
                            </label>
                        </div>
                    </div>
                    
                    <button type="submit" class="button button-primary">Export Terms</button>
                </form>
            </div>
        </div>
        <?php
    }
    
    private function render_taxonomy_options() {
        $taxonomies = get_taxonomies(['public' => true], 'objects');
        foreach ($taxonomies as $tax) {
            echo '<option value="' . esc_attr($tax->name) . '">';
            echo esc_html($tax->label);
            echo '</option>';
        }
    }
}
                        </code></pre>
                    </section>
                    
                    <!-- JavaScript Implementation -->
                    <section>
                        <h2>JavaScript Implementation</h2>
                        
                        <h3>Admin Interface JavaScript</h3>
                        <pre><code class="language-javascript">
// taxonomy-admin.js
jQuery(document).ready(function($) {
    
    // Initialize sortable for term tree
    function initSortable() {
        $('#term-tree, .children').sortable({
            items: '> li',
            handle: '.drag-handle',
            placeholder: 'sortable-placeholder',
            connectWith: '.sortable',
            update: function(event, ui) {
                $('.save-order').addClass('button-primary-active');
            }
        });
    }
    
    initSortable();
    
    // Toggle children visibility
    $(document).on('click', '.toggle-children', function() {
        var $this = $(this);
        var $children = $this.closest('.term-item').find('> .children');
        
        $this.toggleClass('collapsed');
        $children.toggleClass('expanded');
    });
    
    // Expand/Collapse all
    $('.expand-all').on('click', function() {
        $('.children').addClass('expanded');
        $('.toggle-children').removeClass('collapsed');
    });
    
    $('.collapse-all').on('click', function() {
        $('.children').removeClass('expanded');
        $('.toggle-children').addClass('collapsed');
    });
    
    // Save term order
    $('.save-order').on('click', function() {
        var $button = $(this);
        $button.prop('disabled', true);
        
        var order = [];
        $('#term-tree').find('.term-item').each(function(index) {
            order.push({
                term_id: $(this).data('term-id'),
                order: index,
                parent: $(this).parent().closest('.term-item').data('term-id') || 0
            });
        });
        
        $.post(taxonomyAdmin.ajaxurl, {
            action: 'save_term_order',
            nonce: taxonomyAdmin.nonce,
            order: order
        }, function(response) {
            if (response.success) {
                $button.removeClass('button-primary-active');
                showNotice('Term order saved successfully', 'success');
            }
            $button.prop('disabled', false);
        });
    });
    
    // View term details
    $(document).on('click', '.view-details', function(e) {
        e.preventDefault();
        
        var termId = $(this).data('term-id');
        
        $.post(taxonomyAdmin.ajaxurl, {
            action: 'get_term_details',
            nonce: taxonomyAdmin.nonce,
            term_id: termId,
            taxonomy: taxonomyAdmin.taxonomy
        }, function(response) {
            if (response.success) {
                var template = _.template($('#term-details-template').html());
                $('#term-details-content').html(template(response.data));
                
                // Initialize color picker
                $('.color-picker').wpColorPicker();
            }
        });
    });
    
    // Save term meta
    $(document).on('submit', '#term-meta-form', function(e) {
        e.preventDefault();
        
        var formData = $(this).serialize();
        
        $.post(taxonomyAdmin.ajaxurl, {
            action: 'save_term_meta',
            nonce: taxonomyAdmin.nonce,
            data: formData
        }, function(response) {
            if (response.success) {
                showNotice('Term meta saved successfully', 'success');
            }
        });
    });
    
    // Visual selector functionality
    $('.view-toggle').on('click', function() {
        var view = $(this).data('view');
        
        $('.view-toggle').removeClass('active');
        $(this).addClass('active');
        
        $('#visual-selector-container')
            .removeClass('grid-view list-view tree-view')
            .addClass(view + '-view');
    });
    
    // Term selection
    $(document).on('click', '.select-term', function() {
        var $card = $(this).closest('.term-card');
        var termId = $card.data('term-id');
        var termName = $card.find('h4').text();
        
        $card.toggleClass('selected');
        
        if ($card.hasClass('selected')) {
            $('#selected-terms-list').append(
                '<li data-term-id="' + termId + '">' +
                termName + 
                ' <button class="remove-selection">×</button></li>'
            );
        } else {
            $('#selected-terms-list')
                .find('[data-term-id="' + termId + '"]')
                .remove();
        }
    });
    
    // Remove selection
    $(document).on('click', '.remove-selection', function() {
        var termId = $(this).parent().data('term-id');
        $(this).parent().remove();
        $('.term-card[data-term-id="' + termId + '"]').removeClass('selected');
    });
    
    // Expand children
    $(document).on('click', '.expand-children', function() {
        var $children = $(this).closest('.term-card').find('.term-children');
        $children.slideToggle();
    });
    
    // Term search
    $('#term-search').on('keyup', function() {
        var searchTerm = $(this).val().toLowerCase();
        
        $('.term-card').each(function() {
            var termName = $(this).find('h4').text().toLowerCase();
            
            if (termName.indexOf(searchTerm) > -1) {
                $(this).show();
            } else {
                $(this).hide();
            }
        });
    });
    
    // Bulk operations tabs
    $('.tab-button').on('click', function() {
        var tab = $(this).data('tab');
        
        $('.tab-button').removeClass('active');
        $(this).addClass('active');
        
        $('.tab-content').removeClass('active');
        $('#' + tab + '-tab').addClass('active');
    });
    
    // Load terms for merge
    $('#merge-taxonomy').on('change', function() {
        var taxonomy = $(this).val();
        
        $.post(taxonomyAdmin.ajaxurl, {
            action: 'get_taxonomy_terms',
            nonce: taxonomyAdmin.nonce,
            taxonomy: taxonomy
        }, function(response) {
            if (response.success) {
                var html = '';
                response.data.forEach(function(term) {
                    html += '<label>';
                    html += '<input type="checkbox" name="merge_terms[]" value="' + term.term_id + '">';
                    html += ' ' + term.name + ' (' + term.count + ')';
                    html += '</label>';
                });
                $('#mergeable-terms').html(html);
                
                // Update target select
                var targetHtml = '<option value="">Select target term</option>';
                response.data.forEach(function(term) {
                    targetHtml += '<option value="' + term.term_id + '">';
                    targetHtml += term.name;
                    targetHtml += '</option>';
                });
                $('#merge-target').html(targetHtml);
            }
        });
    });
    
    // Merge terms
    $('#merge-terms-form').on('submit', function(e) {
        e.preventDefault();
        
        var formData = $(this).serialize();
        
        $.post(taxonomyAdmin.ajaxurl, {
            action: 'merge_terms',
            nonce: taxonomyAdmin.nonce,
            data: formData
        }, function(response) {
            if (response.success) {
                showNotice('Terms merged successfully', 'success');
                $('#merge-taxonomy').trigger('change');
            } else {
                showNotice(response.data.message, 'error');
            }
        });
    });
    
    // Helper function to show notices
    function showNotice(message, type) {
        var noticeClass = type === 'success' ? 'notice-success' : 'notice-error';
        var $notice = $('<div class="notice ' + noticeClass + ' is-dismissible">' +
                       '<p>' + message + '</p>' +
                       '<button type="button" class="notice-dismiss"></button>' +
                       '</div>');
        
        $('.wrap').prepend($notice);
        
        setTimeout(function() {
            $notice.fadeOut(function() {
                $(this).remove();
            });
        }, 3000);
    }
});
                        </code></pre>
                    </section>
                    
                    <!-- Summary -->
                    <section>
                        <h2>Summary</h2>
                        
                        <div class="summary-box">
                            <h3>Key Takeaways</h3>
                            <ul>
                                <li>Custom admin pages enhance taxonomy management</li>
                                <li>Visual selectors improve user experience</li>
                                <li>Drag-and-drop ordering simplifies hierarchy management</li>
                                <li>Bulk operations save time with large taxonomies</li>
                                <li>Relationship managers enable complex connections</li>
                                <li>AJAX integration provides smooth interactions</li>
                            </ul>
                        </div>
                        
                        <div class="best-practices">
                            <h3>Best Practices</h3>
                            <ul>
                                <li>Always include proper permission checks</li>
                                <li>Use nonces for security in AJAX requests</li>
                                <li>Provide visual feedback for user actions</li>
                                <li>Cache expensive operations</li>
                                <li>Include confirmation dialogs for destructive actions</li>
                                <li>Make interfaces responsive and accessible</li>
                                <li>Test with large datasets for performance</li>
                            </ul>
                        </div>
                    </section>
                    
                    <!-- Additional Resources -->
                    <section class="resources">
                        <h2>Additional Resources</h2>
                        <ul>
                            <li><a href="https://developer.wordpress.org/reference/functions/add_menu_page/" target="_blank">add_menu_page() Documentation</a></li>
                            <li><a href="https://jqueryui.com/sortable/" target="_blank">jQuery UI Sortable</a></li>
                            <li><a href="https://developer.wordpress.org/reference/hooks/wp_ajax/" target="_blank">AJAX in WordPress</a></li>
                            <li><a href="https://underscorejs.org/" target="_blank">Underscore.js Templates</a></li>
                        </ul>
                    </section>
                </div>
                
                <!-- Lesson Navigation -->
                <div class="lesson-navigation">
                    <a href="/07module/advanced_taxonomy_relationships.html" class="lesson-nav-button prev">
                        <svg width="20" height="20" viewBox="0 0 20 20" fill="currentColor">
                            <path d="M12.707 5.293a1 1 0 010 1.414L9.414 10l3.293 3.293a1 1 0 01-1.414 1.414l-4-4a1 1 0 010-1.414l4-4a1 1 0 011.414 0z"/>
                        </svg>
                        <span>
                            <small>Previous</small><br>
                            Advanced Taxonomies
                        </span>
                    </a>
                    
                    <button class="complete-lesson-btn">
                        Mark as Complete
                    </button>
                    
                    <a href="/07module/querying_complex_relationships.html" class="lesson-nav-button next">
                        <span>
                            <small>Next</small><br>
                            Complex Queries
                        </span>
                        <svg width="20" height="20" viewBox="0 0 20 20" fill="currentColor">
                            <path d="M7.293 14.707a1 1 0 010-1.414L10.586 10 7.293 6.707a1 1 0 011.414-1.414l4 4a1 1 0 010 1.414l-4 4a1 1 0 01-1.414 0z"/>
                        </svg>
                    </a>
                </div>
            </div>
        </main>
        
        <!-- Footer -->
        <footer class="site-footer" role="contentinfo">
            <div class="footer-container">
                <div class="footer-content">
                    <div class="footer-section footer-about">
                        <h3>PHP WordPress Development</h3>
                        <p>Complete Web Development Course - From HTML to WordPress</p>
                    </div>
                    
                    <div class="footer-section">
                        <h4>Quick Links</h4>
                        <ul class="footer-links">
                            <li><a href="/">Home</a></li>
                            <li><a href="/module7.html">Module 7</a></li>
                            <li><a href="/resources.html">Resources</a></li>
                            <li><a href="/about.html">About</a></li>
                        </ul>
                    </div>
                </div>
                
                <div class="footer-bottom">
                    <p>&copy; 2025 PHP WordPress Development Course. All rights reserved.</p>
                </div>
            </div>
        </footer>
    </div>
    
    <!-- JavaScript -->
    <script src="/assets/js/prism.js"></script>
    <script src="/assets/js/main.js"></script>
    <script src="/assets/js/lesson.js"></script>
</body>
</html>