<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    
    <!-- SEO Meta Tags -->
    <title>Application Architecture Patterns in WordPress - PHP WordPress Course</title>
    <meta name="description" content="Master advanced application architecture patterns for WordPress development. Learn to implement scalable, maintainable WordPress applications.">
    <meta name="keywords" content="WordPress, architecture patterns, design patterns, application development, software architecture">
    <meta name="author" content="PHP WordPress Course">
    
    <!-- Open Graph Tags -->
    <meta property="og:title" content="Application Architecture Patterns in WordPress">
    <meta property="og:description" content="Implement professional architecture patterns in WordPress applications">
    <meta property="og:type" content="article">
    
    <!-- Favicon -->
    <link rel="icon" type="image/png" href="/favicon.png">
    <link rel="apple-touch-icon" href="/favicon.png">
    
    <!-- CSS -->
    <link rel="stylesheet" href="/assets/css/main.css">
    
    <!-- Prism.js for syntax highlighting -->
    <link href="/assets/css/prism.css" rel="stylesheet">
</head>
<body>
    <!-- Skip to main content -->
    <a href="#main-content" class="sr-only">Skip to main content</a>
    
    <div class="page-wrapper">
        <!-- Header -->
        <header class="site-header" role="banner">
            <div class="header-container">
                <div class="site-branding">
                    <a href="/" class="site-logo">
                        <h1 class="site-title">PHP WordPress Development</h1>
                    </a>
                </div>
                
                <nav class="main-navigation" role="navigation" aria-label="Main navigation">
                    <button class="mobile-menu-btn" aria-label="Toggle navigation" aria-expanded="false">
                        <span></span>
                        <span></span>
                        <span></span>
                    </button>
                    
                    <div class="nav-menu">
                        <ul class="nav-list">
                            <li class="nav-item"><a href="/" class="nav-link">Home</a></li>
                            <li class="nav-item dropdown">
                                <button class="nav-link dropdown-toggle active" aria-haspopup="true">Modules</button>
                                <div class="dropdown-menu">
                                    <a href="/module1.html" class="dropdown-item">Module 1: Web Fundamentals</a>
                                    <a href="/module2.html" class="dropdown-item">Module 2: PHP Fundamentals</a>
                                    <a href="/module3.html" class="dropdown-item">Module 3: MySQL Database</a>
                                    <a href="/module4.html" class="dropdown-item">Module 4: WordPress & Docker</a>
                                    <a href="/module5.html" class="dropdown-item">Module 5: Theme Development</a>
                                    <a href="/module6.html" class="dropdown-item">Module 6: Plugin Development</a>
                                    <a href="/module7.html" class="dropdown-item active">Module 7: Advanced WordPress</a>
                                    <a href="/module8.html" class="dropdown-item">Module 8: Deployment</a>
                                    <a href="/module9.html" class="dropdown-item">Module 9: Final Project</a>
                                </div>
                            </li>
                            <li class="nav-item"><a href="/resources.html" class="nav-link">Resources</a></li>
                            <li class="nav-item"><a href="/about.html" class="nav-link">About</a></li>
                        </ul>
                    </div>
                </nav>
                
                <div class="search-container">
                    <div class="search-input-wrapper">
                        <svg class="search-icon" width="20" height="20" viewBox="0 0 20 20" fill="currentColor">
                            <path fill-rule="evenodd" d="M8 4a4 4 0 100 8 4 4 0 000-8zM2 8a6 6 0 1110.89 3.476l4.817 4.817a1 1 0 01-1.414 1.414l-4.816-4.816A6 6 0 012 8z" clip-rule="evenodd" />
                        </svg>
                        <input type="search" class="search-input" placeholder="Search lessons..." aria-label="Search">
                    </div>
                    <div class="search-results"></div>
                </div>
            </div>
        </header>
        
        <!-- Progress Bar -->
        <div class="progress-container">
            <div class="progress-header">
                <h2 class="progress-title">Course Progress</h2>
                <span class="progress-text">Loading...</span>
            </div>
            <div class="progress-bar">
                <div class="progress-bar-fill">
                    <span class="progress-bar-text"></span>
                </div>
            </div>
        </div>
        
        <!-- Breadcrumb -->
        <nav class="breadcrumb container" aria-label="Breadcrumb">
            <ol class="breadcrumb-list">
                <li class="breadcrumb-item">
                    <a href="/">Home</a>
                    <span class="breadcrumb-separator">/</span>
                </li>
                <li class="breadcrumb-item">
                    <a href="/module7.html">Module 7</a>
                    <span class="breadcrumb-separator">/</span>
                </li>
                <li class="breadcrumb-item">
                    <span aria-current="page">Architecture Patterns</span>
                </li>
            </ol>
        </nav>
        
        <!-- Main Content -->
        <main id="main-content" class="main-content" role="main">
            <div class="container">
                <!-- Lesson Header -->
                <div class="lesson-header">
                    <h1 class="lesson-title">Application Architecture Patterns in WordPress</h1>
                    <p class="lesson-subtitle">Design scalable and maintainable WordPress applications</p>
                </div>
                
                <!-- Learning Objectives -->
                <div class="lesson-objectives">
                    <h2>Learning Objectives</h2>
                    <p>By the end of this lesson, you will be able to:</p>
                    <ul>
                        <li>Implement common design patterns in WordPress</li>
                        <li>Choose appropriate architecture patterns for your projects</li>
                        <li>Apply SOLID principles to WordPress development</li>
                        <li>Create modular and testable code structures</li>
                        <li>Build enterprise-level WordPress applications</li>
                    </ul>
                </div>
                
                <!-- Lesson Body -->
                <div class="lesson-body">
                    <!-- Introduction to Architecture Patterns -->
                    <section>
                        <h2>Understanding Architecture Patterns</h2>
                        
                        <p>Architecture patterns provide proven solutions to common software design problems. In WordPress, these patterns help create:</p>
                        
                        <ul>
                            <li><strong>Maintainable code:</strong> Easier to update and debug</li>
                            <li><strong>Scalable applications:</strong> Can grow with requirements</li>
                            <li><strong>Testable components:</strong> Unit testing becomes straightforward</li>
                            <li><strong>Team collaboration:</strong> Clear structure for multiple developers</li>
                            <li><strong>Code reusability:</strong> Components can be shared across projects</li>
                        </ul>
                    </section>
                    
                    <!-- Repository Pattern -->
                    <section>
                        <h2>Repository Pattern</h2>
                        
                        <p>The Repository pattern abstracts data access logic and provides a more object-oriented view of the persistence layer.</p>
                        
                        <h3>Interface Definition</h3>
                        <pre><code class="language-php">
// src/Repositories/Contracts/RepositoryInterface.php
namespace App\Repositories\Contracts;

interface RepositoryInterface {
    public function all();
    public function find($id);
    public function create(array $data);
    public function update($id, array $data);
    public function delete($id);
    public function findBy($field, $value);
}
                        </code></pre>
                        
                        <h3>Base Repository Implementation</h3>
                        <pre><code class="language-php">
// src/Repositories/BaseRepository.php
namespace App\Repositories;

use App\Repositories\Contracts\RepositoryInterface;

abstract class BaseRepository implements RepositoryInterface {
    protected $model;
    
    public function all() {
        if ($this->usesCustomTable()) {
            return $this->queryCustomTable();
        }
        
        return get_posts([
            'post_type' => $this->getPostType(),
            'posts_per_page' => -1,
            'post_status' => 'publish'
        ]);
    }
    
    public function find($id) {
        if ($this->usesCustomTable()) {
            global $wpdb;
            return $wpdb->get_row($wpdb->prepare(
                "SELECT * FROM {$this->getTableName()} WHERE id = %d",
                $id
            ));
        }
        
        return get_post($id);
    }
    
    public function create(array $data) {
        if ($this->usesCustomTable()) {
            global $wpdb;
            $wpdb->insert($this->getTableName(), $data);
            return $wpdb->insert_id;
        }
        
        return wp_insert_post(array_merge([
            'post_type' => $this->getPostType(),
            'post_status' => 'publish'
        ], $data));
    }
    
    public function update($id, array $data) {
        if ($this->usesCustomTable()) {
            global $wpdb;
            return $wpdb->update(
                $this->getTableName(),
                $data,
                ['id' => $id]
            );
        }
        
        return wp_update_post(array_merge(
            ['ID' => $id],
            $data
        ));
    }
    
    public function delete($id) {
        if ($this->usesCustomTable()) {
            global $wpdb;
            return $wpdb->delete(
                $this->getTableName(),
                ['id' => $id]
            );
        }
        
        return wp_delete_post($id, true);
    }
    
    abstract protected function getPostType();
    abstract protected function usesCustomTable();
    abstract protected function getTableName();
}
                        </code></pre>
                        
                        <h3>Concrete Repository Example</h3>
                        <pre><code class="language-php">
// src/Repositories/ProductRepository.php
namespace App\Repositories;

class ProductRepository extends BaseRepository {
    protected function getPostType() {
        return 'product';
    }
    
    protected function usesCustomTable() {
        return false;
    }
    
    protected function getTableName() {
        return null;
    }
    
    public function findByCategory($categoryId) {
        return get_posts([
            'post_type' => 'product',
            'tax_query' => [
                [
                    'taxonomy' => 'product_category',
                    'field' => 'term_id',
                    'terms' => $categoryId
                ]
            ]
        ]);
    }
    
    public function findInStock() {
        return get_posts([
            'post_type' => 'product',
            'meta_query' => [
                [
                    'key' => '_stock_status',
                    'value' => 'instock',
                    'compare' => '='
                ]
            ]
        ]);
    }
}
                        </code></pre>
                    </section>
                    
                    <!-- Factory Pattern -->
                    <section>
                        <h2>Factory Pattern</h2>
                        
                        <p>The Factory pattern provides an interface for creating objects without specifying their exact classes.</p>
                        
                        <h3>Factory Implementation</h3>
                        <pre><code class="language-php">
// src/Factories/NotificationFactory.php
namespace App\Factories;

use App\Notifications\EmailNotification;
use App\Notifications\SMSNotification;
use App\Notifications\PushNotification;
use App\Notifications\SlackNotification;

class NotificationFactory {
    public static function create($type, $recipient, $message) {
        switch ($type) {
            case 'email':
                return new EmailNotification($recipient, $message);
                
            case 'sms':
                return new SMSNotification($recipient, $message);
                
            case 'push':
                return new PushNotification($recipient, $message);
                
            case 'slack':
                return new SlackNotification($recipient, $message);
                
            default:
                throw new \InvalidArgumentException("Unknown notification type: {$type}");
        }
    }
    
    public static function createMultiple($types, $recipient, $message) {
        $notifications = [];
        
        foreach ($types as $type) {
            $notifications[] = self::create($type, $recipient, $message);
        }
        
        return $notifications;
    }
}

// Usage
$notification = NotificationFactory::create('email', 'user@example.com', 'Welcome!');
$notification->send();

// Send multiple notifications
$notifications = NotificationFactory::createMultiple(
    ['email', 'sms'],
    $user,
    'Your order has been shipped!'
);

foreach ($notifications as $notification) {
    $notification->send();
}
                        </code></pre>
                        
                        <h3>Abstract Factory Pattern</h3>
                        <pre><code class="language-php">
// src/Factories/PaymentGatewayFactory.php
namespace App\Factories;

abstract class PaymentGatewayFactory {
    abstract public function createGateway();
    abstract public function createProcessor();
    abstract public function createValidator();
    
    public function processPayment($amount, $data) {
        $gateway = $this->createGateway();
        $processor = $this->createProcessor();
        $validator = $this->createValidator();
        
        if (!$validator->validate($data)) {
            throw new \Exception('Invalid payment data');
        }
        
        return $processor->process($gateway, $amount, $data);
    }
}

class StripeFactory extends PaymentGatewayFactory {
    public function createGateway() {
        return new StripeGateway();
    }
    
    public function createProcessor() {
        return new StripeProcessor();
    }
    
    public function createValidator() {
        return new StripeValidator();
    }
}

class PayPalFactory extends PaymentGatewayFactory {
    public function createGateway() {
        return new PayPalGateway();
    }
    
    public function createProcessor() {
        return new PayPalProcessor();
    }
    
    public function createValidator() {
        return new PayPalValidator();
    }
}
                        </code></pre>
                    </section>
                    
                    <!-- Observer Pattern -->
                    <section>
                        <h2>Observer Pattern (Event-Driven Architecture)</h2>
                        
                        <p>WordPress hooks are a form of the Observer pattern. Let's extend this concept:</p>
                        
                        <pre><code class="language-php">
// src/Events/EventManager.php
namespace App\Events;

class EventManager {
    private static $instance = null;
    private $listeners = [];
    
    public static function getInstance() {
        if (self::$instance === null) {
            self::$instance = new self();
        }
        return self::$instance;
    }
    
    public function listen($event, $callback, $priority = 10) {
        if (!isset($this->listeners[$event])) {
            $this->listeners[$event] = [];
        }
        
        $this->listeners[$event][] = [
            'callback' => $callback,
            'priority' => $priority
        ];
        
        // Sort by priority
        usort($this->listeners[$event], function($a, $b) {
            return $a['priority'] - $b['priority'];
        });
    }
    
    public function dispatch($event, $data = null) {
        if (!isset($this->listeners[$event])) {
            return $data;
        }
        
        foreach ($this->listeners[$event] as $listener) {
            $data = call_user_func($listener['callback'], $data);
        }
        
        // Also trigger WordPress action for compatibility
        do_action('app_event_' . $event, $data);
        
        return $data;
    }
}

// Event classes
class OrderPlacedEvent {
    public $orderId;
    public $userId;
    public $total;
    public $items;
    
    public function __construct($orderId, $userId, $total, $items) {
        $this->orderId = $orderId;
        $this->userId = $userId;
        $this->total = $total;
        $this->items = $items;
    }
}

// Listeners
class EmailListener {
    public function handleOrderPlaced(OrderPlacedEvent $event) {
        // Send order confirmation email
        wp_mail(
            get_userdata($event->userId)->user_email,
            'Order Confirmation',
            'Your order #' . $event->orderId . ' has been placed.'
        );
    }
}

class InventoryListener {
    public function handleOrderPlaced(OrderPlacedEvent $event) {
        foreach ($event->items as $item) {
            // Update inventory
            $this->decrementStock($item['product_id'], $item['quantity']);
        }
    }
}

// Setup
$eventManager = EventManager::getInstance();
$emailListener = new EmailListener();
$inventoryListener = new InventoryListener();

$eventManager->listen('order_placed', [$emailListener, 'handleOrderPlaced']);
$eventManager->listen('order_placed', [$inventoryListener, 'handleOrderPlaced']);

// Dispatch event
$event = new OrderPlacedEvent(123, 1, 99.99, $items);
$eventManager->dispatch('order_placed', $event);
                        </code></pre>
                    </section>
                    
                    <!-- Strategy Pattern -->
                    <section>
                        <h2>Strategy Pattern</h2>
                        
                        <p>The Strategy pattern allows you to define a family of algorithms and make them interchangeable:</p>
                        
                        <pre><code class="language-php">
// src/Strategies/CacheStrategy.php
namespace App\Strategies;

interface CacheStrategy {
    public function get($key);
    public function set($key, $value, $expiration = 3600);
    public function delete($key);
    public function flush();
}

class TransientCacheStrategy implements CacheStrategy {
    public function get($key) {
        return get_transient($key);
    }
    
    public function set($key, $value, $expiration = 3600) {
        return set_transient($key, $value, $expiration);
    }
    
    public function delete($key) {
        return delete_transient($key);
    }
    
    public function flush() {
        global $wpdb;
        $wpdb->query("DELETE FROM {$wpdb->options} WHERE option_name LIKE '_transient_%'");
    }
}

class RedisCacheStrategy implements CacheStrategy {
    private $redis;
    
    public function __construct() {
        $this->redis = new \Redis();
        $this->redis->connect('127.0.0.1', 6379);
    }
    
    public function get($key) {
        return $this->redis->get($key);
    }
    
    public function set($key, $value, $expiration = 3600) {
        return $this->redis->setex($key, $expiration, serialize($value));
    }
    
    public function delete($key) {
        return $this->redis->del($key);
    }
    
    public function flush() {
        return $this->redis->flushAll();
    }
}

class ObjectCacheStrategy implements CacheStrategy {
    public function get($key) {
        return wp_cache_get($key, 'app_cache');
    }
    
    public function set($key, $value, $expiration = 3600) {
        return wp_cache_set($key, $value, 'app_cache', $expiration);
    }
    
    public function delete($key) {
        return wp_cache_delete($key, 'app_cache');
    }
    
    public function flush() {
        return wp_cache_flush();
    }
}

// Cache Manager using Strategy
class CacheManager {
    private $strategy;
    
    public function __construct(CacheStrategy $strategy) {
        $this->strategy = $strategy;
    }
    
    public function setStrategy(CacheStrategy $strategy) {
        $this->strategy = $strategy;
    }
    
    public function remember($key, $callback, $expiration = 3600) {
        $value = $this->strategy->get($key);
        
        if ($value === false) {
            $value = $callback();
            $this->strategy->set($key, $value, $expiration);
        }
        
        return $value;
    }
    
    public function forget($key) {
        return $this->strategy->delete($key);
    }
}

// Usage
$cache = new CacheManager(new TransientCacheStrategy());

// Switch to Redis in production
if (defined('WP_REDIS_HOST')) {
    $cache->setStrategy(new RedisCacheStrategy());
}

$products = $cache->remember('featured_products', function() {
    return get_posts([
        'post_type' => 'product',
        'meta_key' => 'featured',
        'meta_value' => 'yes'
    ]);
}, 3600);
                        </code></pre>
                    </section>
                    
                    <!-- Decorator Pattern -->
                    <section>
                        <h2>Decorator Pattern</h2>
                        
                        <p>The Decorator pattern allows you to add new functionality to objects dynamically:</p>
                        
                        <pre><code class="language-php">
// src/Decorators/QueryDecorator.php
namespace App\Decorators;

interface QueryInterface {
    public function execute();
}

class BaseQuery implements QueryInterface {
    protected $args = [];
    
    public function __construct($postType) {
        $this->args = [
            'post_type' => $postType,
            'post_status' => 'publish'
        ];
    }
    
    public function execute() {
        return get_posts($this->args);
    }
}

abstract class QueryDecorator implements QueryInterface {
    protected $query;
    
    public function __construct(QueryInterface $query) {
        $this->query = $query;
    }
    
    abstract public function execute();
}

class PaginationDecorator extends QueryDecorator {
    private $page;
    private $perPage;
    
    public function __construct(QueryInterface $query, $page = 1, $perPage = 10) {
        parent::__construct($query);
        $this->page = $page;
        $this->perPage = $perPage;
    }
    
    public function execute() {
        $this->query->args['posts_per_page'] = $this->perPage;
        $this->query->args['paged'] = $this->page;
        return $this->query->execute();
    }
}

class MetaQueryDecorator extends QueryDecorator {
    private $metaKey;
    private $metaValue;
    private $compare;
    
    public function __construct(QueryInterface $query, $key, $value, $compare = '=') {
        parent::__construct($query);
        $this->metaKey = $key;
        $this->metaValue = $value;
        $this->compare = $compare;
    }
    
    public function execute() {
        $this->query->args['meta_query'] = [
            [
                'key' => $this->metaKey,
                'value' => $this->metaValue,
                'compare' => $this->compare
            ]
        ];
        return $this->query->execute();
    }
}

class OrderByDecorator extends QueryDecorator {
    private $orderBy;
    private $order;
    
    public function __construct(QueryInterface $query, $orderBy = 'date', $order = 'DESC') {
        parent::__construct($query);
        $this->orderBy = $orderBy;
        $this->order = $order;
    }
    
    public function execute() {
        $this->query->args['orderby'] = $this->orderBy;
        $this->query->args['order'] = $this->order;
        return $this->query->execute();
    }
}

// Usage
$query = new BaseQuery('product');
$query = new PaginationDecorator($query, 2, 20);
$query = new MetaQueryDecorator($query, 'price', 100, '>');
$query = new OrderByDecorator($query, 'meta_value_num', 'ASC');

$products = $query->execute();
                        </code></pre>
                    </section>
                    
                    <!-- Facade Pattern -->
                    <section>
                        <h2>Facade Pattern</h2>
                        
                        <p>The Facade pattern provides a simplified interface to complex subsystems:</p>
                        
                        <pre><code class="language-php">
// src/Facades/EcommerceFacade.php
namespace App\Facades;

use App\Services\ProductService;
use App\Services\CartService;
use App\Services\OrderService;
use App\Services\PaymentService;
use App\Services\ShippingService;
use App\Services\EmailService;

class EcommerceFacade {
    private $productService;
    private $cartService;
    private $orderService;
    private $paymentService;
    private $shippingService;
    private $emailService;
    
    public function __construct() {
        $this->productService = new ProductService();
        $this->cartService = new CartService();
        $this->orderService = new OrderService();
        $this->paymentService = new PaymentService();
        $this->shippingService = new ShippingService();
        $this->emailService = new EmailService();
    }
    
    public function addToCart($productId, $quantity = 1) {
        // Check product availability
        if (!$this->productService->isAvailable($productId, $quantity)) {
            throw new \Exception('Product not available');
        }
        
        // Add to cart
        $this->cartService->add($productId, $quantity);
        
        // Update cart totals
        $this->cartService->recalculate();
        
        return $this->cartService->getContents();
    }
    
    public function checkout($paymentData, $shippingData) {
        try {
            // Validate cart
            if ($this->cartService->isEmpty()) {
                throw new \Exception('Cart is empty');
            }
            
            // Calculate shipping
            $shippingCost = $this->shippingService->calculate(
                $this->cartService->getContents(),
                $shippingData
            );
            
            // Create order
            $order = $this->orderService->create([
                'items' => $this->cartService->getContents(),
                'shipping' => $shippingCost,
                'total' => $this->cartService->getTotal() + $shippingCost
            ]);
            
            // Process payment
            $payment = $this->paymentService->process(
                $order->getTotal(),
                $paymentData
            );
            
            if ($payment->isSuccessful()) {
                // Update order status
                $order->markAsPaid();
                
                // Send confirmation email
                $this->emailService->sendOrderConfirmation($order);
                
                // Clear cart
                $this->cartService->clear();
                
                return $order;
            } else {
                throw new \Exception('Payment failed: ' . $payment->getError());
            }
            
        } catch (\Exception $e) {
            // Log error
            error_log('Checkout failed: ' . $e->getMessage());
            throw $e;
        }
    }
    
    public function getRecommendedProducts($userId = null) {
        if ($userId) {
            // Get personalized recommendations
            $history = $this->orderService->getUserHistory($userId);
            return $this->productService->getRecommendations($history);
        }
        
        // Get popular products
        return $this->productService->getPopular();
    }
}

// Usage - Simple interface hiding complex operations
$ecommerce = new EcommerceFacade();

// Add to cart
$ecommerce->addToCart(123, 2);

// Checkout
$order = $ecommerce->checkout(
    ['card_number' => '4242...', 'cvv' => '123'],
    ['address' => '123 Main St', 'city' => 'Springfield']
);
                        </code></pre>
                    </section>
                    
                    <!-- Chain of Responsibility -->
                    <section>
                        <h2>Chain of Responsibility Pattern</h2>
                        
                        <p>This pattern creates a chain of handler objects for processing requests:</p>
                        
                        <pre><code class="language-php">
// src/Middleware/Middleware.php
namespace App\Middleware;

abstract class Middleware {
    protected $next;
    
    public function setNext(Middleware $next) {
        $this->next = $next;
        return $next;
    }
    
    public function handle($request) {
        if ($this->next) {
            return $this->next->handle($request);
        }
        
        return $request;
    }
}

class AuthenticationMiddleware extends Middleware {
    public function handle($request) {
        if (!is_user_logged_in()) {
            wp_redirect(wp_login_url());
            exit;
        }
        
        return parent::handle($request);
    }
}

class AuthorizationMiddleware extends Middleware {
    private $capability;
    
    public function __construct($capability) {
        $this->capability = $capability;
    }
    
    public function handle($request) {
        if (!current_user_can($this->capability)) {
            wp_die('Unauthorized', 403);
        }
        
        return parent::handle($request);
    }
}

class ValidationMiddleware extends Middleware {
    private $rules;
    
    public function __construct($rules) {
        $this->rules = $rules;
    }
    
    public function handle($request) {
        foreach ($this->rules as $field => $rule) {
            if (!$this->validate($request[$field], $rule)) {
                wp_die("Invalid {$field}", 400);
            }
        }
        
        return parent::handle($request);
    }
    
    private function validate($value, $rule) {
        // Validation logic
        return true;
    }
}

class RateLimitMiddleware extends Middleware {
    private $maxAttempts;
    private $window;
    
    public function __construct($maxAttempts = 60, $window = 60) {
        $this->maxAttempts = $maxAttempts;
        $this->window = $window;
    }
    
    public function handle($request) {
        $key = 'rate_limit_' . get_current_user_id();
        $attempts = get_transient($key) ?: 0;
        
        if ($attempts >= $this->maxAttempts) {
            wp_die('Too many requests', 429);
        }
        
        set_transient($key, $attempts + 1, $this->window);
        
        return parent::handle($request);
    }
}

// Usage
$middleware = new AuthenticationMiddleware();
$middleware->setNext(new AuthorizationMiddleware('manage_options'))
          ->setNext(new ValidationMiddleware(['email' => 'email', 'name' => 'required']))
          ->setNext(new RateLimitMiddleware(10, 60));

$request = $_POST;
$processedRequest = $middleware->handle($request);
                        </code></pre>
                    </section>
                    
                    <!-- SOLID Principles -->
                    <section>
                        <h2>SOLID Principles in WordPress</h2>
                        
                        <div class="info-box">
                            <h3>Single Responsibility Principle (SRP)</h3>
                            <p>A class should have only one reason to change.</p>
                            
                            <pre><code class="language-php">
// Bad - Multiple responsibilities
class User {
    public function register($data) { }
    public function login($username, $password) { }
    public function sendEmail($message) { }
    public function generateReport() { }
}

// Good - Single responsibility
class UserRegistration {
    public function register($data) { }
}

class UserAuthentication {
    public function login($username, $password) { }
}

class UserNotification {
    public function sendEmail($message) { }
}

class UserReporting {
    public function generateReport() { }
}
                            </code></pre>
                        </div>
                        
                        <div class="info-box">
                            <h3>Open/Closed Principle (OCP)</h3>
                            <p>Classes should be open for extension but closed for modification.</p>
                            
                            <pre><code class="language-php">
// Using WordPress hooks follows OCP
class ShippingCalculator {
    public function calculate($items, $destination) {
        $cost = $this->getBaseCost($items);
        
        // Open for extension via filter
        $cost = apply_filters('shipping_cost_calculated', $cost, $items, $destination);
        
        return $cost;
    }
}

// Extend without modifying original class
add_filter('shipping_cost_calculated', function($cost, $items, $destination) {
    // Add express shipping surcharge
    if (get_option('express_shipping')) {
        $cost *= 1.5;
    }
    return $cost;
}, 10, 3);
                            </code></pre>
                        </div>
                        
                        <div class="info-box">
                            <h3>Dependency Inversion Principle (DIP)</h3>
                            <p>Depend on abstractions, not concretions.</p>
                            
                            <pre><code class="language-php">
// Define abstraction
interface StorageInterface {
    public function save($key, $data);
    public function load($key);
}

// Concrete implementations
class DatabaseStorage implements StorageInterface {
    public function save($key, $data) {
        update_option($key, $data);
    }
    
    public function load($key) {
        return get_option($key);
    }
}

class FileStorage implements StorageInterface {
    public function save($key, $data) {
        file_put_contents($key . '.json', json_encode($data));
    }
    
    public function load($key) {
        return json_decode(file_get_contents($key . '.json'), true);
    }
}

// High-level module depends on abstraction
class DataManager {
    private $storage;
    
    public function __construct(StorageInterface $storage) {
        $this->storage = $storage;
    }
    
    public function saveData($key, $data) {
        return $this->storage->save($key, $data);
    }
}
                            </code></pre>
                        </div>
                    </section>
                    
                    <!-- Summary -->
                    <section>
                        <h2>Summary</h2>
                        
                        <div class="summary-box">
                            <h3>Key Takeaways</h3>
                            <ul>
                                <li>Architecture patterns provide proven solutions to common problems</li>
                                <li>Repository pattern abstracts data access logic</li>
                                <li>Factory pattern simplifies object creation</li>
                                <li>Observer pattern enables event-driven architecture</li>
                                <li>Strategy pattern makes algorithms interchangeable</li>
                                <li>Facade pattern simplifies complex subsystems</li>
                                <li>SOLID principles improve code quality and maintainability</li>
                            </ul>
                        </div>
                        
                        <div class="best-practices">
                            <h3>When to Use These Patterns</h3>
                            <ul>
                                <li><strong>Repository:</strong> When you need to abstract data access</li>
                                <li><strong>Factory:</strong> When object creation is complex</li>
                                <li><strong>Observer:</strong> For event-driven features</li>
                                <li><strong>Strategy:</strong> When you have multiple algorithms</li>
                                <li><strong>Decorator:</strong> To add features dynamically</li>
                                <li><strong>Facade:</strong> To simplify complex APIs</li>
                            </ul>
                        </div>
                    </section>
                    
                    <!-- Additional Resources -->
                    <section class="resources">
                        <h2>Additional Resources</h2>
                        <ul>
                            <li><a href="https://refactoring.guru/design-patterns" target="_blank">Design Patterns Catalog</a></li>
                            <li><a href="https://www.php-fig.org/psr/" target="_blank">PHP Standards Recommendations (PSR)</a></li>
                            <li><a href="https://carlalexander.ca/wordpress-design-patterns/" target="_blank">WordPress Design Patterns</a></li>
                            <li><a href="https://martinfowler.com/eaaCatalog/" target="_blank">Enterprise Application Architecture Patterns</a></li>
                        </ul>
                    </section>
                </div>
                
                <!-- Lesson Navigation -->
                <div class="lesson-navigation">
                    <a href="/07module/wordpress_as_application_framework.html" class="lesson-nav-button prev">
                        <svg width="20" height="20" viewBox="0 0 20 20" fill="currentColor">
                            <path d="M12.707 5.293a1 1 0 010 1.414L9.414 10l3.293 3.293a1 1 0 01-1.414 1.414l-4-4a1 1 0 010-1.414l4-4a1 1 0 011.414 0z"/>
                        </svg>
                        <span>
                            <small>Previous</small><br>
                            WordPress as Framework
                        </span>
                    </a>
                    
                    <button class="complete-lesson-btn">
                        Mark as Complete
                    </button>
                    
                    <a href="/07module/mvc_in_wordpress.html" class="lesson-nav-button next">
                        <span>
                            <small>Next</small><br>
                            MVC in WordPress
                        </span>
                        <svg width="20" height="20" viewBox="0 0 20 20" fill="currentColor">
                            <path d="M7.293 14.707a1 1 0 010-1.414L10.586 10 7.293 6.707a1 1 0 011.414-1.414l4 4a1 1 0 010 1.414l-4 4a1 1 0 01-1.414 0z"/>
                        </svg>
                    </a>
                </div>
            </div>
        </main>
        
        <!-- Footer -->
        <footer class="site-footer" role="contentinfo">
            <div class="footer-container">
                <div class="footer-content">
                    <div class="footer-section footer-about">
                        <h3>PHP WordPress Development</h3>
                        <p>Complete Web Development Course - From HTML to WordPress</p>
                    </div>
                    
                    <div class="footer-section">
                        <h4>Quick Links</h4>
                        <ul class="footer-links">
                            <li><a href="/">Home</a></li>
                            <li><a href="/module7.html">Module 7</a></li>
                            <li><a href="/resources.html">Resources</a></li>
                            <li><a href="/about.html">About</a></li>
                        </ul>
                    </div>
                </div>
                
                <div class="footer-bottom">
                    <p>&copy; 2025 PHP WordPress Development Course. All rights reserved.</p>
                </div>
            </div>
        </footer>
    </div>
    
    <!-- JavaScript -->
    <script src="/assets/js/prism.js"></script>
    <script src="/assets/js/main.js"></script>
    <script src="/assets/js/lesson.js"></script>
</body>
</html>