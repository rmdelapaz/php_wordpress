<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Creating a Contact Form with Validation</title>
    <link rel="stylesheet" href="/styles/main.css">
    <link rel="icon" href="/favicon.png">
    <script type="module">
      import mermaid from 'https://cdn.jsdelivr.net/npm/mermaid@10/dist/mermaid.esm.min.mjs';
      mermaid.initialize({ startOnLoad: true });
    </script>
</head>
<body>
    <header>
        <h1>Creating a Contact Form with Validation</h1>
        <p><a href="index.html">‚Üê Back to Syllabus</a></p>
    </header>
    
    <main>
        <section class="introduction">
            <h2>Introduction to Contact Form Validation</h2>
            <p>Creating a contact form with proper validation is a fundamental skill for web developers. It combines HTML structure, CSS styling, JavaScript client-side validation, and PHP server-side processing. This comprehensive guide will walk you through building a secure, user-friendly contact form using George Polya's four-step problem-solving approach.</p>
            
            <div class="mermaid_diagram">
                <h3>Contact Form System Overview</h3>
                <div class="mermaid">
flowchart TD
    A[User] -->|Fills out| B[Contact Form]
    B -->|Client-side Validation| C{Valid?}
    C -->|No| D[Display Errors]
    D --> B
    C -->|Yes| E[Form Submission]
    E -->|Server-side Validation| F{Valid?}
    F -->|No| G[Return Errors]
    G --> B
    F -->|Yes| H[Process Data]
    H --> I[Send Email]
    H --> J[Store in Database]
    I --> K[Success Message]
    J --> K
    K --> A
                </div>
            </div>
        </section>

        <section class="problem_understanding">
            <h2>Understanding the Problem</h2>
            <p>Following George Polya's problem-solving method, our first step is to clearly understand what we're trying to accomplish.</p>
            
            <div class="requirements">
                <h3>What Are We Building?</h3>
                <p>We need to create a functional contact form with proper validation that:</p>
                <ul>
                    <li>Collects user information (name, email, subject, message)</li>
                    <li>Validates input on both client-side and server-side</li>
                    <li>Provides clear feedback for validation errors</li>
                    <li>Processes the form data securely</li>
                    <li>Sends an email notification</li>
                    <li>Displays appropriate success/error messages</li>
                    <li>Includes protection against common security vulnerabilities</li>
                </ul>
                
                <h3>Key Components Needed</h3>
                <ol>
                    <li><strong>HTML Form</strong>: The structure and input fields</li>
                    <li><strong>CSS Styling</strong>: For visual presentation and error states</li>
                    <li><strong>Client-side JavaScript</strong>: For immediate validation feedback</li>
                    <li><strong>Server-side PHP</strong>: For secure processing and validation</li>
                    <li><strong>Email Functionality</strong>: To send form submissions</li>
                </ol>
            </div>
            
            <div class="form_anatomy">
                <h3>Anatomy of Our Contact Form</h3>
                <svg viewBox="0 0 800 500" xmlns="http://www.w3.org/2000/svg">
                    <!-- Form Container -->
                    <rect x="150" y="50" width="500" height="400" rx="10" fill="#f5f5f5" stroke="#333" stroke-width="2"/>
                    <text x="400" y="30" text-anchor="middle" font-family="Arial" font-size="18" font-weight="bold">Contact Form</text>
                    
                    <!-- Form Header -->
                    <rect x="175" y="75" width="450" height="40" rx="5" fill="#e1f5fe" stroke="#29b6f6" stroke-width="1"/>
                    <text x="400" y="100" text-anchor="middle" font-family="Arial" font-size="16">Contact Us</text>
                    
                    <!-- Name Field -->
                    <rect x="175" y="130" width="450" height="50" rx="0" fill="#ffffff" stroke="#cccccc" stroke-width="1"/>
                    <text x="190" y="150" font-family="Arial" font-size="14" fill="#333333">Name:</text>
                    <rect x="190" y="160" width="420" height="30" rx="3" fill="#f9f9f9" stroke="#cccccc" stroke-width="1"/>
                    
                    <!-- Email Field -->
                    <rect x="175" y="190" width="450" height="50" rx="0" fill="#ffffff" stroke="#cccccc" stroke-width="1"/>
                    <text x="190" y="210" font-family="Arial" font-size="14" fill="#333333">Email:</text>
                    <rect x="190" y="220" width="420" height="30" rx="3" fill="#f9f9f9" stroke="#cccccc" stroke-width="1"/>
                    <rect x="620" y="220" width="20" height="30" rx="0" fill="#ffebee" stroke="#f44336" stroke-width="1"/>
                    <text x="630" y="240" text-anchor="middle" font-family="Arial" font-size="14" fill="#f44336">!</text>
                    <rect x="190" y="255" width="280" height="20" rx="2" fill="#ffebee" stroke="#ffebee" stroke-width="0"/>
                    <text x="200" y="270" font-family="Arial" font-size="12" fill="#f44336">Please enter a valid email address</text>
                    
                    <!-- Subject Field -->
                    <rect x="175" y="280" width="450" height="50" rx="0" fill="#ffffff" stroke="#cccccc" stroke-width="1"/>
                    <text x="190" y="300" font-family="Arial" font-size="14" fill="#333333">Subject:</text>
                    <rect x="190" y="310" width="420" height="30" rx="3" fill="#f9f9f9" stroke="#cccccc" stroke-width="1"/>
                    
                    <!-- Message Field -->
                    <rect x="175" y="340" width="450" height="70" rx="0" fill="#ffffff" stroke="#cccccc" stroke-width="1"/>
                    <text x="190" y="360" font-family="Arial" font-size="14" fill="#333333">Message:</text>
                    <rect x="190" y="370" width="420" height="50" rx="3" fill="#f9f9f9" stroke="#cccccc" stroke-width="1"/>
                    
                    <!-- Submit Button -->
                    <rect x="520" y="430" width="100" height="35" rx="5" fill="#4caf50" stroke="#388e3c" stroke-width="1"/>
                    <text x="570" y="453" text-anchor="middle" font-family="Arial" font-size="14" fill="#ffffff">Submit</text>
                    
                    <!-- Labels -->
                    <text x="80" y="185" font-family="Arial" font-size="12" fill="#333333" transform="rotate(-90 80,185)">Form Fields</text>
                    <text x="660" y="230" font-family="Arial" font-size="12" fill="#333333">Error Indicator</text>
                    <text x="320" y="290" font-family="Arial" font-size="12" fill="#f44336">Error Message</text>
                    <text x="480" y="450" font-family="Arial" font-size="12" fill="#333333">Submit Button</text>
                </svg>
            </div>
            
            <div class="validation_concepts">
                <h3>Important Validation Concepts</h3>
                <table>
                    <thead>
                        <tr>
                            <th>Concept</th>
                            <th>Why It's Important</th>
                            <th>Implementation</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td>Client-side Validation</td>
                            <td>Provides immediate feedback to users without server requests</td>
                            <td>JavaScript (form events, regex patterns)</td>
                        </tr>
                        <tr>
                            <td>Server-side Validation</td>
                            <td>Ensures security by validating on the server (can't be bypassed)</td>
                            <td>PHP validation functions and sanitization</td>
                        </tr>
                        <tr>
                            <td>Input Sanitization</td>
                            <td>Prevents security vulnerabilities (XSS, injection)</td>
                            <td>PHP functions like htmlspecialchars(), filter_var()</td>
                        </tr>
                        <tr>
                            <td>Error Handling</td>
                            <td>Improves user experience by clearly showing what's wrong</td>
                            <td>Visual indicators, descriptive messages</td>
                        </tr>
                        <tr>
                            <td>Form Persistence</td>
                            <td>Maintains user input after validation fails</td>
                            <td>Server-side value preservation</td>
                        </tr>
                    </tbody>
                </table>
            </div>
            
            <div class="validation_rules">
                <h3>Validation Rules for Each Field</h3>
                <ul>
                    <li><strong>Name</strong>: Required, alphabetic characters and spaces only, 2-50 characters</li>
                    <li><strong>Email</strong>: Required, valid email format (contains @ and domain)</li>
                    <li><strong>Subject</strong>: Required, alphanumeric with spaces, 5-100 characters</li>
                    <li><strong>Message</strong>: Required, minimum 10 characters, maximum 1000 characters</li>
                </ul>
            </div>
        </section>

        <section class="devising_plan">
            <h2>Devising a Plan</h2>
            <p>Now that we understand the problem, let's create a step-by-step plan to implement our contact form with validation.</p>
            
            <div class="implementation_plan">
                <h3>Implementation Plan</h3>
                <ol>
                    <li>Create the basic HTML form structure with all required fields</li>
                    <li>Add CSS styling for the form and validation states</li>
                    <li>Implement JavaScript for client-side validation</li>
                    <li>Create PHP script for server-side processing and validation</li>
                    <li>Implement email functionality</li>
                    <li>Add security measures (CSRF protection, honeypot)</li>
                    <li>Test the form with various scenarios</li>
                </ol>
                
                <h3>Project Structure</h3>
                <div class="mermaid">
flowchart TD
    A[Project Root] --> B[index.html]
    A --> C[css/]
    C --> D[styles.css]
    A --> E[js/]
    E --> F[validation.js]
    A --> G[php/]
    G --> H[process_form.php]
    G --> I[functions.php]
                </div>
                
                <h3>Simplified Whiteboard Plan</h3>
                <ol>
                    <li>HTML Form Structure
                        <ul>
                            <li>Create form tag with POST method and proper action</li>
                            <li>Add input fields with appropriate attributes</li>
                            <li>Include error message containers</li>
                            <li>Add submit button</li>
                        </ul>
                    </li>
                    <li>CSS Styling
                        <ul>
                            <li>Style form container and layout</li>
                            <li>Style input fields (normal, focus, error states)</li>
                            <li>Style error messages</li>
                            <li>Style submit button</li>
                        </ul>
                    </li>
                    <li>JavaScript Validation
                        <ul>
                            <li>Add event listeners (submit, input events)</li>
                            <li>Create validation functions for each field</li>
                            <li>Implement visual feedback for validation</li>
                            <li>Prevent form submission if validation fails</li>
                        </ul>
                    </li>
                    <li>PHP Processing
                        <ul>
                            <li>Create validation functions for server-side</li>
                            <li>Sanitize and validate each field</li>
                            <li>Store validation errors</li>
                            <li>Implement email sending functionality</li>
                            <li>Handle form submission success/failure</li>
                        </ul>
                    </li>
                    <li>Security Implementation
                        <ul>
                            <li>Add CSRF token generation and validation</li>
                            <li>Implement honeypot field for bot detection</li>
                            <li>Sanitize all outputs</li>
                        </ul>
                    </li>
                </ol>
            </div>
        </section>

        <section class="implementation">
            <h2>Carrying Out the Plan</h2>
            <p>Now let's implement our solution step by step according to our plan.</p>
            
            <div class="html_implementation">
                <h3>Step 1: HTML Form Structure</h3>
                <p>Create a file named <code>index.html</code> in your project root directory with the following content:</p>
                
                <pre><code>&lt;!DOCTYPE html&gt;
&lt;html lang="en"&gt;
&lt;head&gt;
    &lt;meta charset="UTF-8"&gt;
    &lt;meta name="viewport" content="width=device-width, initial-scale=1.0"&gt;
    &lt;title&gt;Contact Us&lt;/title&gt;
    &lt;link rel="stylesheet" href="css/styles.css"&gt;
&lt;/head&gt;
&lt;body&gt;
    &lt;div class="container"&gt;
        &lt;h1&gt;Contact Us&lt;/h1&gt;
        
        &lt;!-- Success message (shown after successful submission) --&gt;
        &lt;?php if (isset($_GET['success']) && $_GET['success'] == 1): ?&gt;
            &lt;div class="success-message"&gt;
                Thank you for your message! We'll get back to you soon.
            &lt;/div&gt;
        &lt;?php endif; ?&gt;
        
        &lt;!-- Error message (shown if server-side validation fails) --&gt;
        &lt;?php if (isset($_GET['error']) && $_GET['error'] == 1): ?&gt;
            &lt;div class="error-message"&gt;
                There was a problem with your submission. Please check the form and try again.
            &lt;/div&gt;
        &lt;?php endif; ?&gt;
        
        &lt;form id="contactForm" action="php/process_form.php" method="post" novalidate&gt;
            &lt;!-- CSRF Protection Token --&gt;
            &lt;input type="hidden" name="csrf_token" value="&lt;?php echo isset($_SESSION['csrf_token']) ? $_SESSION['csrf_token'] : ''; ?&gt;"&gt;
            
            &lt;!-- Honeypot field (spam protection) --&gt;
            &lt;div class="honeypot-field"&gt;
                &lt;label for="website"&gt;Website (leave this empty):&lt;/label&gt;
                &lt;input type="text" name="website" id="website" autocomplete="off"&gt;
            &lt;/div&gt;
            
            &lt;div class="form-group"&gt;
                &lt;label for="name"&gt;Your Name*&lt;/label&gt;
                &lt;input 
                    type="text" 
                    id="name" 
                    name="name" 
                    value="&lt;?php echo isset($_SESSION['form_data']['name']) ? htmlspecialchars($_SESSION['form_data']['name']) : ''; ?&gt;"
                    required
                &gt;
                &lt;span class="error" id="name-error"&gt;&lt;?php echo isset($_SESSION['form_errors']['name']) ? $_SESSION['form_errors']['name'] : ''; ?&gt;&lt;/span&gt;
            &lt;/div&gt;
            
            &lt;div class="form-group"&gt;
                &lt;label for="email"&gt;Your Email*&lt;/label&gt;
                &lt;input 
                    type="email" 
                    id="email" 
                    name="email" 
                    value="&lt;?php echo isset($_SESSION['form_data']['email']) ? htmlspecialchars($_SESSION['form_data']['email']) : ''; ?&gt;"
                    required
                &gt;
                &lt;span class="error" id="email-error"&gt;&lt;?php echo isset($_SESSION['form_errors']['email']) ? $_SESSION['form_errors']['email'] : ''; ?&gt;&lt;/span&gt;
            &lt;/div&gt;
            
            &lt;div class="form-group"&gt;
                &lt;label for="subject"&gt;Subject*&lt;/label&gt;
                &lt;input 
                    type="text" 
                    id="subject" 
                    name="subject" 
                    value="&lt;?php echo isset($_SESSION['form_data']['subject']) ? htmlspecialchars($_SESSION['form_data']['subject']) : ''; ?&gt;"
                    required
                &gt;
                &lt;span class="error" id="subject-error"&gt;&lt;?php echo isset($_SESSION['form_errors']['subject']) ? $_SESSION['form_errors']['subject'] : ''; ?&gt;&lt;/span&gt;
            &lt;/div&gt;
            
            &lt;div class="form-group"&gt;
                &lt;label for="message"&gt;Your Message*&lt;/label&gt;
                &lt;textarea 
                    id="message" 
                    name="message" 
                    rows="5" 
                    required
                &gt;&lt;?php echo isset($_SESSION['form_data']['message']) ? htmlspecialchars($_SESSION['form_data']['message']) : ''; ?&gt;&lt;/textarea&gt;
                &lt;span class="error" id="message-error"&gt;&lt;?php echo isset($_SESSION['form_errors']['message']) ? $_SESSION['form_errors']['message'] : ''; ?&gt;&lt;/span&gt;
            &lt;/div&gt;
            
            &lt;div class="form-group"&gt;
                &lt;button type="submit" class="submit-btn"&gt;Send Message&lt;/button&gt;
            &lt;/div&gt;
            
            &lt;div class="form-note"&gt;
                Fields marked with * are required
            &lt;/div&gt;
        &lt;/form&gt;
    &lt;/div&gt;
    
    &lt;script src="js/validation.js"&gt;&lt;/script&gt;
&lt;/body&gt;
&lt;/html&gt;</code></pre>

                <h3>Key HTML Components Explained</h3>
                <ul>
                    <li><strong>PHP Session Integration:</strong> The PHP snippets will display messages and repopulate form fields after submission</li>
                    <li><strong>novalidate Attribute:</strong> Disables browser's default validation so we can handle it with JavaScript</li>
                    <li><strong>CSRF Token:</strong> Hidden field for security against cross-site request forgery</li>
                    <li><strong>Honeypot Field:</strong> Hidden field to catch spam bots (legitimate users don't fill it)</li>
                    <li><strong>Error Elements:</strong> Dedicated spans to display validation error messages</li>
                    <li><strong>PHP Value Echo:</strong> Preserves user input after failed validation</li>
                </ul>
            </div>
            
            <div class="css_implementation">
                <h3>Step 2: CSS Styling</h3>
                <p>Create a folder named <code>css</code> in your project root, then create a file named <code>styles.css</code> with the following content:</p>
                
                <pre><code>/* Reset and base styles */
* {
    margin: 0;
    padding: 0;
    box-sizing: border-box;
}

body {
    font-family: Arial, sans-serif;
    line-height: 1.6;
    color: #333;
    background-color: #f4f4f4;
    padding: 20px;
}

.container {
    max-width: 600px;
    margin: 0 auto;
    background: #fff;
    padding: 30px;
    border-radius: 8px;
    box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
}

h1 {
    text-align: center;
    margin-bottom: 30px;
    color: #333;
}

/* Form styles */
.form-group {
    margin-bottom: 20px;
}

label {
    display: block;
    margin-bottom: 5px;
    font-weight: bold;
}

input,
textarea {
    width: 100%;
    padding: 10px;
    border: 1px solid #ddd;
    border-radius: 4px;
    font-size: 16px;
    transition: border-color 0.3s;
}

input:focus,
textarea:focus {
    border-color: #4caf50;
    outline: none;
}

/* Error states */
input.error,
textarea.error {
    border-color: #f44336;
    background-color: #ffebee;
}

.error {
    color: #f44336;
    font-size: 14px;
    margin-top: 5px;
    display: block;
}

/* Success message */
.success-message {
    background-color: #e8f5e9;
    color: #2e7d32;
    padding: 15px;
    border-radius: 4px;
    margin-bottom: 20px;
    text-align: center;
}

/* Error message */
.error-message {
    background-color: #ffebee;
    color: #c62828;
    padding: 15px;
    border-radius: 4px;
    margin-bottom: 20px;
    text-align: center;
}

/* Submit button */
.submit-btn {
    background-color: #4caf50;
    color: white;
    border: none;
    padding: 12px 24px;
    font-size: 16px;
    border-radius: 4px;
    cursor: pointer;
    transition: background-color 0.3s;
}

.submit-btn:hover {
    background-color: #388e3c;
}

/* Form note */
.form-note {
    font-size: 14px;
    color: #666;
    text-align: center;
    margin-top: 20px;
}

/* Hide honeypot field */
.honeypot-field {
    display: none;
}</code></pre>

                <h3>CSS Styling Explained</h3>
                <ul>
                    <li><strong>Container Styling:</strong> Creates a clean card-like appearance for the form</li>
                    <li><strong>Input States:</strong> Different styles for default, focus, and error states</li>
                    <li><strong>Error Messages:</strong> Clear red styling to draw attention to issues</li>
                    <li><strong>Success Message:</strong> Green confirmation message for successful submissions</li>
                    <li><strong>Honeypot Field:</strong> Hidden with CSS but still accessible to bots</li>
                    <li><strong>Responsive Design:</strong> Works well on various screen sizes</li>
                </ul>
            </div>
            
            <div class="js_implementation">
                <h3>Step 3: JavaScript Validation</h3>
                <p>Create a folder named <code>js</code> in your project root, then create a file named <code>validation.js</code> with the following content:</p>
                
                <pre><code>document.addEventListener('DOMContentLoaded', function() {
    // Get form and form elements
    const form = document.getElementById('contactForm');
    const nameInput = document.getElementById('name');
    const emailInput = document.getElementById('email');
    const subjectInput = document.getElementById('subject');
    const messageInput = document.getElementById('message');
    
    // Get error elements
    const nameError = document.getElementById('name-error');
    const emailError = document.getElementById('email-error');
    const subjectError = document.getElementById('subject-error');
    const messageError = document.getElementById('message-error');
    
    // Regular expressions for validation
    const nameRegex = /^[A-Za-z\s]{2,50}$/;
    const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
    const subjectRegex = /^[A-Za-z0-9\s\-_,.!?]{5,100}$/;
    
    // Validation functions
    function validateName() {
        const name = nameInput.value.trim();
        
        // Reset error
        nameError.textContent = '';
        nameInput.classList.remove('error');
        
        // Check if empty
        if (name === '') {
            nameError.textContent = 'Name is required';
            nameInput.classList.add('error');
            return false;
        }
        
        // Check format
        if (!nameRegex.test(name)) {
            nameError.textContent = 'Name must contain only letters and spaces (2-50 characters)';
            nameInput.classList.add('error');
            return false;
        }
        
        return true;
    }
    
    function validateEmail() {
        const email = emailInput.value.trim();
        
        // Reset error
        emailError.textContent = '';
        emailInput.classList.remove('error');
        
        // Check if empty
        if (email === '') {
            emailError.textContent = 'Email is required';
            emailInput.classList.add('error');
            return false;
        }
        
        // Check format
        if (!emailRegex.test(email)) {
            emailError.textContent = 'Please enter a valid email address';
            emailInput.classList.add('error');
            return false;
        }
        
        return true;
    }
    
    function validateSubject() {
        const subject = subjectInput.value.trim();
        
        // Reset error
        subjectError.textContent = '';
        subjectInput.classList.remove('error');
        
        // Check if empty
        if (subject === '') {
            subjectError.textContent = 'Subject is required';
            subjectInput.classList.add('error');
            return false;
        }
        
        // Check length and format
        if (!subjectRegex.test(subject)) {
            subjectError.textContent = 'Subject must be 5-100 characters (letters, numbers, and basic punctuation)';
            subjectInput.classList.add('error');
            return false;
        }
        
        return true;
    }
    
    function validateMessage() {
        const message = messageInput.value.trim();
        
        // Reset error
        messageError.textContent = '';
        messageInput.classList.remove('error');
        
        // Check if empty
        if (message === '') {
            messageError.textContent = 'Message is required';
            messageInput.classList.add('error');
            return false;
        }
        
        // Check length
        if (message.length < 10) {
            messageError.textContent = 'Message must be at least 10 characters';
            messageInput.classList.add('error');
            return false;
        }
        
        if (message.length > 1000) {
            messageError.textContent = 'Message must be no more than 1000 characters';
            messageInput.classList.add('error');
            return false;
        }
        
        return true;
    }
    
    // Real-time validation on input blur
    nameInput.addEventListener('blur', validateName);
    emailInput.addEventListener('blur', validateEmail);
    subjectInput.addEventListener('blur', validateSubject);
    messageInput.addEventListener('blur', validateMessage);
    
    // Also validate on input for fields with errors (for better UX)
    nameInput.addEventListener('input', function() {
        if (nameInput.classList.contains('error')) {
            validateName();
        }
    });
    
    emailInput.addEventListener('input', function() {
        if (emailInput.classList.contains('error')) {
            validateEmail();
        }
    });
    
    subjectInput.addEventListener('input', function() {
        if (subjectInput.classList.contains('error')) {
            validateSubject();
        }
    });
    
    messageInput.addEventListener('input', function() {
        if (messageInput.classList.contains('error')) {
            validateMessage();
        }
    });
    
    // Form submission validation
    form.addEventListener('submit', function(e) {
        // Validate all fields
        const isNameValid = validateName();
        const isEmailValid = validateEmail();
        const isSubjectValid = validateSubject();
        const isMessageValid = validateMessage();
        
        // If any validation fails, prevent form submission
        if (!isNameValid || !isEmailValid || !isSubjectValid || !isMessageValid) {
            e.preventDefault();
            // Scroll to the first error
            const firstError = document.querySelector('.error:not(:empty)');
            if (firstError) {
                firstError.scrollIntoView({ behavior: 'smooth', block: 'center' });
            }
        }
    });
});</code></pre>

                <h3>JavaScript Validation Explained</h3>
                <ul>
                    <li><strong>Event Listeners:</strong> Attach validation to blur (when leaving field) and submit events</li>
                    <li><strong>Regex Patterns:</strong> Define acceptable formats for each field</li>
                    <li><strong>Real-time Feedback:</strong> Validates as user types after an error is shown</li>
                    <li><strong>Visual Indicators:</strong> Adds error class for styling and displays error messages</li>
                    <li><strong>Form Submission:</strong> Prevents submission if any validation fails</li>
                    <li><strong>UX Enhancement:</strong> Scrolls to first error when form submission fails</li>
                </ul>
                
                <div class="regex_explanation">
                    <h3>Regular Expression Breakdown</h3>
                    <table>
                        <thead>
                            <tr>
                                <th>Pattern</th>
                                <th>Explanation</th>
                                <th>Examples of Valid Input</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td><code>/^[A-Za-z\s]{2,50}$/</code></td>
                                <td>
                                    <ul>
                                        <li><code>^</code> - Start of string</li>
                                        <li><code>[A-Za-z\s]</code> - Letters and spaces only</li>
                                        <li><code>{2,50}</code> - Between 2 and 50 characters</li>
                                        <li><code>$</code> - End of string</li>
                                    </ul>
                                </td>
                                <td>"John Smith", "Maria", "Jean Claude"</td>
                            </tr>
                            <tr>
                                <td><code>/^[^\s@]+@[^\s@]+\.[^\s@]+$/</code></td>
                                <td>
                                    <ul>
                                        <li><code>^</code> - Start of string</li>
                                        <li><code>[^\s@]+</code> - One or more chars not space or @</li>
                                        <li><code>@</code> - The @ symbol</li>
                                        <li><code>[^\s@]+</code> - One or more chars not space or @</li>
                                        <li><code>\.</code> - A literal dot</li>
                                        <li><code>[^\s@]+</code> - One or more chars not space or @</li>
                                        <li><code>$</code> - End of string</li>
                                    </ul>
                                </td>
                                <td>"user@example.com", "name.lastname@domain.co.uk"</td>
                            </tr>
                            <tr>
                                <td><code>/^[A-Za-z0-9\s\-_,.!?]{5,100}$/</code></td>
                                <td>
                                    <ul>
                                        <li><code>^</code> - Start of string</li>
                                        <li><code>[A-Za-z0-9\s\-_,.!?]</code> - Letters, numbers, spaces, and basic punctuation</li>
                                        <li><code>{5,100}</code> - Between 5 and 100 characters</li>
                                        <li><code>$</code> - End of string</li>
                                    </ul>
                                </td>
                                <td>"Website Feedback", "Question about your services!", "Product inquiry - Model X3"</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
            
            <div class="php_implementation">
                <h3>Step 4: PHP Server-Side Processing</h3>
                <p>First, create a folder named <code>php</code> in your project root. Then create a file named <code>functions.php</code> with utility functions:</p>
                
                <pre><code>&lt;?php
/**
 * Utility functions for contact form processing
 */

// Start session if not already started
function start_session_if_not_started() {
    if (session_status() === PHP_SESSION_NONE) {
        session_start();
    }
}

/**
 * Generate CSRF token
 * 
 * @return string Generated token
 */
function generate_csrf_token() {
    start_session_if_not_started();
    
    if (!isset($_SESSION['csrf_token'])) {
        $_SESSION['csrf_token'] = bin2hex(random_bytes(32));
    }
    
    return $_SESSION['csrf_token'];
}

/**
 * Validate CSRF token
 * 
 * @param string $token The token to validate
 * @return bool True if valid, false otherwise
 */
function validate_csrf_token($token) {
    start_session_if_not_started();
    
    if (!isset($_SESSION['csrf_token']) || $token !== $_SESSION['csrf_token']) {
        return false;
    }
    
    return true;
}

/**
 * Sanitize and validate name
 * 
 * @param string $name The name to validate
 * @return array Result with status and message
 */
function validate_name($name) {
    $name = trim($name);
    
    if (empty($name)) {
        return ['valid' => false, 'message' => 'Name is required'];
    }
    
    if (strlen($name) < 2 || strlen($name) > 50) {
        return ['valid' => false, 'message' => 'Name must be between 2 and 50 characters'];
    }
    
    if (!preg_match('/^[A-Za-z\s]{2,50}$/', $name)) {
        return ['valid' => false, 'message' => 'Name must contain only letters and spaces'];
    }
    
    return ['valid' => true, 'sanitized' => htmlspecialchars($name)];
}

/**
 * Sanitize and validate email
 * 
 * @param string $email The email to validate
 * @return array Result with status and message
 */
function validate_email($email) {
    $email = trim($email);
    
    if (empty($email)) {
        return ['valid' => false, 'message' => 'Email is required'];
    }
    
    // First use PHP's filter
    $email = filter_var($email, FILTER_SANITIZE_EMAIL);
    
    if (!filter_var($email, FILTER_VALIDATE_EMAIL)) {
        return ['valid' => false, 'message' => 'Please enter a valid email address'];
    }
    
    return ['valid' => true, 'sanitized' => htmlspecialchars($email)];
}

/**
 * Sanitize and validate subject
 * 
 * @param string $subject The subject to validate
 * @return array Result with status and message
 */
function validate_subject($subject) {
    $subject = trim($subject);
    
    if (empty($subject)) {
        return ['valid' => false, 'message' => 'Subject is required'];
    }
    
    if (strlen($subject) < 5 || strlen($subject) > 100) {
        return ['valid' => false, 'message' => 'Subject must be between 5 and 100 characters'];
    }
    
    if (!preg_match('/^[A-Za-z0-9\s\-_,.!?]{5,100}$/', $subject)) {
        return ['valid' => false, 'message' => 'Subject contains invalid characters'];
    }
    
    return ['valid' => true, 'sanitized' => htmlspecialchars($subject)];
}

/**
 * Sanitize and validate message
 * 
 * @param string $message The message to validate
 * @return array Result with status and message
 */
function validate_message($message) {
    $message = trim($message);
    
    if (empty($message)) {
        return ['valid' => false, 'message' => 'Message is required'];
    }
    
    if (strlen($message) < 10) {
        return ['valid' => false, 'message' => 'Message must be at least 10 characters'];
    }
    
    if (strlen($message) > 1000) {
        return ['valid' => false, 'message' => 'Message must be no more than 1000 characters'];
    }
    
    return ['valid' => true, 'sanitized' => htmlspecialchars($message)];
}

/**
 * Send email
 * 
 * @param array $data Form data
 * @return bool True if email was sent successfully
 */
function send_email($data) {
    $name = $data['name'];
    $email = $data['email'];
    $subject = $data['subject'];
    $message = $data['message'];
    
    // Email recipient (your email address)
    $to = 'your_email@example.com';
    
    // Email headers
    $headers = [
        'From' => "$name &lt;$email&gt;",
        'Reply-To' => $email,
        'X-Mailer' => 'PHP/' . phpversion(),
        'Content-Type' => 'text/html; charset=UTF-8'
    ];
    
    // Compose email body
    $email_body = '
    &lt;html&gt;
    &lt;head&gt;
        &lt;title&gt;New Contact Form Submission&lt;/title&gt;
    &lt;/head&gt;
    &lt;body&gt;
        &lt;h2&gt;New Contact Form Submission&lt;/h2&gt;
        &lt;p&gt;&lt;strong&gt;Name:&lt;/strong&gt; ' . $name . '&lt;/p&gt;
        &lt;p&gt;&lt;strong&gt;Email:&lt;/strong&gt; ' . $email . '&lt;/p&gt;
        &lt;p&gt;&lt;strong&gt;Subject:&lt;/strong&gt; ' . $subject . '&lt;/p&gt;
        &lt;p&gt;&lt;strong&gt;Message:&lt;/strong&gt;&lt;/p&gt;
        &lt;p&gt;' . nl2br($message) . '&lt;/p&gt;
        &lt;hr&gt;
        &lt;p&gt;This email was sent from your website contact form.&lt;/p&gt;
    &lt;/body&gt;
    &lt;/html&gt;';
    
    // Send email
    return mail($to, "Contact Form: $subject", $email_body, $headers);
}
?&gt;</code></pre>

                <p>Next, create a file named <code>process_form.php</code> in the same folder:</p>
                
                <pre><code>&lt;?php
/**
 * Contact form processing script
 */

// Include helper functions
require_once 'functions.php';

// Start session
start_session_if_not_started();

// Initialize variables
$errors = [];
$form_data = [];

// Check if form was submitted
if ($_SERVER['REQUEST_METHOD'] === 'POST') {
    
    // Check honeypot field (spam protection)
    if (!empty($_POST['website'])) {
        // If honeypot field is filled, it's likely a bot
        // Redirect without processing
        header('Location: ../index.html');
        exit;
    }
    
    // Verify CSRF token
    if (!isset($_POST['csrf_token']) || !validate_csrf_token($_POST['csrf_token'])) {
        die('Security check failed. Please try again.');
    }
    
    // Collect form data
    $name = $_POST['name'] ?? '';
    $email = $_POST['email'] ?? '';
    $subject = $_POST['subject'] ?? '';
    $message = $_POST['message'] ?? '';
    
    // Store raw form data for repopulating the form
    $form_data = [
        'name' => $name,
        'email' => $email,
        'subject' => $subject,
        'message' => $message
    ];
    
    // Validate form fields
    $name_validation = validate_name($name);
    if (!$name_validation['valid']) {
        $errors['name'] = $name_validation['message'];
    } else {
        $form_data['name'] = $name_validation['sanitized'];
    }
    
    $email_validation = validate_email($email);
    if (!$email_validation['valid']) {
        $errors['email'] = $email_validation['message'];
    } else {
        $form_data['email'] = $email_validation['sanitized'];
    }
    
    $subject_validation = validate_subject($subject);
    if (!$subject_validation['valid']) {
        $errors['subject'] = $subject_validation['message'];
    } else {
        $form_data['subject'] = $subject_validation['sanitized'];
    }
    
    $message_validation = validate_message($message);
    if (!$message_validation['valid']) {
        $errors['message'] = $message_validation['message'];
    } else {
        $form_data['message'] = $message_validation['sanitized'];
    }
    
    // Check if there are any validation errors
    if (empty($errors)) {
        // No errors, send email
        $email_sent = send_email($form_data);
        
        if ($email_sent) {
            // Email sent successfully
            // Clear form data and redirect with success message
            unset($_SESSION['form_data']);
            unset($_SESSION['form_errors']);
            
            // Optional: Log successful submission
            error_log('Contact form submitted: ' . $form_data['email']);
            
            // Generate new CSRF token for next submission
            generate_csrf_token();
            
            // Redirect with success parameter
            header('Location: ../index.html?success=1');
            exit;
        } else {
            // Email sending failed
            $errors['submit'] = 'Failed to send email. Please try again later.';
        }
    }
    
    // If we get here, there were validation errors or email failed
    // Store form data and errors in session
    $_SESSION['form_data'] = $form_data;
    $_SESSION['form_errors'] = $errors;
    
    // Redirect back to form with error parameter
    header('Location: ../index.html?error=1');
    exit;
} else {
    // If accessed directly without POST request
    header('Location: ../index.html');
    exit;
}
?&gt;</code></pre>

                <h3>PHP Implementation Explained</h3>
                <ul>
                    <li><strong>Functions File:</strong> Separates reusable validation and utility functions</li>
                    <li><strong>Server-side Validation:</strong> Mirrors client-side validation but is more thorough</li>
                    <li><strong>CSRF Protection:</strong> Generates and validates tokens to prevent cross-site request forgery</li>
                    <li><strong>Honeypot Field:</strong> Invisible field to catch spam bots (they typically fill all fields)</li>
                    <li><strong>Email Functionality:</strong> Formats and sends the contact form data</li>
                    <li><strong>Session Handling:</strong> Stores form data and errors for repopulation and feedback</li>
                    <li><strong>Redirects:</strong> Uses the POST-Redirect-GET pattern to prevent form resubmission</li>
                </ul>
            </div>
        </section>

        <section class="completing_solution">
            <h2>Looking Back and Refining</h2>
            <p>Now that we've implemented our contact form with validation, let's review our solution, test it, and consider potential improvements.</p>
            
            <div class="testing_scenarios">
                <h3>Testing Scenarios</h3>
                <table>
                    <thead>
                        <tr>
                            <th>Test Case</th>
                            <th>Expected Result</th>
                            <th>How to Verify</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td>Submit with empty fields</td>
                            <td>Form should not submit, errors displayed</td>
                            <td>Try submitting an empty form</td>
                        </tr>
                        <tr>
                            <td>Submit with invalid email</td>
                            <td>Email field should show error</td>
                            <td>Enter "notanemail" in email field</td>
                        </tr>
                        <tr>
                            <td>Submit with short message</td>
                            <td>Message field should show length error</td>
                            <td>Enter "Hi" in message field</td>
                        </tr>
                        <tr>
                            <td>CSRF protection</td>
                            <td>Direct form submission should fail</td>
                            <td>Try submitting directly to process_form.php</td>
                        </tr>
                        <tr>
                            <td>Successful submission</td>
                            <td>Success message displayed, email sent</td>
                            <td>Fill out form correctly and submit</td>
                        </tr>
                        <tr>
                            <td>XSS attack attempt</td>
                            <td>Script tags should be escaped</td>
                            <td>Enter <code>&lt;script&gt;alert(1)&lt;/script&gt;</code> in fields</td>
                        </tr>
                    </tbody>
                </table>
            </div>
            
            <div class="potential_improvements">
                <h3>Potential Improvements</h3>
                <ol>
                    <li><strong>Add reCAPTCHA:</strong> Integrate Google reCAPTCHA for better bot protection</li>
                    <li><strong>Improve Accessibility:</strong> Add ARIA attributes and ensure keyboard navigation</li>
                    <li><strong>Add Database Storage:</strong> Save submissions to a database for reference</li>
                    <li><strong>Implement AJAX Submission:</strong> Submit form without page reload for better UX</li>
                    <li><strong>Add File Upload:</strong> Allow users to attach files to their messages</li>
                    <li><strong>Implement Rate Limiting:</strong> Prevent form submission abuse</li>
                </ol>
            </div>
            
            <div class="advanced_solution">
                <h3>Advanced Solution: AJAX Form Submission</h3>
                <p>Here's how to enhance our form with AJAX submission for a smoother user experience. Update the <code>validation.js</code> file:</p>
                
                <pre><code>document.addEventListener('DOMContentLoaded', function() {
    // Get form and form elements
    const form = document.getElementById('contactForm');
    const nameInput = document.getElementById('name');
    const emailInput = document.getElementById('email');
    const subjectInput = document.getElementById('subject');
    const messageInput = document.getElementById('message');
    
    // Get error elements
    const nameError = document.getElementById('name-error');
    const emailError = document.getElementById('email-error');
    const subjectError = document.getElementById('subject-error');
    const messageError = document.getElementById('message-error');
    
    // Regular expressions for validation
    const nameRegex = /^[A-Za-z\s]{2,50}$/;
    const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
    const subjectRegex = /^[A-Za-z0-9\s\-_,.!?]{5,100}$/;
    
    // Validation functions (same as before)
    function validateName() { /* ... */ }
    function validateEmail() { /* ... */ }
    function validateSubject() { /* ... */ }
    function validateMessage() { /* ... */ }
    
    // Event listeners for blur/input events (same as before)
    nameInput.addEventListener('blur', validateName);
    emailInput.addEventListener('blur', validateEmail);
    // ...
    
    // Form submission with AJAX
    form.addEventListener('submit', function(e) {
        e.preventDefault();
        
        // Validate all fields
        const isNameValid = validateName();
        const isEmailValid = validateEmail();
        const isSubjectValid = validateSubject();
        const isMessageValid = validateMessage();
        
        // If any validation fails, prevent form submission
        if (!isNameValid || !isEmailValid || !isSubjectValid || !isMessageValid) {
            // Scroll to the first error
            const firstError = document.querySelector('.error:not(:empty)');
            if (firstError) {
                firstError.scrollIntoView({ behavior: 'smooth', block: 'center' });
            }
            return;
        }
        
        // Show loading state
        const submitBtn = form.querySelector('.submit-btn');
        const originalBtnText = submitBtn.textContent;
        submitBtn.disabled = true;
        submitBtn.textContent = 'Sending...';
        
        // Create form data object
        const formData = new FormData(form);
        
        // Send form data with fetch API
        fetch(form.action, {
            method: 'POST',
            body: formData
        })
        .then(response => response.json())
        .then(data => {
            // Reset button
            submitBtn.disabled = false;
            submitBtn.textContent = originalBtnText;
            
            if (data.success) {
                // Show success message
                const successMessage = document.createElement('div');
                successMessage.className = 'success-message';
                successMessage.textContent = data.message;
                
                // Insert before form
                form.parentNode.insertBefore(successMessage, form);
                
                // Reset form
                form.reset();
                
                // Hide form
                form.style.display = 'none';
                
                // Scroll to success message
                successMessage.scrollIntoView({ behavior: 'smooth', block: 'center' });
            } else {
                // Show error messages
                if (data.errors) {
                    if (data.errors.name) {
                        nameError.textContent = data.errors.name;
                        nameInput.classList.add('error');
                    }
                    
                    if (data.errors.email) {
                        emailError.textContent = data.errors.email;
                        emailInput.classList.add('error');
                    }
                    
                    if (data.errors.subject) {
                        subjectError.textContent = data.errors.subject;
                        subjectInput.classList.add('error');
                    }
                    
                    if (data.errors.message) {
                        messageError.textContent = data.errors.message;
                        messageInput.classList.add('error');
                    }
                    
                    // Scroll to first error
                    const firstError = document.querySelector('.error:not(:empty)');
                    if (firstError) {
                        firstError.scrollIntoView({ behavior: 'smooth', block: 'center' });
                    }
                } else {
                    // General error
                    alert(data.message || 'An error occurred. Please try again.');
                }
            }
        })
        .catch(error => {
            // Reset button
            submitBtn.disabled = false;
            submitBtn.textContent = originalBtnText;
            
            // Show error message
            console.error('Error:', error);
            alert('An error occurred. Please try again later.');
        });
    });
});</code></pre>

                <p>Then modify <code>process_form.php</code> to return JSON responses for AJAX:</p>
                
                <pre><code>&lt;?php
// Include helper functions
require_once 'functions.php';

// Start session
start_session_if_not_started();

// Function to send JSON response
function send_json_response($success, $message, $errors = []) {
    header('Content-Type: application/json');
    echo json_encode([
        'success' => $success,
        'message' => $message,
        'errors' => $errors
    ]);
    exit;
}

// Check if form was submitted
if ($_SERVER['REQUEST_METHOD'] === 'POST') {
    // Check honeypot field (spam protection)
    if (!empty($_POST['website'])) {
        send_json_response(false, 'Form submission failed.', []);
    }
    
    // Verify CSRF token
    if (!isset($_POST['csrf_token']) || !validate_csrf_token($_POST['csrf_token'])) {
        send_json_response(false, 'Security check failed. Please try again.', []);
    }
    
    // Collect and validate form data (same as before)
    // ...
    
    // Check if there are any validation errors
    if (empty($errors)) {
        // No errors, send email
        $email_sent = send_email($form_data);
        
        if ($email_sent) {
            // Success
            send_json_response(true, 'Thank you for your message! We\'ll get back to you soon.');
        } else {
            // Email sending failed
            send_json_response(false, 'Failed to send email. Please try again later.');
        }
    } else {
        // Validation errors
        send_json_response(false, 'Please correct the errors in the form.', $errors);
    }
} else {
    // If accessed directly without POST request
    send_json_response(false, 'Invalid request method.');
}
?&gt;</code></pre>
            </div>
            
            <div class="lessons_learned">
                <h3>Key Takeaways</h3>
                <ul>
                    <li><strong>Defense in Depth:</strong> Both client-side and server-side validation are essential</li>
                    <li><strong>User Experience:</strong> Clear error messages and preserved input improve usability</li>
                    <li><strong>Security Measures:</strong> CSRF tokens, input sanitization, and honeypot fields protect against common vulnerabilities</li>
                    <li><strong>Code Organization:</strong> Separating functions into reusable components improves maintainability</li>
                    <li><strong>Progressive Enhancement:</strong> Starting with a basic form that works without JavaScript, then enhancing with JS</li>
                </ul>
                
                <h3>Real-World Application</h3>
                <p>The skills learned in this project apply to many real-world scenarios:</p>
                <ul>
                    <li><strong>Newsletter Subscriptions:</strong> Email validation and processing</li>
                    <li><strong>User Registration Forms:</strong> More complex validation with similar techniques</li>
                    <li><strong>E-commerce Checkout:</strong> Form handling for payment and shipping information</li>
                    <li><strong>Survey Forms:</strong> Collecting and validating user feedback</li>
                    <li><strong>Job Application Forms:</strong> Handling personal information securely</li>
                </ul>
                
                <div class="mermaid_diagram">
                    <h3>Complete Validation Flow</h3>
                    <div class="mermaid">
graph TD
    A[User Enters Data] --> B[JavaScript Validation]
    B -->|Valid| C[Form Submission]
    B -->|Invalid| D[Show Client-side Errors]
    D --> A
    C --> E[PHP Server Validation]
    E -->|Valid| F[CSRF Token Check]
    E -->|Invalid| G[Store Errors in Session]
    G --> H[Redirect Back to Form]
    H --> I[Display Server-side Errors]
    I --> A
    F -->|Valid| J[Process Form Data]
    F -->|Invalid| K[Security Error]
    K --> H
    J --> L[Send Email]
    L -->|Success| M[Show Success Message]
    L -->|Failure| N[Show Error Message]
    N --> H
                    </div>
                </div>
            </div>
        </section>

        <section class="further_learning">
            <h2>Further Learning Resources</h2>
            
            <div class="resources_list">
                <h3>Documentation and Tutorials</h3>
                <ul>
                    <li><a href="https://developer.mozilla.org/en-US/docs/Learn/Forms" target="_blank">MDN Web Forms Guide</a></li>
                    <li><a href="https://www.php.net/manual/en/filter.examples.validation.php" target="_blank">PHP Filter Functions</a></li>
                    <li><a href="https://www.smashingmagazine.com/2018/10/form-validation-html5-regex/" target="_blank">Form Validation with HTML5 and Regex</a></li>
                    <li><a href="https://developer.mozilla.org/en-US/docs/Web/API/Fetch_API/Using_Fetch" target="_blank">Using Fetch API</a></li>
                </ul>
                
                <h3>Security Resources</h3>
                <ul>
                    <li><a href="https://owasp.org/www-community/attacks/csrf" target="_blank">OWASP: Cross-Site Request Forgery</a></li>
                    <li><a href="https://owasp.org/www-community/attacks/xss/" target="_blank">OWASP: Cross-Site Scripting</a></li>
                    <li><a href="https://cheatsheetseries.owasp.org/cheatsheets/Input_Validation_Cheat_Sheet.html" target="_blank">OWASP: Input Validation Cheat Sheet</a></li>
                </ul>
                
                <h3>Advanced Topics</h3>
                <ul>
                    <li><a href="https://developers.google.com/recaptcha/docs/display" target="_blank">Google reCAPTCHA Integration</a></li>
                    <li><a href="https://developer.mozilla.org/en-US/docs/Web/Accessibility/ARIA" target="_blank">ARIA for Form Accessibility</a></li>
                    <li><a href="https://www.php.net/manual/en/book.pdo.php" target="_blank">PHP PDO for Database Storage</a></li>
                </ul>
            </div>
        </section>
    </main>
    
    <footer>
        <p>&copy; 2025 PHP WordPress Development Course</p>
        <p><a href="file_uploads_with_php.html">Previous Lesson: File Uploads with PHP</a> | <a href="index.html">Back to Syllabus</a></p>
    </footer>
</body>
</html>
