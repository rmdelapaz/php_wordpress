<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Implementing User Input and Processing</title>
    <link rel="stylesheet" href="/styles/main.css">
    <link rel="icon" href="/favicon.png">
    <script type="module">
      import mermaid from 'https://cdn.jsdelivr.net/npm/mermaid@10/dist/mermaid.esm.min.mjs';
      mermaid.initialize({ startOnLoad: true });
    </script>
</head>
<body>
    <header>
        <h1>Implementing User Input and Processing</h1>
        <p><a href="index.html">‚Üê Back to Syllabus</a></p>
    </header>
    
    <main>
        <section class="intro">
            <h2>Introduction to User Input in Dynamic PHP Applications</h2>
            <p>Welcome to today's lecture on implementing user input and processing in PHP! This topic is absolutely crucial to building dynamic web applications, as user input is what transforms a static website into an interactive experience.</p>
            
            <p>User input is the lifeblood of any interactive web application. It's the mechanism through which users communicate their intentions, preferences, and data to your application. How your application receives, validates, processes, and responds to this input defines the quality of the user experience.</p>
            
            <div class="analogy">
                <h3>The Post Office Analogy</h3>
                <p>Think of user input processing as a post office system:</p>
                <ul>
                    <li><strong>HTML Forms:</strong> Like envelopes and paper, providing standardized containers for messages</li>
                    <li><strong>Input Fields:</strong> Different types of forms for different types of information (text boxes, checkboxes, etc.)</li>
                    <li><strong>Submission:</strong> Like dropping a letter in a mailbox</li>
                    <li><strong>Server-side Processing:</strong> Like postal workers sorting, verifying, and delivering mail</li>
                    <li><strong>Validation:</strong> Similar to checking for proper postage, correct addresses, and prohibited items</li>
                    <li><strong>Response:</strong> The reply that confirms your mail was processed or explains issues</li>
                </ul>
            </div>
            
            <div class="mermaid-diagram">
                <h3>The User Input Flow in PHP Applications</h3>
                <div class="mermaid">
flowchart LR
    A[User Input] --> B[HTML Form]
    B --> C[HTTP Request]
    C --> D[PHP Script]
    D --> E{Validation}
    E -->|Valid| F[Process Data]
    E -->|Invalid| G[Return Errors]
    F --> H[Store in Database]
    F --> I[Generate Response]
    G --> J[Repopulate Form]
    I --> K[Return to User]
    J --> K
                </div>
            </div>
        </section>
        
        <section class="html_forms">
            <h2>HTML Forms: The Gateway to User Input</h2>
            
            <p>HTML forms are the standard way users provide input on the web. Let's review the key components of HTML forms and how they connect to PHP processing.</p>
            
            <div class="code-example">
                <h3>Basic HTML Form Structure</h3>
                <pre><code>&lt;!-- Basic contact form example --&gt;
&lt;form action="process_contact.php" method="POST"&gt;
    &lt;div class="form-group"&gt;
        &lt;label for="name"&gt;Your Name:&lt;/label&gt;
        &lt;input type="text" id="name" name="name" required&gt;
    &lt;/div&gt;
    
    &lt;div class="form-group"&gt;
        &lt;label for="email"&gt;Email Address:&lt;/label&gt;
        &lt;input type="email" id="email" name="email" required&gt;
    &lt;/div&gt;
    
    &lt;div class="form-group"&gt;
        &lt;label for="message"&gt;Your Message:&lt;/label&gt;
        &lt;textarea id="message" name="message" rows="5" required&gt;&lt;/textarea&gt;
    &lt;/div&gt;
    
    &lt;button type="submit"&gt;Send Message&lt;/button&gt;
&lt;/form&gt;</code></pre>
            </div>
            
            <h3>Key Form Attributes</h3>
            <ul>
                <li><strong>action:</strong> The URL of the PHP script that will process the form data</li>
                <li><strong>method:</strong> The HTTP method to use (GET or POST)</li>
                <li><strong>enctype:</strong> The encoding type (important for file uploads)</li>
            </ul>
            
            <div class="mermaid-diagram">
                <h3>GET vs POST Methods</h3>
                <div class="mermaid">
flowchart TD
    A[Form Submission] --> B{Method?}
    B -->|GET| C[Data in URL]
    B -->|POST| D[Data in Request Body]
    C --> E[Visible in Browser Address Bar]
    C --> F[Limited Data Size]
    C --> G[Bookmarkable]
    C --> H[Not Secure for Sensitive Data]
    D --> I[Not Visible in URL]
    D --> J[No Size Limitation]
    D --> K[Not Bookmarkable]
    D --> L[More Secure for Sensitive Data]
                </div>
            </div>
            
            <div class="example">
                <h3>When to Use GET vs POST</h3>
                <table>
                    <thead>
                        <tr>
                            <th>Use GET when:</th>
                            <th>Use POST when:</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td>
                                <ul>
                                    <li>Submitting search queries</li>
                                    <li>Applying filters to a page</li>
                                    <li>Pagination</li>
                                    <li>Any operation that doesn't change server state</li>
                                </ul>
                            </td>
                            <td>
                                <ul>
                                    <li>Submitting login credentials</li>
                                    <li>Uploading files</li>
                                    <li>Creating, updating, or deleting data</li>
                                    <li>Sending large amounts of data</li>
                                    <li>Submitting sensitive information</li>
                                </ul>
                            </td>
                        </tr>
                    </tbody>
                </table>
            </div>
            
            <h3>Common Form Input Types</h3>
            <ul>
                <li><strong>text:</strong> Single-line text input</li>
                <li><strong>email:</strong> Email address input with validation</li>
                <li><strong>password:</strong> Masked input for sensitive information</li>
                <li><strong>number:</strong> Numeric input with optional min/max</li>
                <li><strong>date:</strong> Date picker input</li>
                <li><strong>checkbox:</strong> Multiple-choice selections</li>
                <li><strong>radio:</strong> Single-choice from multiple options</li>
                <li><strong>select:</strong> Dropdown for selecting from options</li>
                <li><strong>file:</strong> File upload input</li>
                <li><strong>hidden:</strong> Invisible input with preset value</li>
                <li><strong>textarea:</strong> Multi-line text input</li>
                <li><strong>button:</strong> Clickable button (submit, reset, or custom)</li>
            </ul>
            
            <div class="example">
                <h3>Form Input Examples</h3>
                <div class="code-example">
                    <pre><code>&lt;!-- Text input with placeholder and pattern validation --&gt;
&lt;input type="text" name="username" placeholder="Enter username" 
       pattern="[A-Za-z0-9_]{3,20}" title="Username must be 3-20 characters, alphanumeric or underscore"&gt;

&lt;!-- Select dropdown with options --&gt;
&lt;select name="country"&gt;
    &lt;option value=""&gt;Select your country&lt;/option&gt;
    &lt;option value="us"&gt;United States&lt;/option&gt;
    &lt;option value="ca"&gt;Canada&lt;/option&gt;
    &lt;option value="mx"&gt;Mexico&lt;/option&gt;
    &lt;option value="other"&gt;Other&lt;/option&gt;
&lt;/select&gt;

&lt;!-- Radio buttons for single selection --&gt;
&lt;div&gt;
    &lt;label&gt;Subscription Type:&lt;/label&gt;
    &lt;input type="radio" id="free" name="subscription" value="free" checked&gt;
    &lt;label for="free"&gt;Free&lt;/label&gt;
    
    &lt;input type="radio" id="premium" name="subscription" value="premium"&gt;
    &lt;label for="premium"&gt;Premium&lt;/label&gt;
    
    &lt;input type="radio" id="enterprise" name="subscription" value="enterprise"&gt;
    &lt;label for="enterprise"&gt;Enterprise&lt;/label&gt;
&lt;/div&gt;

&lt;!-- Checkboxes for multiple selections --&gt;
&lt;div&gt;
    &lt;label&gt;Interests:&lt;/label&gt;
    &lt;input type="checkbox" id="web" name="interests[]" value="web"&gt;
    &lt;label for="web"&gt;Web Development&lt;/label&gt;
    
    &lt;input type="checkbox" id="mobile" name="interests[]" value="mobile"&gt;
    &lt;label for="mobile"&gt;Mobile Development&lt;/label&gt;
    
    &lt;input type="checkbox" id="data" name="interests[]" value="data"&gt;
    &lt;label for="data"&gt;Data Science&lt;/label&gt;
&lt;/div&gt;

&lt;!-- File upload with restrictions --&gt;
&lt;input type="file" name="profile_image" accept="image/*" max-size="2097152"&gt;</code></pre>
                </div>
            </div>
            
            <div class="note">
                <h3>Important Form Best Practices</h3>
                <ul>
                    <li>Always use <strong>labels</strong> with input fields for accessibility</li>
                    <li>Include <strong>placeholder</strong> text to guide user input</li>
                    <li>Use appropriate <strong>input types</strong> for better mobile support and basic validation</li>
                    <li>Implement <strong>client-side validation</strong> for immediate feedback</li>
                    <li>Always validate on the <strong>server-side</strong> as well (never trust client-side validation alone)</li>
                    <li>Structure forms logically with <strong>fieldset</strong> and <strong>legend</strong> elements for complex forms</li>
                    <li>Use <strong>name</strong> attributes wisely as they become keys in your PHP $_GET or $_POST arrays</li>
                </ul>
            </div>
        </section>
        
        <section class="php_input_handling">
            <h2>Handling Form Data in PHP</h2>
            
            <p>When a form is submitted, PHP provides several superglobal arrays that contain the submitted data:</p>
            <ul>
                <li><strong>$_GET:</strong> Contains data sent through URL parameters (GET method)</li>
                <li><strong>$_POST:</strong> Contains data sent in the request body (POST method)</li>
                <li><strong>$_REQUEST:</strong> Contains data from both $_GET and $_POST (use with caution)</li>
                <li><strong>$_FILES:</strong> Contains information about uploaded files</li>
            </ul>
            
            <div class="code-example">
                <h3>Basic Form Processing in PHP</h3>
                <pre><code>&lt;?php
// process_contact.php - Processes the contact form

// Check if form was submitted
if ($_SERVER['REQUEST_METHOD'] === 'POST') {
    // Retrieve form data
    $name = $_POST['name'] ?? '';
    $email = $_POST['email'] ?? '';
    $message = $_POST['message'] ?? '';
    
    // Validation would go here (we'll cover this shortly)
    
    // Process the data (e.g., send email, store in database)
    $success = sendContactEmail($name, $email, $message);
    
    if ($success) {
        echo "Thank you for your message! We'll respond shortly.";
    } else {
        echo "There was an error sending your message. Please try again.";
    }
} else {
    // If accessed directly without form submission
    echo "This script should only be accessed via form submission.";
}

// Example function to send email (implementation would vary)
function sendContactEmail($name, $email, $message) {
    $to = "contact@example.com";
    $subject = "Contact Form Submission from $name";
    $body = "Name: $name\nEmail: $email\n\nMessage:\n$message";
    $headers = "From: $email";
    
    return mail($to, $subject, $body, $headers);
}
?&gt;</code></pre>
            </div>
            
            <div class="example">
                <h3>Handling Different Input Types</h3>
                <div class="code-example">
                    <pre><code>&lt;?php
// Process different form input types

// Text input - simple string
$username = $_POST['username'] ?? '';

// Select dropdown - single value
$country = $_POST['country'] ?? '';

// Radio buttons - single value
$subscription = $_POST['subscription'] ?? '';

// Checkboxes - array of values (note the [] in the HTML name)
$interests = $_POST['interests'] ?? [];
if (!is_array($interests)) {
    $interests = [$interests]; // Ensure it's always an array
}

// Processing checkbox values
$interestString = implode(', ', $interests);
echo "Your interests: $interestString";

// File upload - complex array with file information
if (isset($_FILES['profile_image']) && $_FILES['profile_image']['error'] === UPLOAD_ERR_OK) {
    $tmpName = $_FILES['profile_image']['tmp_name'];
    $fileName = $_FILES['profile_image']['name'];
    $fileSize = $_FILES['profile_image']['size'];
    $fileType = $_FILES['profile_image']['type'];
    
    // Example: move uploaded file to a permanent location
    move_uploaded_file($tmpName, "uploads/$fileName");
}
?&gt;</code></pre>
                </div>
            </div>
            
            <div class="note">
                <h3>The $_FILES Array Structure</h3>
                <p>When uploading files, $_FILES contains a multi-dimensional array with the following structure:</p>
                <pre><code>$_FILES['field_name'] = [
    'name'     => 'original_filename.jpg',  // Original filename
    'type'     => 'image/jpeg',             // MIME type
    'tmp_name' => '/tmp/php7FBh.tmp',       // Temporary location
    'error'    => 0,                        // Error code (0 = success)
    'size'     => 123456                    // File size in bytes
];</code></pre>
            </div>
            
            <h3>Common File Upload Error Codes</h3>
            <table>
                <thead>
                    <tr>
                        <th>Constant</th>
                        <th>Value</th>
                        <th>Description</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td>UPLOAD_ERR_OK</td>
                        <td>0</td>
                        <td>File uploaded successfully</td>
                    </tr>
                    <tr>
                        <td>UPLOAD_ERR_INI_SIZE</td>
                        <td>1</td>
                        <td>File exceeds the upload_max_filesize directive in php.ini</td>
                    </tr>
                    <tr>
                        <td>UPLOAD_ERR_FORM_SIZE</td>
                        <td>2</td>
                        <td>File exceeds the MAX_FILE_SIZE directive in the HTML form</td>
                    </tr>
                    <tr>
                        <td>UPLOAD_ERR_PARTIAL</td>
                        <td>3</td>
                        <td>File was only partially uploaded</td>
                    </tr>
                    <tr>
                        <td>UPLOAD_ERR_NO_FILE</td>
                        <td>4</td>
                        <td>No file was uploaded</td>
                    </tr>
                    <tr>
                        <td>UPLOAD_ERR_NO_TMP_DIR</td>
                        <td>6</td>
                        <td>Missing a temporary folder</td>
                    </tr>
                    <tr>
                        <td>UPLOAD_ERR_CANT_WRITE</td>
                        <td>7</td>
                        <td>Failed to write file to disk</td>
                    </tr>
                    <tr>
                        <td>UPLOAD_ERR_EXTENSION</td>
                        <td>8</td>
                        <td>A PHP extension stopped the file upload</td>
                    </tr>
                </tbody>
            </table>
        </section>
        
        <section class="input_validation">
            <h2>Input Validation and Sanitization: The Shield of Your Application</h2>
            
            <div class="analogy">
                <h3>The Bouncer Analogy</h3>
                <p>Think of input validation and sanitization as bouncers at an exclusive club:</p>
                <ul>
                    <li><strong>Validation:</strong> The bouncer checking IDs and dress code before allowing entry</li>
                    <li><strong>Sanitization:</strong> The coat check ensuring no weapons or contraband are brought in</li>
                </ul>
                <p>Both are essential security measures that protect your application and data.</p>
            </div>
            
            <h3>Why Validation Matters</h3>
            <p>Without proper validation and sanitization, your application is vulnerable to:</p>
            <ul>
                <li><strong>SQL Injection:</strong> Attackers can execute malicious database queries</li>
                <li><strong>Cross-Site Scripting (XSS):</strong> Injecting malicious client-side scripts</li>
                <li><strong>Data Corruption:</strong> Invalid data formats breaking application logic</li>
                <li><strong>Security Breaches:</strong> Unauthorized access to sensitive information</li>
            </ul>
            
            <div class="mermaid-diagram">
                <h3>The Validation Process</h3>
                <div class="mermaid">
flowchart TD
    A[Receive User Input] --> B[Basic Validation]
    B --> C{Is Input Valid?}
    C -->|No| D[Return Errors]
    C -->|Yes| E[Sanitize Input]
    E --> F[Type Casting/Conversion]
    F --> G[Business Logic Validation]
    G --> H{Passes Business Rules?}
    H -->|No| D
    H -->|Yes| I[Process Valid Input]
                </div>
            </div>
            
            <h3>Types of Validation</h3>
            <ul>
                <li><strong>Required Fields:</strong> Ensuring mandatory fields aren't empty</li>
                <li><strong>Type Validation:</strong> Checking that input matches expected types (numbers, emails, dates)</li>
                <li><strong>Format Validation:</strong> Verifying input follows specific patterns (ZIP codes, phone numbers)</li>
                <li><strong>Range Validation:</strong> Confirming numeric values are within acceptable ranges</li>
                <li><strong>Cross-field Validation:</strong> Comparing related fields (password confirmation, date ranges)</li>
                <li><strong>Database Validation:</strong> Checking against existing records (unique email, valid foreign keys)</li>
            </ul>
            
            <div class="code-example">
                <h3>Basic Manual Validation Example</h3>
                <pre><code>&lt;?php
// registration_process.php

// Initialize errors array
$errors = [];

// Check if form was submitted
if ($_SERVER['REQUEST_METHOD'] === 'POST') {
    
    // Retrieve and validate username
    $username = $_POST['username'] ?? '';
    if (empty($username)) {
        $errors['username'] = 'Username is required';
    } elseif (strlen($username) < 3 || strlen($username) > 20) {
        $errors['username'] = 'Username must be between 3 and 20 characters';
    } elseif (!preg_match('/^[A-Za-z0-9_]+$/', $username)) {
        $errors['username'] = 'Username can only contain letters, numbers, and underscores';
    }
    
    // Retrieve and validate email
    $email = $_POST['email'] ?? '';
    if (empty($email)) {
        $errors['email'] = 'Email is required';
    } elseif (!filter_var($email, FILTER_VALIDATE_EMAIL)) {
        $errors['email'] = 'Invalid email format';
    }
    
    // Retrieve and validate password
    $password = $_POST['password'] ?? '';
    $confirm_password = $_POST['confirm_password'] ?? '';
    if (empty($password)) {
        $errors['password'] = 'Password is required';
    } elseif (strlen($password) < 8) {
        $errors['password'] = 'Password must be at least 8 characters long';
    } elseif ($password !== $confirm_password) {
        $errors['confirm_password'] = 'Passwords do not match';
    }
    
    // If no errors, process the registration
    if (empty($errors)) {
        // Sanitize inputs before using
        $username = filter_var($username, FILTER_SANITIZE_STRING);
        $email = filter_var($email, FILTER_SANITIZE_EMAIL);
        
        // Hash password for secure storage
        $password_hash = password_hash($password, PASSWORD_DEFAULT);
        
        // Process the registration (database storage, etc.)
        $registered = registerUser($username, $email, $password_hash);
        
        if ($registered) {
            // Redirect to success page
            header("Location: registration_success.php");
            exit;
        } else {
            $errors['general'] = 'Registration failed. Please try again.';
        }
    }
}

// Function to register user (example)
function registerUser($username, $email, $password_hash) {
    // In a real application, this would store the user in a database
    // For this example, we'll just return true to simulate success
    return true;
}
?&gt;</code></pre>
            </div>
            
            <h3>PHP Input Validation Functions</h3>
            <p>PHP provides several built-in functions for validating input:</p>
            <ul>
                <li><strong>empty():</strong> Checks if a variable is empty</li>
                <li><strong>isset():</strong> Determines if a variable is set and not NULL</li>
                <li><strong>is_*():</strong> Type-checking functions (is_numeric(), is_string(), is_array(), etc.)</li>
                <li><strong>filter_var():</strong> Validates and sanitizes variables using filters</li>
                <li><strong>preg_match():</strong> Performs regular expression pattern matching</li>
                <li><strong>strlen():</strong> Gets string length for length validation</li>
                <li><strong>in_array():</strong> Checks if a value exists in an array (for validating against allowed values)</li>
            </ul>
            
            <div class="example">
                <h3>Using PHP Filter Functions</h3>
                <div class="code-example">
                    <pre><code>&lt;?php
// Using PHP's filter functions for validation

// Validate email
$email = 'user@example.com';
if (filter_var($email, FILTER_VALIDATE_EMAIL)) {
    echo "Valid email format";
} else {
    echo "Invalid email format";
}

// Validate integer
$age = '25';
if (filter_var($age, FILTER_VALIDATE_INT) !== false) {
    echo "Valid integer";
} else {
    echo "Not a valid integer";
}

// Validate URL
$url = 'https://www.example.com';
if (filter_var($url, FILTER_VALIDATE_URL)) {
    echo "Valid URL";
} else {
    echo "Invalid URL";
}

// Validate IP address
$ip = '192.168.1.1';
if (filter_var($ip, FILTER_VALIDATE_IP)) {
    echo "Valid IP address";
} else {
    echo "Invalid IP address";
}

// Validate with options (integer between 1 and 100)
$score = 75;
$options = [
    'options' => [
        'min_range' => 1,
        'max_range' => 100
    ]
];
if (filter_var($score, FILTER_VALIDATE_INT, $options) !== false) {
    echo "Valid score (1-100)";
} else {
    echo "Invalid score (must be 1-100)";
}
?&gt;</code></pre>
                </div>
            </div>
            
            <h3>Input Sanitization</h3>
            <p>Sanitization removes or neutralizes potentially harmful characters from user input:</p>
            <ul>
                <li><strong>filter_var() with FILTER_SANITIZE_* flags</strong></li>
                <li><strong>htmlspecialchars():</strong> Converts special characters to HTML entities</li>
                <li><strong>strip_tags():</strong> Removes HTML and PHP tags</li>
                <li><strong>trim():</strong> Removes whitespace from the beginning and end of strings</li>
                <li><strong>mysqli_real_escape_string():</strong> Escapes characters for SQL queries (for MySQLi)</li>
                <li><strong>PDO::quote():</strong> Escapes and quotes strings for SQL (for PDO)</li>
            </ul>
            
            <div class="code-example">
                <h3>Sanitization Examples</h3>
                <pre><code>&lt;?php
// Sanitizing user input examples

// Remove all HTML tags
$comment = '&lt;script&gt;alert("XSS attack")&lt;/script&gt;This is a comment.';
$sanitized = strip_tags($comment);
echo $sanitized; // Outputs: This is a comment.

// Convert special characters to HTML entities (for displaying in HTML)
$username = 'John &lt;script&gt;alert("Hack")&lt;/script&gt;';
$sanitized = htmlspecialchars($username, ENT_QUOTES, 'UTF-8');
echo $sanitized; // Safely displays as: John &amp;lt;script&amp;gt;alert("Hack")&amp;lt;/script&amp;gt;

// Sanitize email
$email = ' user@example.com ';
$sanitized = filter_var(trim($email), FILTER_SANITIZE_EMAIL);
echo $sanitized; // Outputs: user@example.com

// Sanitize integers
$age = '25years';
$sanitized = filter_var($age, FILTER_SANITIZE_NUMBER_INT);
echo $sanitized; // Outputs: 25

// Sanitize for SQL (using PDO - preferred method)
$pdo = new PDO('mysql:host=localhost;dbname=mydb', 'username', 'password');
$username = "O'Reilly"; // Has a quote that could break SQL
$sanitized = $pdo->quote($username);
echo $sanitized; // Outputs: 'O\'Reilly'

// Sanitize for SQL (using MySQLi)
$mysqli = new mysqli('localhost', 'username', 'password', 'mydb');
$username = "O'Reilly";
$sanitized = $mysqli->real_escape_string($username);
echo $sanitized; // Outputs: O\'Reilly
?&gt;</code></pre>
            </div>
            
            <div class="note">
                <h3>Important Security Notes</h3>
                <ul>
                    <li>Never trust user input, even if you've implemented client-side validation</li>
                    <li>Always validate and sanitize server-side</li>
                    <li>Use parameterized queries (prepared statements) for database operations whenever possible</li>
                    <li>Apply the principle of least privilege: only allow what's absolutely necessary</li>
                    <li>Sanitize output when displaying user-provided content</li>
                    <li>Use context-appropriate sanitization (HTML context, JavaScript context, SQL context, etc.)</li>
                </ul>
            </div>
        </section>
        
        <section class="form_processing_patterns">
            <h2>Form Processing Patterns</h2>
            
            <h3>Single-File Approach</h3>
            <p>In this approach, the form and its processing logic reside in the same file:</p>
            <div class="code-example">
                <pre><code>&lt;?php
// contact.php - Combined form and processing

// Initialize variables
$name = $email = $message = '';
$errors = [];
$success = false;

// Check if form was submitted
if ($_SERVER['REQUEST_METHOD'] === 'POST') {
    // Process the form
    $name = $_POST['name'] ?? '';
    $email = $_POST['email'] ?? '';
    $message = $_POST['message'] ?? '';
    
    // Validate inputs
    if (empty($name)) {
        $errors['name'] = 'Name is required';
    }
    
    if (empty($email)) {
        $errors['email'] = 'Email is required';
    } elseif (!filter_var($email, FILTER_VALIDATE_EMAIL)) {
        $errors['email'] = 'Invalid email format';
    }
    
    if (empty($message)) {
        $errors['message'] = 'Message is required';
    }
    
    // If no errors, process the form
    if (empty($errors)) {
        // Process the form (e.g., send email)
        $success = true;
        
        // Clear form values after successful submission
        $name = $email = $message = '';
    }
}
?&gt;

&lt;!DOCTYPE html&gt;
&lt;html&gt;
&lt;head&gt;
    &lt;title&gt;Contact Us&lt;/title&gt;
&lt;/head&gt;
&lt;body&gt;
    &lt;h1&gt;Contact Us&lt;/h1&gt;
    
    &lt;?php if ($success): ?&gt;
        &lt;div class="success-message"&gt;
            Thank you for your message! We'll respond shortly.
        &lt;/div&gt;
    &lt;?php endif; ?&gt;
    
    &lt;form method="post" action=""&gt;
        &lt;div class="form-group"&gt;
            &lt;label for="name"&gt;Your Name:&lt;/label&gt;
            &lt;input type="text" id="name" name="name" value="&lt;?= htmlspecialchars($name) ?&gt;"&gt;
            &lt;?php if (isset($errors['name'])): ?&gt;
                &lt;span class="error"&gt;&lt;?= $errors['name'] ?&gt;&lt;/span&gt;
            &lt;?php endif; ?&gt;
        &lt;/div&gt;
        
        &lt;div class="form-group"&gt;
            &lt;label for="email"&gt;Email Address:&lt;/label&gt;
            &lt;input type="email" id="email" name="email" value="&lt;?= htmlspecialchars($email) ?&gt;"&gt;
            &lt;?php if (isset($errors['email'])): ?&gt;
                &lt;span class="error"&gt;&lt;?= $errors['email'] ?&gt;&lt;/span&gt;
            &lt;?php endif; ?&gt;
        &lt;/div&gt;
        
        &lt;div class="form-group"&gt;
            &lt;label for="message"&gt;Your Message:&lt;/label&gt;
            &lt;textarea id="message" name="message" rows="5"&gt;&lt;?= htmlspecialchars($message) ?&gt;&lt;/textarea&gt;
            &lt;?php if (isset($errors['message'])): ?&gt;
                &lt;span class="error"&gt;&lt;?= $errors['message'] ?&gt;&lt;/span&gt;
            &lt;?php endif; ?&gt;
        &lt;/div&gt;
        
        &lt;button type="submit"&gt;Send Message&lt;/button&gt;
    &lt;/form&gt;
&lt;/body&gt;
&lt;/html&gt;</code></pre>
            </div>
            
            <div class="pros-cons">
                <h4>Pros and Cons of Single-File Approach</h4>
                <div class="pros">
                    <h5>Pros:</h5>
                    <ul>
                        <li>Simple and straightforward for small forms</li>
                        <li>Easy to maintain form state and display errors</li>
                        <li>Self-contained in one file</li>
                    </ul>
                </div>
                <div class="cons">
                    <h5>Cons:</h5>
                    <ul>
                        <li>Mixes presentation and logic</li>
                        <li>Can become unwieldy for complex forms</li>
                        <li>Less maintainable in larger applications</li>
                    </ul>
                </div>
            </div>
            
            <h3>Separate Files Approach</h3>
            <p>Separating form display and processing into different files:</p>
            <div class="code-example">
                <h4>Form Display File (contact_form.php)</h4>
                <pre><code>&lt;?php
// contact_form.php - Displays the contact form

// Initialize variables
session_start();

// Retrieve any saved form data and errors from session
$name = $_SESSION['form_data']['name'] ?? '';
$email = $_SESSION['form_data']['email'] ?? '';
$message = $_SESSION['form_data']['message'] ?? '';
$errors = $_SESSION['form_errors'] ?? [];
$success = $_SESSION['form_success'] ?? false;

// Clear session variables after retrieving
unset($_SESSION['form_data']);
unset($_SESSION['form_errors']);
unset($_SESSION['form_success']);
?&gt;

&lt;!DOCTYPE html&gt;
&lt;html&gt;
&lt;head&gt;
    &lt;title&gt;Contact Us&lt;/title&gt;
&lt;/head&gt;
&lt;body&gt;
    &lt;h1&gt;Contact Us&lt;/h1&gt;
    
    &lt;?php if ($success): ?&gt;
        &lt;div class="success-message"&gt;
            Thank you for your message! We'll respond shortly.
        &lt;/div&gt;
    &lt;?php endif; ?&gt;
    
    &lt;form method="post" action="process_contact.php"&gt;
        &lt;div class="form-group"&gt;
            &lt;label for="name"&gt;Your Name:&lt;/label&gt;
            &lt;input type="text" id="name" name="name" value="&lt;?= htmlspecialchars($name) ?&gt;"&gt;
            &lt;?php if (isset($errors['name'])): ?&gt;
                &lt;span class="error"&gt;&lt;?= $errors['name'] ?&gt;&lt;/span&gt;
            &lt;?php endif; ?&gt;
        &lt;/div&gt;
        
        &lt;div class="form-group"&gt;
            &lt;label for="email"&gt;Email Address:&lt;/label&gt;
            &lt;input type="email" id="email" name="email" value="&lt;?= htmlspecialchars($email) ?&gt;"&gt;
            &lt;?php if (isset($errors['email'])): ?&gt;
                &lt;span class="error"&gt;&lt;?= $errors['email'] ?&gt;&lt;/span&gt;
            &lt;?php endif; ?&gt;
        &lt;/div&gt;
        
        &lt;div class="form-group"&gt;
            &lt;label for="message"&gt;Your Message:&lt;/label&gt;
            &lt;textarea id="message" name="message" rows="5"&gt;&lt;?= htmlspecialchars($message) ?&gt;&lt;/textarea&gt;
            &lt;?php if (isset($errors['message'])): ?&gt;
                &lt;span class="error"&gt;&lt;?= $errors['message'] ?&gt;&lt;/span&gt;
            &lt;?php endif; ?&gt;
        &lt;/div&gt;
        
        &lt;button type="submit"&gt;Send Message&lt;/button&gt;
    &lt;/form&gt;
&lt;/body&gt;
&lt;/html&gt;</code></pre>
            </div>
            
            <div class="code-example">
                <h4>Form Processing File (process_contact.php)</h4>
                <pre><code>&lt;?php
// process_contact.php - Processes the contact form

session_start();

// Initialize errors array
$errors = [];

// Check if form was submitted
if ($_SERVER['REQUEST_METHOD'] === 'POST') {
    // Retrieve form data
    $name = $_POST['name'] ?? '';
    $email = $_POST['email'] ?? '';
    $message = $_POST['message'] ?? '';
    
    // Save form data in session for repopulating the form if there are errors
    $_SESSION['form_data'] = [
        'name' => $name,
        'email' => $email,
        'message' => $message
    ];
    
    // Validate inputs
    if (empty($name)) {
        $errors['name'] = 'Name is required';
    }
    
    if (empty($email)) {
        $errors['email'] = 'Email is required';
    } elseif (!filter_var($email, FILTER_VALIDATE_EMAIL)) {
        $errors['email'] = 'Invalid email format';
    }
    
    if (empty($message)) {
        $errors['message'] = 'Message is required';
    }
    
    // If there are errors, save them in session and redirect back to form
    if (!empty($errors)) {
        $_SESSION['form_errors'] = $errors;
        header('Location: contact_form.php');
        exit;
    }
    
    // Process the valid form data (e.g., send email, store in database)
    $success = sendContactEmail($name, $email, $message);
    
    if ($success) {
        // Set success flag and redirect
        $_SESSION['form_success'] = true;
        
        // Clear form data since submission was successful
        unset($_SESSION['form_data']);
        
        header('Location: contact_form.php');
        exit;
    } else {
        // If processing failed, set error and redirect
        $errors['general'] = 'There was an error processing your message. Please try again.';
        $_SESSION['form_errors'] = $errors;
        header('Location: contact_form.php');
        exit;
    }
} else {
    // If accessed directly without form submission, redirect to form
    header('Location: contact_form.php');
    exit;
}

// Example function to send email
function sendContactEmail($name, $email, $message) {
    // Implementation would go here
    // For this example, we'll just return true
    return true;
}
?&gt;</code></pre>
            </div>
            
            <div class="pros-cons">
                <h4>Pros and Cons of Separate Files Approach</h4>
                <div class="pros">
                    <h5>Pros:</h5>
                    <ul>
                        <li>Clean separation of concerns</li>
                        <li>Better organization in larger applications</li>
                        <li>Follows Post/Redirect/Get pattern to prevent form resubmission</li>
                    </ul>
                </div>
                <div class="cons">
                    <h5>Cons:</h5>
                    <ul>
                        <li>Requires session management for passing data between requests</li>
                        <li>More complex setup for simple forms</li>
                        <li>Multiple files to maintain</li>
                    </ul>
                </div>
            </div>
            
            <h3>Object-Oriented Approach</h3>
            <p>Using classes to encapsulate form handling logic:</p>
            <div class="code-example">
                <h4>Form Class (ContactForm.php)</h4>
                <pre><code>&lt;?php
// app/forms/ContactForm.php

class ContactForm {
    private $name;
    private $email;
    private $message;
    private $errors = [];
    
    // Constructor to initialize with form data
    public function __construct($formData = []) {
        $this->name = $formData['name'] ?? '';
        $this->email = $formData['email'] ?? '';
        $this->message = $formData['message'] ?? '';
    }
    
    // Validate form data
    public function validate() {
        // Reset errors array
        $this->errors = [];
        
        // Validate name
        if (empty($this->name)) {
            $this->errors['name'] = 'Name is required';
        }
        
        // Validate email
        if (empty($this->email)) {
            $this->errors['email'] = 'Email is required';
        } elseif (!filter_var($this->email, FILTER_VALIDATE_EMAIL)) {
            $this->errors['email'] = 'Invalid email format';
        }
        
        // Validate message
        if (empty($this->message)) {
            $this->errors['message'] = 'Message is required';
        }
        
        // Return whether validation passed
        return empty($this->errors);
    }
    
    // Process the form (e.g., send email)
    public function process() {
        if (!$this->validate()) {
            return false;
        }
        
        // Send the contact email
        $to = "contact@example.com";
        $subject = "Contact Form Submission from {$this->name}";
        $body = "Name: {$this->name}\n";
        $body .= "Email: {$this->email}\n\n";
        $body .= "Message:\n{$this->message}";
        $headers = "From: {$this->email}";
        
        return mail($to, $subject, $body, $headers);
    }
    
    // Getters
    public function getName() {
        return $this->name;
    }
    
    public function getEmail() {
        return $this->email;
    }
    
    public function getMessage() {
        return $this->message;
    }
    
    public function getErrors() {
        return $this->errors;
    }
    
    public function getError($field) {
        return $this->errors[$field] ?? '';
    }
    
    public function hasError($field) {
        return isset($this->errors[$field]);
    }
}
?&gt;</code></pre>
            </div>
            
            <div class="code-example">
                <h4>Controller File (contact.php)</h4>
                <pre><code>&lt;?php
// contact.php - Using the ContactForm class

// Include the form class
require_once 'app/forms/ContactForm.php';

session_start();

// Initialize variables
$success = false;
$form = null;

// Check if form was submitted
if ($_SERVER['REQUEST_METHOD'] === 'POST') {
    // Create form object with submitted data
    $form = new ContactForm($_POST);
    
    // Process the form
    if ($form->process()) {
        $success = true;
        // Create a new empty form for display
        $form = new ContactForm();
    }
} else {
    // If not submitted, create an empty form
    $form = new ContactForm();
}
?&gt;

&lt;!DOCTYPE html&gt;
&lt;html&gt;
&lt;head&gt;
    &lt;title&gt;Contact Us&lt;/title&gt;
&lt;/head&gt;
&lt;body&gt;
    &lt;h1&gt;Contact Us&lt;/h1&gt;
    
    &lt;?php if ($success): ?&gt;
        &lt;div class="success-message"&gt;
            Thank you for your message! We'll respond shortly.
        &lt;/div&gt;
    &lt;?php endif; ?&gt;
    
    &lt;form method="post" action=""&gt;
        &lt;div class="form-group"&gt;
            &lt;label for="name"&gt;Your Name:&lt;/label&gt;
            &lt;input type="text" id="name" name="name" value="&lt;?= htmlspecialchars($form->getName()) ?&gt;"&gt;
            &lt;?php if ($form->hasError('name')): ?&gt;
                &lt;span class="error"&gt;&lt;?= $form->getError('name') ?&gt;&lt;/span&gt;
            &lt;?php endif; ?&gt;
        &lt;/div&gt;
        
        &lt;div class="form-group"&gt;
            &lt;label for="email"&gt;Email Address:&lt;/label&gt;
            &lt;input type="email" id="email" name="email" value="&lt;?= htmlspecialchars($form->getEmail()) ?&gt;"&gt;
            &lt;?php if ($form->hasError('email')): ?&gt;
                &lt;span class="error"&gt;&lt;?= $form->getError('email') ?&gt;&lt;/span&gt;
            &lt;?php endif; ?&gt;
        &lt;/div&gt;
        
        &lt;div class="form-group"&gt;
            &lt;label for="message"&gt;Your Message:&lt;/label&gt;
            &lt;textarea id="message" name="message" rows="5"&gt;&lt;?= htmlspecialchars($form->getMessage()) ?&gt;&lt;/textarea&gt;
            &lt;?php if ($form->hasError('message')): ?&gt;
                &lt;span class="error"&gt;&lt;?= $form->getError('message') ?&gt;&lt;/span&gt;
            &lt;?php endif; ?&gt;
        &lt;/div&gt;
        
        &lt;button type="submit"&gt;Send Message&lt;/button&gt;
    &lt;/form&gt;
&lt;/body&gt;
&lt;/html&gt;</code></pre>
            </div>
            
            <div class="pros-cons">
                <h4>Pros and Cons of Object-Oriented Approach</h4>
                <div class="pros">
                    <h5>Pros:</h5>
                    <ul>
                        <li>Encapsulates form logic in reusable classes</li>
                        <li>Makes code more maintainable and testable</li>
                        <li>Promotes better organization in large applications</li>
                        <li>Can build form inheritance hierarchies for related forms</li>
                    </ul>
                </div>
                <div class="cons">
                    <h5>Cons:</h5>
                    <ul>
                        <li>More complex for simple forms</li>
                        <li>Requires good object-oriented design skills</li>
                        <li>May be overkill for small applications</li>
                    </ul>
                </div>
            </div>
        </section>
        
        <section class="ajax_forms">
            <h2>AJAX Form Processing</h2>
            
            <p>AJAX (Asynchronous JavaScript and XML) allows forms to be submitted without page reloads, providing a smoother user experience.</p>
            
            <div class="mermaid-diagram">
                <h3>Traditional vs. AJAX Form Submission</h3>
                <div class="mermaid">
flowchart TD
    subgraph "Traditional Form Submission"
    A1[User Fills Form] --> B1[Clicks Submit]
    B1 --> C1[Page Unloads]
    C1 --> D1[Server Processes Form]
    D1 --> E1[Server Generates New Page]
    E1 --> F1[Browser Loads New Page]
    end
    
    subgraph "AJAX Form Submission"
    A2[User Fills Form] --> B2[Clicks Submit]
    B2 --> C2[JavaScript Captures Form Data]
    C2 --> D2[AJAX Request to Server]
    D2 --> E2[Server Processes Form]
    E2 --> F2[Server Returns JSON Response]
    F2 --> G2[JavaScript Updates Page]
    end
                </div>
            </div>
            
            <h3>Implementing AJAX Form Submission</h3>
            <div class="code-example">
                <h4>HTML Form with AJAX</h4>
                <pre><code>&lt;!-- contact_form.html --&gt;
&lt;!DOCTYPE html&gt;
&lt;html&gt;
&lt;head&gt;
    &lt;title&gt;Contact Us - AJAX Form&lt;/title&gt;
    &lt;style&gt;
        .error { color: red; }
        .success { color: green; }
        .loading { color: blue; }
    &lt;/style&gt;
&lt;/head&gt;
&lt;body&gt;
    &lt;h1&gt;Contact Us&lt;/h1&gt;
    
    &lt;div id="form-messages"&gt;&lt;/div&gt;
    
    &lt;form id="contact-form" method="post" action="process_contact_ajax.php"&gt;
        &lt;div class="form-group"&gt;
            &lt;label for="name"&gt;Your Name:&lt;/label&gt;
            &lt;input type="text" id="name" name="name"&gt;
            &lt;span class="error" id="name-error"&gt;&lt;/span&gt;
        &lt;/div&gt;
        
        &lt;div class="form-group"&gt;
            &lt;label for="email"&gt;Email Address:&lt;/label&gt;
            &lt;input type="email" id="email" name="email"&gt;
            &lt;span class="error" id="email-error"&gt;&lt;/span&gt;
        &lt;/div&gt;
        
        &lt;div class="form-group"&gt;
            &lt;label for="message"&gt;Your Message:&lt;/label&gt;
            &lt;textarea id="message" name="message" rows="5"&gt;&lt;/textarea&gt;
            &lt;span class="error" id="message-error"&gt;&lt;/span&gt;
        &lt;/div&gt;
        
        &lt;button type="submit"&gt;Send Message&lt;/button&gt;
    &lt;/form&gt;
    
    &lt;script&gt;
    document.addEventListener('DOMContentLoaded', function() {
        const form = document.getElementById('contact-form');
        const formMessages = document.getElementById('form-messages');
        
        // Handle form submission
        form.addEventListener('submit', function(event) {
            event.preventDefault();
            
            // Clear previous error messages
            clearErrors();
            
            // Show loading message
            formMessages.textContent = 'Sending your message...';
            formMessages.className = 'loading';
            
            // Create FormData object
            const formData = new FormData(form);
            
            // Send AJAX request
            fetch(form.getAttribute('action'), {
                method: 'POST',
                body: formData
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    // Success
                    formMessages.textContent = data.message;
                    formMessages.className = 'success';
                    form.reset(); // Clear the form
                } else {
                    // Errors
                    formMessages.textContent = data.message;
                    formMessages.className = 'error';
                    
                    // Display field-specific errors
                    if (data.errors) {
                        for (const field in data.errors) {
                            const errorSpan = document.getElementById(field + '-error');
                            if (errorSpan) {
                                errorSpan.textContent = data.errors[field];
                            }
                        }
                    }
                }
            })
            .catch(error => {
                // AJAX error
                formMessages.textContent = 'There was an error processing your form. Please try again.';
                formMessages.className = 'error';
                console.error('Error:', error);
            });
        });
        
        // Function to clear error messages
        function clearErrors() {
            const errorElements = document.querySelectorAll('.error');
            errorElements.forEach(element => {
                element.textContent = '';
            });
        }
    });
    &lt;/script&gt;
&lt;/body&gt;
&lt;/html&gt;</code></pre>
            </div>
            
            <div class="code-example">
                <h4>PHP AJAX Handler</h4>
                <pre><code>&lt;?php
// process_contact_ajax.php - Processes AJAX contact form

// Set header to indicate JSON response
header('Content-Type: application/json');

// Initialize response array
$response = [
    'success' => false,
    'message' => '',
    'errors' => []
];

// Check if form was submitted via POST
if ($_SERVER['REQUEST_METHOD'] === 'POST') {
    // Retrieve form data
    $name = $_POST['name'] ?? '';
    $email = $_POST['email'] ?? '';
    $message = $_POST['message'] ?? '';
    
    // Validate inputs
    if (empty($name)) {
        $response['errors']['name'] = 'Name is required';
    }
    
    if (empty($email)) {
        $response['errors']['email'] = 'Email is required';
    } elseif (!filter_var($email, FILTER_VALIDATE_EMAIL)) {
        $response['errors']['email'] = 'Invalid email format';
    }
    
    if (empty($message)) {
        $response['errors']['message'] = 'Message is required';
    }
    
    // If no errors, process the form
    if (empty($response['errors'])) {
        // Process the form (e.g., send email, store in database)
        $success = sendContactEmail($name, $email, $message);
        
        if ($success) {
            $response['success'] = true;
            $response['message'] = 'Thank you for your message! We\'ll respond shortly.';
        } else {
            $response['message'] = 'There was an error sending your message. Please try again.';
        }
    } else {
        $response['message'] = 'Please correct the errors in the form.';
    }
} else {
    // If not accessed via POST
    $response['message'] = 'Invalid request method.';
}

// Function to send email (example)
function sendContactEmail($name, $email, $message) {
    // Implementation would go here
    // For this example, we'll just return true
    return true;
}

// Return JSON response
echo json_encode($response);
?&gt;</code></pre>
            </div>
            
            <div class="pros-cons">
                <h4>Pros and Cons of AJAX Form Processing</h4>
                <div class="pros">
                    <h5>Pros:</h5>
                    <ul>
                        <li>Better user experience with no page reloads</li>
                        <li>Real-time form validation feedback</li>
                        <li>Ability to submit forms without losing context</li>
                        <li>Can show loading indicators during processing</li>
                    </ul>
                </div>
                <div class="cons">
                    <h5>Cons:</h5>
                    <ul>
                        <li>Requires JavaScript (though you should always have a non-JS fallback)</li>
                        <li>More complex to implement</li>
                        <li>Can be more difficult to debug</li>
                        <li>May need to handle browser history manually</li>
                    </ul>
                </div>
            </div>
        </section>
        
        <section class="advanced_techniques">
            <h2>Advanced User Input Processing Techniques</h2>
            
            <h3>File Uploads</h3>
            <p>Handling file uploads requires special considerations:</p>
            <div class="code-example">
                <h4>File Upload Form</h4>
                <pre><code>&lt;!-- file_upload_form.php --&gt;
&lt;!DOCTYPE html&gt;
&lt;html&gt;
&lt;head&gt;
    &lt;title&gt;File Upload Example&lt;/title&gt;
&lt;/head&gt;
&lt;body&gt;
    &lt;h1&gt;Upload Profile Image&lt;/h1&gt;
    
    &lt;?php
    // Display errors if any
    if (isset($_GET['error'])) {
        echo '&lt;div class="error"&gt;' . htmlspecialchars($_GET['error']) . '&lt;/div&gt;';
    }
    
    // Display success message if any
    if (isset($_GET['success'])) {
        echo '&lt;div class="success"&gt;' . htmlspecialchars($_GET['success']) . '&lt;/div&gt;';
    }
    ?&gt;
    
    &lt;form method="post" action="process_file_upload.php" enctype="multipart/form-data"&gt;
        &lt;!-- Important: enctype="multipart/form-data" is required for file uploads --&gt;
        
        &lt;div class="form-group"&gt;
            &lt;label for="profile_image"&gt;Select Image:&lt;/label&gt;
            &lt;input type="file" id="profile_image" name="profile_image" accept="image/*"&gt;
            &lt;p class="help-text"&gt;Allowed formats: JPG, PNG, GIF. Max size: 2MB.&lt;/p&gt;
        &lt;/div&gt;
        
        &lt;!-- Optional: Add a MAX_FILE_SIZE hidden field (client-side limitation) --&gt;
        &lt;input type="hidden" name="MAX_FILE_SIZE" value="2097152"&gt; &lt;!-- 2MB in bytes --&gt;
        
        &lt;button type="submit"&gt;Upload Image&lt;/button&gt;
    &lt;/form&gt;
&lt;/body&gt;
&lt;/html&gt;</code></pre>
            </div>
            
            <div class="code-example">
                <h4>File Upload Processing</h4>
                <pre><code>&lt;?php
// process_file_upload.php

// Check if a file was uploaded
if ($_SERVER['REQUEST_METHOD'] === 'POST' && isset($_FILES['profile_image'])) {
    // Get file information
    $file = $_FILES['profile_image'];
    
    // Check for upload errors
    if ($file['error'] !== UPLOAD_ERR_OK) {
        $errorMessage = getUploadErrorMessage($file['error']);
        header("Location: file_upload_form.php?error=" . urlencode($errorMessage));
        exit;
    }
    
    // Validate file type
    $allowedTypes = ['image/jpeg', 'image/png', 'image/gif'];
    $fileType = mime_content_type($file['tmp_name']);
    
    if (!in_array($fileType, $allowedTypes)) {
        $errorMessage = "Invalid file type. Only JPG, PNG, and GIF are allowed.";
        header("Location: file_upload_form.php?error=" . urlencode($errorMessage));
        exit;
    }
    
    // Validate file size (server-side check)
    $maxSize = 2 * 1024 * 1024; // 2MB in bytes
    if ($file['size'] > $maxSize) {
        $errorMessage = "File is too large. Maximum size is 2MB.";
        header("Location: file_upload_form.php?error=" . urlencode($errorMessage));
        exit;
    }
    
    // Generate unique filename to prevent overwriting
    $uploadDir = 'uploads/';
    $fileExtension = pathinfo($file['name'], PATHINFO_EXTENSION);
    $uniqueName = uniqid() . '.' . $fileExtension;
    $uploadPath = $uploadDir . $uniqueName;
    
    // Create upload directory if it doesn't exist
    if (!is_dir($uploadDir)) {
        mkdir($uploadDir, 0755, true);
    }
    
    // Move the uploaded file to the destination
    if (move_uploaded_file($file['tmp_name'], $uploadPath)) {
        // Success - file was uploaded
        $successMessage = "File uploaded successfully!";
        header("Location: file_upload_form.php?success=" . urlencode($successMessage));
        exit;
    } else {
        // Error moving the file
        $errorMessage = "Failed to move uploaded file. Please try again.";
        header("Location: file_upload_form.php?error=" . urlencode($errorMessage));
        exit;
    }
} else {
    // No file uploaded or direct access
    header("Location: file_upload_form.php");
    exit;
}


function getUploadErrorMessage($errorCode) {
    switch ($errorCode) {
        case UPLOAD_ERR_INI_SIZE:
            return "The uploaded file exceeds the upload_max_filesize directive in php.ini.";
        case UPLOAD_ERR_FORM_SIZE:
            return "The// Function to get human-readable upload error messages
            function getUploadErrorMessage($errorCode) {
                switch ($errorCode) {
                    case UPLOAD_ERR_INI_SIZE:
                        return "The uploaded file exceeds the upload_max_filesize directive in php.ini.";
                    case UPLOAD_ERR_FORM_SIZE:
                        return "The uploaded file exceeds the MAX_FILE_SIZE directive in the HTML form.";
                    case UPLOAD_ERR_PARTIAL:
                        return "The uploaded file was only partially uploaded.";
                    case UPLOAD_ERR_NO_FILE:
                        return "No file was uploaded.";
                    case UPLOAD_ERR_NO_TMP_DIR:
                        return "Missing a temporary folder.";
                    case UPLOAD_ERR_CANT_WRITE:
                        return "Failed to write file to disk.";
                    case UPLOAD_ERR_EXTENSION:
                        return "A PHP extension stopped the file upload.";
                    default:
                        return "Unknown upload error.";
                }
            }
            
            // Security considerations for file uploads
            function secureFileUpload($file, $uploadDir, $allowedTypes) {
                // Generate random filename instead of using original
                $fileExtension = pathinfo($file['name'], PATHINFO_EXTENSION);
                $uniqueName = bin2hex(random_bytes(16)) . '.' . $fileExtension;
                $uploadPath = $uploadDir . $uniqueName;
                
                // Verify MIME type using PHP's fileinfo extension
                $finfo = new finfo(FILEINFO_MIME_TYPE);
                $fileType = $finfo->file($file['tmp_name']);
                
                if (!in_array($fileType, $allowedTypes)) {
                    return [false, "Invalid file type"];
                }
                
                // Perform additional security checks
                // For example, scan for malware or check image dimensions for image files
                
                // Move to final destination
                if (move_uploaded_file($file['tmp_name'], $uploadPath)) {
                    return [true, $uniqueName];
                } else {
                    return [false, "Failed to save file"];
                }
            }
          </div>
            
          <h3>Common File Upload Error Codes</h3>
          <table>
              <thead>
                  <tr>
                      <th>Constant</th>
                      <th>Value</th>
                      <th>Description</th>
                  </tr>
              </thead>
              <tbody>
                  <tr>
                      <td>UPLOAD_ERR_OK</td>
                      <td>0</td>
                      <td>File uploaded successfully</td>
                  </tr>
                  <tr>
                      <td>UPLOAD_ERR_INI_SIZE</td>
                      <td>1</td>
                      <td>File exceeds the upload_max_filesize directive in php.ini</td>
                  </tr>
                  <tr>
                      <td>UPLOAD_ERR_FORM_SIZE</td>
                      <td>2</td>
                      <td>File exceeds the MAX_FILE_SIZE directive in the HTML form</td>
                  </tr>
                  <tr>
                      <td>UPLOAD_ERR_PARTIAL</td>
                      <td>3</td>
                      <td>File was only partially uploaded</td>
                  </tr>
                  <tr>
                      <td>UPLOAD_ERR_NO_FILE</td>
                      <td>4</td>
                      <td>No file was uploaded</td>
                  </tr>
                  <tr>
                      <td>UPLOAD_ERR_NO_TMP_DIR</td>
                      <td>6</td>
                      <td>Missing a temporary folder</td>
                  </tr>
                  <tr>
                      <td>UPLOAD_ERR_CANT_WRITE</td>
                      <td>7</td>
                      <td>Failed to write file to disk</td>
                  </tr>
                  <tr>
                      <td>UPLOAD_ERR_EXTENSION</td>
                      <td>8</td>
                      <td>A PHP extension stopped the file upload</td>
                  </tr>
              </tbody>
          </table>
          
          <div class="note">
              <h4>File Upload Security Best Practices</h4>
              <ul>
                  <li><strong>Validate file types:</strong> Always check both file extension and MIME type</li>
                  <li><strong>Use whitelist approach:</strong> Only allow specific file types rather than blacklisting dangerous ones</li>
                  <li><strong>Generate random filenames:</strong> Never use user-provided filenames directly</li>
                  <li><strong>Store files outside web root:</strong> If possible, store uploaded files in a location not directly accessible via URL</li>
                  <li><strong>Set appropriate permissions:</strong> Make sure uploaded files cannot be executed</li>
                  <li><strong>Scan for malware:</strong> Consider implementing virus scanning for uploaded files</li>
                  <li><strong>Set file size limits:</strong> Both in HTML form and server configuration</li>
                  <li><strong>Process images:</strong> For image uploads, consider resizing or recompressing to remove any embedded malicious code</li>
              </ul>
          </div>
          
          <h3>Form Validation Libraries</h3>
          <p>For complex forms, consider using validation libraries:</p>
          <ul>
              <li><strong>PHP's built-in Validation Classes:</strong> Available for modern PHP (8.2+)</li>
              <li><strong>Respect\Validation:</strong> A versatile validation library</li>
              <li><strong>Symfony Validator Component:</strong> Powerful validation from the Symfony framework</li>
              <li><strong>Laravel Validator:</strong> Laravel's validation system</li>
          </ul>
          
          <div class="code-example">
              <h4>Respect\Validation Example</h4>
              <pre><code>&lt;?php
// Using Respect\Validation

// Include via Composer's autoloader
require 'vendor/autoload.php';

use Respect\Validation\Validator as v;

// Process a registration form
if ($_SERVER['REQUEST_METHOD'] === 'POST') {
  $username = $_POST['username'] ?? '';
  $email = $_POST['email'] ?? '';
  $age = $_POST['age'] ?? '';
  $password = $_POST['password'] ?? '';
  
  try {
      // Validate username
      v::alnum()
          ->noWhitespace()
          ->length(3, 20)
          ->check($username);
      
      // Validate email
      v::email()
          ->check($email);
      
      // Validate age
      v::numeric()
          ->positive()
          ->between(18, 120)
          ->check($age);
      
      // Validate password
      v::length(8, null)
          ->check($password);
      
      // If we get here, all validations passed
      echo "All validations passed!";
  } catch (\Respect\Validation\Exceptions\ValidationException $exception) {
      echo $exception->getMessage();
  }
}
?&gt;</code></pre>
          </div>
          
          <h3>Dynamic Form Generation</h3>
          <p>Creating forms dynamically based on data structures:</p>
          <div class="code-example">
              <pre><code>&lt;?php
// Dynamic form generation based on a schema

// Form field definition schema
$formFields = [
  'name' => [
      'type' => 'text',
      'label' => 'Your Name',
      'required' => true,
      'validation' => ['required', 'max:50']
  ],
  'email' => [
      'type' => 'email',
      'label' => 'Email Address',
      'required' => true,
      'validation' => ['required', 'email']
  ],
  'age' => [
      'type' => 'number',
      'label' => 'Age',
      'min' => 18,
      'max' => 120,
      'validation' => ['required', 'numeric', 'min:18', 'max:120']
  ],
  'interests' => [
      'type' => 'checkbox',
      'label' => 'Interests',
      'options' => [
          'tech' => 'Technology',
          'sports' => 'Sports',
          'music' => 'Music',
          'art' => 'Art'
      ],
      'validation' => ['array']
  ],
  'country' => [
      'type' => 'select',
      'label' => 'Country',
      'options' => [
          'us' => 'United States',
          'ca' => 'Canada',
          'mx' => 'Mexico',
          'other' => 'Other'
      ],
      'validation' => ['required']
  ],
  'message' => [
      'type' => 'textarea',
      'label' => 'Message',
      'rows' => 5,
      'validation' => ['max:500']
  ]
];

// Function to generate form HTML from schema
function generateFormField($name, $field, $value = '') {
  $required = $field['required'] ?? false ? 'required' : '';
  $html = '<div class="form-group">';
  $html .= '<label for="' . $name . '">' . $field['label'] . ($required ? ' *' : '') . ':</label>';
  
  switch ($field['type']) {
      case 'text':
      case 'email':
      case 'number':
      case 'date':
      case 'password':
          $min = isset($field['min']) ? 'min="' . $field['min'] . '"' : '';
          $max = isset($field['max']) ? 'max="' . $field['max'] . '"' : '';
          $html .= '<input type="' . $field['type'] . '" id="' . $name . '" name="' . $name . '" value="' . htmlspecialchars($value) . '" ' . $required . ' ' . $min . ' ' . $max . '>';
          break;
          
      case 'textarea':
          $rows = $field['rows'] ?? 3;
          $html .= '<textarea id="' . $name . '" name="' . $name . '" rows="' . $rows . '" ' . $required . '>' . htmlspecialchars($value) . '</textarea>';
          break;
          
      case 'select':
          $html .= '<select id="' . $name . '" name="' . $name . '" ' . $required . '>';
          $html .= '<option value="">Select ' . $field['label'] . '</option>';
          
          foreach ($field['options'] as $optionValue => $optionLabel) {
              $selected = $value == $optionValue ? 'selected' : '';
              $html .= '<option value="' . $optionValue . '" ' . $selected . '>' . $optionLabel . '</option>';
          }
          
          $html .= '</select>';
          break;
          
      case 'checkbox':
      case 'radio':
          foreach ($field['options'] as $optionValue => $optionLabel) {
              $checked = '';
              if ($field['type'] == 'checkbox') {
                  $checked = is_array($value) && in_array($optionValue, $value) ? 'checked' : '';
                  $html .= '<div class="' . $field['type'] . '-option">';
                  $html .= '<input type="' . $field['type'] . '" id="' . $name . '_' . $optionValue . '" name="' . $name . '[]" value="' . $optionValue . '" ' . $checked . '>';
              } else {
                  $checked = $value == $optionValue ? 'checked' : '';
                  $html .= '<div class="' . $field['type'] . '-option">';
                  $html .= '<input type="' . $field['type'] . '" id="' . $name . '_' . $optionValue . '" name="' . $name . '" value="' . $optionValue . '" ' . $checked . '>';
              }
              $html .= '<label for="' . $name . '_' . $optionValue . '">' . $optionLabel . '</label>';
              $html .= '</div>';
          }
          break;
  }
  
  $html .= '</div>';
  return $html;
}

// Function to validate form data based on schema rules
function validateFormData($data, $schema) {
  $errors = [];
  
  foreach ($schema as $field => $rules) {
      $validation = $rules['validation'] ?? [];
      $value = $data[$field] ?? null;
      
      foreach ($validation as $rule) {
          // Simple rule parsing (would be more complex in real application)
          if ($rule == 'required' && empty($value)) {
              $errors[$field] = $rules['label'] . ' is required';
          } elseif ($rule == 'email' && !filter_var($value, FILTER_VALIDATE_EMAIL)) {
              $errors[$field] = 'Invalid email format';
          } elseif ($rule == 'numeric' && !is_numeric($value)) {
              $errors[$field] = $rules['label'] . ' must be a number';
          } elseif ($rule == 'array' && !is_array($value)) {
              $errors[$field] = 'Invalid selection';
          } elseif (strpos($rule, 'min:') === 0) {
              $min = (int)substr($rule, 4);
              if (is_numeric($value) && $value < $min) {
                  $errors[$field] = $rules['label'] . ' must be at least ' . $min;
              }
          } elseif (strpos($rule, 'max:') === 0) {
              $max = (int)substr($rule, 4);
              if (is_string($value) && strlen($value) > $max) {
                  $errors[$field] = $rules['label'] . ' must be less than ' . $max . ' characters';
              } elseif (is_numeric($value) && $value > $max) {
                  $errors[$field] = $rules['label'] . ' must be less than ' . $max;
              }
          }
      }
  }
  
  return $errors;
}
?&gt;

&lt;!-- Using the dynamic form generator --&gt;
&lt;form method="post" action=""&gt;
  &lt;?php
  // Generate form fields from schema
  foreach ($formFields as $name => $field) {
      $value = $_POST[$name] ?? '';
      echo generateFormField($name, $field, $value);
  }
  ?&gt;
  
  &lt;button type="submit"&gt;Submit&lt;/button&gt;
&lt;/form&gt;</code></pre>
          </div>
      </section>
      
      <section class="conclusion">
          <h2>Conclusion and Next Steps</h2>
          
          <p>Proper implementation of user input and processing is crucial for creating dynamic, interactive PHP applications that provide excellent user experiences while maintaining security and data integrity.</p>
          
          <h3>Key Takeaways</h3>
          <ul>
              <li><strong>Security First:</strong> Always prioritize security when handling user input by implementing proper validation and sanitization.</li>
              <li><strong>User Experience:</strong> Design intuitive forms with appropriate feedback and error messages.</li>
              <li><strong>Separation of Concerns:</strong> Separate form display from form processing logic when possible.</li>
              <li><strong>Validation Strategy:</strong> Implement both client-side and server-side validation, never trusting client-side validation alone.</li>
              <li><strong>Error Handling:</strong> Provide clear, user-friendly error messages that guide the user toward successful form completion.</li>
              <li><strong>Data Persistence:</strong> Ensure form data persists between submissions when there are validation errors.</li>
          </ul>
          
          <h3>Next Topics to Explore</h3>
          <p>In our next session, we'll build on these concepts as we delve into working with sessions and cookies, which will allow us to maintain state across multiple page requests and provide a personalized experience for users.</p>
          
          <div class="mermaid-diagram">
              <h3>Interconnected Topics</h3>
              <div class="mermaid">
mindmap
root((User Input))
  Form Processing
    Validation
    Sanitization
    Error Handling
  Data Storage
    Databases
    Files
    Sessions
  User Experience
    Feedback
    Accessibility
    Performance
  Security
    Input Validation
    Session Security
    SQL Injection Prevention
    XSS Prevention
  Advanced Techniques
    AJAX
    File Uploads
    Multi-step Forms
              </div>
          </div>
          
          <div class="note">
              <h3>Real-world Considerations</h3>
              <p>When implementing user input processing in production applications:</p>
              <ul>
                  <li>Consider accessibility requirements (WCAG) for forms</li>
                  <li>Implement Cross-Site Request Forgery (CSRF) protection</li>
                  <li>Use prepared statements for all database operations</li>
                  <li>Implement rate limiting for form submissions to prevent abuse</li>
                  <li>Consider using established validation libraries rather than building your own</li>
                  <li>Test forms thoroughly on different browsers and devices</li>
                  <li>Implement appropriate logging for form submissions and errors</li>
              </ul>
          </div>
          
          <section class="assignment">
              <h3>Practice Assignment</h3>
              <div class="assignment_details">
                  <h4>Form Implementation Challenge</h4>
                  <p>Create a registration form for a fictional web application that includes:</p>
                  <ol>
                      <li>Personal information fields (name, email, birthday)</li>
                      <li>Address information</li>
                      <li>Account setup (username, password with confirmation)</li>
                      <li>Preferences (checkboxes for receiving newsletters, etc.)</li>
                      <li>Terms of service agreement</li>
                  </ol>
                  
                  <p><strong>Requirements:</strong></p>
                  <ul>
                      <li>Implement both client-side and server-side validation</li>
                      <li>Display appropriate error messages</li>
                      <li>Maintain form state on validation errors</li>
                      <li>Sanitize all input before processing</li>
                      <li>Use appropriate input types for different data</li>
                      <li>Implement at least one of the form processing patterns covered in the lecture</li>
                  </ul>
                  
                  <p><strong>Bonus Challenge:</strong></p>
                  <ul>
                      <li>Convert the form to a multi-step form</li>
                      <li>Add AJAX validation for username availability</li>
                      <li>Implement a profile picture upload with proper validation</li>
                  </ul>
              </div>
          </section>
          
          <section class="resources">
              <h3>Additional Resources</h3>
              <ul>
                  <li><a href="https://www.php.net/manual/en/filter.filters.php">PHP Filter Functions Documentation</a></li>
                  <li><a href="https://respect-validation.readthedocs.io/">Respect\Validation Documentation</a></li>
                  <li><a href="https://www.owasp.org/index.php/Input_Validation_Cheat_Sheet">OWASP Input Validation Cheat Sheet</a></li>
                  <li><a href="https://developer.mozilla.org/en-US/docs/Learn/Forms">MDN Web Forms Guide</a></li>
                  <li><a href="https://symfony.com/doc/current/components/form.html">Symfony Form Component</a></li>
              </ul>
          </section>
      </section>
  </main>
  
  <footer>
      <p>&copy; 2025 PHP WordPress Development Course</p>
 
  </footer>
</body>
</html>
