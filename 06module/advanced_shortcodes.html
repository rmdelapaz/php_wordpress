<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    
    <!-- SEO Meta Tags -->
    <title>Advanced Shortcodes - Shortcodes and Widgets - PHP WordPress Course</title>
    <meta name="description" content="Learn advanced WordPress shortcode techniques including nested shortcodes, AJAX integration, dynamic content, and complex implementations.">
    <meta name="keywords" content="PHP, WordPress, advanced shortcodes, nested shortcodes, AJAX, plugin development">
    <meta name="author" content="PHP WordPress Course">
    
    <!-- Favicon -->
    <link rel="icon" type="image/png" href="/favicon.png">
    <link rel="apple-touch-icon" href="/favicon.png">
    
    <!-- CSS -->
    <link rel="stylesheet" href="/assets/css/main.css">
    <link rel="stylesheet" href="/assets/css/sidebar-enhanced.css">
    <link rel="stylesheet" href="/assets/css/sidebar-toggle.css">
    
    <!-- Custom styles for this lesson -->
    <style>
        .advanced-header {
            background: linear-gradient(135deg, #f97316 0%, #dc2626 100%);
            color: white;
            padding: 3rem 2rem;
            border-radius: 12px;
            margin-bottom: 2rem;
            text-align: center;
        }

        .advanced-concept {
            background: white;
            border: 2px solid #e5e7eb;
            border-radius: 12px;
            padding: 2rem;
            margin: 2rem 0;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }

        .advanced-concept h3 {
            color: #dc2626;
            margin-top: 0;
            border-bottom: 2px solid #e5e7eb;
            padding-bottom: 1rem;
        }

        .code-example {
            background: #1e293b;
            color: #e2e8f0;
            padding: 1.5rem;
            border-radius: 8px;
            margin: 1.5rem 0;
            overflow-x: auto;
        }

        .code-example pre {
            margin: 0;
            white-space: pre-wrap;
        }

        .nesting-diagram {
            background: linear-gradient(135deg, #fef3c7 0%, #fed7aa 100%);
            border: 2px solid #f97316;
            border-radius: 8px;
            padding: 1.5rem;
            margin: 1.5rem 0;
        }

        .nesting-level {
            background: white;
            border: 1px solid #f97316;
            border-radius: 6px;
            padding: 1rem;
            margin: 0.5rem 0;
        }

        .nesting-level-2 {
            margin-left: 2rem;
            background: #fff7ed;
        }

        .nesting-level-3 {
            margin-left: 4rem;
            background: #ffedd5;
        }

        .ajax-demo {
            background: linear-gradient(135deg, #e0e7ff 0%, #c7d2fe 100%);
            border: 2px solid #6366f1;
            border-radius: 8px;
            padding: 1.5rem;
            margin: 1.5rem 0;
        }

        .ajax-demo h4 {
            color: #4f46e5;
            margin-top: 0;
        }

        .performance-box {
            background: #f0f9ff;
            border: 2px solid #0ea5e9;
            border-radius: 8px;
            padding: 1.5rem;
            margin: 1.5rem 0;
        }

        .performance-box h4 {
            color: #0284c7;
            margin-top: 0;
        }

        .security-alert {
            background: linear-gradient(135deg, #fee2e2 0%, #fecaca 100%);
            border: 2px solid #ef4444;
            border-radius: 8px;
            padding: 1.5rem;
            margin: 1.5rem 0;
        }

        .security-alert h4 {
            color: #dc2626;
            margin-top: 0;
        }

        .tip-box {
            background: #f0fdf4;
            border: 2px solid #10b981;
            border-radius: 8px;
            padding: 1rem;
            margin: 1.5rem 0;
        }

        .warning-box {
            background: #fef3c7;
            border: 2px solid #fbbf24;
            border-radius: 8px;
            padding: 1rem;
            margin: 1.5rem 0;
        }

        .technique-cards {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 1.5rem;
            margin: 2rem 0;
        }

        .technique-card {
            background: white;
            border: 2px solid #e5e7eb;
            border-radius: 8px;
            padding: 1.5rem;
            transition: transform 0.2s;
        }

        .technique-card:hover {
            transform: translateY(-4px);
            box-shadow: 0 8px 16px rgba(0, 0, 0, 0.1);
        }

        .technique-card h4 {
            color: #f97316;
            margin-top: 0;
        }

        .shortcode-output-preview {
            background: white;
            border: 2px solid #e5e7eb;
            border-radius: 6px;
            padding: 1rem;
            margin: 1rem 0;
        }

        .shortcode-output-preview h5 {
            color: #6b7280;
            font-size: 0.875rem;
            margin-top: 0;
            text-transform: uppercase;
        }
    </style>
</head>
<body>
    <!-- Skip to main content -->
    <a href="#main-content" class="sr-only">Skip to main content</a>
    
    <div class="page-wrapper">
        <!-- Header -->
        <header class="site-header" role="banner">
            <div class="header-container">
                <div class="site-branding">
                    <a href="/" class="site-logo">
                        <h1 class="site-title">PHP WordPress Development</h1>
                    </a>
                </div>
                
                <nav class="main-navigation" role="navigation" aria-label="Main navigation">
                    <button class="mobile-menu-btn" aria-label="Toggle navigation" aria-expanded="false">
                        <span></span>
                        <span></span>
                        <span></span>
                    </button>
                    
                    <div class="nav-menu">
                        <ul class="nav-list">
                            <li class="nav-item"><a href="/" class="nav-link">Home</a></li>
                            <li class="nav-item dropdown">
                                <button class="nav-link dropdown-toggle active" aria-haspopup="true">Modules</button>
                                <div class="dropdown-menu">
                                    <a href="/module1.html" class="dropdown-item">Module 1: Web Fundamentals</a>
                                    <a href="/module2.html" class="dropdown-item">Module 2: PHP Fundamentals</a>
                                    <a href="/module3.html" class="dropdown-item">Module 3: MySQL Database</a>
                                    <a href="/module4.html" class="dropdown-item">Module 4: WordPress & Docker</a>
                                    <a href="/module5.html" class="dropdown-item">Module 5: Theme Development</a>
                                    <a href="/module6.html" class="dropdown-item active">Module 6: Plugin Development</a>
                                    <a href="/module7.html" class="dropdown-item">Module 7: Advanced WordPress</a>
                                    <a href="/module8.html" class="dropdown-item">Module 8: Deployment</a>
                                    <a href="/module9.html" class="dropdown-item">Module 9: Final Project</a>
                                </div>
                            </li>
                            <li class="nav-item"><a href="/resources.html" class="nav-link">Resources</a></li>
                            <li class="nav-item"><a href="/about.html" class="nav-link">About</a></li>
                        </ul>
                    </div>
                </nav>
                
                <div class="search-container">
                    <div class="search-input-wrapper">
                        <svg class="search-icon" width="20" height="20" viewBox="0 0 20 20" fill="currentColor">
                            <path fill-rule="evenodd" d="M8 4a4 4 0 100 8 4 4 0 000-8zM2 8a6 6 0 1110.89 3.476l4.817 4.817a1 1 0 01-1.414 1.414l-4.816-4.816A6 6 0 012 8z" clip-rule="evenodd" />
                        </svg>
                        <input type="search" class="search-input" placeholder="Search lessons..." aria-label="Search">
                    </div>
                    <div class="search-results"></div>
                </div>
            </div>
        </header>
        
        <!-- Progress Bar -->
        <div class="progress-container">
            <div class="progress-header">
                <h2 class="progress-title">Course Progress</h2>
                <span class="progress-text">Loading...</span>
            </div>
            <div class="progress-bar">
                <div class="progress-bar-fill">
                    <span class="progress-bar-text"></span>
                </div>
            </div>
        </div>
        
        <!-- Breadcrumb -->
        <nav class="breadcrumb container" aria-label="Breadcrumb">
            <ol class="breadcrumb-list">
                <li class="breadcrumb-item">
                    <a href="/">Home</a>
                    <span class="breadcrumb-separator">/</span>
                </li>
                <li class="breadcrumb-item">
                    <a href="/module6.html">Module 6</a>
                    <span class="breadcrumb-separator">/</span>
                </li>
                <li class="breadcrumb-item">
                    <span aria-current="page">Advanced Shortcodes</span>
                </li>
            </ol>
        </nav>
        
        <!-- Main Content -->
        <main id="main-content" class="main-content" role="main">
            <div class="container">
                <div class="content-with-sidebar">
                    <!-- Sidebar -->
                    <aside class="sidebar">
                        <div class="sidebar-nav">
                            <h3 class="sidebar-title">Module 6: Plugin Development</h3>
                            <div class="sidebar-section">
                                <h4 class="sidebar-section-title">Session 5: Shortcodes and Widgets</h4>
                                <ul class="sidebar-menu">
                                    <li><a class="sidebar-link" href="/06module/introduction_to_shortcodes.html">Introduction to Shortcodes</a></li>
                                    <li><a class="sidebar-link" href="/06module/shortcode_attributes.html">Shortcode Attributes</a></li>
                                    <li class="active"><a class="sidebar-link active" href="/06module/advanced_shortcodes.html">Advanced Shortcodes</a></li>
                                    <li><a class="sidebar-link" href="/06module/creating_widgets.html">Creating Widgets</a></li>
                                    <li><a class="sidebar-link" href="/06module/widget_settings.html">Widget Settings & Forms</a></li>
                                    <li><a class="sidebar-link" href="/06module/widget_output.html">Widget Output & Styling</a></li>
                                    <li><a class="sidebar-link" href="/06module/homework_shortcode_widget.html">Homework: Shortcode & Widget Plugin</a></li>
                                </ul>
                            </div>
                            <div class="sidebar-section">
                                <h4 class="sidebar-section-title">Quick Links</h4>
                                <ul class="sidebar-menu">
                                    <li><a class="sidebar-link" href="/module6.html">Module Overview</a></li>
                                    <li><a class="sidebar-link" href="/06module/shortcode_attributes.html">← Previous Lesson</a></li>
                                    <li><a class="sidebar-link next-session" href="/06module/creating_widgets.html">Next Lesson →</a></li>
                                    <li><a class="sidebar-link" href="/">← Course Home</a></li>
                                    <li><a class="sidebar-link" href="/resources.html">Resources</a></li>
                                </ul>
                            </div>
                        </div>
                    </aside>
                    
                    <!-- Main Lesson Content -->
                    <article class="lesson-content">
                        <div class="advanced-header">
                            <h1>🚀 Advanced Shortcodes</h1>
                            <p class="lead">Master complex shortcode implementations</p>
                            <p>Learn nested shortcodes, AJAX integration, and performance optimization</p>
                        </div>

                        <!-- Learning Objectives -->
                        <div class="lesson-objectives">
                            <h2>Learning Objectives</h2>
                            <ul>
                                <li>Create and handle nested shortcodes</li>
                                <li>Implement AJAX-powered shortcodes</li>
                                <li>Build dynamic content shortcodes</li>
                                <li>Optimize shortcode performance</li>
                                <li>Handle complex data structures</li>
                                <li>Create shortcode generators</li>
                                <li>Debug complex shortcode issues</li>
                            </ul>
                        </div>
                        
                        <!-- Lesson Body -->
                        <div class="lesson-body">
                            <!-- Nested Shortcodes -->
                            <section>
                                <h2>Nested Shortcodes</h2>
                                <p class="lead">Nested shortcodes allow you to create complex, hierarchical content structures. They're perfect for layouts, accordions, tabs, and other compound elements.</p>
                                
                                <div class="nesting-diagram">
                                    <h4>Nesting Structure Example</h4>
                                    <div class="nesting-level">
                                        [tabs] <em>← Parent shortcode</em>
                                        <div class="nesting-level-2">
                                            [tab title="First Tab"]Content 1[/tab] <em>← Child shortcode</em>
                                        </div>
                                        <div class="nesting-level-2">
                                            [tab title="Second Tab"]Content 2[/tab] <em>← Child shortcode</em>
                                        </div>
                                        <div class="nesting-level-2">
                                            [tab title="Third Tab"]
                                            <div class="nesting-level-3">
                                                [button]Click Me[/button] <em>← Nested within child</em>
                                            </div>
                                            [/tab]
                                        </div>
                                        [/tabs]
                                    </div>
                                </div>
                                
                                <div class="advanced-concept">
                                    <h3>Implementing Tabs with Nested Shortcodes</h3>
                                    
                                    <div class="code-example">
                                        <pre><code class="language-php">// Parent shortcode for tabs container
function tabs_shortcode( $atts, $content = null ) {
    static $tab_group_id = 0;
    $tab_group_id++;
    
    $atts = shortcode_atts( array(
        'type' => 'horizontal', // horizontal, vertical
        'style' => 'default',    // default, pills, underline
        'active' => 1,           // Which tab is active by default
    ), $atts, 'tabs' );
    
    // Process nested shortcodes first
    $content = do_shortcode( $content );
    
    // Parse individual tabs from processed content
    global $tabs_data;
    $tabs_data = array();
    
    // Use regex to extract tab data
    preg_match_all( '/\[tab_processed title="([^"]+)" id="([^"]+)"\](.*?)\[\/tab_processed\]/s', $content, $matches );
    
    $output = '<div class="tabs-container tabs-' . esc_attr( $atts['style'] ) . '" data-tabs-id="' . $tab_group_id . '">';
    
    // Build tab navigation
    $output .= '<ul class="tab-nav nav-' . esc_attr( $atts['type'] ) . '">';
    foreach ( $matches[1] as $index => $title ) {
        $active_class = ( $index + 1 == $atts['active'] ) ? ' active' : '';
        $output .= '<li class="tab-nav-item' . $active_class . '">';
        $output .= '<a href="#tab-' . $tab_group_id . '-' . ($index + 1) . '" data-tab="' . ($index + 1) . '">';
        $output .= esc_html( $title );
        $output .= '</a></li>';
    }
    $output .= '</ul>';
    
    // Build tab content panels
    $output .= '<div class="tab-content">';
    foreach ( $matches[3] as $index => $tab_content ) {
        $active_class = ( $index + 1 == $atts['active'] ) ? ' active' : '';
        $output .= '<div id="tab-' . $tab_group_id . '-' . ($index + 1) . '" class="tab-pane' . $active_class . '">';
        $output .= $tab_content;
        $output .= '</div>';
    }
    $output .= '</div>';
    
    $output .= '</div>';
    
    // Add JavaScript for tab switching
    $output .= '<script>
    jQuery(document).ready(function($) {
        $("[data-tabs-id=\'' . $tab_group_id . '\'] .tab-nav-item a").click(function(e) {
            e.preventDefault();
            var tabId = $(this).attr("href");
            
            // Remove active classes
            $(this).closest(".tabs-container").find(".tab-nav-item").removeClass("active");
            $(this).closest(".tabs-container").find(".tab-pane").removeClass("active");
            
            // Add active classes
            $(this).parent().addClass("active");
            $(tabId).addClass("active");
        });
    });
    </script>';
    
    return $output;
}
add_shortcode( 'tabs', 'tabs_shortcode' );

// Child shortcode for individual tabs
function tab_shortcode( $atts, $content = null ) {
    static $tab_id = 0;
    $tab_id++;
    
    $atts = shortcode_atts( array(
        'title' => 'Tab ' . $tab_id,
        'icon' => '',
    ), $atts, 'tab' );
    
    // Process any nested shortcodes within the tab content
    $content = do_shortcode( $content );
    
    // Return processed format for parent to parse
    return '[tab_processed title="' . esc_attr( $atts['title'] ) . '" id="' . $tab_id . '"]' . $content . '[/tab_processed]';
}
add_shortcode( 'tab', 'tab_shortcode' );

// Usage:
// [tabs type="horizontal" style="pills" active="2"]
//   [tab title="Overview"]This is the overview content[/tab]
//   [tab title="Features"]List of features here[/tab]
//   [tab title="Pricing"]Pricing information[/tab]
// [/tabs]</code></pre>
                                    </div>
                                </div>
                            </section>

                            <!-- AJAX Shortcodes -->
                            <section>
                                <h2>AJAX-Powered Shortcodes</h2>
                                
                                <div class="ajax-demo">
                                    <h4>Dynamic Content Loading</h4>
                                    <p>Create shortcodes that load content dynamically without page refresh.</p>
                                </div>
                                
                                <div class="advanced-concept">
                                    <h3>Load More Posts Shortcode with AJAX</h3>
                                    
                                    <div class="code-example">
                                        <pre><code class="language-php">// Shortcode for AJAX posts loader
function ajax_posts_shortcode( $atts ) {
    $atts = shortcode_atts( array(
        'posts_per_page' => 3,
        'category' => '',
        'post_type' => 'post',
        'orderby' => 'date',
        'order' => 'DESC',
    ), $atts, 'ajax_posts' );
    
    // Generate unique ID for this instance
    $unique_id = 'ajax-posts-' . uniqid();
    
    // Prepare data for JavaScript
    $ajax_data = array(
        'posts_per_page' => $atts['posts_per_page'],
        'category' => $atts['category'],
        'post_type' => $atts['post_type'],
        'orderby' => $atts['orderby'],
        'order' => $atts['order'],
        'paged' => 1,
    );
    
    ob_start();
    ?>
    <div id="<?php echo esc_attr( $unique_id ); ?>" class="ajax-posts-container">
        <div class="posts-list">
            <!-- Posts will be loaded here -->
        </div>
        <div class="load-more-wrapper">
            <button class="load-more-btn" data-page="1">Load More</button>
            <div class="loading-spinner" style="display: none;">Loading...</div>
        </div>
    </div>
    
    <script>
    jQuery(document).ready(function($) {
        var container = $('#<?php echo esc_js( $unique_id ); ?>');
        var settings = <?php echo json_encode( $ajax_data ); ?>;
        var loading = false;
        
        // Initial load
        loadPosts(1, false);
        
        // Load more button click
        container.find('.load-more-btn').on('click', function() {
            if (!loading) {
                var nextPage = parseInt($(this).data('page')) + 1;
                loadPosts(nextPage, true);
            }
        });
        
        function loadPosts(page, append) {
            loading = true;
            container.find('.loading-spinner').show();
            container.find('.load-more-btn').prop('disabled', true);
            
            $.ajax({
                url: '<?php echo admin_url( 'admin-ajax.php' ); ?>',
                type: 'POST',
                data: {
                    action: 'load_ajax_posts',
                    settings: settings,
                    page: page,
                    nonce: '<?php echo wp_create_nonce( 'ajax_posts_nonce' ); ?>'
                },
                success: function(response) {
                    if (response.success) {
                        if (append) {
                            container.find('.posts-list').append(response.data.html);
                        } else {
                            container.find('.posts-list').html(response.data.html);
                        }
                        
                        if (response.data.has_more) {
                            container.find('.load-more-btn').data('page', page).show();
                        } else {
                            container.find('.load-more-btn').hide();
                        }
                    }
                },
                complete: function() {
                    loading = false;
                    container.find('.loading-spinner').hide();
                    container.find('.load-more-btn').prop('disabled', false);
                }
            });
        }
    });
    </script>
    <?php
    
    return ob_get_clean();
}
add_shortcode( 'ajax_posts', 'ajax_posts_shortcode' );

// AJAX handler
function handle_ajax_posts() {
    check_ajax_referer( 'ajax_posts_nonce', 'nonce' );
    
    $settings = $_POST['settings'];
    $page = intval( $_POST['page'] );
    
    $args = array(
        'post_type' => sanitize_text_field( $settings['post_type'] ),
        'posts_per_page' => intval( $settings['posts_per_page'] ),
        'paged' => $page,
        'orderby' => sanitize_text_field( $settings['orderby'] ),
        'order' => sanitize_text_field( $settings['order'] ),
    );
    
    if ( ! empty( $settings['category'] ) ) {
        $args['category_name'] = sanitize_text_field( $settings['category'] );
    }
    
    $query = new WP_Query( $args );
    
    ob_start();
    
    if ( $query->have_posts() ) {
        while ( $query->have_posts() ) {
            $query->the_post();
            ?>
            <article class="ajax-post-item">
                <h3><a href="<?php the_permalink(); ?>"><?php the_title(); ?></a></h3>
                <div class="post-meta">
                    <?php echo get_the_date(); ?> | <?php the_author(); ?>
                </div>
                <?php the_excerpt(); ?>
            </article>
            <?php
        }
    }
    
    $html = ob_get_clean();
    
    wp_send_json_success( array(
        'html' => $html,
        'has_more' => $page < $query->max_num_pages,
    ) );
}
add_action( 'wp_ajax_load_ajax_posts', 'handle_ajax_posts' );
add_action( 'wp_ajax_nopriv_load_ajax_posts', 'handle_ajax_posts' );</code></pre>
                                    </div>
                                </div>
                            </section>

                            <!-- Dynamic Shortcodes -->
                            <section>
                                <h2>Dynamic Content Shortcodes</h2>
                                
                                <div class="advanced-concept">
                                    <h3>Conditional Content Display</h3>
                                    
                                    <div class="code-example">
                                        <pre><code class="language-php">// Show content based on user role
function user_role_content_shortcode( $atts, $content = null ) {
    $atts = shortcode_atts( array(
        'role' => 'subscriber',
        'capability' => '',
        'logged_in' => 'yes',
        'message' => 'You do not have permission to view this content.',
    ), $atts, 'user_content' );
    
    // Check if user needs to be logged in
    if ( $atts['logged_in'] === 'yes' && ! is_user_logged_in() ) {
        return '<p class="restricted-content">' . esc_html( $atts['message'] ) . '</p>';
    }
    
    // Check capability if specified
    if ( ! empty( $atts['capability'] ) ) {
        if ( ! current_user_can( $atts['capability'] ) ) {
            return '<p class="restricted-content">' . esc_html( $atts['message'] ) . '</p>';
        }
    }
    
    // Check role if specified
    if ( ! empty( $atts['role'] ) ) {
        $user = wp_get_current_user();
        $allowed_roles = explode( ',', $atts['role'] );
        $allowed_roles = array_map( 'trim', $allowed_roles );
        
        if ( ! array_intersect( $allowed_roles, $user->roles ) ) {
            return '<p class="restricted-content">' . esc_html( $atts['message'] ) . '</p>';
        }
    }
    
    // User has permission, show content
    return do_shortcode( $content );
}
add_shortcode( 'user_content', 'user_role_content_shortcode' );

// Time-based content display
function scheduled_content_shortcode( $atts, $content = null ) {
    $atts = shortcode_atts( array(
        'start' => '',
        'end' => '',
        'timezone' => wp_timezone_string(),
        'message_before' => 'This content is not yet available.',
        'message_after' => 'This content is no longer available.',
    ), $atts, 'scheduled_content' );
    
    $timezone = new DateTimeZone( $atts['timezone'] );
    $now = new DateTime( 'now', $timezone );
    
    // Check start date
    if ( ! empty( $atts['start'] ) ) {
        $start = new DateTime( $atts['start'], $timezone );
        if ( $now < $start ) {
            return '<p class="scheduled-message">' . esc_html( $atts['message_before'] ) . '</p>';
        }
    }
    
    // Check end date
    if ( ! empty( $atts['end'] ) ) {
        $end = new DateTime( $atts['end'], $timezone );
        if ( $now > $end ) {
            return '<p class="scheduled-message">' . esc_html( $atts['message_after'] ) . '</p>';
        }
    }
    
    // Within schedule, show content
    return do_shortcode( $content );
}
add_shortcode( 'scheduled_content', 'scheduled_content_shortcode' );

// Usage examples:
// [user_content role="administrator,editor"]Admin only content[/user_content]
// [scheduled_content start="2024-01-01 09:00" end="2024-12-31 17:00"]Limited time offer![/scheduled_content]</code></pre>
                                    </div>
                                </div>
                            </section>

                            <!-- Performance Optimization -->
                            <section>
                                <h2>Performance Optimization</h2>
                                
                                <div class="performance-box">
                                    <h4>⚡ Optimization Techniques</h4>
                                    <ul>
                                        <li>Cache expensive operations</li>
                                        <li>Lazy load content when possible</li>
                                        <li>Minimize database queries</li>
                                        <li>Use transients for temporary data</li>
                                        <li>Avoid nested loops</li>
                                    </ul>
                                </div>
                                
                                <div class="advanced-concept">
                                    <h3>Cached Shortcode Implementation</h3>
                                    
                                    <div class="code-example">
                                        <pre><code class="language-php">// Shortcode with caching
function cached_products_shortcode( $atts ) {
    $atts = shortcode_atts( array(
        'count' => 10,
        'category' => '',
        'cache_time' => 3600, // 1 hour in seconds
    ), $atts, 'cached_products' );
    
    // Generate cache key based on attributes
    $cache_key = 'shortcode_products_' . md5( serialize( $atts ) );
    
    // Try to get cached version
    $output = get_transient( $cache_key );
    
    if ( false === $output ) {
        // No cache found, generate content
        $args = array(
            'post_type' => 'product',
            'posts_per_page' => intval( $atts['count'] ),
        );
        
        if ( ! empty( $atts['category'] ) ) {
            $args['tax_query'] = array(
                array(
                    'taxonomy' => 'product_category',
                    'field' => 'slug',
                    'terms' => $atts['category'],
                ),
            );
        }
        
        $products = new WP_Query( $args );
        
        ob_start();
        
        if ( $products->have_posts() ) {
            echo '<div class="cached-products">';
            while ( $products->have_posts() ) {
                $products->the_post();
                ?>
                <div class="product-item">
                    <h3><?php the_title(); ?></h3>
                    <?php the_excerpt(); ?>
                </div>
                <?php
            }
            echo '</div>';
            wp_reset_postdata();
        } else {
            echo '<p>No products found.</p>';
        }
        
        $output = ob_get_clean();
        
        // Save to cache
        set_transient( $cache_key, $output, intval( $atts['cache_time'] ) );
    }
    
    return $output;
}
add_shortcode( 'cached_products', 'cached_products_shortcode' );

// Clear cache when products are updated
function clear_products_shortcode_cache( $post_id ) {
    if ( get_post_type( $post_id ) === 'product' ) {
        // Delete all product shortcode transients
        global $wpdb;
        $wpdb->query( 
            "DELETE FROM {$wpdb->options} 
             WHERE option_name LIKE '_transient_shortcode_products_%' 
             OR option_name LIKE '_transient_timeout_shortcode_products_%'"
        );
    }
}
add_action( 'save_post', 'clear_products_shortcode_cache' );
add_action( 'delete_post', 'clear_products_shortcode_cache' );</code></pre>
                                    </div>
                                </div>
                            </section>

                            <!-- Security Considerations -->
                            <section>
                                <h2>Security in Advanced Shortcodes</h2>
                                
                                <div class="security-alert">
                                    <h4>🔒 Security Best Practices</h4>
                                    <ul>
                                        <li>Always validate and sanitize all inputs</li>
                                        <li>Use nonces for AJAX requests</li>
                                        <li>Check user capabilities</li>
                                        <li>Escape all output</li>
                                        <li>Avoid eval() and similar dangerous functions</li>
                                        <li>Limit shortcode execution in comments</li>
                                    </ul>
                                </div>
                                
                                <div class="code-example">
                                    <pre><code class="language-php">// Disable shortcodes in comments for security
remove_filter( 'comment_text', 'do_shortcode' );

// Limit shortcode execution to certain contexts
function restrict_shortcode_execution( $content ) {
    // Only process shortcodes in main content, not widgets or excerpts
    if ( ! is_singular() || ! in_the_loop() || ! is_main_query() ) {
        return $content;
    }
    return do_shortcode( $content );
}

// Whitelist specific shortcodes for comments
function safe_comment_shortcodes( $content ) {
    global $shortcode_tags;
    
    // Backup current shortcodes
    $orig_shortcode_tags = $shortcode_tags;
    
    // Remove all shortcodes
    remove_all_shortcodes();
    
    // Re-add only safe shortcodes
    add_shortcode( 'quote', 'quote_shortcode' );
    add_shortcode( 'code', 'code_shortcode' );
    
    // Process shortcodes
    $content = do_shortcode( $content );
    
    // Restore original shortcodes
    $shortcode_tags = $orig_shortcode_tags;
    
    return $content;
}
add_filter( 'comment_text', 'safe_comment_shortcodes' );</code></pre>
                                </div>
                            </section>

                            <!-- Complex Example -->
                            <section>
                                <h2>Complete Advanced Example</h2>
                                
                                <div class="advanced-concept">
                                    <h3>Interactive FAQ Accordion Shortcode</h3>
                                    
                                    <div class="code-example">
                                        <pre><code class="language-php">// FAQ Accordion with search and categories
function faq_accordion_shortcode( $atts ) {
    $atts = shortcode_atts( array(
        'category' => '',
        'limit' => -1,
        'search' => 'yes',
        'expand_first' => 'no',
        'style' => 'default', // default, minimal, boxed
    ), $atts, 'faq_accordion' );
    
    // Query FAQs
    $args = array(
        'post_type' => 'faq',
        'posts_per_page' => intval( $atts['limit'] ),
        'orderby' => 'menu_order',
        'order' => 'ASC',
    );
    
    if ( ! empty( $atts['category'] ) ) {
        $args['tax_query'] = array(
            array(
                'taxonomy' => 'faq_category',
                'field' => 'slug',
                'terms' => explode( ',', $atts['category'] ),
            ),
        );
    }
    
    $faqs = new WP_Query( $args );
    
    if ( ! $faqs->have_posts() ) {
        return '<p>No FAQs found.</p>';
    }
    
    $unique_id = 'faq-' . uniqid();
    
    ob_start();
    ?>
    <div id="<?php echo esc_attr( $unique_id ); ?>" class="faq-accordion faq-style-<?php echo esc_attr( $atts['style'] ); ?>">
        
        <?php if ( $atts['search'] === 'yes' ) : ?>
        <div class="faq-search">
            <input type="text" class="faq-search-input" placeholder="Search FAQs...">
        </div>
        <?php endif; ?>
        
        <div class="faq-items">
            <?php 
            $index = 0;
            while ( $faqs->have_posts() ) : $faqs->the_post(); 
                $index++;
                $is_expanded = ( $index === 1 && $atts['expand_first'] === 'yes' );
            ?>
                <div class="faq-item" data-search-content="<?php echo esc_attr( strtolower( get_the_title() . ' ' . get_the_content() ) ); ?>">
                    <div class="faq-question <?php echo $is_expanded ? 'active' : ''; ?>">
                        <span class="faq-icon">
                            <svg width="20" height="20" viewBox="0 0 20 20">
                                <path d="M10 6L14 10L10 14" stroke="currentColor" fill="none" stroke-width="2"/>
                            </svg>
                        </span>
                        <?php the_title(); ?>
                    </div>
                    <div class="faq-answer" <?php echo $is_expanded ? 'style="display: block;"' : ''; ?>>
                        <?php the_content(); ?>
                    </div>
                </div>
            <?php endwhile; ?>
        </div>
    </div>
    
    <style>
    #<?php echo esc_attr( $unique_id ); ?> .faq-item {
        margin-bottom: 10px;
        border: 1px solid #e5e7eb;
        border-radius: 8px;
        overflow: hidden;
    }
    
    #<?php echo esc_attr( $unique_id ); ?> .faq-question {
        padding: 15px;
        background: #f9fafb;
        cursor: pointer;
        display: flex;
        align-items: center;
        transition: background 0.3s;
    }
    
    #<?php echo esc_attr( $unique_id ); ?> .faq-question:hover {
        background: #f3f4f6;
    }
    
    #<?php echo esc_attr( $unique_id ); ?> .faq-question.active {
        background: #667eea;
        color: white;
    }
    
    #<?php echo esc_attr( $unique_id ); ?> .faq-icon {
        margin-right: 10px;
        transition: transform 0.3s;
    }
    
    #<?php echo esc_attr( $unique_id ); ?> .faq-question.active .faq-icon {
        transform: rotate(90deg);
    }
    
    #<?php echo esc_attr( $unique_id ); ?> .faq-answer {
        padding: 15px;
        display: none;
        background: white;
    }
    
    #<?php echo esc_attr( $unique_id ); ?> .faq-search {
        margin-bottom: 20px;
    }
    
    #<?php echo esc_attr( $unique_id ); ?> .faq-search-input {
        width: 100%;
        padding: 10px;
        border: 1px solid #e5e7eb;
        border-radius: 6px;
    }
    </style>
    
    <script>
    jQuery(document).ready(function($) {
        var container = $('#<?php echo esc_js( $unique_id ); ?>');
        
        // Accordion functionality
        container.find('.faq-question').on('click', function() {
            var $this = $(this);
            var $answer = $this.next('.faq-answer');
            
            // Toggle current item
            $this.toggleClass('active');
            $answer.slideToggle(300);
            
            // Optional: Close other items
            // container.find('.faq-question').not($this).removeClass('active');
            // container.find('.faq-answer').not($answer).slideUp(300);
        });
        
        // Search functionality
        container.find('.faq-search-input').on('keyup', function() {
            var searchTerm = $(this).val().toLowerCase();
            
            container.find('.faq-item').each(function() {
                var content = $(this).data('search-content');
                if (content.indexOf(searchTerm) > -1) {
                    $(this).show();
                } else {
                    $(this).hide();
                }
            });
        });
    });
    </script>
    <?php
    
    wp_reset_postdata();
    return ob_get_clean();
}
add_shortcode( 'faq_accordion', 'faq_accordion_shortcode' );</code></pre>
                                    </div>
                                </div>
                            </section>

                            <!-- Practice Exercise -->
                            <section>
                                <h2>Practice Exercise</h2>
                                <div class="alert alert-success">
                                    <div class="alert-icon">💻</div>
                                    <div class="alert-content">
                                        <div class="alert-title">Build an Advanced Gallery Shortcode</div>
                                        <div class="alert-message">
                                            <p>Create a complex gallery shortcode with these features:</p>
                                            <ul>
                                                <li>Support for multiple layout types (grid, masonry, slider)</li>
                                                <li>Lightbox integration for image viewing</li>
                                                <li>Lazy loading for performance</li>
                                                <li>Filter buttons by category</li>
                                                <li>AJAX pagination</li>
                                                <li>Customizable number of columns</li>
                                                <li>Caption and title display options</li>
                                                <li>Social sharing buttons</li>
                                            </ul>
                                            <p><strong>Bonus:</strong> Add image zoom on hover and infinite scroll option.</p>
                                        </div>
                                    </div>
                                </div>
                            </section>

                            <!-- Resources -->
                            <section class="resources">
                                <h2>Additional Resources</h2>
                                <ul>
                                    <li><a href="https://developer.wordpress.org/apis/handbook/shortcode/" target="_blank">WordPress Shortcode Handbook</a></li>
                                    <li><a href="https://codex.wordpress.org/AJAX_in_Plugins" target="_blank">AJAX in WordPress Plugins</a></li>
                                    <li><a href="https://developer.wordpress.org/apis/handbook/transients/" target="_blank">WordPress Transients API</a></li>
                                    <li><a href="https://developer.wordpress.org/plugins/shortcodes/enclosing-shortcodes/" target="_blank">Enclosing Shortcodes Guide</a></li>
                                </ul>
                            </section>
                        </div>

                        <!-- Lesson Navigation -->
                        <div class="lesson-navigation">
                            <a href="/06module/shortcode_attributes.html" class="lesson-nav-button prev">
                                <svg width="20" height="20" viewBox="0 0 20 20" fill="currentColor">
                                    <path d="M12.707 5.293a1 1 0 010 1.414L9.414 10l3.293 3.293a1 1 0 01-1.414 1.414l-4-4a1 1 0 010-1.414l4-4a1 1 0 011.414 0z"/>
                                </svg>
                                <span>
                                    <small>Previous</small><br>
                                    Shortcode Attributes
                                </span>
                            </a>
                            
                            <button class="complete-lesson-btn">
                                Mark as Complete
                            </button>
                            
                            <a href="/06module/creating_widgets.html" class="lesson-nav-button next">
                                <span>
                                    <small>Next</small><br>
                                    Creating Widgets
                                </span>
                                <svg width="20" height="20" viewBox="0 0 20 20" fill="currentColor">
                                    <path d="M7.293 14.707a1 1 0 010-1.414L10.586 10 7.293 6.707a1 1 0 011.414-1.414l4 4a1 1 0 010 1.414l-4 4a1 1 0 01-1.414 0z"/>
                                </svg>
                            </a>
                        </div>
                    </article>
                </div>
            </div>
        </main>

        <!-- Footer -->
        <footer class="site-footer" role="contentinfo">
            <div class="footer-container">
                <div class="footer-content">
                    <div class="footer-section footer-about">
                        <h3>PHP WordPress Development</h3>
                        <p>Complete Web Development Course</p>
                    </div>
                    
                    <div class="footer-section">
                        <h4>Quick Links</h4>
                        <ul class="footer-links">
                            <li><a href="/">Home</a></li>
                            <li><a href="/module6.html">Module 6</a></li>
                            <li><a href="/resources.html">Resources</a></li>
                        </ul>
                    </div>
                    
                    <div class="footer-section">
                        <h4>Support</h4>
                        <ul class="footer-links">
                            <li><a href="/about.html">About</a></li>
                            <li><a href="/contact.html">Contact</a></li>
                        </ul>
                    </div>
                </div>
                
                <div class="footer-bottom">
                    <p>&copy; 2024 PHP WordPress Course. All rights reserved.</p>
                    <p>This course material is for educational purposes only.</p>
                </div>
            </div>
        </footer>
    </div>
    
    <!-- JavaScript -->
    <script src="/assets/js/prism.js"></script>
    <script src="/assets/js/main.js"></script>
    <script src="/assets/js/sidebar-toggle.js"></script>
    <script src="/assets/js/progress-tracker.js"></script>
    <script src="/assets/js/search.js"></script>
    <script src="/assets/js/theme-toggle.js"></script>
</body>
</html>