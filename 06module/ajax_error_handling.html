<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    
    <!-- SEO Meta Tags -->
    <title>Error Handling in AJAX - PHP WordPress Course</title>
    <meta name="description" content="Master error handling in WordPress AJAX. Learn to gracefully handle errors, provide user feedback, and debug AJAX issues effectively.">
    <meta name="keywords" content="PHP, WordPress, AJAX error handling, debugging, error messages, user feedback">
    <meta name="author" content="PHP WordPress Course">
    
    <!-- Favicon -->
    <link rel="icon" type="image/png" href="/favicon.png">
    <link rel="apple-touch-icon" href="/favicon.png">
    
    <!-- CSS -->
    <link rel="stylesheet" href="/assets/css/main.css">
    <link rel="stylesheet" href="/assets/css/sidebar-enhanced.css">
    <link rel="stylesheet" href="/assets/css/sidebar-toggle.css">
    
    <!-- Custom styles for this lesson -->
    <style>
        .error-header {
            background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%);
            color: white;
            padding: 3rem 2rem;
            border-radius: 12px;
            margin-bottom: 2rem;
            text-align: center;
        }

        .error-concept {
            background: white;
            border: 2px solid #e5e7eb;
            border-radius: 12px;
            padding: 2rem;
            margin: 2rem 0;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }

        .error-concept h3 {
            color: #ef4444;
            margin-top: 0;
            border-bottom: 2px solid #e5e7eb;
            padding-bottom: 1rem;
        }

        .code-example {
            background: #1e293b;
            color: #e2e8f0;
            padding: 1.5rem;
            border-radius: 8px;
            margin: 1.5rem 0;
            overflow-x: auto;
        }

        .code-example pre {
            margin: 0;
            white-space: pre-wrap;
        }

        .error-types {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 1.5rem;
            margin: 2rem 0;
        }

        .error-type-card {
            background: white;
            border: 2px solid #e5e7eb;
            border-radius: 8px;
            padding: 1.5rem;
            transition: transform 0.2s, box-shadow 0.2s;
        }

        .error-type-card:hover {
            transform: translateY(-4px);
            box-shadow: 0 8px 16px rgba(0, 0, 0, 0.1);
        }

        .error-type-card h4 {
            color: #dc2626;
            margin-top: 0;
        }

        .error-code {
            display: inline-block;
            background: #fee2e2;
            color: #dc2626;
            padding: 0.25rem 0.75rem;
            border-radius: 4px;
            font-family: monospace;
            font-weight: 600;
        }

        .success-message {
            background: #d1fae5;
            border: 2px solid #10b981;
            color: #065f46;
            padding: 1rem;
            border-radius: 8px;
            margin: 1rem 0;
        }

        .warning-message {
            background: #fef3c7;
            border: 2px solid #fbbf24;
            color: #92400e;
            padding: 1rem;
            border-radius: 8px;
            margin: 1rem 0;
        }

        .error-message {
            background: #fee2e2;
            border: 2px solid #ef4444;
            color: #991b1b;
            padding: 1rem;
            border-radius: 8px;
            margin: 1rem 0;
        }

        .info-message {
            background: #dbeafe;
            border: 2px solid #3b82f6;
            color: #1e40af;
            padding: 1rem;
            border-radius: 8px;
            margin: 1rem 0;
        }

        .error-flow {
            background: linear-gradient(135deg, #fee2e2 0%, #fecaca 100%);
            border: 2px solid #ef4444;
            border-radius: 8px;
            padding: 1.5rem;
            margin: 2rem 0;
        }

        .flow-step {
            display: flex;
            align-items: center;
            margin: 1rem 0;
            padding: 1rem;
            background: white;
            border-radius: 6px;
            position: relative;
        }

        .flow-step:not(:last-child)::after {
            content: '↓';
            position: absolute;
            bottom: -1.5rem;
            left: 50%;
            transform: translateX(-50%);
            font-size: 1.5rem;
            color: #ef4444;
        }

        .flow-number {
            background: #ef4444;
            color: white;
            width: 30px;
            height: 30px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            margin-right: 1rem;
            flex-shrink: 0;
        }

        .debug-tools {
            background: #f9fafb;
            border: 2px solid #d1d5db;
            border-radius: 8px;
            padding: 1.5rem;
            margin: 2rem 0;
        }

        .debug-tool {
            background: white;
            border: 1px solid #e5e7eb;
            border-radius: 6px;
            padding: 1rem;
            margin: 0.5rem 0;
        }

        .debug-tool h5 {
            color: #6366f1;
            margin-top: 0;
            margin-bottom: 0.5rem;
        }

        .tip-box {
            background: #f0fdf4;
            border: 2px solid #10b981;
            border-radius: 8px;
            padding: 1rem;
            margin: 1.5rem 0;
        }

        .warning-box {
            background: #fef3c7;
            border: 2px solid #fbbf24;
            border-radius: 8px;
            padding: 1rem;
            margin: 1.5rem 0;
        }

        .implementation-tabs {
            border: 2px solid #e5e7eb;
            border-radius: 8px;
            overflow: hidden;
            margin: 2rem 0;
        }

        .tab-nav {
            display: flex;
            background: #f3f4f6;
            border-bottom: 2px solid #e5e7eb;
        }

        .tab-nav button {
            flex: 1;
            padding: 1rem;
            background: none;
            border: none;
            cursor: pointer;
            font-weight: 600;
            color: #6b7280;
            transition: all 0.2s;
        }

        .tab-nav button.active {
            background: white;
            color: #ef4444;
            border-bottom: 2px solid #ef4444;
            margin-bottom: -2px;
        }

        .tab-content {
            background: white;
        }

        .tab-panel {
            display: none;
            padding: 1.5rem;
        }

        .tab-panel.active {
            display: block;
        }

        .user-feedback-examples {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 1.5rem;
            margin: 2rem 0;
        }

        .feedback-example {
            background: white;
            border: 2px solid #e5e7eb;
            border-radius: 8px;
            padding: 1.5rem;
        }

        .feedback-example h5 {
            color: #6366f1;
            margin-top: 0;
        }

        .error-strategy {
            background: white;
            border: 2px solid #ef4444;
            border-radius: 8px;
            padding: 1.5rem;
            margin: 2rem 0;
        }

        .strategy-item {
            display: flex;
            align-items: flex-start;
            margin: 1rem 0;
        }

        .strategy-number {
            background: #ef4444;
            color: white;
            width: 24px;
            height: 24px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.875rem;
            font-weight: bold;
            margin-right: 1rem;
            flex-shrink: 0;
        }
    </style>
</head>
<body>
    <!-- Skip to main content -->
    <a href="#main-content" class="sr-only">Skip to main content</a>
    
    <div class="page-wrapper">
        <!-- Header -->
        <header class="site-header" role="banner">
            <div class="header-container">
                <div class="site-branding">
                    <a href="/" class="site-logo">
                        <h1 class="site-title">PHP WordPress Development</h1>
                    </a>
                </div>
                
                <nav class="main-navigation" role="navigation" aria-label="Main navigation">
                    <button class="mobile-menu-btn" aria-label="Toggle navigation" aria-expanded="false">
                        <span></span>
                        <span></span>
                        <span></span>
                    </button>
                    
                    <div class="nav-menu">
                        <ul class="nav-list">
                            <li class="nav-item"><a href="/" class="nav-link">Home</a></li>
                            <li class="nav-item dropdown">
                                <button class="nav-link dropdown-toggle active" aria-haspopup="true">Modules</button>
                                <div class="dropdown-menu">
                                    <a href="/module1.html" class="dropdown-item">Module 1: Web Fundamentals</a>
                                    <a href="/module2.html" class="dropdown-item">Module 2: PHP Fundamentals</a>
                                    <a href="/module3.html" class="dropdown-item">Module 3: MySQL Database</a>
                                    <a href="/module4.html" class="dropdown-item">Module 4: WordPress & Docker</a>
                                    <a href="/module5.html" class="dropdown-item">Module 5: Theme Development</a>
                                    <a href="/module6.html" class="dropdown-item active">Module 6: Plugin Development</a>
                                    <a href="/module7.html" class="dropdown-item">Module 7: Advanced WordPress</a>
                                    <a href="/module8.html" class="dropdown-item">Module 8: Deployment</a>
                                    <a href="/module9.html" class="dropdown-item">Module 9: Final Project</a>
                                </div>
                            </li>
                            <li class="nav-item"><a href="/resources.html" class="nav-link">Resources</a></li>
                            <li class="nav-item"><a href="/about.html" class="nav-link">About</a></li>
                        </ul>
                    </div>
                </nav>
                
                <div class="search-container">
                    <div class="search-input-wrapper">
                        <svg class="search-icon" width="20" height="20" viewBox="0 0 20 20" fill="currentColor">
                            <path fill-rule="evenodd" d="M8 4a4 4 0 100 8 4 4 0 000-8zM2 8a6 6 0 1110.89 3.476l4.817 4.817a1 1 0 01-1.414 1.414l-4.816-4.816A6 6 0 012 8z" clip-rule="evenodd" />
                        </svg>
                        <input type="search" class="search-input" placeholder="Search lessons..." aria-label="Search">
                    </div>
                    <div class="search-results"></div>
                </div>
            </div>
        </header>
        
        <!-- Progress Bar -->
        <div class="progress-container">
            <div class="progress-header">
                <h2 class="progress-title">Course Progress</h2>
                <span class="progress-text">Loading...</span>
            </div>
            <div class="progress-bar">
                <div class="progress-bar-fill">
                    <span class="progress-bar-text"></span>
                </div>
            </div>
        </div>
        
        <!-- Breadcrumb -->
        <nav class="breadcrumb container" aria-label="Breadcrumb">
            <ol class="breadcrumb-list">
                <li class="breadcrumb-item">
                    <a href="/">Home</a>
                    <span class="breadcrumb-separator">/</span>
                </li>
                <li class="breadcrumb-item">
                    <a href="/module6.html">Module 6</a>
                    <span class="breadcrumb-separator">/</span>
                </li>
                <li class="breadcrumb-item">
                    <span aria-current="page">Error Handling in AJAX</span>
                </li>
            </ol>
        </nav>
        
        <!-- Main Content -->
        <main id="main-content" class="main-content" role="main">
            <div class="container">
                <div class="content-with-sidebar">
                    <!-- Sidebar -->
                    <aside class="sidebar">
                        <div class="sidebar-nav">
                            <h3 class="sidebar-title">Module 6: Plugin Development</h3>
                            <div class="sidebar-section">
                                <h4 class="sidebar-section-title">Session 7: AJAX in WordPress</h4>
                                <ul class="sidebar-menu">
                                    <li><a class="sidebar-link" href="/07module/ajax_overview.html">AJAX in WordPress Overview</a></li>
                                    <li><a class="sidebar-link" href="/07module/ajax_handlers.html">Setting up AJAX Handlers</a></li>
                                    <li><a class="sidebar-link" href="/07module/admin_frontend_ajax.html">Admin and Frontend AJAX</a></li>
                                    <li><a class="sidebar-link" href="/07module/ajax_security.html">AJAX Security with Nonces</a></li>
                                    <li class="active"><a class="sidebar-link active" href="/07module/ajax_error_handling.html">Error Handling in AJAX</a></li>
                                    <li><a class="sidebar-link" href="/07module/loading_scripts.html">Loading Scripts for AJAX</a></li>
                                    <li><a class="sidebar-link" href="/07module/homework_ajax_plugin.html">Homework: AJAX Plugin</a></li>
                                </ul>
                            </div>
                            <div class="sidebar-section">
                                <h4 class="sidebar-section-title">Quick Links</h4>
                                <ul class="sidebar-menu">
                                    <li><a class="sidebar-link" href="/module6.html">Module Overview</a></li>
                                    <li><a class="sidebar-link" href="/07module/ajax_security.html">← Previous Lesson</a></li>
                                    <li><a class="sidebar-link next-session" href="/07module/loading_scripts.html">Next Lesson →</a></li>
                                    <li><a class="sidebar-link" href="/">← Course Home</a></li>
                                    <li><a class="sidebar-link" href="/resources.html">Resources</a></li>
                                </ul>
                            </div>
                        </div>
                    </aside>
                    
                    <!-- Main Lesson Content -->
                    <article class="lesson-content">
                        <div class="error-header">
                            <h1>⚠️ Error Handling in AJAX</h1>
                            <p class="lead">Build robust AJAX applications with proper error handling</p>
                            <p>Learn to gracefully handle errors and provide excellent user feedback</p>
                        </div>

                        <!-- Learning Objectives -->
                        <div class="lesson-objectives">
                            <h2>Learning Objectives</h2>
                            <ul>
                                <li>Understand different types of AJAX errors</li>
                                <li>Implement comprehensive error handling strategies</li>
                                <li>Create user-friendly error messages</li>
                                <li>Build retry mechanisms and fallbacks</li>
                                <li>Debug AJAX issues effectively</li>
                                <li>Log and monitor errors</li>
                                <li>Handle network and timeout issues</li>
                            </ul>
                        </div>
                        
                        <!-- Lesson Body -->
                        <div class="lesson-body">
                            <!-- Types of AJAX Errors -->
                            <section>
                                <h2>Types of AJAX Errors</h2>
                                
                                <div class="error-types">
                                    <div class="error-type-card">
                                        <h4>Network Errors</h4>
                                        <span class="error-code">0</span>
                                        <p>No connection, DNS failures, CORS issues</p>
                                    </div>
                                    
                                    <div class="error-type-card">
                                        <h4>Client Errors</h4>
                                        <span class="error-code">4xx</span>
                                        <p>400 Bad Request, 401 Unauthorized, 403 Forbidden, 404 Not Found</p>
                                    </div>
                                    
                                    <div class="error-type-card">
                                        <h4>Server Errors</h4>
                                        <span class="error-code">5xx</span>
                                        <p>500 Internal Server Error, 502 Bad Gateway, 503 Service Unavailable</p>
                                    </div>
                                    
                                    <div class="error-type-card">
                                        <h4>Timeout Errors</h4>
                                        <span class="error-code">timeout</span>
                                        <p>Request exceeds time limit</p>
                                    </div>
                                    
                                    <div class="error-type-card">
                                        <h4>Parse Errors</h4>
                                        <span class="error-code">parsererror</span>
                                        <p>Invalid JSON or XML response</p>
                                    </div>
                                    
                                    <div class="error-type-card">
                                        <h4>Abort Errors</h4>
                                        <span class="error-code">abort</span>
                                        <p>Request cancelled by user or script</p>
                                    </div>
                                </div>
                            </section>

                            <!-- Error Handling Flow -->
                            <section>
                                <h2>Error Handling Flow</h2>
                                
                                <div class="error-flow">
                                    <h3>Complete Error Handling Process</h3>
                                    
                                    <div class="flow-step">
                                        <div class="flow-number">1</div>
                                        <div>
                                            <strong>Error Detection</strong>
                                            <p>Catch error in AJAX callback or promise</p>
                                        </div>
                                    </div>
                                    
                                    <div class="flow-step">
                                        <div class="flow-number">2</div>
                                        <div>
                                            <strong>Error Classification</strong>
                                            <p>Determine error type and severity</p>
                                        </div>
                                    </div>
                                    
                                    <div class="flow-step">
                                        <div class="flow-number">3</div>
                                        <div>
                                            <strong>Recovery Attempt</strong>
                                            <p>Try retry logic or fallback options</p>
                                        </div>
                                    </div>
                                    
                                    <div class="flow-step">
                                        <div class="flow-number">4</div>
                                        <div>
                                            <strong>User Notification</strong>
                                            <p>Display appropriate error message</p>
                                        </div>
                                    </div>
                                    
                                    <div class="flow-step">
                                        <div class="flow-number">5</div>
                                        <div>
                                            <strong>Error Logging</strong>
                                            <p>Log error details for debugging</p>
                                        </div>
                                    </div>
                                    
                                    <div class="flow-step">
                                        <div class="flow-number">6</div>
                                        <div>
                                            <strong>State Recovery</strong>
                                            <p>Reset UI to consistent state</p>
                                        </div>
                                    </div>
                                </div>
                            </section>

                            <!-- Complete Implementation -->
                            <section>
                                <h2>Complete Error Handling Implementation</h2>
                                
                                <div class="implementation-tabs">
                                    <div class="tab-nav">
                                        <button class="active" data-tab="php">PHP Error Handling</button>
                                        <button data-tab="javascript">JavaScript Error Handling</button>
                                        <button data-tab="advanced">Advanced Strategies</button>
                                    </div>
                                    
                                    <div class="tab-content">
                                        <!-- PHP Error Handling -->
                                        <div class="tab-panel active" id="php">
                                            <h4>Server-Side Error Handling</h4>
                                            <div class="code-example">
                                                <pre><code class="language-php"><?php
/**
 * Comprehensive AJAX Error Handler
 */
class AJAX_Error_Handler {
    
    /**
     * Handle AJAX request with comprehensive error handling
     */
    public function handle_ajax_request() {
        try {
            // Verify nonce
            if (!wp_verify_nonce($_POST['nonce'], 'ajax_nonce')) {
                $this->send_error('Security verification failed', 'security_error', 403);
            }
            
            // Validate input
            $validation = $this->validate_input($_POST);
            if (is_wp_error($validation)) {
                $this->send_validation_errors($validation);
            }
            
            // Process request
            $result = $this->process_request($_POST);
            
            if (is_wp_error($result)) {
                $this->handle_wp_error($result);
            }
            
            // Success response
            wp_send_json_success(array(
                'message' => 'Request processed successfully',
                'data' => $result
            ));
            
        } catch (Exception $e) {
            $this->handle_exception($e);
        } catch (Error $e) {
            $this->handle_fatal_error($e);
        }
    }
    
    /**
     * Send structured error response
     */
    private function send_error($message, $code = 'general_error', $status = 400) {
        wp_send_json_error(array(
            'message' => $message,
            'code' => $code,
            'status' => $status,
            'timestamp' => current_time('mysql'),
            'details' => $this->get_error_details($code)
        ), $status);
    }
    
    /**
     * Handle validation errors
     */
    private function send_validation_errors($wp_error) {
        $errors = array();
        foreach ($wp_error->get_error_codes() as $code) {
            $errors[$code] = $wp_error->get_error_message($code);
        }
        
        wp_send_json_error(array(
            'message' => 'Validation failed',
            'code' => 'validation_error',
            'errors' => $errors,
            'fields' => array_keys($errors)
        ), 422);
    }
    
    /**
     * Handle WP_Error objects
     */
    private function handle_wp_error($wp_error) {
        $code = $wp_error->get_error_code();
        $message = $wp_error->get_error_message();
        $data = $wp_error->get_error_data();
        
        // Map error codes to HTTP status codes
        $status_map = array(
            'unauthorized' => 401,
            'forbidden' => 403,
            'not_found' => 404,
            'rate_limit' => 429,
            'server_error' => 500
        );
        
        $status = isset($status_map[$code]) ? $status_map[$code] : 400;
        
        // Log error
        $this->log_error($code, $message, $data);
        
        wp_send_json_error(array(
            'message' => $this->get_user_friendly_message($code, $message),
            'code' => $code,
            'technical_details' => WP_DEBUG ? $data : null
        ), $status);
    }
    
    /**
     * Handle exceptions
     */
    private function handle_exception($exception) {
        // Log exception
        error_log('AJAX Exception: ' . $exception->getMessage());
        error_log($exception->getTraceAsString());
        
        // Send user-friendly error
        $message = WP_DEBUG ? $exception->getMessage() : 'An error occurred processing your request';
        
        wp_send_json_error(array(
            'message' => $message,
            'code' => 'exception',
            'file' => WP_DEBUG ? $exception->getFile() : null,
            'line' => WP_DEBUG ? $exception->getLine() : null
        ), 500);
    }
    
    /**
     * Handle fatal errors
     */
    private function handle_fatal_error($error) {
        // Log fatal error
        error_log('AJAX Fatal Error: ' . $error->getMessage());
        
        // Send critical error response
        wp_send_json_error(array(
            'message' => 'A critical error occurred',
            'code' => 'fatal_error',
            'severity' => 'critical'
        ), 500);
    }
    
    /**
     * Get user-friendly error message
     */
    private function get_user_friendly_message($code, $default) {
        $messages = array(
            'database_error' => 'Unable to save your data. Please try again.',
            'permission_denied' => 'You don\'t have permission to perform this action.',
            'invalid_data' => 'The data you submitted is invalid.',
            'not_found' => 'The requested item was not found.',
            'rate_limit' => 'Too many requests. Please wait and try again.',
            'timeout' => 'The request took too long. Please try again.',
            'network_error' => 'Connection error. Please check your internet.',
        );
        
        return isset($messages[$code]) ? $messages[$code] : $default;
    }
    
    /**
     * Log errors for monitoring
     */
    private function log_error($code, $message, $data = null) {
        $log_entry = array(
            'timestamp' => current_time('mysql'),
            'code' => $code,
            'message' => $message,
            'user_id' => get_current_user_id(),
            'ip' => $_SERVER['REMOTE_ADDR'],
            'url' => $_SERVER['REQUEST_URI'],
            'data' => $data
        );
        
        // Log to file
        error_log(json_encode($log_entry));
        
        // Optionally save to database
        global $wpdb;
        $wpdb->insert(
            $wpdb->prefix . 'ajax_error_log',
            array(
                'error_code' => $code,
                'error_message' => $message,
                'user_id' => get_current_user_id(),
                'created_at' => current_time('mysql')
            )
        );
    }
    
    /**
     * Validate input data
     */
    private function validate_input($data) {
        $errors = new WP_Error();
        
        // Required field validation
        if (empty($data['required_field'])) {
            $errors->add('required_field', 'This field is required');
        }
        
        // Email validation
        if (!empty($data['email']) && !is_email($data['email'])) {
            $errors->add('email', 'Please enter a valid email address');
        }
        
        // Numeric validation
        if (!empty($data['number']) && !is_numeric($data['number'])) {
            $errors->add('number', 'Please enter a valid number');
        }
        
        return $errors->has_errors() ? $errors : true;
    }
    
    /**
     * Process the request (placeholder)
     */
    private function process_request($data) {
        // Simulate potential errors
        if (rand(1, 10) > 8) {
            return new WP_Error('random_error', 'Random error for testing');
        }
        
        return array('success' => true);
    }
    
    /**
     * Get error details for debugging
     */
    private function get_error_details($code) {
        if (!WP_DEBUG) {
            return null;
        }
        
        return array(
            'backtrace' => debug_backtrace(DEBUG_BACKTRACE_IGNORE_ARGS, 5),
            'server' => $_SERVER,
            'post' => $_POST
        );
    }
}

// Initialize
new AJAX_Error_Handler();</code></pre>
                                            </div>
                                        </div>
                                        
                                        <!-- JavaScript Error Handling -->
                                        <div class="tab-panel" id="javascript">
                                            <h4>Client-Side Error Handling</h4>
                                            <div class="code-example">
                                                <pre><code class="language-javascript">/**
 * Comprehensive AJAX Error Handler
 */
var AJAXErrorHandler = {
    
    // Configuration
    config: {
        maxRetries: 3,
        retryDelay: 1000,
        timeout: 30000,
        errorMessages: {
            0: 'Unable to connect. Please check your internet connection.',
            400: 'Invalid request. Please check your input.',
            401: 'You need to log in to continue.',
            403: 'You don\'t have permission to do this.',
            404: 'The requested resource was not found.',
            429: 'Too many requests. Please wait a moment.',
            500: 'Server error. Please try again later.',
            502: 'Server is temporarily unavailable.',
            503: 'Service unavailable. Please try again later.',
            timeout: 'Request timed out. Please try again.',
            parsererror: 'Invalid response from server.',
            abort: 'Request was cancelled.'
        }
    },
    
    /**
     * Make AJAX request with error handling
     */
    request: function(options) {
        var self = this;
        var deferred = $.Deferred();
        
        // Default options
        var defaults = {
            url: ajaxurl,
            type: 'POST',
            dataType: 'json',
            timeout: this.config.timeout,
            retries: 0,
            maxRetries: this.config.maxRetries
        };
        
        options = $.extend({}, defaults, options);
        
        // Add error callback wrapper
        var originalError = options.error;
        options.error = function(xhr, status, error) {
            self.handleError(xhr, status, error, options, deferred, originalError);
        };
        
        // Add success callback wrapper
        var originalSuccess = options.success;
        options.success = function(response) {
            if (response.success === false) {
                self.handleApplicationError(response, options, deferred);
            } else {
                if (originalSuccess) {
                    originalSuccess(response);
                }
                deferred.resolve(response);
            }
        };
        
        // Make request
        $.ajax(options);
        
        return deferred.promise();
    },
    
    /**
     * Handle AJAX errors
     */
    handleError: function(xhr, status, error, options, deferred, callback) {
        var self = this;
        
        // Log error
        this.logError(xhr, status, error);
        
        // Check if we should retry
        if (this.shouldRetry(xhr, status, options)) {
            options.retries++;
            
            setTimeout(function() {
                console.log('Retrying request (attempt ' + options.retries + ')');
                $.ajax(options);
            }, this.config.retryDelay * options.retries);
            
            return;
        }
        
        // Get error details
        var errorInfo = this.getErrorInfo(xhr, status, error);
        
        // Show user notification
        this.showErrorNotification(errorInfo);
        
        // Call original error callback
        if (callback) {
            callback(xhr, status, error);
        }
        
        // Reject deferred
        deferred.reject(errorInfo);
    },
    
    /**
     * Handle application-level errors
     */
    handleApplicationError: function(response, options, deferred) {
        var errorInfo = {
            message: response.data.message || 'An error occurred',
            code: response.data.code || 'unknown_error',
            errors: response.data.errors || {},
            status: response.data.status || 400
        };
        
        // Handle validation errors specially
        if (errorInfo.code === 'validation_error') {
            this.handleValidationErrors(errorInfo.errors);
        } else {
            this.showErrorNotification(errorInfo);
        }
        
        deferred.reject(errorInfo);
    },
    
    /**
     * Determine if request should be retried
     */
    shouldRetry: function(xhr, status, options) {
        // Don\'t retry if max retries reached
        if (options.retries >= options.maxRetries) {
            return false;
        }
        
        // Retry on network errors or 5xx errors
        if (xhr.status === 0 || (xhr.status >= 500 && xhr.status < 600)) {
            return true;
        }
        
        // Retry on timeout
        if (status === 'timeout') {
            return true;
        }
        
        return false;
    },
    
    /**
     * Get error information
     */
    getErrorInfo: function(xhr, status, error) {
        var message = '';
        var code = xhr.status || status;
        
        // Try to parse error response
        try {
            var response = JSON.parse(xhr.responseText);
            if (response.data && response.data.message) {
                message = response.data.message;
            }
        } catch (e) {
            // Use default messages
            message = this.config.errorMessages[code] || 
                     this.config.errorMessages[status] || 
                     'An unexpected error occurred';
        }
        
        return {
            message: message,
            code: code,
            status: status,
            error: error,
            xhr: xhr
        };
    },
    
    /**
     * Show error notification to user
     */
    showErrorNotification: function(errorInfo) {
        // Remove existing notifications
        $('.ajax-error-notification').remove();
        
        // Create notification element
        var $notification = $('<div class="ajax-error-notification error-message">')
            .html('<strong>Error:</strong> ' + errorInfo.message);
        
        // Add retry button for certain errors
        if (this.isRetryable(errorInfo.code)) {
            var $retryBtn = $('<button class="retry-button">Retry</button>');
            $retryBtn.on('click', function() {
                location.reload();
            });
            $notification.append($retryBtn);
        }
        
        // Add to page
        $('body').prepend($notification);
        
        // Auto-hide after 10 seconds
        setTimeout(function() {
            $notification.fadeOut(function() {
                $(this).remove();
            });
        }, 10000);
    },
    
    /**
     * Handle validation errors
     */
    handleValidationErrors: function(errors) {
        // Clear previous errors
        $('.form-error').removeClass('form-error');
        $('.error-message').remove();
        
        // Show field-specific errors
        $.each(errors, function(field, message) {
            var $field = $('#' + field);
            if ($field.length) {
                $field.addClass('form-error');
                $field.after('<span class="error-message">' + message + '</span>');
            }
        });
        
        // Scroll to first error
        var $firstError = $('.form-error:first');
        if ($firstError.length) {
            $('html, body').animate({
                scrollTop: $firstError.offset().top - 100
            }, 500);
        }
    },
    
    /**
     * Check if error is retryable
     */
    isRetryable: function(code) {
        return code === 0 || code >= 500 || code === 'timeout';
    },
    
    /**
     * Log error for debugging
     */
    logError: function(xhr, status, error) {
        if (console && console.error) {
            console.group('AJAX Error');
            console.error('Status:', status);
            console.error('Error:', error);
            console.error('Response:', xhr.responseText);
            console.error('Status Code:', xhr.status);
            console.groupEnd();
        }
        
        // Send to error tracking service
        if (typeof window.trackError === 'function') {
            window.trackError({
                type: 'ajax',
                status: status,
                error: error,
                url: xhr.responseURL,
                statusCode: xhr.status
            });
        }
    },
    
    /**
     * Global error handler
     */
    setupGlobalHandler: function() {
        var self = this;
        
        // Handle all AJAX errors globally
        $(document).ajaxError(function(event, xhr, settings, error) {
            // Don't handle if already handled
            if (xhr.handled) return;
            
            self.logError(xhr, 'global', error);
            
            // Show generic error for unhandled errors
            if (xhr.status !== 0) { // Ignore aborted requests
                self.showErrorNotification({
                    message: 'An error occurred. Please try again.',
                    code: xhr.status
                });
            }
        });
        
        // Show loading indicator
        $(document).ajaxStart(function() {
            $('.ajax-loader').show();
        });
        
        // Hide loading indicator
        $(document).ajaxStop(function() {
            $('.ajax-loader').hide();
        });
    }
};

// Initialize on document ready
jQuery(document).ready(function($) {
    AJAXErrorHandler.setupGlobalHandler();
    
    // Example usage
    $('.ajax-form').on('submit', function(e) {
        e.preventDefault();
        
        var $form = $(this);
        var formData = $form.serialize();
        
        AJAXErrorHandler.request({
            data: formData,
            success: function(response) {
                // Handle success
                console.log('Success:', response);
            },
            error: function(xhr, status, error) {
                // Additional error handling if needed
                console.log('Custom error handler');
            }
        }).done(function(response) {
            // Promise resolved
            $form[0].reset();
        }).fail(function(errorInfo) {
            // Promise rejected
            console.log('Request failed:', errorInfo);
        });
    });
});</code></pre>
                                            </div>
                                        </div>
                                        
                                        <!-- Advanced Strategies -->
                                        <div class="tab-panel" id="advanced">
                                            <h4>Advanced Error Handling Strategies</h4>
                                            <div class="code-example">
                                                <pre><code class="language-javascript">/**
 * Advanced Error Recovery System
 */
var AdvancedErrorHandler = {
    
    /**
     * Circuit Breaker Pattern
     */
    circuitBreaker: {
        states: {},
        threshold: 5,
        timeout: 60000,
        
        isOpen: function(endpoint) {
            var state = this.states[endpoint];
            if (!state) return false;
            
            if (state.status === 'open') {
                // Check if timeout has passed
                if (Date.now() - state.openedAt > this.timeout) {
                    this.states[endpoint].status = 'half-open';
                    return false;
                }
                return true;
            }
            return false;
        },
        
        recordSuccess: function(endpoint) {
            if (this.states[endpoint]) {
                this.states[endpoint] = {
                    status: 'closed',
                    failures: 0
                };
            }
        },
        
        recordFailure: function(endpoint) {
            if (!this.states[endpoint]) {
                this.states[endpoint] = {
                    status: 'closed',
                    failures: 0
                };
            }
            
            this.states[endpoint].failures++;
            
            if (this.states[endpoint].failures >= this.threshold) {
                this.states[endpoint] = {
                    status: 'open',
                    openedAt: Date.now(),
                    failures: this.states[endpoint].failures
                };
                
                console.warn('Circuit breaker opened for:', endpoint);
            }
        }
    },
    
    /**
     * Exponential Backoff
     */
    exponentialBackoff: function(attemptNumber) {
        var delay = Math.min(1000 * Math.pow(2, attemptNumber), 30000);
        var jitter = Math.random() * 1000;
        return delay + jitter;
    },
    
    /**
     * Request Queue with Priority
     */
    requestQueue: {
        queue: [],
        processing: false,
        
        add: function(request, priority = 5) {
            this.queue.push({
                request: request,
                priority: priority,
                timestamp: Date.now()
            });
            
            // Sort by priority
            this.queue.sort((a, b) => b.priority - a.priority);
            
            if (!this.processing) {
                this.process();
            }
        },
        
        process: function() {
            if (this.queue.length === 0) {
                this.processing = false;
                return;
            }
            
            this.processing = true;
            var item = this.queue.shift();
            
            item.request().always(() => {
                setTimeout(() => this.process(), 100);
            });
        }
    },
    
    /**
     * Fallback Strategies
     */
    fallbackStrategies: {
        
        // Use cached data
        useCache: function(key) {
            var cached = localStorage.getItem('ajax_cache_' + key);
            if (cached) {
                var data = JSON.parse(cached);
                if (Date.now() - data.timestamp < 3600000) { // 1 hour
                    return data.value;
                }
            }
            return null;
        },
        
        // Use default data
        useDefault: function(type) {
            var defaults = {
                'user_list': [],
                'settings': { theme: 'default' },
                'posts': []
            };
            return defaults[type] || null;
        },
        
        // Degrade gracefully
        degradeGracefully: function() {
            $('.ajax-dependent').hide();
            $('.fallback-content').show();
            $('.error-banner').text('Some features are temporarily unavailable').show();
        }
    },
    
    /**
     * Error Recovery Strategies
     */
    recover: function(error, context) {
        var strategy = this.determineRecoveryStrategy(error);
        
        switch(strategy) {
            case 'retry':
                return this.retryWithBackoff(context);
                
            case 'cache':
                return this.fallbackStrategies.useCache(context.cacheKey);
                
            case 'default':
                return this.fallbackStrategies.useDefault(context.type);
                
            case 'degrade':
                this.fallbackStrategies.degradeGracefully();
                return null;
                
            case 'offline':
                return this.handleOfflineMode(context);
                
            default:
                throw error;
        }
    },
    
    /**
     * Determine recovery strategy based on error
     */
    determineRecoveryStrategy: function(error) {
        if (error.code === 0 || !navigator.onLine) {
            return 'offline';
        }
        
        if (error.code >= 500) {
            return 'retry';
        }
        
        if (error.code === 404) {
            return 'default';
        }
        
        if (error.code === 429) {
            return 'degrade';
        }
        
        return 'cache';
    },
    
    /**
     * Handle offline mode
     */
    handleOfflineMode: function(context) {
        // Queue request for when online
        this.offlineQueue.add(context);
        
        // Show offline notification
        this.showOfflineNotification();
        
        // Return cached data if available
        return this.fallbackStrategies.useCache(context.cacheKey);
    },
    
    /**
     * Offline queue
     */
    offlineQueue: {
        queue: [],
        
        add: function(request) {
            this.queue.push(request);
            localStorage.setItem('offline_queue', JSON.stringify(this.queue));
        },
        
        process: function() {
            var queue = JSON.parse(localStorage.getItem('offline_queue') || '[]');
            
            queue.forEach(function(request) {
                // Retry each queued request
                $.ajax(request);
            });
            
            localStorage.removeItem('offline_queue');
        }
    },
    
    /**
     * Monitor connection status
     */
    monitorConnection: function() {
        window.addEventListener('online', function() {
            console.log('Connection restored');
            AdvancedErrorHandler.offlineQueue.process();
        });
        
        window.addEventListener('offline', function() {
            console.log('Connection lost');
            AdvancedErrorHandler.showOfflineNotification();
        });
    }
};

// Initialize
AdvancedErrorHandler.monitorConnection();</code></pre>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </section>

                            <!-- User Feedback Examples -->
                            <section>
                                <h2>User Feedback Patterns</h2>
                                
                                <div class="user-feedback-examples">
                                    <div class="feedback-example">
                                        <h5>Success Message</h5>
                                        <div class="success-message">
                                            ✅ Your changes have been saved successfully!
                                        </div>
                                    </div>
                                    
                                    <div class="feedback-example">
                                        <h5>Warning Message</h5>
                                        <div class="warning-message">
                                            ⚠️ Your session will expire in 5 minutes
                                        </div>
                                    </div>
                                    
                                    <div class="feedback-example">
                                        <h5>Error Message</h5>
                                        <div class="error-message">
                                            ❌ Unable to save. Please check your connection.
                                        </div>
                                    </div>
                                    
                                    <div class="feedback-example">
                                        <h5>Info Message</h5>
                                        <div class="info-message">
                                            ℹ️ Loading more content...
                                        </div>
                                    </div>
                                </div>
                            </section>

                            <!-- Debugging Tools -->
                            <section>
                                <h2>Debugging AJAX Errors</h2>
                                
                                <div class="debug-tools">
                                    <h3>Essential Debugging Tools</h3>
                                    
                                    <div class="debug-tool">
                                        <h5>Browser DevTools</h5>
                                        <p>Network tab for request/response inspection</p>
                                        <code>F12 → Network → XHR</code>
                                    </div>
                                    
                                    <div class="debug-tool">
                                        <h5>Console Logging</h5>
                                        <code>console.log(xhr.responseText);</code>
                                        <code>console.error('Error:', status);</code>
                                    </div>
                                    
                                    <div class="debug-tool">
                                        <h5>WordPress Debug Mode</h5>
                                        <code>define('WP_DEBUG', true);</code>
                                        <code>define('WP_DEBUG_LOG', true);</code>
                                    </div>
                                    
                                    <div class="debug-tool">
                                        <h5>Query Monitor Plugin</h5>
                                        <p>Monitor AJAX requests, database queries, and errors</p>
                                    </div>
                                </div>
                            </section>

                            <!-- Error Recovery Strategy -->
                            <section>
                                <h2>Error Recovery Strategy</h2>
                                
                                <div class="error-strategy">
                                    <h3>Complete Recovery Plan</h3>
                                    
                                    <div class="strategy-item">
                                        <div class="strategy-number">1</div>
                                        <div>
                                            <strong>Immediate Response</strong>
                                            <p>Show loading state, disable form elements</p>
                                        </div>
                                    </div>
                                    
                                    <div class="strategy-item">
                                        <div class="strategy-number">2</div>
                                        <div>
                                            <strong>Error Classification</strong>
                                            <p>Determine if temporary or permanent</p>
                                        </div>
                                    </div>
                                    
                                    <div class="strategy-item">
                                        <div class="strategy-number">3</div>
                                        <div>
                                            <strong>Retry Logic</strong>
                                            <p>Automatic retry with exponential backoff</p>
                                        </div>
                                    </div>
                                    
                                    <div class="strategy-item">
                                        <div class="strategy-number">4</div>
                                        <div>
                                            <strong>Fallback Options</strong>
                                            <p>Use cache, defaults, or alternative endpoints</p>
                                        </div>
                                    </div>
                                    
                                    <div class="strategy-item">
                                        <div class="strategy-number">5</div>
                                        <div>
                                            <strong>User Communication</strong>
                                            <p>Clear error message with actionable steps</p>
                                        </div>
                                    </div>
                                    
                                    <div class="strategy-item">
                                        <div class="strategy-number">6</div>
                                        <div>
                                            <strong>State Consistency</strong>
                                            <p>Reset UI to prevent inconsistent state</p>
                                        </div>
                                    </div>
                                </div>
                            </section>

                            <!-- Best Practices -->
                            <section>
                                <h2>Best Practices</h2>
                                
                                <div class="tip-box">
                                    <h4>✅ Do's</h4>
                                    <ul>
                                        <li>Always provide user feedback for errors</li>
                                        <li>Implement retry logic with backoff</li>
                                        <li>Log errors for debugging and monitoring</li>
                                        <li>Use appropriate HTTP status codes</li>
                                        <li>Provide fallback options when possible</li>
                                        <li>Test error scenarios thoroughly</li>
                                        <li>Handle network connectivity issues</li>
                                        <li>Validate data on both client and server</li>
                                    </ul>
                                </div>
                                
                                <div class="warning-box">
                                    <h4>⚠️ Don'ts</h4>
                                    <ul>
                                        <li>Don't show technical errors to users</li>
                                        <li>Don't retry indefinitely</li>
                                        <li>Don't ignore error responses</li>
                                        <li>Don't expose sensitive information in errors</li>
                                        <li>Don't leave users in limbo</li>
                                        <li>Don't forget to test edge cases</li>
                                        <li>Don't assume requests always succeed</li>
                                    </ul>
                                </div>
                            </section>

                            <!-- Practice Exercise -->
                            <section>
                                <h2>Practice Exercise</h2>
                                <div class="alert alert-success">
                                    <div class="alert-icon">💻</div>
                                    <div class="alert-content">
                                        <div class="alert-title">Build Robust Error Handling</div>
                                        <div class="alert-message">
                                            <p>Create a file upload system with comprehensive error handling:</p>
                                            
                                            <h4>Requirements:</h4>
                                            <ol>
                                                <li>Handle file size limits</li>
                                                <li>Validate file types</li>
                                                <li>Show upload progress</li>
                                                <li>Handle network interruptions</li>
                                                <li>Implement retry logic</li>
                                                <li>Provide clear error messages</li>
                                                <li>Log all errors</li>
                                                <li>Queue failed uploads</li>
                                            </ol>
                                            
                                            <h4>Error Scenarios to Handle:</h4>
                                            <ul>
                                                <li>File too large</li>
                                                <li>Invalid file type</li>
                                                <li>Network timeout</li>
                                                <li>Server error</li>
                                                <li>Permission denied</li>
                                                <li>Quota exceeded</li>
                                            </ul>
                                        </div>
                                    </div>
                                </div>
                            </section>

                            <!-- Resources -->
                            <section class="resources">
                                <h2>Additional Resources</h2>
                                <ul>
                                    <li><a href="https://developer.mozilla.org/en-US/docs/Web/API/XMLHttpRequest/readyState" target="_blank">XMLHttpRequest States</a></li>
                                    <li><a href="https://developer.mozilla.org/en-US/docs/Web/HTTP/Status" target="_blank">HTTP Status Codes</a></li>
                                    <li><a href="https://api.jquery.com/jQuery.ajax/" target="_blank">jQuery AJAX Documentation</a></li>
                                    <li><a href="https://developer.wordpress.org/reference/functions/wp_send_json_error/" target="_blank">wp_send_json_error()</a></li>
                                    <li><a href="https://www.smashingmagazine.com/2021/03/complete-guide-accessible-front-end-components/" target="_blank">Accessible Error Messages</a></li>
                                </ul>
                            </section>
                        </div>

                        <!-- Lesson Navigation -->
                        <div class="lesson-navigation">
                            <a href="/07module/ajax_security.html" class="lesson-nav-button prev">
                                <svg width="20" height="20" viewBox="0 0 20 20" fill="currentColor">
                                    <path d="M12.707 5.293a1 1 0 010 1.414L9.414 10l3.293 3.293a1 1 0 01-1.414 1.414l-4-4a1 1 0 010-1.414l4-4a1 1 0 011.414 0z"/>
                                </svg>
                                <span>
                                    <small>Previous</small><br>
                                    AJAX Security
                                </span>
                            </a>
                            
                            <button class="complete-lesson-btn">
                                Mark as Complete
                            </button>
                            
                            <a href="/07module/loading_scripts.html" class="lesson-nav-button next">
                                <span>
                                    <small>Next</small><br>
                                    Loading Scripts for AJAX
                                </span>
                                <svg width="20" height="20" viewBox="0 0 20 20" fill="currentColor">
                                    <path d="M7.293 14.707a1 1 0 010-1.414L10.586 10 7.293 6.707a1 1 0 011.414-1.414l4 4a1 1 0 010 1.414l-4 4a1 1 0 01-1.414 0z"/>
                                </svg>
                            </a>
                        </div>
                    </article>
                </div>
            </div>
        </main>

        <!-- Footer -->
        <footer class="site-footer" role="contentinfo">
            <div class="footer-container">
                <div class="footer-content">
                    <div class="footer-section footer-about">
                        <h3>PHP WordPress Development</h3>
                        <p>Complete Web Development Course</p>
                    </div>
                    
                    <div class="footer-section">
                        <h4>Quick Links</h4>
                        <ul class="footer-links">
                            <li><a href="/">Home</a></li>
                            <li><a href="/module6.html">Module 6</a></li>
                            <li><a href="/resources.html">Resources</a></li>
                        </ul>
                    </div>
                    
                    <div class="footer-section">
                        <h4>Support</h4>
                        <ul class="footer-links">
                            <li><a href="/about.html">About</a></li>
                            <li><a href="/contact.html">Contact</a></li>
                        </ul>
                    </div>
                </div>
                
                <div class="footer-bottom">
                    <p>&copy; 2024 PHP WordPress Course. All rights reserved.</p>
                    <p>This course material is for educational purposes only.</p>
                </div>
            </div>
        </footer>
    </div>
    
    <!-- JavaScript for tabs -->
    <script>
    document.addEventListener('DOMContentLoaded', function() {
        const tabButtons = document.querySelectorAll('.tab-nav button');
        const tabPanels = document.querySelectorAll('.tab-panel');
        
        tabButtons.forEach(button => {
            button.addEventListener('click', function() {
                const tabId = this.getAttribute('data-tab');
                
                // Remove active class from all
                tabButtons.forEach(btn => btn.classList.remove('active'));
                tabPanels.forEach(panel => panel.classList.remove('active'));
                
                // Add active class to clicked
                this.classList.add('active');
                document.getElementById(tabId).classList.add('active');
            });
        });
    });
    </script>
    
    <!-- JavaScript -->
    <script src="/assets/js/prism.js"></script>
    <script src="/assets/js/main.js"></script>
    <script src="/assets/js/sidebar-toggle.js"></script>
    <script src="/assets/js/progress-tracker.js"></script>
    <script src="/assets/js/search.js"></script>
    <script src="/assets/js/theme-toggle.js"></script>
</body>
</html>