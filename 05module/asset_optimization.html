<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    
    <!-- SEO Meta Tags -->
    <title>Asset Optimization and Best Practices - WordPress Theme Development - PHP WordPress Course</title>
    <meta name="description" content="Learn asset optimization techniques for WordPress themes. Master minification, compression, lazy loading, critical CSS, and performance best practices.">
    <meta name="keywords" content="PHP, WordPress, asset optimization, performance, minification, lazy loading, critical CSS, caching">
    <meta name="author" content="PHP WordPress Course">
    
    <!-- Favicon -->
    <link rel="icon" type="image/png" href="/favicon.png">
    <link rel="apple-touch-icon" href="/favicon.png">
    
    <!-- CSS -->
    <link rel="stylesheet" href="/assets/css/main.css">
    <link rel="stylesheet" href="/assets/css/sidebar-enhanced.css">
    <link rel="stylesheet" href="/assets/css/sidebar-toggle.css">
    
    <!-- Custom styles for optimization lesson -->
    <style>
        .optimization-header {
            background: linear-gradient(135deg, #00d084 0%, #0693e3 100%);
            color: white;
            padding: 3rem 2rem;
            border-radius: 12px;
            margin-bottom: 2rem;
            text-align: center;
        }

        .optimization-concept {
            background: white;
            border: 2px solid #e5e7eb;
            border-radius: 12px;
            padding: 2rem;
            margin: 2rem 0;
        }

        .optimization-concept h3 {
            color: #00d084;
            margin-top: 0;
            border-bottom: 2px solid #e5e7eb;
            padding-bottom: 1rem;
        }

        .code-example {
            background: #1e293b;
            color: #e2e8f0;
            padding: 1.5rem;
            border-radius: 8px;
            margin: 1.5rem 0;
            overflow-x: auto;
            font-family: 'Courier New', monospace;
        }

        .code-example h4 {
            color: #a5b4fc;
            margin-top: 0;
            border-bottom: 1px solid #475569;
            padding-bottom: 0.5rem;
        }

        .performance-metrics {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1.5rem;
            margin: 2rem 0;
        }

        .metric-card {
            background: linear-gradient(135deg, #f0f9ff 0%, #e0f2fe 100%);
            border: 2px solid #0ea5e9;
            border-radius: 8px;
            padding: 1.5rem;
            text-align: center;
        }

        .metric-card h4 {
            color: #0369a1;
            margin-top: 0;
            font-size: 1rem;
        }

        .metric-card .value {
            font-size: 2rem;
            font-weight: bold;
            color: #0369a1;
            margin: 0.5rem 0;
        }

        .metric-card .description {
            font-size: 0.875rem;
            color: #64748b;
        }

        .optimization-table {
            background: white;
            border: 2px solid #e5e7eb;
            border-radius: 8px;
            overflow: hidden;
            margin: 2rem 0;
        }

        .optimization-table table {
            width: 100%;
            border-collapse: collapse;
        }

        .optimization-table th {
            background: #f3f4f6;
            padding: 1rem;
            text-align: left;
            font-weight: bold;
            border-bottom: 2px solid #e5e7eb;
        }

        .optimization-table td {
            padding: 1rem;
            border-bottom: 1px solid #e5e7eb;
        }

        .optimization-table code {
            background: #f3f4f6;
            padding: 0.2rem 0.4rem;
            border-radius: 3px;
            font-size: 0.875rem;
            color: #00d084;
        }

        .lazy-loading-section {
            background: linear-gradient(135deg, #fef3c7 0%, #fed7aa 100%);
            border: 2px solid #f59e0b;
            border-radius: 12px;
            padding: 2rem;
            margin: 2rem 0;
        }

        .lazy-loading-section h3 {
            color: #92400e;
            margin-top: 0;
        }

        .critical-css-section {
            background: white;
            border: 2px solid #667eea;
            border-radius: 12px;
            padding: 2rem;
            margin: 2rem 0;
        }

        .critical-css-section h3 {
            color: #667eea;
            margin-top: 0;
        }

        .caching-section {
            background: linear-gradient(135deg, #f0fdf4 0%, #dcfce7 100%);
            border: 2px solid #22c55e;
            border-radius: 12px;
            padding: 2rem;
            margin: 2rem 0;
        }

        .caching-section h3 {
            color: #166534;
            margin-top: 0;
        }

        .best-practice {
            background: #f0f9ff;
            border-left: 4px solid #0ea5e9;
            padding: 1rem 1.5rem;
            margin: 1.5rem 0;
        }

        .best-practice h4 {
            color: #0369a1;
            margin-top: 0;
        }

        .warning-box {
            background: #fef3c7;
            border: 2px solid #fbbf24;
            border-radius: 8px;
            padding: 1rem;
            margin: 1.5rem 0;
        }

        .warning-box::before {
            content: "‚ö†Ô∏è Warning: ";
            font-weight: bold;
            color: #92400e;
        }

        .tip-box {
            background: #f0fdf4;
            border: 2px solid #86efac;
            border-radius: 8px;
            padding: 1rem;
            margin: 1.5rem 0;
        }

        .tip-box::before {
            content: "üí° Tip: ";
            font-weight: bold;
            color: #166534;
        }

        .checklist {
            background: white;
            border: 2px solid #e5e7eb;
            border-radius: 8px;
            padding: 1.5rem;
            margin: 2rem 0;
        }

        .checklist h4 {
            color: #00d084;
            margin-top: 0;
        }

        .checklist ul {
            list-style: none;
            padding: 0;
        }

        .checklist li {
            padding: 0.5rem 0;
            padding-left: 2rem;
            position: relative;
        }

        .checklist li::before {
            content: "‚úì";
            position: absolute;
            left: 0;
            color: #22c55e;
            font-weight: bold;
        }

        @media (max-width: 768px) {
            .performance-metrics {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <!-- Skip to main content -->
    <a href="#main-content" class="sr-only">Skip to main content</a>
    
    <div class="page-wrapper">
        <!-- Header -->
        <header class="site-header" role="banner">
            <div class="header-container">
                <div class="site-branding">
                    <a href="/" class="site-logo">
                        <h1 class="site-title">PHP WordPress Development</h1>
                    </a>
                </div>
                
                <nav class="main-navigation" role="navigation" aria-label="Main navigation">
                    <button class="mobile-menu-btn" aria-label="Toggle navigation" aria-expanded="false">
                        <span></span>
                        <span></span>
                        <span></span>
                    </button>
                    
                    <div class="nav-menu">
                        <ul class="nav-list">
                            <li class="nav-item"><a href="/" class="nav-link">Home</a></li>
                            <li class="nav-item dropdown">
                                <button class="nav-link dropdown-toggle active" aria-haspopup="true">Modules</button>
                                <div class="dropdown-menu">
                                    <a href="/module1.html" class="dropdown-item">Module 1: Web Fundamentals</a>
                                    <a href="/module2.html" class="dropdown-item">Module 2: PHP Fundamentals</a>
                                    <a href="/module3.html" class="dropdown-item">Module 3: MySQL Database</a>
                                    <a href="/module4.html" class="dropdown-item">Module 4: WordPress & Docker</a>
                                    <a href="/module5.html" class="dropdown-item active">Module 5: Theme Development</a>
                                    <a href="/module6.html" class="dropdown-item">Module 6: Plugin Development</a>
                                    <a href="/module7.html" class="dropdown-item">Module 7: Advanced WordPress</a>
                                    <a href="/module8.html" class="dropdown-item">Module 8: Deployment</a>
                                    <a href="/module9.html" class="dropdown-item">Module 9: Final Project</a>
                                </div>
                            </li>
                            <li class="nav-item"><a href="/resources.html" class="nav-link">Resources</a></li>
                            <li class="nav-item"><a href="/about.html" class="nav-link">About</a></li>
                        </ul>
                    </div>
                </nav>
                
                <div class="search-container">
                    <div class="search-input-wrapper">
                        <svg class="search-icon" width="20" height="20" viewBox="0 0 20 20" fill="currentColor">
                            <path fill-rule="evenodd" d="M8 4a4 4 0 100 8 4 4 0 000-8zM2 8a6 6 0 1110.89 3.476l4.817 4.817a1 1 0 01-1.414 1.414l-4.816-4.816A6 6 0 012 8z" clip-rule="evenodd" />
                        </svg>
                        <input type="search" class="search-input" placeholder="Search lessons..." aria-label="Search">
                    </div>
                    <div class="search-results"></div>
                </div>
            </div>
        </header>
        
        <!-- Progress Bar -->
        <div class="progress-container">
            <div class="progress-header">
                <h2 class="progress-title">Course Progress</h2>
                <span class="progress-text">Loading...</span>
            </div>
            <div class="progress-bar">
                <div class="progress-bar-fill">
                    <span class="progress-bar-text"></span>
                </div>
            </div>
        </div>
        
        <!-- Breadcrumb -->
        <nav class="breadcrumb container" aria-label="Breadcrumb">
            <ol class="breadcrumb-list">
                <li class="breadcrumb-item">
                    <a href="/">Home</a>
                    <span class="breadcrumb-separator">/</span>
                </li>
                <li class="breadcrumb-item">
                    <a href="/module5.html">Module 5</a>
                    <span class="breadcrumb-separator">/</span>
                </li>
                <li class="breadcrumb-item">
                    <span aria-current="page">Asset Optimization and Best Practices</span>
                </li>
            </ol>
        </nav>
        
        <!-- Main Content -->
        <main id="main-content" class="main-content" role="main">
            <div class="container">
                <div class="content-with-sidebar">
                    <!-- Sidebar -->
                    <aside class="sidebar">
                        <div class="sidebar-nav">
                            <h3 class="sidebar-title">Module 5: Theme Development</h3>
                            <div class="sidebar-section">
                                <h4 class="sidebar-section-title">Session 8: Theme Assets and Frontend</h4>
                                <ul class="sidebar-menu">
                                    <li><a class="sidebar-link" href="/05module/asset_organization.html">Asset Organization in Themes</a></li>
                                    <li><a class="sidebar-link" href="/05module/responsive_design.html">Responsive Design Implementation</a></li>
                                    <li><a class="sidebar-link" href="/05module/sass_in_themes.html">Using Sass in Theme Development</a></li>
                                    <li><a class="sidebar-link" href="/05module/javascript_in_themes.html">JavaScript in WordPress Themes</a></li>
                                    <li><a class="sidebar-link" href="/05module/jquery_wordpress.html">Working with jQuery in WordPress</a></li>
                                    <li><a class="sidebar-link" href="/05module/third_party_libraries.html">Using Third-party Libraries</a></li>
                                    <li class="active"><a class="sidebar-link active" href="/05module/asset_optimization.html">Asset Optimization and Best Practices</a></li>
                                    <li><a class="sidebar-link" href="/05module/homework_assets_frontend.html">Homework: Assets & Frontend</a></li>
                                </ul>
                            </div>
                            <div class="sidebar-section">
                                <h4 class="sidebar-section-title">Quick Links</h4>
                                <ul class="sidebar-menu">
                                    <li><a class="sidebar-link" href="/module5.html">Module Overview</a></li>
                                    <li><a class="sidebar-link" href="/05module/third_party_libraries.html">‚Üê Previous Lesson</a></li>
                                    <li><a class="sidebar-link next-session" href="/05module/homework_assets_frontend.html">Next: Homework ‚Üí</a></li>
                                    <li><a class="sidebar-link" href="/">‚Üê Course Home</a></li>
                                    <li><a class="sidebar-link" href="/resources.html">Resources</a></li>
                                </ul>
                            </div>
                        </div>
                    </aside>
                    
                    <!-- Main Lesson Content -->
                    <article class="lesson-content">
                        <div class="optimization-header">
                            <h1>‚ö° Asset Optimization and Best Practices</h1>
                            <p class="lead">Maximize WordPress theme performance</p>
                            <p>Learn minification, compression, lazy loading, and advanced optimization techniques</p>
                        </div>

                        <!-- Learning Objectives -->
                        <div class="lesson-objectives">
                            <h2>Learning Objectives</h2>
                            <ul>
                                <li>Understand performance metrics and goals</li>
                                <li>Implement asset minification and compression</li>
                                <li>Master lazy loading techniques</li>
                                <li>Optimize critical rendering path</li>
                                <li>Implement browser caching strategies</li>
                                <li>Use CDNs effectively</li>
                                <li>Optimize images and media</li>
                                <li>Apply performance best practices</li>
                            </ul>
                        </div>
                        
                        <!-- Lesson Body -->
                        <div class="lesson-body">
                            <!-- Introduction -->
                            <section>
                                <h2>Why Asset Optimization Matters</h2>
                                <p class="lead">Website performance directly impacts user experience, SEO rankings, and conversion rates. Optimizing assets in WordPress themes is crucial for creating fast, efficient websites.</p>
                                
                                <div class="performance-metrics">
                                    <div class="metric-card">
                                        <h4>First Contentful Paint</h4>
                                        <div class="value">&lt; 1.8s</div>
                                        <div class="description">Good performance target</div>
                                    </div>
                                    
                                    <div class="metric-card">
                                        <h4>Largest Contentful Paint</h4>
                                        <div class="value">&lt; 2.5s</div>
                                        <div class="description">Main content visible</div>
                                    </div>
                                    
                                    <div class="metric-card">
                                        <h4>Time to Interactive</h4>
                                        <div class="value">&lt; 3.8s</div>
                                        <div class="description">Page fully interactive</div>
                                    </div>
                                    
                                    <div class="metric-card">
                                        <h4>Cumulative Layout Shift</h4>
                                        <div class="value">&lt; 0.1</div>
                                        <div class="description">Visual stability</div>
                                    </div>
                                </div>

                                <div class="alert alert-info">
                                    <div class="alert-icon">üí°</div>
                                    <div class="alert-content">
                                        <div class="alert-title">Key Insight</div>
                                        <div class="alert-message">A 1-second delay in page load time can result in a 7% reduction in conversions and 11% fewer page views.</div>
                                    </div>
                                </div>
                            </section>

                            <!-- Minification and Compression -->
                            <section>
                                <h2>Minification and Compression</h2>
                                
                                <div class="optimization-concept">
                                    <h3>Asset Minification</h3>
                                    
                                    <div class="code-example">
                                        <h4>WordPress Minification Setup</h4>
                                        <pre><code class="language-php">&lt;?php
// functions.php

class ThemeAssetOptimizer {
    private $minify_css = true;
    private $minify_js = true;
    private $combine_files = true;
    
    public function __construct() {
        add_action('wp_enqueue_scripts', array($this, 'optimize_assets'), 999);
        add_filter('script_loader_tag', array($this, 'add_async_defer'), 10, 3);
        add_filter('style_loader_tag', array($this, 'optimize_css_loading'), 10, 4);
    }
    
    public function optimize_assets() {
        if (!is_admin() && !is_customize_preview()) {
            // Remove version strings
            add_filter('script_loader_src', array($this, 'remove_version_strings'), 15, 1);
            add_filter('style_loader_src', array($this, 'remove_version_strings'), 15, 1);
            
            // Conditionally load assets
            $this->conditional_loading();
            
            // Load minified versions in production
            if (!WP_DEBUG) {
                $this->load_minified_assets();
            }
        }
    }
    
    private function load_minified_assets() {
        // Dequeue original and enqueue minified
        if (wp_style_is('theme-style', 'enqueued')) {
            wp_dequeue_style('theme-style');
            wp_enqueue_style(
                'theme-style-min',
                get_template_directory_uri() . '/assets/css/style.min.css',
                array(),
                filemtime(get_template_directory() . '/assets/css/style.min.css')
            );
        }
        
        if (wp_script_is('theme-script', 'enqueued')) {
            wp_dequeue_script('theme-script');
            wp_enqueue_script(
                'theme-script-min',
                get_template_directory_uri() . '/assets/js/main.min.js',
                array(),
                filemtime(get_template_directory() . '/assets/js/main.min.js'),
                true
            );
        }
    }
    
    private function conditional_loading() {
        // Only load contact form scripts on contact page
        if (!is_page('contact')) {
            wp_dequeue_script('contact-form-7');
            wp_dequeue_style('contact-form-7');
        }
        
        // Only load comment scripts on single posts with comments
        if (!is_singular() || !comments_open()) {
            wp_dequeue_script('comment-reply');
        }
        
        // Remove block library CSS if not using Gutenberg
        if (!has_blocks()) {
            wp_dequeue_style('wp-block-library');
            wp_dequeue_style('wp-block-library-theme');
        }
    }
    
    public function add_async_defer($tag, $handle, $src) {
        // Async loading for non-critical scripts
        $async_scripts = array('google-analytics', 'facebook-pixel');
        if (in_array($handle, $async_scripts)) {
            return str_replace(' src', ' async src', $tag);
        }
        
        // Defer loading for other scripts
        $defer_scripts = array('theme-script-min', 'animations');
        if (in_array($handle, $defer_scripts)) {
            return str_replace(' src', ' defer src', $tag);
        }
        
        return $tag;
    }
    
    public function optimize_css_loading($html, $handle, $href, $media) {
        // Preload critical CSS
        $critical_styles = array('theme-critical', 'above-fold');
        if (in_array($handle, $critical_styles)) {
            $html = sprintf(
                '&lt;link rel="preload" as="style" href="%s" onload="this.onload=null;this.rel=\'stylesheet\'"&gt;
                &lt;noscript&gt;%s&lt;/noscript&gt;',
                $href,
                $html
            );
        }
        
        return $html;
    }
    
    public function remove_version_strings($src) {
        if (strpos($src, 'ver=')) {
            $src = remove_query_arg('ver', $src);
        }
        return $src;
    }
}

// Initialize optimizer
new ThemeAssetOptimizer();</code></pre>
                                    </div>

                                    <div class="code-example">
                                        <h4>Gulp Task for Minification</h4>
                                        <pre><code class="language-javascript">// gulpfile.js
const gulp = require('gulp');
const uglify = require('gulp-uglify');
const cleanCSS = require('gulp-clean-css');
const concat = require('gulp-concat');
const sourcemaps = require('gulp-sourcemaps');
const imagemin = require('gulp-imagemin');
const gzip = require('gulp-gzip');

// Minify JavaScript
gulp.task('minify-js', () => {
    return gulp.src('assets/js/*.js')
        .pipe(sourcemaps.init())
        .pipe(concat('main.min.js'))
        .pipe(uglify({
            compress: {
                drop_console: true,
                drop_debugger: true
            }
        }))
        .pipe(sourcemaps.write('./'))
        .pipe(gulp.dest('dist/js'))
        .pipe(gzip())
        .pipe(gulp.dest('dist/js'));
});

// Minify CSS
gulp.task('minify-css', () => {
    return gulp.src('assets/css/*.css')
        .pipe(sourcemaps.init())
        .pipe(concat('style.min.css'))
        .pipe(cleanCSS({
            level: {
                1: {
                    specialComments: 0
                },
                2: {
                    mergeMedia: true,
                    removeEmpty: true,
                    removeDuplicates: true
                }
            }
        }))
        .pipe(sourcemaps.write('./'))
        .pipe(gulp.dest('dist/css'))
        .pipe(gzip())
        .pipe(gulp.dest('dist/css'));
});

// Optimize images
gulp.task('optimize-images', () => {
    return gulp.src('assets/images/**/*')
        .pipe(imagemin([
            imagemin.gifsicle({interlaced: true}),
            imagemin.mozjpeg({quality: 75, progressive: true}),
            imagemin.optipng({optimizationLevel: 5}),
            imagemin.svgo({
                plugins: [
                    {removeViewBox: true},
                    {cleanupIDs: false}
                ]
            })
        ]))
        .pipe(gulp.dest('dist/images'));
});

// Watch task
gulp.task('watch', () => {
    gulp.watch('assets/js/*.js', gulp.series('minify-js'));
    gulp.watch('assets/css/*.css', gulp.series('minify-css'));
    gulp.watch('assets/images/**/*', gulp.series('optimize-images'));
});

// Default task
gulp.task('default', gulp.parallel('minify-js', 'minify-css', 'optimize-images'));</code></pre>
                                    </div>
                                </div>
                            </section>

                            <!-- Lazy Loading -->
                            <section>
                                <div class="lazy-loading-section">
                                    <h3>Implementing Lazy Loading</h3>
                                    
                                    <div class="code-example">
                                        <h4>Native Lazy Loading</h4>
                                        <pre><code class="language-php">&lt;?php
// functions.php

// Add lazy loading to images
function mytheme_add_lazy_loading($content) {
    // Add loading="lazy" to images
    $content = preg_replace(
        '/&lt;img(.*?)src=/i',
        '&lt;img$1loading="lazy" src=',
        $content
    );
    
    // Add loading="lazy" to iframes
    $content = preg_replace(
        '/&lt;iframe(.*?)src=/i',
        '&lt;iframe$1loading="lazy" src=',
        $content
    );
    
    return $content;
}
add_filter('the_content', 'mytheme_add_lazy_loading');

// Lazy load post thumbnails
function mytheme_lazy_load_thumbnails($attr, $attachment, $size) {
    $attr['loading'] = 'lazy';
    
    // Add data attributes for advanced lazy loading
    $attr['data-src'] = $attr['src'];
    $attr['src'] = 'data:image/svg+xml,%3Csvg xmlns=\'http://www.w3.org/2000/svg\' viewBox=\'0 0 1 1\'%3E%3C/svg%3E';
    $attr['class'] = isset($attr['class']) ? $attr['class'] . ' lazyload' : 'lazyload';
    
    return $attr;
}
add_filter('wp_get_attachment_image_attributes', 'mytheme_lazy_load_thumbnails', 10, 3);</code></pre>
                                    </div>

                                    <div class="code-example">
                                        <h4>JavaScript Lazy Loading with Intersection Observer</h4>
                                        <pre><code class="language-javascript">// lazy-load.js
class LazyLoader {
    constructor() {
        this.images = document.querySelectorAll('img[data-src]');
        this.videos = document.querySelectorAll('video[data-src]');
        this.iframes = document.querySelectorAll('iframe[data-src]');
        
        this.imageOptions = {
            threshold: 0.01,
            rootMargin: '50px'
        };
        
        this.init();
    }
    
    init() {
        if ('IntersectionObserver' in window) {
            this.createObserver();
        } else {
            // Fallback for older browsers
            this.loadAllImages();
        }
    }
    
    createObserver() {
        const imageObserver = new IntersectionObserver((entries, observer) => {
            entries.forEach(entry => {
                if (entry.isIntersecting) {
                    this.loadElement(entry.target);
                    observer.unobserve(entry.target);
                }
            });
        }, this.imageOptions);
        
        // Observe all lazy elements
        this.images.forEach(img => imageObserver.observe(img));
        this.videos.forEach(video => imageObserver.observe(video));
        this.iframes.forEach(iframe => imageObserver.observe(iframe));
    }
    
    loadElement(element) {
        const src = element.dataset.src;
        const srcset = element.dataset.srcset;
        
        if (!src) return;
        
        // Handle different element types
        if (element.tagName === 'IMG') {
            this.loadImage(element, src, srcset);
        } else if (element.tagName === 'VIDEO') {
            this.loadVideo(element, src);
        } else if (element.tagName === 'IFRAME') {
            this.loadIframe(element, src);
        }
    }
    
    loadImage(img, src, srcset) {
        // Preload image
        const tempImg = new Image();
        
        tempImg.onload = () => {
            img.src = src;
            if (srcset) {
                img.srcset = srcset;
            }
            img.classList.add('loaded');
            img.classList.remove('lazyload');
        };
        
        tempImg.src = src;
        if (srcset) {
            tempImg.srcset = srcset;
        }
    }
    
    loadVideo(video, src) {
        video.src = src;
        video.load();
        video.classList.add('loaded');
    }
    
    loadIframe(iframe, src) {
        iframe.src = src;
        iframe.classList.add('loaded');
    }
    
    loadAllImages() {
        // Fallback: load all images immediately
        this.images.forEach(img => {
            if (img.dataset.src) {
                img.src = img.dataset.src;
                if (img.dataset.srcset) {
                    img.srcset = img.dataset.srcset;
                }
            }
        });
    }
}

// Initialize on DOM ready
document.addEventListener('DOMContentLoaded', () => {
    new LazyLoader();
});

// Reinitialize after AJAX content loads
document.addEventListener('ajax-content-loaded', () => {
    new LazyLoader();
});</code></pre>
                                    </div>

                                    <div class="code-example">
                                        <h4>Background Image Lazy Loading</h4>
                                        <pre><code class="language-javascript">// Lazy load background images
class BackgroundLazyLoader {
    constructor() {
        this.elements = document.querySelectorAll('[data-bg]');
        this.init();
    }
    
    init() {
        if ('IntersectionObserver' in window) {
            const bgObserver = new IntersectionObserver((entries) => {
                entries.forEach(entry => {
                    if (entry.isIntersecting) {
                        const element = entry.target;
                        const bg = element.dataset.bg;
                        
                        element.style.backgroundImage = `url(${bg})`;
                        element.classList.add('bg-loaded');
                        
                        bgObserver.unobserve(element);
                    }
                });
            });
            
            this.elements.forEach(el => bgObserver.observe(el));
        } else {
            // Immediate load for unsupported browsers
            this.elements.forEach(el => {
                el.style.backgroundImage = `url(${el.dataset.bg})`;
            });
        }
    }
}

new BackgroundLazyLoader();</code></pre>
                                    </div>
                                </div>
                            </section>

                            <!-- Critical CSS -->
                            <section>
                                <div class="critical-css-section">
                                    <h3>Critical CSS and Above-the-Fold Optimization</h3>
                                    
                                    <div class="code-example">
                                        <h4>Inline Critical CSS</h4>
                                        <pre><code class="language-php">&lt;?php
// functions.php

function mytheme_inline_critical_css() {
    $critical_css_file = get_template_directory() . '/assets/css/critical.min.css';
    
    if (file_exists($critical_css_file)) {
        $critical_css = file_get_contents($critical_css_file);
        echo '&lt;style id="critical-css"&gt;' . $critical_css . '&lt;/style&gt;';
    }
}
add_action('wp_head', 'mytheme_inline_critical_css', 5);

// Load main CSS asynchronously
function mytheme_async_styles() {
    ?&gt;
    &lt;script&gt;
    // Async CSS loading
    function loadCSS(href) {
        const link = document.createElement('link');
        link.rel = 'stylesheet';
        link.href = href;
        link.media = 'print';
        link.onload = function() { this.media = 'all'; };
        document.head.appendChild(link);
    }
    
    // Load non-critical CSS
    loadCSS('&lt;?php echo get_template_directory_uri(); ?&gt;/assets/css/style.min.css');
    &lt;/script&gt;
    
    &lt;noscript&gt;
        &lt;link rel="stylesheet" href="&lt;?php echo get_template_directory_uri(); ?&gt;/assets/css/style.min.css"&gt;
    &lt;/noscript&gt;
    &lt;?php
}
add_action('wp_head', 'mytheme_async_styles', 100);</code></pre>
                                    </div>

                                    <div class="code-example">
                                        <h4>Generate Critical CSS with Node</h4>
                                        <pre><code class="language-javascript">// generate-critical.js
const critical = require('critical');

critical.generate({
    base: './',
    src: 'index.html',
    css: ['assets/css/style.css'],
    width: 1300,
    height: 900,
    target: {
        css: 'assets/css/critical.min.css',
        uncritical: 'assets/css/uncritical.min.css'
    },
    minify: true,
    extract: true,
    ignore: {
        atrule: ['@font-face'],
        decl: (node, value) => /url\(/.test(value)
    }
});</code></pre>
                                    </div>

                                    <div class="code-example">
                                        <h4>Resource Hints</h4>
                                        <pre><code class="language-php">&lt;?php
// Add resource hints for faster loading
function mytheme_resource_hints($hints, $relation_type) {
    // DNS Prefetch for external domains
    if ('dns-prefetch' === $relation_type) {
        $hints[] = '//fonts.googleapis.com';
        $hints[] = '//fonts.gstatic.com';
        $hints[] = '//cdnjs.cloudflare.com';
        $hints[] = '//www.google-analytics.com';
    }
    
    // Preconnect for critical resources
    if ('preconnect' === $relation_type) {
        $hints[] = 'https://fonts.googleapis.com';
        $hints[] = 'https://fonts.gstatic.com';
    }
    
    return $hints;
}
add_filter('wp_resource_hints', 'mytheme_resource_hints', 10, 2);

// Preload critical resources
function mytheme_preload_resources() {
    // Preload fonts
    echo '&lt;link rel="preload" as="font" type="font/woff2" crossorigin href="' . 
         get_template_directory_uri() . '/assets/fonts/main-font.woff2"&gt;';
    
    // Preload hero image
    if (is_front_page()) {
        $hero_image = get_theme_mod('hero_image');
        if ($hero_image) {
            echo '&lt;link rel="preload" as="image" href="' . esc_url($hero_image) . '"&gt;';
        }
    }
    
    // Prefetch next page
    if (is_single()) {
        $next_post = get_next_post();
        if ($next_post) {
            echo '&lt;link rel="prefetch" href="' . get_permalink($next_post) . '"&gt;';
        }
    }
}
add_action('wp_head', 'mytheme_preload_resources', 2);</code></pre>
                                    </div>
                                </div>
                            </section>

                            <!-- Browser Caching -->
                            <section>
                                <div class="caching-section">
                                    <h3>Browser Caching and Service Workers</h3>
                                    
                                    <div class="code-example">
                                        <h4>.htaccess Caching Rules</h4>
                                        <pre><code class="language-apache"># Browser Caching
&lt;IfModule mod_expires.c&gt;
    ExpiresActive On
    
    # Images
    ExpiresByType image/jpeg "access plus 1 year"
    ExpiresByType image/jpg "access plus 1 year"
    ExpiresByType image/png "access plus 1 year"
    ExpiresByType image/gif "access plus 1 year"
    ExpiresByType image/svg+xml "access plus 1 year"
    ExpiresByType image/webp "access plus 1 year"
    
    # CSS and JavaScript
    ExpiresByType text/css "access plus 1 month"
    ExpiresByType application/javascript "access plus 1 month"
    ExpiresByType text/javascript "access plus 1 month"
    
    # Fonts
    ExpiresByType font/woff2 "access plus 1 year"
    ExpiresByType font/woff "access plus 1 year"
    ExpiresByType font/ttf "access plus 1 year"
    ExpiresByType font/otf "access plus 1 year"
    
    # HTML
    ExpiresByType text/html "access plus 0 seconds"
    
    # Default
    ExpiresDefault "access plus 2 days"
&lt;/IfModule&gt;

# Cache-Control Headers
&lt;IfModule mod_headers.c&gt;
    # Images
    &lt;FilesMatch "\.(jpg|jpeg|png|gif|svg|webp|ico)$"&gt;
        Header set Cache-Control "public, max-age=31536000, immutable"
    &lt;/FilesMatch&gt;
    
    # CSS and JS
    &lt;FilesMatch "\.(css|js)$"&gt;
        Header set Cache-Control "public, max-age=2592000"
    &lt;/FilesMatch&gt;
    
    # Fonts
    &lt;FilesMatch "\.(woff|woff2|ttf|otf|eot)$"&gt;
        Header set Cache-Control "public, max-age=31536000"
    &lt;/FilesMatch&gt;
    
    # Disable caching for dynamic content
    &lt;FilesMatch "\.(php|html?)$"&gt;
        Header set Cache-Control "no-cache, no-store, must-revalidate"
        Header set Pragma "no-cache"
        Header set Expires "0"
    &lt;/FilesMatch&gt;
&lt;/IfModule&gt;

# Enable Gzip Compression
&lt;IfModule mod_deflate.c&gt;
    AddOutputFilterByType DEFLATE text/html
    AddOutputFilterByType DEFLATE text/css
    AddOutputFilterByType DEFLATE text/javascript
    AddOutputFilterByType DEFLATE application/javascript
    AddOutputFilterByType DEFLATE application/json
    AddOutputFilterByType DEFLATE application/xml
    AddOutputFilterByType DEFLATE image/svg+xml
&lt;/IfModule&gt;</code></pre>
                                    </div>

                                    <div class="code-example">
                                        <h4>Service Worker for Offline Caching</h4>
                                        <pre><code class="language-javascript">// service-worker.js
const CACHE_NAME = 'mytheme-v1.0.0';
const urlsToCache = [
    '/',
    '/wp-content/themes/mytheme/assets/css/critical.min.css',
    '/wp-content/themes/mytheme/assets/js/main.min.js',
    '/wp-content/themes/mytheme/assets/fonts/main-font.woff2',
    '/offline.html'
];

// Install event
self.addEventListener('install', event => {
    event.waitUntil(
        caches.open(CACHE_NAME)
            .then(cache => {
                console.log('Opened cache');
                return cache.addAll(urlsToCache);
            })
    );
});

// Fetch event
self.addEventListener('fetch', event => {
    event.respondWith(
        caches.match(event.request)
            .then(response => {
                // Cache hit - return response
                if (response) {
                    return response;
                }
                
                // Clone the request
                const fetchRequest = event.request.clone();
                
                return fetch(fetchRequest).then(response => {
                    // Check if valid response
                    if (!response || response.status !== 200 || response.type !== 'basic') {
                        return response;
                    }
                    
                    // Clone the response
                    const responseToCache = response.clone();
                    
                    // Cache the response
                    caches.open(CACHE_NAME)
                        .then(cache => {
                            cache.put(event.request, responseToCache);
                        });
                    
                    return response;
                });
            })
            .catch(() => {
                // Return offline page for navigation requests
                if (event.request.mode === 'navigate') {
                    return caches.match('/offline.html');
                }
            })
    );
});

// Activate event
self.addEventListener('activate', event => {
    const cacheWhitelist = [CACHE_NAME];
    
    event.waitUntil(
        caches.keys().then(cacheNames => {
            return Promise.all(
                cacheNames.map(cacheName => {
                    if (cacheWhitelist.indexOf(cacheName) === -1) {
                        return caches.delete(cacheName);
                    }
                })
            );
        })
    );
});</code></pre>
                                    </div>

                                    <div class="code-example">
                                        <h4>Register Service Worker</h4>
                                        <pre><code class="language-php">&lt;?php
// Register service worker
function mytheme_register_service_worker() {
    ?&gt;
    &lt;script&gt;
    if ('serviceWorker' in navigator) {
        window.addEventListener('load', function() {
            navigator.serviceWorker.register('&lt;?php echo get_template_directory_uri(); ?&gt;/service-worker.js')
                .then(function(registration) {
                    console.log('ServiceWorker registration successful');
                }, function(err) {
                    console.log('ServiceWorker registration failed: ', err);
                });
        });
    }
    &lt;/script&gt;
    &lt;?php
}
add_action('wp_footer', 'mytheme_register_service_worker');</code></pre>
                                    </div>
                                </div>
                            </section>

                            <!-- Image Optimization -->
                            <section>
                                <h2>Image and Media Optimization</h2>
                                
                                <div class="code-example">
                                    <h4>Responsive Images with srcset</h4>
                                    <pre><code class="language-php">&lt;?php
// Generate responsive images
function mytheme_responsive_image($attachment_id, $sizes = array()) {
    $default_sizes = array(
        '(max-width: 480px) 480px',
        '(max-width: 768px) 768px',
        '(max-width: 1024px) 1024px',
        '1920px'
    );
    
    $sizes = !empty($sizes) ? $sizes : $default_sizes;
    $img_src = wp_get_attachment_image_src($attachment_id, 'full');
    $img_srcset = wp_get_attachment_image_srcset($attachment_id, 'full');
    $img_sizes = implode(', ', $sizes);
    
    $output = sprintf(
        '&lt;img src="%s" srcset="%s" sizes="%s" loading="lazy" alt="%s"&gt;',
        esc_url($img_src[0]),
        esc_attr($img_srcset),
        esc_attr($img_sizes),
        esc_attr(get_post_meta($attachment_id, '_wp_attachment_image_alt', true))
    );
    
    return $output;
}

// Add WebP support
function mytheme_webp_support($mimes) {
    $mimes['webp'] = 'image/webp';
    return $mimes;
}
add_filter('mime_types', 'mytheme_webp_support');

// Serve WebP images when available
function mytheme_serve_webp($image_url) {
    $image_path = str_replace(site_url(), ABSPATH, $image_url);
    $webp_path = preg_replace('/\.(jpg|jpeg|png)$/i', '.webp', $image_path);
    $webp_url = preg_replace('/\.(jpg|jpeg|png)$/i', '.webp', $image_url);
    
    if (file_exists($webp_path) && mytheme_browser_supports_webp()) {
        return $webp_url;
    }
    
    return $image_url;
}

function mytheme_browser_supports_webp() {
    return isset($_SERVER['HTTP_ACCEPT']) && 
           strpos($_SERVER['HTTP_ACCEPT'], 'image/webp') !== false;
}</code></pre>
                                </div>

                                <div class="code-example">
                                    <h4>Optimize Upload Images</h4>
                                    <pre><code class="language-php">&lt;?php
// Automatically optimize uploaded images
function mytheme_optimize_uploaded_image($metadata, $attachment_id) {
    $uploads_dir = wp_upload_dir();
    $file_path = $uploads_dir['basedir'] . '/' . $metadata['file'];
    
    // Get image type
    $image_type = wp_check_filetype($file_path);
    
    switch ($image_type['type']) {
        case 'image/jpeg':
        case 'image/jpg':
            $image = imagecreatefromjpeg($file_path);
            imagejpeg($image, $file_path, 85); // 85% quality
            break;
            
        case 'image/png':
            $image = imagecreatefrompng($file_path);
            imagepng($image, $file_path, 8); // Compression level 8
            break;
    }
    
    if (isset($image)) {
        imagedestroy($image);
    }
    
    // Optimize thumbnails
    if (isset($metadata['sizes'])) {
        foreach ($metadata['sizes'] as $size => $data) {
            $thumb_path = $uploads_dir['basedir'] . '/' . 
                         dirname($metadata['file']) . '/' . $data['file'];
            
            // Apply same optimization to thumbnails
            if (file_exists($thumb_path)) {
                // Optimization code here
            }
        }
    }
    
    return $metadata;
}
add_filter('wp_generate_attachment_metadata', 'mytheme_optimize_uploaded_image', 10, 2);</code></pre>
                                </div>
                            </section>

                            <!-- Performance Monitoring -->
                            <section>
                                <h2>Performance Monitoring</h2>
                                
                                <div class="code-example">
                                    <h4>Performance Monitoring Script</h4>
                                    <pre><code class="language-javascript">// performance-monitor.js
class PerformanceMonitor {
    constructor() {
        this.metrics = {};
        this.init();
    }
    
    init() {
        if ('performance' in window && 'PerformanceObserver' in window) {
            this.observePerformance();
            this.measureMetrics();
        }
    }
    
    observePerformance() {
        // Observe Largest Contentful Paint
        const lcpObserver = new PerformanceObserver((list) => {
            const entries = list.getEntries();
            const lastEntry = entries[entries.length - 1];
            this.metrics.lcp = lastEntry.renderTime || lastEntry.loadTime;
            console.log('LCP:', this.metrics.lcp);
        });
        lcpObserver.observe({ entryTypes: ['largest-contentful-paint'] });
        
        // Observe First Input Delay
        const fidObserver = new PerformanceObserver((list) => {
            const entries = list.getEntries();
            entries.forEach(entry => {
                this.metrics.fid = entry.processingStart - entry.startTime;
                console.log('FID:', this.metrics.fid);
            });
        });
        fidObserver.observe({ entryTypes: ['first-input'] });
        
        // Observe Cumulative Layout Shift
        let clsValue = 0;
        const clsObserver = new PerformanceObserver((list) => {
            for (const entry of list.getEntries()) {
                if (!entry.hadRecentInput) {
                    clsValue += entry.value;
                }
            }
            this.metrics.cls = clsValue;
            console.log('CLS:', this.metrics.cls);
        });
        clsObserver.observe({ entryTypes: ['layout-shift'] });
    }
    
    measureMetrics() {
        window.addEventListener('load', () => {
            const perfData = performance.getEntriesByType('navigation')[0];
            
            // Calculate metrics
            this.metrics.domContentLoaded = perfData.domContentLoadedEventEnd - perfData.domContentLoadedEventStart;
            this.metrics.loadComplete = perfData.loadEventEnd - perfData.loadEventStart;
            this.metrics.domInteractive = perfData.domInteractive;
            this.metrics.firstByte = perfData.responseStart - perfData.requestStart;
            
            // Send to analytics
            this.sendMetrics();
        });
    }
    
    sendMetrics() {
        // Send to Google Analytics
        if (typeof gtag !== 'undefined') {
            gtag('event', 'performance', {
                'event_category': 'Web Vitals',
                'event_label': 'Page Load',
                'value': Math.round(this.metrics.lcp),
                'metric_lcp': this.metrics.lcp,
                'metric_fid': this.metrics.fid,
                'metric_cls': this.metrics.cls
            });
        }
        
        // Or send to custom endpoint
        fetch('/wp-json/mytheme/v1/performance', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
            },
            body: JSON.stringify(this.metrics)
        });
    }
}

// Initialize
new PerformanceMonitor();</code></pre>
                                </div>
                            </section>

                            <!-- Optimization Checklist -->
                            <section>
                                <h2>Complete Optimization Checklist</h2>
                                
                                <div class="checklist">
                                    <h4>Pre-Launch Optimization Checklist</h4>
                                    <ul>
                                        <li>Minify all CSS and JavaScript files</li>
                                        <li>Combine and bundle assets where appropriate</li>
                                        <li>Implement lazy loading for images and videos</li>
                                        <li>Generate and inline critical CSS</li>
                                        <li>Add resource hints (dns-prefetch, preconnect, preload)</li>
                                        <li>Optimize and compress all images</li>
                                        <li>Provide WebP alternatives for images</li>
                                        <li>Configure browser caching headers</li>
                                        <li>Enable Gzip/Brotli compression</li>
                                        <li>Remove unused CSS and JavaScript</li>
                                        <li>Defer non-critical JavaScript</li>
                                        <li>Optimize web fonts loading</li>
                                        <li>Implement service worker for offline support</li>
                                        <li>Remove query strings from static resources</li>
                                        <li>Optimize database queries</li>
                                        <li>Use CDN for static assets</li>
                                        <li>Test with PageSpeed Insights</li>
                                        <li>Monitor Core Web Vitals</li>
                                        <li>Implement performance budgets</li>
                                        <li>Document optimization strategies</li>
                                    </ul>
                                </div>
                            </section>

                            <!-- Best Practices -->
                            <section>
                                <h2>Best Practices</h2>
                                
                                <div class="best-practice">
                                    <h4>Asset Optimization Best Practices</h4>
                                    <ul>
                                        <li><strong>Mobile-first approach:</strong> Optimize for mobile devices first</li>
                                        <li><strong>Progressive enhancement:</strong> Start with basic functionality</li>
                                        <li><strong>Performance budgets:</strong> Set limits for page weight and load time</li>
                                        <li><strong>Regular audits:</strong> Use Lighthouse and WebPageTest regularly</li>
                                        <li><strong>Monitor real users:</strong> Track Core Web Vitals in production</li>
                                        <li><strong>Optimize critical path:</strong> Prioritize above-the-fold content</li>
                                        <li><strong>Use modern formats:</strong> WebP, AVIF for images, WOFF2 for fonts</li>
                                        <li><strong>Eliminate render-blocking:</strong> Async/defer scripts, critical CSS</li>
                                        <li><strong>Cache aggressively:</strong> Use long cache lifetimes with versioning</li>
                                        <li><strong>Test thoroughly:</strong> Check performance across devices and networks</li>
                                    </ul>
                                </div>

                                <div class="warning-box">
                                    Over-optimization can lead to maintainability issues. Find the right balance between performance and code complexity. Always measure the impact of optimizations.
                                </div>

                                <div class="tip-box">
                                    Use Chrome DevTools' Coverage tab to identify unused CSS and JavaScript. This can help you eliminate dead code and reduce bundle sizes.
                                </div>
                            </section>

                            <!-- Practice Exercise -->
                            <section>
                                <h2>Practice Exercise</h2>
                                <div class="alert alert-success">
                                    <div class="alert-icon">üíª</div>
                                    <div class="alert-content">
                                        <div class="alert-title">Optimize Your Theme</div>
                                        <div class="alert-message">
                                            <p>Apply optimization techniques to your theme:</p>
                                            <ol>
                                                <li>Set up build process for minification</li>
                                                <li>Implement lazy loading for all images</li>
                                                <li>Extract and inline critical CSS</li>
                                                <li>Configure browser caching in .htaccess</li>
                                                <li>Optimize all images with compression</li>
                                                <li>Add resource hints for external resources</li>
                                                <li>Implement service worker for offline</li>
                                                <li>Defer non-critical JavaScript</li>
                                                <li>Remove unused CSS with PurgeCSS</li>
                                                <li>Achieve 90+ PageSpeed score</li>
                                            </ol>
                                        </div>
                                    </div>
                                </div>
                            </section>

                            <!-- Resources -->
                            <section class="resources">
                                <h2>Additional Resources</h2>
                                <ul>
                                    <li><a href="https://web.dev/vitals/" target="_blank">Core Web Vitals</a></li>
                                    <li><a href="https://developers.google.com/speed/pagespeed/insights/" target="_blank">PageSpeed Insights</a></li>
                                    <li><a href="https://www.webpagetest.org/" target="_blank">WebPageTest</a></li>
                                    <li><a href="https://gtmetrix.com/" target="_blank">GTmetrix</a></li>
                                    <li><a href="https://github.com/addyosmani/critical" target="_blank">Critical CSS Generator</a></li>
                                    <li><a href="https://imageoptim.com/" target="_blank">ImageOptim</a></li>
                                    <li><a href="https://developers.google.com/web/tools/lighthouse" target="_blank">Lighthouse</a></li>
                                    <li><a href="https://bundlephobia.com/" target="_blank">Bundle Phobia</a></li>
                                </ul>
                            </section>
                        </div>

                        <!-- Lesson Navigation -->
                        <div class="lesson-navigation">
                            <a href="/05module/third_party_libraries.html" class="lesson-nav-button prev">
                                <svg width="20" height="20" viewBox="0 0 20 20" fill="currentColor">
                                    <path d="M12.707 5.293a1 1 0 010 1.414L9.414 10l3.293 3.293a1 1 0 01-1.414 1.414l-4-4a1 1 0 010-1.414l4-4a1 1 0 011.414 0z"/>
                                </svg>
                                <span>
                                    <small>Previous</small><br>
                                    Using Third-party Libraries
                                </span>
                            </a>
                            
                            <button class="complete-lesson-btn">
                                Mark as Complete
                            </button>
                            
                            <a href="/05module/homework_assets_frontend.html" class="lesson-nav-button next">
                                <span>
                                    <small>Next</small><br>
                                    Homework: Assets & Frontend
                                </span>
                                <svg width="20" height="20" viewBox="0 0 20 20" fill="currentColor">
                                    <path d="M7.293 14.707a1 1 0 010-1.414L10.586 10 7.293 6.707a1 1 0 011.414-1.414l4 4a1 1 0 010 1.414l-4 4a1 1 0 01-1.414 0z"/>
                                </svg>
                            </a>
                        </div>
                    </article>
                </div>
            </div>
        </main>

        <!-- Footer -->
        <footer class="site-footer" role="contentinfo">
            <div class="footer-container">
                <div class="footer-content">
                    <div class="footer-section footer-about">
                        <h3>PHP WordPress Development</h3>
                        <p>Complete Web Development Course</p>
                    </div>
                    
                    <div class="footer-section">
                        <h4>Quick Links</h4>
                        <ul class="footer-links">
                            <li><a href="/">Home</a></li>
                            <li><a href="/module5.html">Module 5</a></li>
                            <li><a href="/resources.html">Resources</a></li>
                        </ul>
                    </div>
                    
                    <div class="footer-section">
                        <h4>Support</h4>
                        <ul class="footer-links">
                            <li><a href="/about.html">About</a></li>
                            <li><a href="/contact.html">Contact</a></li>
                        </ul>
                    </div>
                </div>
                
                <div class="footer-bottom">
                    <p>&copy; 2024 PHP WordPress Course. All rights reserved.</p>
                    <p>This course material is for educational purposes only.</p>
                </div>
            </div>
        </footer>
    </div>
    
    <!-- JavaScript -->
    <script src="/assets/js/prism.js"></script>
    <script src="/assets/js/main.js"></script>
    <script src="/assets/js/sidebar-toggle.js"></script>
    <script src="/assets/js/progress-tracker.js"></script>
    <script src="/assets/js/search.js"></script>
    <script src="/assets/js/theme-toggle.js"></script>
</body>
</html>