<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    
    <!-- SEO Meta Tags -->
    <title>Theme Performance Optimization - WordPress Theme Development - PHP WordPress Course</title>
    <meta name="description" content="Master WordPress theme performance optimization. Learn lazy loading, caching strategies, database optimization, and Core Web Vitals to create lightning-fast themes.">
    <meta name="keywords" content="PHP, WordPress, performance, optimization, lazy loading, caching, Core Web Vitals, page speed">
    <meta name="author" content="PHP WordPress Course">
    
    <!-- Favicon -->
    <link rel="icon" type="image/png" href="/favicon.png">
    <link rel="apple-touch-icon" href="/favicon.png">
    
    <!-- CSS -->
    <link rel="stylesheet" href="/assets/css/main.css">
    <link rel="stylesheet" href="/assets/css/sidebar-enhanced.css">
    <link rel="stylesheet" href="/assets/css/sidebar-toggle.css">
    
    <!-- Custom styles for performance lesson -->
    <style>
        .performance-header {
            background: linear-gradient(135deg, #f59e0b 0%, #ef4444 100%);
            color: white;
            padding: 3rem 2rem;
            border-radius: 12px;
            margin-bottom: 2rem;
            text-align: center;
        }

        .performance-concept {
            background: white;
            border: 2px solid #e5e7eb;
            border-radius: 12px;
            padding: 2rem;
            margin: 2rem 0;
        }

        .performance-concept h3 {
            color: #f59e0b;
            margin-top: 0;
            border-bottom: 2px solid #e5e7eb;
            padding-bottom: 1rem;
        }

        .code-example {
            background: #1e293b;
            color: #e2e8f0;
            padding: 1.5rem;
            border-radius: 8px;
            margin: 1.5rem 0;
            overflow-x: auto;
            font-family: 'Courier New', monospace;
        }

        .code-example h4 {
            color: #a5b4fc;
            margin-top: 0;
            border-bottom: 1px solid #475569;
            padding-bottom: 0.5rem;
        }

        .metrics-dashboard {
            background: linear-gradient(135deg, #f3f4f6 0%, #e5e7eb 100%);
            border: 2px solid #9ca3af;
            border-radius: 12px;
            padding: 2rem;
            margin: 2rem 0;
        }

        .metrics-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1.5rem;
            margin-top: 1.5rem;
        }

        .metric-card {
            background: white;
            border-radius: 8px;
            padding: 1.5rem;
            text-align: center;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        }

        .metric-value {
            font-size: 2.5rem;
            font-weight: bold;
            margin: 0.5rem 0;
        }

        .metric-value.good {
            color: #22c55e;
        }

        .metric-value.needs-improvement {
            color: #f59e0b;
        }

        .metric-value.poor {
            color: #ef4444;
        }

        .metric-label {
            font-size: 0.875rem;
            color: #6b7280;
            text-transform: uppercase;
            letter-spacing: 0.05em;
        }

        .metric-target {
            font-size: 0.75rem;
            color: #9ca3af;
            margin-top: 0.5rem;
        }

        .optimization-strategies {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 1.5rem;
            margin: 2rem 0;
        }

        .strategy-card {
            background: linear-gradient(135deg, #fef3c7 0%, #fed7aa 100%);
            border: 2px solid #f59e0b;
            border-radius: 8px;
            padding: 1.5rem;
        }

        .strategy-card h4 {
            color: #92400e;
            margin-top: 0;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .strategy-card .impact {
            display: inline-block;
            padding: 0.2rem 0.5rem;
            border-radius: 4px;
            font-size: 0.75rem;
            font-weight: bold;
            color: white;
            background: #ef4444;
        }

        .strategy-card .impact.high {
            background: #ef4444;
        }

        .strategy-card .impact.medium {
            background: #f59e0b;
        }

        .strategy-card .impact.low {
            background: #3b82f6;
        }

        .performance-table {
            background: white;
            border: 2px solid #e5e7eb;
            border-radius: 8px;
            overflow: hidden;
            margin: 2rem 0;
        }

        .performance-table table {
            width: 100%;
            border-collapse: collapse;
        }

        .performance-table th {
            background: #f3f4f6;
            padding: 1rem;
            text-align: left;
            font-weight: bold;
            border-bottom: 2px solid #e5e7eb;
        }

        .performance-table td {
            padding: 1rem;
            border-bottom: 1px solid #e5e7eb;
        }

        .performance-table code {
            background: #f3f4f6;
            padding: 0.2rem 0.4rem;
            border-radius: 3px;
            font-size: 0.875rem;
            color: #f59e0b;
        }

        .checklist-section {
            background: linear-gradient(135deg, #f0fdf4 0%, #dcfce7 100%);
            border: 2px solid #22c55e;
            border-radius: 12px;
            padding: 2rem;
            margin: 2rem 0;
        }

        .checklist-section h3 {
            color: #166534;
            margin-top: 0;
        }

        .checklist {
            list-style: none;
            padding: 0;
        }

        .checklist li {
            padding: 0.75rem 0;
            padding-left: 2rem;
            position: relative;
            border-bottom: 1px solid #bbf7d0;
        }

        .checklist li:last-child {
            border-bottom: none;
        }

        .checklist li::before {
            content: "‚úì";
            position: absolute;
            left: 0;
            color: #22c55e;
            font-weight: bold;
            font-size: 1.25rem;
        }

        .benchmark-results {
            background: white;
            border: 2px solid #3b82f6;
            border-radius: 8px;
            padding: 1.5rem;
            margin: 2rem 0;
        }

        .benchmark-bar {
            background: #e5e7eb;
            border-radius: 4px;
            height: 30px;
            margin: 1rem 0;
            position: relative;
            overflow: hidden;
        }

        .benchmark-fill {
            background: linear-gradient(90deg, #22c55e 0%, #10b981 100%);
            height: 100%;
            transition: width 0.5s ease;
        }

        .benchmark-label {
            position: absolute;
            left: 10px;
            top: 50%;
            transform: translateY(-50%);
            font-size: 0.875rem;
            font-weight: bold;
            color: white;
        }

        .best-practice {
            background: #f0f9ff;
            border-left: 4px solid #0ea5e9;
            padding: 1rem 1.5rem;
            margin: 1.5rem 0;
        }

        .best-practice h4 {
            color: #0369a1;
            margin-top: 0;
        }

        .warning-box {
            background: #fef3c7;
            border: 2px solid #fbbf24;
            border-radius: 8px;
            padding: 1rem;
            margin: 1.5rem 0;
        }

        .warning-box::before {
            content: "‚ö†Ô∏è Warning: ";
            font-weight: bold;
            color: #92400e;
        }

        .tip-box {
            background: #f0fdf4;
            border: 2px solid #86efac;
            border-radius: 8px;
            padding: 1rem;
            margin: 1.5rem 0;
        }

        .tip-box::before {
            content: "üí° Tip: ";
            font-weight: bold;
            color: #166534;
        }

        @media (max-width: 768px) {
            .metrics-grid,
            .optimization-strategies {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <!-- Skip to main content -->
    <a href="#main-content" class="sr-only">Skip to main content</a>
    
    <div class="page-wrapper">
        <!-- Header -->
        <header class="site-header" role="banner">
            <div class="header-container">
                <div class="site-branding">
                    <a href="/" class="site-logo">
                        <h1 class="site-title">PHP WordPress Development</h1>
                    </a>
                </div>
                
                <nav class="main-navigation" role="navigation" aria-label="Main navigation">
                    <button class="mobile-menu-btn" aria-label="Toggle navigation" aria-expanded="false">
                        <span></span>
                        <span></span>
                        <span></span>
                    </button>
                    
                    <div class="nav-menu">
                        <ul class="nav-list">
                            <li class="nav-item"><a href="/" class="nav-link">Home</a></li>
                            <li class="nav-item dropdown">
                                <button class="nav-link dropdown-toggle active" aria-haspopup="true">Modules</button>
                                <div class="dropdown-menu">
                                    <a href="/module1.html" class="dropdown-item">Module 1: Web Fundamentals</a>
                                    <a href="/module2.html" class="dropdown-item">Module 2: PHP Fundamentals</a>
                                    <a href="/module3.html" class="dropdown-item">Module 3: MySQL Database</a>
                                    <a href="/module4.html" class="dropdown-item">Module 4: WordPress & Docker</a>
                                    <a href="/module5.html" class="dropdown-item active">Module 5: Theme Development</a>
                                    <a href="/module6.html" class="dropdown-item">Module 6: Plugin Development</a>
                                    <a href="/module7.html" class="dropdown-item">Module 7: Advanced WordPress</a>
                                    <a href="/module8.html" class="dropdown-item">Module 8: Deployment</a>
                                    <a href="/module9.html" class="dropdown-item">Module 9: Final Project</a>
                                </div>
                            </li>
                            <li class="nav-item"><a href="/resources.html" class="nav-link">Resources</a></li>
                            <li class="nav-item"><a href="/about.html" class="nav-link">About</a></li>
                        </ul>
                    </div>
                </nav>
                
                <div class="search-container">
                    <div class="search-input-wrapper">
                        <svg class="search-icon" width="20" height="20" viewBox="0 0 20 20" fill="currentColor">
                            <path fill-rule="evenodd" d="M8 4a4 4 0 100 8 4 4 0 000-8zM2 8a6 6 0 1110.89 3.476l4.817 4.817a1 1 0 01-1.414 1.414l-4.816-4.816A6 6 0 012 8z" clip-rule="evenodd" />
                        </svg>
                        <input type="search" class="search-input" placeholder="Search lessons..." aria-label="Search">
                    </div>
                    <div class="search-results"></div>
                </div>
            </div>
        </header>
        
        <!-- Progress Bar -->
        <div class="progress-container">
            <div class="progress-header">
                <h2 class="progress-title">Course Progress</h2>
                <span class="progress-text">Loading...</span>
            </div>
            <div class="progress-bar">
                <div class="progress-bar-fill">
                    <span class="progress-bar-text"></span>
                </div>
            </div>
        </div>
        
        <!-- Breadcrumb -->
        <nav class="breadcrumb container" aria-label="Breadcrumb">
            <ol class="breadcrumb-list">
                <li class="breadcrumb-item">
                    <a href="/">Home</a>
                    <span class="breadcrumb-separator">/</span>
                </li>
                <li class="breadcrumb-item">
                    <a href="/module5.html">Module 5</a>
                    <span class="breadcrumb-separator">/</span>
                </li>
                <li class="breadcrumb-item">
                    <span aria-current="page">Theme Performance Optimization</span>
                </li>
            </ol>
        </nav>
        
        <!-- Main Content -->
        <main id="main-content" class="main-content" role="main">
            <div class="container">
                <div class="content-with-sidebar">
                    <!-- Sidebar -->
                    <aside class="sidebar">
                        <div class="sidebar-nav">
                            <h3 class="sidebar-title">Module 5: Theme Development</h3>
                            <div class="sidebar-section">
                                <h4 class="sidebar-section-title">Session 9: Advanced Theme Features</h4>
                                <ul class="sidebar-menu">
                                    <li><a class="sidebar-link" href="/05module/theme_i18n.html">Theme Internationalization (i18n)</a></li>
                                    <li><a class="sidebar-link" href="/05module/translation_ready_themes.html">Translation-ready Themes</a></li>
                                    <li><a class="sidebar-link" href="/05module/accessibility_considerations.html">Accessibility Considerations</a></li>
                                    <li><a class="sidebar-link" href="/05module/seo_best_practices.html">SEO Best Practices in Themes</a></li>
                                    <li><a class="sidebar-link" href="/05module/schema_markup.html">Schema Markup</a></li>
                                    <li><a class="sidebar-link" href="/05module/theme_security_best_practices.html">Theme Security Best Practices</a></li>
                                    <li class="active"><a class="sidebar-link active" href="/05module/theme_performance_optimization.html">Theme Performance Optimization</a></li>
                                    <li><a class="sidebar-link" href="/05module/homework_advanced_features.html">Homework: Advanced Features</a></li>
                                </ul>
                            </div>
                            <div class="sidebar-section">
                                <h4 class="sidebar-section-title">Quick Links</h4>
                                <ul class="sidebar-menu">
                                    <li><a class="sidebar-link" href="/module5.html">Module Overview</a></li>
                                    <li><a class="sidebar-link" href="/05module/theme_security_best_practices.html">‚Üê Previous Lesson</a></li>
                                    <li><a class="sidebar-link next-session" href="/05module/homework_advanced_features.html">Next Lesson ‚Üí</a></li>
                                    <li><a class="sidebar-link" href="/">‚Üê Course Home</a></li>
                                    <li><a class="sidebar-link" href="/resources.html">Resources</a></li>
                                </ul>
                            </div>
                        </div>
                    </aside>
                    
                    <!-- Main Lesson Content -->
                    <article class="lesson-content">
                        <div class="performance-header">
                            <h1>‚ö° Theme Performance Optimization</h1>
                            <p class="lead">Create lightning-fast WordPress themes</p>
                            <p>Master lazy loading, caching, database optimization, and Core Web Vitals</p>
                        </div>

                        <!-- Learning Objectives -->
                        <div class="lesson-objectives">
                            <h2>Learning Objectives</h2>
                            <ul>
                                <li>Understand Core Web Vitals and performance metrics</li>
                                <li>Implement lazy loading for images and content</li>
                                <li>Optimize CSS and JavaScript delivery</li>
                                <li>Master WordPress caching strategies</li>
                                <li>Optimize database queries</li>
                                <li>Implement critical CSS</li>
                                <li>Use CDN and asset optimization</li>
                                <li>Monitor and measure performance</li>
                            </ul>
                        </div>
                        
                        <!-- Lesson Body -->
                        <div class="lesson-body">
                            <!-- Introduction -->
                            <section>
                                <h2>Understanding Performance Metrics</h2>
                                <p class="lead">Performance directly impacts user experience, SEO rankings, and conversion rates. A 1-second delay in page load time can result in a 7% reduction in conversions.</p>
                                
                                <div class="performance-concept">
                                    <h3>Core Web Vitals</h3>
                                    <ul>
                                        <li><strong>Largest Contentful Paint (LCP):</strong> Loading performance - should occur within 2.5 seconds</li>
                                        <li><strong>First Input Delay (FID):</strong> Interactivity - pages should have FID less than 100 milliseconds</li>
                                        <li><strong>Cumulative Layout Shift (CLS):</strong> Visual stability - pages should maintain CLS less than 0.1</li>
                                        <li><strong>Time to First Byte (TTFB):</strong> Server response time - should be under 200ms</li>
                                        <li><strong>First Contentful Paint (FCP):</strong> First visual feedback - should occur within 1.8 seconds</li>
                                    </ul>
                                </div>
                            </section>

                            <!-- Performance Metrics Dashboard -->
                            <section>
                                <div class="metrics-dashboard">
                                    <h3>Target Performance Metrics</h3>
                                    
                                    <div class="metrics-grid">
                                        <div class="metric-card">
                                            <div class="metric-label">LCP</div>
                                            <div class="metric-value good">2.5s</div>
                                            <div class="metric-target">Good &lt; 2.5s</div>
                                        </div>
                                        
                                        <div class="metric-card">
                                            <div class="metric-label">FID</div>
                                            <div class="metric-value good">100ms</div>
                                            <div class="metric-target">Good &lt; 100ms</div>
                                        </div>
                                        
                                        <div class="metric-card">
                                            <div class="metric-label">CLS</div>
                                            <div class="metric-value good">0.1</div>
                                            <div class="metric-target">Good &lt; 0.1</div>
                                        </div>
                                        
                                        <div class="metric-card">
                                            <div class="metric-label">TTFB</div>
                                            <div class="metric-value good">200ms</div>
                                            <div class="metric-target">Good &lt; 200ms</div>
                                        </div>
                                        
                                        <div class="metric-card">
                                            <div class="metric-label">Page Size</div>
                                            <div class="metric-value needs-improvement">2MB</div>
                                            <div class="metric-target">Target &lt; 1MB</div>
                                        </div>
                                        
                                        <div class="metric-card">
                                            <div class="metric-label">Requests</div>
                                            <div class="metric-value needs-improvement">50</div>
                                            <div class="metric-target">Target &lt; 30</div>
                                        </div>
                                    </div>
                                </div>
                            </section>

                            <!-- Lazy Loading -->
                            <section>
                                <h2>Implementing Lazy Loading</h2>
                                
                                <div class="code-example">
                                    <h4>Native Lazy Loading</h4>
                                    <pre><code class="language-php">&lt;?php
/**
 * Add native lazy loading to images
 */
function add_lazy_loading_attribute( $attributes, $attachment, $size ) {
    // Skip if loading attribute already defined
    if ( isset( $attributes['loading'] ) ) {
        return $attributes;
    }
    
    // Add lazy loading
    $attributes['loading'] = 'lazy';
    
    // Add decoding async for better performance
    $attributes['decoding'] = 'async';
    
    return $attributes;
}
add_filter( 'wp_get_attachment_image_attributes', 'add_lazy_loading_attribute', 10, 3 );

/**
 * Lazy load content images
 */
function add_lazy_loading_to_content( $content ) {
    // Don't lazy load if is admin
    if ( is_admin() ) {
        return $content;
    }
    
    // Add loading="lazy" to images
    $content = preg_replace(
        '/(&lt;img(?![^&gt;]*loading=)[^&gt;]*)(\/?)&gt;/i',
        '$1 loading="lazy" decoding="async"$2&gt;',
        $content
    );
    
    // Add loading="lazy" to iframes
    $content = preg_replace(
        '/(&lt;iframe(?![^&gt;]*loading=)[^&gt;]*)(\/?)&gt;/i',
        '$1 loading="lazy"$2&gt;',
        $content
    );
    
    return $content;
}
add_filter( 'the_content', 'add_lazy_loading_to_content' );

/**
 * Advanced lazy loading with Intersection Observer
 */
function enqueue_lazy_loading_script() {
    wp_enqueue_script(
        'lazy-loading',
        get_template_directory_uri() . '/assets/js/lazy-loading.js',
        array(),
        '1.0.0',
        true
    );
}
add_action( 'wp_enqueue_scripts', 'enqueue_lazy_loading_script' );</code></pre>
                                </div>

                                <div class="code-example">
                                    <h4>JavaScript Lazy Loading (lazy-loading.js)</h4>
                                    <pre><code class="language-javascript">// Intersection Observer for lazy loading
document.addEventListener('DOMContentLoaded', function() {
    // Images
    const lazyImages = document.querySelectorAll('img[data-src]');
    
    const imageObserver = new IntersectionObserver((entries, observer) => {
        entries.forEach(entry => {
            if (entry.isIntersecting) {
                const img = entry.target;
                img.src = img.dataset.src;
                
                // Handle srcset
                if (img.dataset.srcset) {
                    img.srcset = img.dataset.srcset;
                }
                
                // Remove data attributes
                delete img.dataset.src;
                delete img.dataset.srcset;
                
                // Add loaded class for animations
                img.classList.add('loaded');
                
                // Stop observing
                observer.unobserve(img);
            }
        });
    }, {
        rootMargin: '50px'
    });
    
    lazyImages.forEach(img => imageObserver.observe(img));
    
    // Background images
    const lazyBackgrounds = document.querySelectorAll('[data-bg]');
    
    const bgObserver = new IntersectionObserver((entries, observer) => {
        entries.forEach(entry => {
            if (entry.isIntersecting) {
                const element = entry.target;
                element.style.backgroundImage = `url(${element.dataset.bg})`;
                delete element.dataset.bg;
                element.classList.add('bg-loaded');
                observer.unobserve(element);
            }
        });
    });
    
    lazyBackgrounds.forEach(el => bgObserver.observe(el));
});</code></pre>
                                </div>
                            </section>

                            <!-- CSS Optimization -->
                            <section>
                                <h2>CSS Optimization</h2>
                                
                                <div class="code-example">
                                    <h4>Critical CSS Implementation</h4>
                                    <pre><code class="language-php">&lt;?php
/**
 * Inline critical CSS
 */
function inline_critical_css() {
    if ( is_front_page() ) {
        $critical_css = file_get_contents( get_template_directory() . '/assets/css/critical-home.css' );
    } else {
        $critical_css = file_get_contents( get_template_directory() . '/assets/css/critical.css' );
    }
    
    if ( $critical_css ) {
        echo '&lt;style id="critical-css"&gt;' . $critical_css . '&lt;/style&gt;';
    }
}
add_action( 'wp_head', 'inline_critical_css', 5 );

/**
 * Defer non-critical CSS
 */
function defer_non_critical_css() {
    ?&gt;
    &lt;link rel="preload" href="&lt;?php echo get_stylesheet_uri(); ?&gt;" as="style" onload="this.onload=null;this.rel='stylesheet'"&gt;
    &lt;noscript&gt;&lt;link rel="stylesheet" href="&lt;?php echo get_stylesheet_uri(); ?&gt;"&gt;&lt;/noscript&gt;
    &lt;?php
}
add_action( 'wp_head', 'defer_non_critical_css', 20 );

/**
 * Remove unused CSS
 */
function remove_unused_css() {
    // Remove Gutenberg block CSS if not using blocks
    if ( ! is_singular() ) {
        wp_dequeue_style( 'wp-block-library' );
        wp_dequeue_style( 'wp-block-library-theme' );
    }
    
    // Remove emoji styles
    remove_action( 'wp_head', 'print_emoji_detection_script', 7 );
    remove_action( 'wp_print_styles', 'print_emoji_styles' );
}
add_action( 'wp_enqueue_scripts', 'remove_unused_css', 100 );

/**
 * Minify inline CSS
 */
function minify_css( $css ) {
    // Remove comments
    $css = preg_replace( '!/\*[^*]*\*+([^/][^*]*\*+)*/!', '', $css );
    // Remove whitespace
    $css = str_replace( array("\r\n", "\r", "\n", "\t", '  ', '    ', '    '), '', $css );
    // Remove unnecessary spaces
    $css = preg_replace( '/\s*([{}|:;,])\s+/', '$1', $css );
    $css = preg_replace( '/\s\s+(.*)/', '$1', $css );
    
    return $css;
}</code></pre>
                                </div>
                            </section>

                            <!-- JavaScript Optimization -->
                            <section>
                                <h2>JavaScript Optimization</h2>
                                
                                <div class="code-example">
                                    <h4>Optimizing Script Loading</h4>
                                    <pre><code class="language-php">&lt;?php
/**
 * Defer JavaScript loading
 */
function defer_parsing_of_js( $tag, $handle, $src ) {
    // Scripts to defer
    $defer = array(
        'jquery-migrate',
        'comment-reply',
        'theme-script'
    );
    
    if ( in_array( $handle, $defer ) ) {
        return str_replace( ' src', ' defer src', $tag );
    }
    
    return $tag;
}
add_filter( 'script_loader_tag', 'defer_parsing_of_js', 10, 3 );

/**
 * Async JavaScript loading
 */
function async_scripts( $tag, $handle, $src ) {
    // Scripts to load async
    $async = array(
        'google-analytics',
        'facebook-pixel'
    );
    
    if ( in_array( $handle, $async ) ) {
        return str_replace( ' src', ' async src', $tag );
    }
    
    return $tag;
}
add_filter( 'script_loader_tag', 'async_scripts', 10, 3 );

/**
 * Move scripts to footer
 */
function move_scripts_to_footer() {
    remove_action( 'wp_head', 'wp_print_scripts' );
    remove_action( 'wp_head', 'wp_print_head_scripts', 9 );
    remove_action( 'wp_head', 'wp_enqueue_scripts', 1 );
    
    add_action( 'wp_footer', 'wp_print_scripts', 5 );
    add_action( 'wp_footer', 'wp_print_head_scripts', 5 );
    add_action( 'wp_footer', 'wp_enqueue_scripts', 5 );
}
add_action( 'after_setup_theme', 'move_scripts_to_footer' );

/**
 * Conditional script loading
 */
function conditional_script_loading() {
    // Only load contact form script on contact page
    if ( ! is_page( 'contact' ) ) {
        wp_dequeue_script( 'contact-form-7' );
        wp_dequeue_style( 'contact-form-7' );
    }
    
    // Only load slider on homepage
    if ( ! is_front_page() ) {
        wp_dequeue_script( 'slider-script' );
        wp_dequeue_style( 'slider-style' );
    }
}
add_action( 'wp_enqueue_scripts', 'conditional_script_loading', 100 );</code></pre>
                                </div>
                            </section>

                            <!-- Database Optimization -->
                            <section>
                                <h2>Database Query Optimization</h2>
                                
                                <div class="code-example">
                                    <h4>Efficient Database Queries</h4>
                                    <pre><code class="language-php">&lt;?php
/**
 * Optimize WP_Query
 */
function get_optimized_posts() {
    $args = array(
        'post_type' => 'post',
        'posts_per_page' => 10,
        'no_found_rows' => true, // Skip pagination count
        'update_post_meta_cache' => false, // Skip meta if not needed
        'update_post_term_cache' => false, // Skip terms if not needed
        'fields' => 'ids', // Get only IDs if that's all you need
        'post_status' => 'publish',
        'orderby' => 'date',
        'order' => 'DESC'
    );
    
    return new WP_Query( $args );
}

/**
 * Use transients for expensive queries
 */
function get_popular_posts() {
    $popular_posts = get_transient( 'popular_posts' );
    
    if ( false === $popular_posts ) {
        $args = array(
            'post_type' => 'post',
            'posts_per_page' => 5,
            'meta_key' => 'post_views_count',
            'orderby' => 'meta_value_num',
            'order' => 'DESC'
        );
        
        $popular_posts = new WP_Query( $args );
        
        // Cache for 12 hours
        set_transient( 'popular_posts', $popular_posts, 12 * HOUR_IN_SECONDS );
    }
    
    return $popular_posts;
}

/**
 * Delete expired transients
 */
function delete_expired_transients() {
    global $wpdb;
    
    $wpdb->query(
        "DELETE FROM {$wpdb->options}
         WHERE option_name LIKE '_transient_timeout_%'
         AND option_value < UNIX_TIMESTAMP()"
    );
    
    $wpdb->query(
        "DELETE FROM {$wpdb->options}
         WHERE option_name LIKE '_site_transient_timeout_%'
         AND option_value < UNIX_TIMESTAMP()"
    );
}
add_action( 'wp_scheduled_delete', 'delete_expired_transients' );

/**
 * Optimize autoloaded options
 */
function optimize_autoloaded_options() {
    global $wpdb;
    
    // Get size of autoloaded data
    $autoload_size = $wpdb->get_var(
        "SELECT SUM(LENGTH(option_value))
         FROM {$wpdb->options}
         WHERE autoload = 'yes'"
    );
    
    // If over 1MB, optimize
    if ( $autoload_size > 1000000 ) {
        // Set large options to not autoload
        $wpdb->query(
            "UPDATE {$wpdb->options}
             SET autoload = 'no'
             WHERE autoload = 'yes'
             AND LENGTH(option_value) > 5000"
        );
    }
}</code></pre>
                                </div>
                            </section>

                            <!-- Caching Strategies -->
                            <section>
                                <h2>WordPress Caching</h2>
                                
                                <div class="code-example">
                                    <h4>Implementing Object Caching</h4>
                                    <pre><code class="language-php">&lt;?php
/**
 * Object cache implementation
 */
function get_cached_data( $key ) {
    // Try to get from cache
    $data = wp_cache_get( $key, 'my_theme' );
    
    if ( false === $data ) {
        // Generate data
        $data = expensive_function();
        
        // Store in cache for 1 hour
        wp_cache_set( $key, $data, 'my_theme', HOUR_IN_SECONDS );
    }
    
    return $data;
}

/**
 * Fragment caching
 */
function cached_sidebar() {
    $cache_key = 'sidebar_' . get_current_blog_id();
    $sidebar = get_transient( $cache_key );
    
    if ( false === $sidebar ) {
        ob_start();
        dynamic_sidebar( 'sidebar-1' );
        $sidebar = ob_get_clean();
        
        set_transient( $cache_key, $sidebar, HOUR_IN_SECONDS );
    }
    
    echo $sidebar;
}

/**
 * Page cache headers
 */
function set_cache_headers() {
    if ( ! is_user_logged_in() && ! is_admin() ) {
        header( 'Cache-Control: public, max-age=3600' );
        header( 'Expires: ' . gmdate( 'D, d M Y H:i:s', time() + 3600 ) . ' GMT' );
        header( 'Last-Modified: ' . gmdate( 'D, d M Y H:i:s', get_the_modified_time( 'U' ) ) . ' GMT' );
        header( 'Vary: Accept-Encoding' );
    }
}
add_action( 'send_headers', 'set_cache_headers' );

/**
 * Clear cache on post update
 */
function clear_cache_on_save( $post_id ) {
    // Clear transients
    delete_transient( 'popular_posts' );
    delete_transient( 'recent_posts' );
    delete_transient( 'sidebar_' . get_current_blog_id() );
    
    // Clear object cache
    wp_cache_delete( 'homepage_data', 'my_theme' );
    
    // Trigger cache purge for caching plugins
    if ( function_exists( 'wp_cache_clear_cache' ) ) {
        wp_cache_clear_cache();
    }
}
add_action( 'save_post', 'clear_cache_on_save' );</code></pre>
                                </div>
                            </section>

                            <!-- Image Optimization -->
                            <section>
                                <h2>Image Optimization</h2>
                                
                                <div class="code-example">
                                    <h4>Advanced Image Optimization</h4>
                                    <pre><code class="language-php">&lt;?php
/**
 * Responsive images with srcset
 */
function responsive_image( $attachment_id, $size = 'full', $attr = array() ) {
    $image = wp_get_attachment_image_src( $attachment_id, $size );
    
    if ( ! $image ) {
        return '';
    }
    
    $srcset = wp_get_attachment_image_srcset( $attachment_id, $size );
    $sizes = wp_get_attachment_image_sizes( $attachment_id, $size );
    
    $attr = wp_parse_args( $attr, array(
        'src' => $image[0],
        'srcset' => $srcset,
        'sizes' => $sizes,
        'loading' => 'lazy',
        'decoding' => 'async'
    ) );
    
    $html = '&lt;img';
    foreach ( $attr as $name => $value ) {
        $html .= ' ' . $name . '="' . esc_attr( $value ) . '"';
    }
    $html .= '&gt;';
    
    return $html;
}

/**
 * WebP support
 */
function add_webp_support( $mimes ) {
    $mimes['webp'] = 'image/webp';
    return $mimes;
}
add_filter( 'upload_mimes', 'add_webp_support' );

/**
 * Serve WebP images when supported
 */
function serve_webp_images( $image_url ) {
    // Check if browser supports WebP
    if ( isset( $_SERVER['HTTP_ACCEPT'] ) && 
         strpos( $_SERVER['HTTP_ACCEPT'], 'image/webp' ) !== false ) {
        
        $webp_url = str_replace( 
            array( '.jpg', '.jpeg', '.png' ), 
            '.webp', 
            $image_url 
        );
        
        // Check if WebP version exists
        $upload_dir = wp_upload_dir();
        $webp_path = str_replace( 
            $upload_dir['baseurl'], 
            $upload_dir['basedir'], 
            $webp_url 
        );
        
        if ( file_exists( $webp_path ) ) {
            return $webp_url;
        }
    }
    
    return $image_url;
}
add_filter( 'wp_get_attachment_url', 'serve_webp_images' );

/**
 * Optimize image sizes
 */
function optimize_image_sizes() {
    // Remove default image sizes
    remove_image_size( '1536x1536' );
    remove_image_size( '2048x2048' );
    
    // Add optimized sizes
    add_image_size( 'hero', 1920, 800, true );
    add_image_size( 'card', 400, 300, true );
    add_image_size( 'thumbnail-retina', 300, 300, true );
}
add_action( 'after_setup_theme', 'optimize_image_sizes' );

/**
 * JPEG quality
 */
add_filter( 'jpeg_quality', function() {
    return 85;
});</code></pre>
                                </div>
                            </section>

                            <!-- Preloading and Prefetching -->
                            <section>
                                <h2>Resource Hints</h2>
                                
                                <div class="code-example">
                                    <h4>Preloading Critical Resources</h4>
                                    <pre><code class="language-php">&lt;?php
/**
 * Add resource hints
 */
function add_resource_hints() {
    // Preload fonts
    echo '&lt;link rel="preload" as="font" type="font/woff2" crossorigin 
          href="' . get_template_directory_uri() . '/assets/fonts/main.woff2"&gt;';
    
    // Preload critical CSS
    echo '&lt;link rel="preload" as="style" 
          href="' . get_template_directory_uri() . '/assets/css/critical.css"&gt;';
    
    // Preconnect to external domains
    echo '&lt;link rel="preconnect" href="https://fonts.googleapis.com"&gt;';
    echo '&lt;link rel="dns-prefetch" href="https://fonts.googleapis.com"&gt;';
    
    // Prefetch next page (for pagination)
    if ( is_single() ) {
        $next_post = get_next_post();
        if ( $next_post ) {
            echo '&lt;link rel="prefetch" href="' . get_permalink( $next_post ) . '"&gt;';
        }
    }
}
add_action( 'wp_head', 'add_resource_hints', 2 );

/**
 * Preload above-the-fold images
 */
function preload_hero_image() {
    if ( has_post_thumbnail() ) {
        $image_id = get_post_thumbnail_id();
        $image_url = wp_get_attachment_image_url( $image_id, 'hero' );
        
        if ( $image_url ) {
            echo '&lt;link rel="preload" as="image" href="' . esc_url( $image_url ) . '"&gt;';
        }
    }
}
add_action( 'wp_head', 'preload_hero_image', 3 );</code></pre>
                                </div>
                            </section>

                            <!-- Optimization Strategies -->
                            <section>
                                <h2>Optimization Strategies</h2>
                                
                                <div class="optimization-strategies">
                                    <div class="strategy-card">
                                        <h4>Minimize HTTP Requests <span class="impact high">HIGH</span></h4>
                                        <ul>
                                            <li>Combine CSS files</li>
                                            <li>Combine JavaScript files</li>
                                            <li>Use CSS sprites</li>
                                            <li>Inline small CSS/JS</li>
                                            <li>Remove unnecessary plugins</li>
                                        </ul>
                                    </div>

                                    <div class="strategy-card">
                                        <h4>Optimize Images <span class="impact high">HIGH</span></h4>
                                        <ul>
                                            <li>Use WebP format</li>
                                            <li>Implement lazy loading</li>
                                            <li>Serve responsive images</li>
                                            <li>Compress images</li>
                                            <li>Use CDN for images</li>
                                        </ul>
                                    </div>

                                    <div class="strategy-card">
                                        <h4>Leverage Caching <span class="impact high">HIGH</span></h4>
                                        <ul>
                                            <li>Browser caching</li>
                                            <li>Page caching</li>
                                            <li>Object caching</li>
                                            <li>Database caching</li>
                                            <li>CDN caching</li>
                                        </ul>
                                    </div>

                                    <div class="strategy-card">
                                        <h4>Optimize Database <span class="impact medium">MEDIUM</span></h4>
                                        <ul>
                                            <li>Clean post revisions</li>
                                            <li>Optimize tables</li>
                                            <li>Remove spam comments</li>
                                            <li>Delete transients</li>
                                            <li>Limit autoloaded data</li>
                                        </ul>
                                    </div>

                                    <div class="strategy-card">
                                        <h4>Minify Resources <span class="impact medium">MEDIUM</span></h4>
                                        <ul>
                                            <li>Minify CSS</li>
                                            <li>Minify JavaScript</li>
                                            <li>Minify HTML</li>
                                            <li>Remove comments</li>
                                            <li>Remove whitespace</li>
                                        </ul>
                                    </div>

                                    <div class="strategy-card">
                                        <h4>Server Optimization <span class="impact high">HIGH</span></h4>
                                        <ul>
                                            <li>Use PHP 8+</li>
                                            <li>Enable Gzip compression</li>
                                            <li>Use HTTP/2</li>
                                            <li>Optimize server config</li>
                                            <li>Use SSD hosting</li>
                                        </ul>
                                    </div>
                                </div>
                            </section>

                            <!-- Performance Monitoring -->
                            <section>
                                <h2>Performance Monitoring</h2>
                                
                                <div class="code-example">
                                    <h4>Custom Performance Monitoring</h4>
                                    <pre><code class="language-php">&lt;?php
/**
 * Track page load time
 */
function track_page_load_time() {
    ?&gt;
    &lt;script&gt;
    window.addEventListener('load', function() {
        const perfData = window.performance.timing;
        const pageLoadTime = perfData.loadEventEnd - perfData.navigationStart;
        const connectTime = perfData.responseEnd - perfData.requestStart;
        const renderTime = perfData.domComplete - perfData.domLoading;
        
        console.log('Page Load Time:', pageLoadTime + 'ms');
        console.log('Connect Time:', connectTime + 'ms');
        console.log('Render Time:', renderTime + 'ms');
        
        // Send to analytics
        if (typeof gtag !== 'undefined') {
            gtag('event', 'timing_complete', {
                'name': 'load',
                'value': pageLoadTime,
                'event_category': 'Performance'
            });
        }
    });
    &lt;/script&gt;
    &lt;?php
}
add_action( 'wp_footer', 'track_page_load_time' );

/**
 * Monitor database queries
 */
function monitor_db_queries() {
    if ( current_user_can( 'manage_options' ) && defined( 'WP_DEBUG' ) && WP_DEBUG ) {
        global $wpdb;
        echo '&lt;!-- Queries: ' . $wpdb->num_queries . ' --&gt;';
        echo '&lt;!-- Timer: ' . timer_stop( 0 ) . ' seconds --&gt;';
    }
}
add_action( 'wp_footer', 'monitor_db_queries', 100 );</code></pre>
                                </div>
                            </section>

                            <!-- Performance Checklist -->
                            <section>
                                <div class="checklist-section">
                                    <h3>Performance Optimization Checklist</h3>
                                    
                                    <ul class="checklist">
                                        <li>Enable lazy loading for images and iframes</li>
                                        <li>Implement critical CSS inline</li>
                                        <li>Defer non-critical CSS</li>
                                        <li>Defer or async JavaScript files</li>
                                        <li>Minify CSS, JavaScript, and HTML</li>
                                        <li>Enable Gzip compression</li>
                                        <li>Optimize images (WebP, compression)</li>
                                        <li>Use responsive images with srcset</li>
                                        <li>Implement browser caching</li>
                                        <li>Use a CDN for static assets</li>
                                        <li>Optimize database queries</li>
                                        <li>Use transients for expensive operations</li>
                                        <li>Remove unused CSS and JavaScript</li>
                                        <li>Limit post revisions</li>
                                        <li>Optimize autoloaded options</li>
                                        <li>Preload critical resources</li>
                                        <li>Use HTTP/2</li>
                                        <li>Enable page caching</li>
                                        <li>Monitor Core Web Vitals</li>
                                        <li>Regular performance testing</li>
                                    </ul>
                                </div>
                            </section>

                            <!-- Best Practices -->
                            <section>
                                <h2>Best Practices</h2>
                                
                                <div class="best-practice">
                                    <h4>Performance Best Practices</h4>
                                    <ul>
                                        <li><strong>Mobile-first:</strong> Optimize for mobile devices first</li>
                                        <li><strong>Progressive enhancement:</strong> Start with core functionality</li>
                                        <li><strong>Measure regularly:</strong> Monitor performance metrics</li>
                                        <li><strong>Budget performance:</strong> Set performance budgets</li>
                                        <li><strong>Optimize critical path:</strong> Prioritize above-the-fold content</li>
                                        <li><strong>Use modern formats:</strong> WebP, AVIF for images</li>
                                        <li><strong>Avoid render-blocking:</strong> Eliminate render-blocking resources</li>
                                        <li><strong>Reduce JavaScript:</strong> Ship less JavaScript</li>
                                        <li><strong>Cache aggressively:</strong> Cache everything possible</li>
                                        <li><strong>Test on real devices:</strong> Don't rely only on tools</li>
                                    </ul>
                                </div>

                                <div class="warning-box">
                                    Don't over-optimize at the expense of maintainability. Balance performance improvements with code clarity and development speed.
                                </div>

                                <div class="tip-box">
                                    Use tools like Lighthouse, GTmetrix, and WebPageTest regularly to monitor your theme's performance and identify areas for improvement.
                                </div>
                            </section>

                            <!-- Practice Exercise -->
                            <section>
                                <h2>Practice Exercise</h2>
                                <div class="alert alert-success">
                                    <div class="alert-icon">üíª</div>
                                    <div class="alert-content">
                                        <div class="alert-title">Optimize Your Theme Performance</div>
                                        <div class="alert-message">
                                            <p>Implement comprehensive performance optimizations:</p>
                                            <ol>
                                                <li>Implement lazy loading for all images</li>
                                                <li>Create and inline critical CSS</li>
                                                <li>Defer non-critical CSS and JavaScript</li>
                                                <li>Minify all CSS and JavaScript files</li>
                                                <li>Optimize and compress images</li>
                                                <li>Implement caching strategy</li>
                                                <li>Add resource hints (preload, prefetch)</li>
                                                <li>Optimize database queries</li>
                                                <li>Test with PageSpeed Insights</li>
                                                <li>Achieve 90+ performance score</li>
                                            </ol>
                                        </div>
                                    </div>
                                </div>
                            </section>

                            <!-- Resources -->
                            <section class="resources">
                                <h2>Additional Resources</h2>
                                <ul>
                                    <li><a href="https://web.dev/vitals/" target="_blank">Web Vitals - Google</a></li>
                                    <li><a href="https://pagespeed.web.dev/" target="_blank">PageSpeed Insights</a></li>
                                    <li><a href="https://gtmetrix.com/" target="_blank">GTmetrix</a></li>
                                    <li><a href="https://www.webpagetest.org/" target="_blank">WebPageTest</a></li>
                                    <li><a href="https://developer.wordpress.org/themes/advanced-topics/performance/" target="_blank">WordPress Performance Guide</a></li>
                                    <li><a href="https://kinsta.com/learn/speed-up-wordpress/" target="_blank">Kinsta Performance Guide</a></li>
                                    <li><a href="https://developers.google.com/web/tools/lighthouse" target="_blank">Lighthouse</a></li>
                                    <li><a href="https://wp-rocket.me/blog/" target="_blank">WP Rocket Blog</a></li>
                                </ul>
                            </section>
                        </div>

                        <!-- Lesson Navigation -->
                        <div class="lesson-navigation">
                            <a href="/05module/theme_security_best_practices.html" class="lesson-nav-button prev">
                                <svg width="20" height="20" viewBox="0 0 20 20" fill="currentColor">
                                    <path d="M12.707 5.293a1 1 0 010 1.414L9.414 10l3.293 3.293a1 1 0 01-1.414 1.414l-4-4a1 1 0 010-1.414l4-4a1 1 0 011.414 0z"/>
                                </svg>
                                <span>
                                    <small>Previous</small><br>
                                    Theme Security Best Practices
                                </span>
                            </a>
                            
                            <button class="complete-lesson-btn">
                                Mark as Complete
                            </button>
                            
                            <a href="/05module/homework_advanced_features.html" class="lesson-nav-button next">
                                <span>
                                    <small>Next</small><br>
                                    Homework: Advanced Features
                                </span>
                                <svg width="20" height="20" viewBox="0 0 20 20" fill="currentColor">
                                    <path d="M7.293 14.707a1 1 0 010-1.414L10.586 10 7.293 6.707a1 1 0 011.414-1.414l4 4a1 1 0 010 1.414l-4 4a1 1 0 01-1.414 0z"/>
                                </svg>
                            </a>
                        </div>
                    </article>
                </div>
            </div>
        </main>

        <!-- Footer -->
        <footer class="site-footer" role="contentinfo">
            <div class="footer-container">
                <div class="footer-content">
                    <div class="footer-section footer-about">
                        <h3>PHP WordPress Development</h3>
                        <p>Complete Web Development Course</p>
                    </div>
                    
                    <div class="footer-section">
                        <h4>Quick Links</h4>
                        <ul class="footer-links">
                            <li><a href="/">Home</a></li>
                            <li><a href="/module5.html">Module 5</a></li>
                            <li><a href="/resources.html">Resources</a></li>
                        </ul>
                    </div>
                    
                    <div class="footer-section">
                        <h4>Support</h4>
                        <ul class="footer-links">
                            <li><a href="/about.html">About</a></li>
                            <li><a href="/contact.html">Contact</a></li>
                        </ul>
                    </div>
                </div>
                
                <div class="footer-bottom">
                    <p>&copy; 2024 PHP WordPress Course. All rights reserved.</p>
                    <p>This course material is for educational purposes only.</p>
                </div>
            </div>
        </footer>
    </div>
    
    <!-- JavaScript -->
    <script src="/assets/js/prism.js"></script>
    <script src="/assets/js/main.js"></script>
    <script src="/assets/js/sidebar-toggle.js"></script>
    <script src="/assets/js/progress-tracker.js"></script>
    <script src="/assets/js/search.js"></script>
    <script src="/assets/js/theme-toggle.js"></script>
</body>
</html>