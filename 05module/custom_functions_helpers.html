<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    
    <!-- SEO Meta Tags -->
    <title>Custom Functions & Helpers - WordPress Theme Development - PHP WordPress Course</title>
    <meta name="description" content="Learn how to create custom functions, helper utilities, and reusable code for WordPress themes. Master theme customization and functionality.">
    <meta name="keywords" content="PHP, WordPress, custom functions, helper functions, theme functions, utilities, customization">
    <meta name="author" content="PHP WordPress Course">
    
    <!-- Favicon -->
    <link rel="icon" type="image/png" href="/favicon.png">
    <link rel="apple-touch-icon" href="/favicon.png">
    
    <!-- CSS -->
    <link rel="stylesheet" href="/assets/css/main.css">
    <link rel="stylesheet" href="/assets/css/sidebar-enhanced.css">
    <link rel="stylesheet" href="/assets/css/sidebar-toggle.css">
    
    <!-- Custom styles for custom functions lesson -->
    <style>
        .functions-header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 3rem 2rem;
            border-radius: 12px;
            margin-bottom: 2rem;
            text-align: center;
        }

        .function-category {
            background: white;
            border: 2px solid #e5e7eb;
            border-radius: 12px;
            padding: 2rem;
            margin: 2rem 0;
        }

        .function-category h3 {
            color: #667eea;
            margin-top: 0;
            border-bottom: 2px solid #e5e7eb;
            padding-bottom: 1rem;
        }

        .code-example {
            background: #1e293b;
            color: #e2e8f0;
            padding: 1.5rem;
            border-radius: 8px;
            margin: 1.5rem 0;
            overflow-x: auto;
            font-family: 'Courier New', monospace;
        }

        .code-example h4 {
            color: #a5b4fc;
            margin-top: 0;
            border-bottom: 1px solid #475569;
            padding-bottom: 0.5rem;
        }

        .helper-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 1.5rem;
            margin: 2rem 0;
        }

        .helper-card {
            background: white;
            border: 2px solid #e5e7eb;
            border-radius: 8px;
            padding: 1.5rem;
            transition: all 0.3s ease;
        }

        .helper-card:hover {
            transform: translateY(-3px);
            box-shadow: 0 10px 20px rgba(0,0,0,0.1);
            border-color: #667eea;
        }

        .helper-card h4 {
            color: #667eea;
            margin-top: 0;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .helper-icon {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            width: 40px;
            height: 40px;
            background: #667eea;
            color: white;
            border-radius: 50%;
            font-size: 1.2rem;
        }

        .best-practice {
            background: #f0f9ff;
            border-left: 4px solid #0ea5e9;
            padding: 1rem 1.5rem;
            margin: 1.5rem 0;
        }

        .best-practice h4 {
            color: #0369a1;
            margin-top: 0;
        }

        .warning-box {
            background: #fef3c7;
            border: 2px solid #fbbf24;
            border-radius: 8px;
            padding: 1rem;
            margin: 1.5rem 0;
        }

        .warning-box::before {
            content: "⚠️ Warning: ";
            font-weight: bold;
            color: #92400e;
        }

        .utility-showcase {
            background: linear-gradient(135deg, #f0f9ff 0%, #e0f2fe 100%);
            border: 2px solid #0ea5e9;
            border-radius: 12px;
            padding: 2rem;
            margin: 2rem 0;
        }

        .utility-showcase h3 {
            color: #0369a1;
            margin-top: 0;
        }

        .function-tabs {
            background: #f8f9fa;
            border: 2px solid #e5e7eb;
            border-radius: 8px;
            overflow: hidden;
            margin: 2rem 0;
        }

        .tab-buttons {
            display: flex;
            background: #e5e7eb;
            border-bottom: 2px solid #cbd5e1;
        }

        .tab-button {
            padding: 1rem 1.5rem;
            background: none;
            border: none;
            cursor: pointer;
            font-weight: bold;
            transition: all 0.3s ease;
            flex: 1;
        }

        .tab-button.active {
            background: white;
            color: #667eea;
            border-bottom: 2px solid #667eea;
        }

        .tab-content {
            padding: 1.5rem;
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        .organization-structure {
            background: white;
            border: 2px solid #667eea;
            border-radius: 12px;
            padding: 2rem;
            margin: 2rem 0;
        }

        .organization-structure h3 {
            color: #667eea;
            margin-top: 0;
        }

        .file-tree {
            font-family: monospace;
            background: #f8f9fa;
            padding: 1rem;
            border-radius: 4px;
            margin: 1rem 0;
        }

        .file-tree ul {
            list-style: none;
            padding-left: 1.5rem;
            margin: 0;
        }

        .file-tree > ul {
            padding-left: 0;
        }

        .file-tree li {
            position: relative;
            padding: 0.25rem 0;
        }

        .file-tree li::before {
            content: "├── ";
            position: absolute;
            left: -1.5rem;
        }

        .file-tree li:last-child::before {
            content: "└── ";
        }

        .ajax-example {
            background: white;
            border: 2px solid #667eea;
            border-radius: 12px;
            padding: 2rem;
            margin: 2rem 0;
        }

        .ajax-example h3 {
            color: #667eea;
            margin-top: 0;
        }

        .snippet-library {
            background: #f8f9fa;
            border: 2px solid #e5e7eb;
            border-radius: 8px;
            padding: 1.5rem;
            margin: 2rem 0;
        }

        .snippet-library h3 {
            color: #667eea;
            margin-top: 0;
        }

        .snippet-item {
            background: white;
            border: 1px solid #e5e7eb;
            border-radius: 4px;
            padding: 1rem;
            margin: 1rem 0;
        }

        .snippet-item h5 {
            color: #667eea;
            margin-top: 0;
        }

        @media (max-width: 768px) {
            .helper-grid {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <!-- Skip to main content -->
    <a href="#main-content" class="sr-only">Skip to main content</a>
    
    <div class="page-wrapper">
        <!-- Header -->
        <header class="site-header" role="banner">
            <div class="header-container">
                <div class="site-branding">
                    <a href="/" class="site-logo">
                        <h1 class="site-title">PHP WordPress Development</h1>
                    </a>
                </div>
                
                <nav class="main-navigation" role="navigation" aria-label="Main navigation">
                    <button class="mobile-menu-btn" aria-label="Toggle navigation" aria-expanded="false">
                        <span></span>
                        <span></span>
                        <span></span>
                    </button>
                    
                    <div class="nav-menu">
                        <ul class="nav-list">
                            <li class="nav-item"><a href="/" class="nav-link">Home</a></li>
                            <li class="nav-item dropdown">
                                <button class="nav-link dropdown-toggle active" aria-haspopup="true">Modules</button>
                                <div class="dropdown-menu">
                                    <a href="/module1.html" class="dropdown-item">Module 1: Web Fundamentals</a>
                                    <a href="/module2.html" class="dropdown-item">Module 2: PHP Fundamentals</a>
                                    <a href="/module3.html" class="dropdown-item">Module 3: MySQL Database</a>
                                    <a href="/module4.html" class="dropdown-item">Module 4: WordPress & Docker</a>
                                    <a href="/module5.html" class="dropdown-item active">Module 5: Theme Development</a>
                                    <a href="/module6.html" class="dropdown-item">Module 6: Plugin Development</a>
                                    <a href="/module7.html" class="dropdown-item">Module 7: Advanced WordPress</a>
                                    <a href="/module8.html" class="dropdown-item">Module 8: Deployment</a>
                                    <a href="/module9.html" class="dropdown-item">Module 9: Final Project</a>
                                </div>
                            </li>
                            <li class="nav-item"><a href="/resources.html" class="nav-link">Resources</a></li>
                            <li class="nav-item"><a href="/about.html" class="nav-link">About</a></li>
                        </ul>
                    </div>
                </nav>
                
                <div class="search-container">
                    <div class="search-input-wrapper">
                        <svg class="search-icon" width="20" height="20" viewBox="0 0 20 20" fill="currentColor">
                            <path fill-rule="evenodd" d="M8 4a4 4 0 100 8 4 4 0 000-8zM2 8a6 6 0 1110.89 3.476l4.817 4.817a1 1 0 01-1.414 1.414l-4.816-4.816A6 6 0 012 8z" clip-rule="evenodd" />
                        </svg>
                        <input type="search" class="search-input" placeholder="Search lessons..." aria-label="Search">
                    </div>
                    <div class="search-results"></div>
                </div>
            </div>
        </header>
        
        <!-- Progress Bar -->
        <div class="progress-container">
            <div class="progress-header">
                <h2 class="progress-title">Course Progress</h2>
                <span class="progress-text">Loading...</span>
            </div>
            <div class="progress-bar">
                <div class="progress-bar-fill">
                    <span class="progress-bar-text"></span>
                </div>
            </div>
        </div>
        
        <!-- Breadcrumb -->
        <nav class="breadcrumb container" aria-label="Breadcrumb">
            <ol class="breadcrumb-list">
                <li class="breadcrumb-item">
                    <a href="/">Home</a>
                    <span class="breadcrumb-separator">/</span>
                </li>
                <li class="breadcrumb-item">
                    <a href="/module5.html">Module 5</a>
                    <span class="breadcrumb-separator">/</span>
                </li>
                <li class="breadcrumb-item">
                    <span aria-current="page">Custom Functions & Helpers</span>
                </li>
            </ol>
        </nav>
        
        <!-- Main Content -->
        <main id="main-content" class="main-content" role="main">
            <div class="container">
                <div class="content-with-sidebar">
                    <!-- Sidebar -->
                    <aside class="sidebar">
                        <div class="sidebar-nav">
                            <h3 class="sidebar-title">Module 5: Theme Development</h3>
                            <div class="sidebar-section">
                                <h4 class="sidebar-section-title">Session 4: Functions and Features</h4>
                                <ul class="sidebar-menu">
                                    <li><a class="sidebar-link" href="/05module/understanding_functions_php.html">Understanding functions.php</a></li>
                                    <li><a class="sidebar-link" href="/05module/theme_support_features.html">Theme Support & Features</a></li>
                                    <li><a class="sidebar-link" href="/05module/enqueuing_styles_scripts.html">Enqueuing Styles & Scripts</a></li>
                                    <li><a class="sidebar-link" href="/05module/navigation_menus.html">Navigation Menus</a></li>
                                    <li><a class="sidebar-link" href="/05module/widget_areas_sidebars.html">Widget Areas & Sidebars</a></li>
                                    <li class="active"><a class="sidebar-link active" href="/05module/custom_functions_helpers.html">Custom Functions & Helpers</a></li>
                                    <li><a class="sidebar-link" href="/05module/homework_complete_functions.html">Homework: Complete Functions File</a></li>
                                </ul>
                            </div>
                            <div class="sidebar-section">
                                <h4 class="sidebar-section-title">Quick Links</h4>
                                <ul class="sidebar-menu">
                                    <li><a class="sidebar-link" href="/module5.html">Module Overview</a></li>
                                    <li><a class="sidebar-link" href="/05module/widget_areas_sidebars.html">← Previous Lesson</a></li>
                                    <li><a class="sidebar-link next-session" href="/05module/homework_complete_functions.html">Next: Homework →</a></li>
                                    <li><a class="sidebar-link" href="/">← Course Home</a></li>
                                    <li><a class="sidebar-link" href="/resources.html">Resources</a></li>
                                </ul>
                            </div>
                        </div>
                    </aside>
                    
                    <!-- Main Lesson Content -->
                    <article class="lesson-content">
                        <div class="functions-header">
                            <h1>🛠️ Custom Functions & Helpers</h1>
                            <p class="lead">Build reusable utilities and custom functionality</p>
                            <p>Master creating efficient, maintainable theme functions</p>
                        </div>

                        <!-- Learning Objectives -->
                        <div class="lesson-objectives">
                            <h2>Learning Objectives</h2>
                            <ul>
                                <li>Create custom helper functions for common tasks</li>
                                <li>Build utility functions for theme customization</li>
                                <li>Implement custom template tags</li>
                                <li>Create AJAX handlers for dynamic functionality</li>
                                <li>Build custom shortcodes</li>
                                <li>Organize functions for maintainability</li>
                                <li>Implement security best practices</li>
                                <li>Create reusable code snippets</li>
                            </ul>
                        </div>
                        
                        <!-- Lesson Body -->
                        <div class="lesson-body">
                            <!-- Introduction -->
                            <section>
                                <h2>Why Custom Functions?</h2>
                                <p class="lead">Custom functions extend WordPress functionality, reduce code repetition, and make your theme more maintainable. They encapsulate complex logic into reusable components.</p>
                                
                                <div class="alert alert-info">
                                    <div class="alert-icon">💡</div>
                                    <div class="alert-content">
                                        <div class="alert-title">Key Principle</div>
                                        <div class="alert-message">Follow the DRY principle (Don't Repeat Yourself). If you use code more than twice, create a function for it.</div>
                                    </div>
                                </div>

                                <div class="helper-grid">
                                    <div class="helper-card">
                                        <h4><span class="helper-icon">📝</span> Content Helpers</h4>
                                        <p>Functions for excerpts, read more, content formatting</p>
                                    </div>
                                    <div class="helper-card">
                                        <h4><span class="helper-icon">🖼️</span> Image Utilities</h4>
                                        <p>Custom image sizes, placeholders, responsive images</p>
                                    </div>
                                    <div class="helper-card">
                                        <h4><span class="helper-icon">🔍</span> Query Helpers</h4>
                                        <p>Custom queries, related posts, popular posts</p>
                                    </div>
                                    <div class="helper-card">
                                        <h4><span class="helper-icon">👤</span> User Functions</h4>
                                        <p>User avatars, author info, login checks</p>
                                    </div>
                                    <div class="helper-card">
                                        <h4><span class="helper-icon">📊</span> Analytics</h4>
                                        <p>View counts, reading time, post statistics</p>
                                    </div>
                                    <div class="helper-card">
                                        <h4><span class="helper-icon">🎨</span> Theme Options</h4>
                                        <p>Custom settings, theme mods, options</p>
                                    </div>
                                </div>
                            </section>

                            <!-- Content Helper Functions -->
                            <section class="function-category">
                                <h3>Content Helper Functions</h3>
                                
                                <div class="code-example">
                                    <h4>Custom Excerpt Functions</h4>
                                    <pre><code class="language-php">&lt;?php
/**
 * Custom excerpt length
 */
function mytheme_excerpt_length( $length ) {
    if ( is_home() ) {
        return 20;
    } elseif ( is_archive() ) {
        return 30;
    }
    return $length;
}
add_filter( 'excerpt_length', 'mytheme_excerpt_length', 999 );

/**
 * Custom excerpt more string
 */
function mytheme_excerpt_more( $more ) {
    return '...';
}
add_filter( 'excerpt_more', 'mytheme_excerpt_more' );

/**
 * Get custom excerpt with specific word count
 */
function mytheme_get_excerpt( $limit = 20, $source = null ) {
    $excerpt = $source ? $source : get_the_excerpt();
    $excerpt = preg_replace( ' (\[.*?\])', '', $excerpt );
    $excerpt = strip_shortcodes( $excerpt );
    $excerpt = strip_tags( $excerpt );
    $excerpt = substr( $excerpt, 0, $limit );
    $excerpt = substr( $excerpt, 0, strripos( $excerpt, " " ) );
    $excerpt = trim( preg_replace( '/\s+/', ' ', $excerpt ) );
    $excerpt = $excerpt . '...';
    return $excerpt;
}

/**
 * Estimated reading time
 */
function mytheme_reading_time() {
    $content = get_post_field( 'post_content', get_the_ID() );
    $word_count = str_word_count( strip_tags( $content ) );
    $reading_time = ceil( $word_count / 200 ); // Average reading speed
    
    if ( $reading_time == 1 ) {
        $timer = " minute";
    } else {
        $timer = " minutes";
    }
    
    return $reading_time . $timer;
}

/**
 * Display reading time
 */
function mytheme_the_reading_time() {
    echo '&lt;span class="reading-time"&gt;';
    echo '&lt;svg class="icon"&gt;...&lt;/svg&gt; ';
    echo mytheme_reading_time() . ' read';
    echo '&lt;/span&gt;';
}</code></pre>
                                </div>

                                <div class="code-example">
                                    <h4>Content Formatting Helpers</h4>
                                    <pre><code class="language-php">&lt;?php
/**
 * Add custom classes to body tag
 */
function mytheme_body_classes( $classes ) {
    // Add page slug
    if ( is_page() ) {
        global $post;
        $classes[] = 'page-' . $post->post_name;
    }
    
    // Add user state
    if ( is_user_logged_in() ) {
        $classes[] = 'logged-in-user';
    } else {
        $classes[] = 'logged-out-user';
    }
    
    // Add sidebar status
    if ( is_active_sidebar( 'sidebar-1' ) ) {
        $classes[] = 'has-sidebar';
    } else {
        $classes[] = 'no-sidebar';
    }
    
    return $classes;
}
add_filter( 'body_class', 'mytheme_body_classes' );

/**
 * Custom "Read More" link
 */
function mytheme_read_more_link( $text = 'Read More' ) {
    return '&lt;a class="read-more-link" href="' . get_permalink() . '"&gt;' . 
           $text . ' &lt;span class="screen-reader-text"&gt;about ' . 
           get_the_title() . '&lt;/span&gt;&lt;/a&gt;';
}

/**
 * Truncate text with preservation of words
 */
function mytheme_truncate( $text, $length = 100, $ending = '...' ) {
    if ( strlen( $text ) <= $length ) {
        return $text;
    }
    
    $text = substr( $text, 0, $length );
    $text = substr( $text, 0, strrpos( $text, ' ' ) );
    $text = $text . $ending;
    
    return $text;
}</code></pre>
                                </div>
                            </section>

                            <!-- Image Helper Functions -->
                            <section class="function-category">
                                <h3>Image & Media Helpers</h3>
                                
                                <div class="code-example">
                                    <h4>Image Utility Functions</h4>
                                    <pre><code class="language-php">&lt;?php
/**
 * Get featured image URL
 */
function mytheme_get_featured_image_url( $size = 'full', $post_id = null ) {
    if ( ! $post_id ) {
        $post_id = get_the_ID();
    }
    
    if ( has_post_thumbnail( $post_id ) ) {
        $image = wp_get_attachment_image_src( get_post_thumbnail_id( $post_id ), $size );
        return $image[0];
    }
    
    // Return placeholder
    return get_template_directory_uri() . '/assets/images/placeholder.jpg';
}

/**
 * Display responsive image
 */
function mytheme_responsive_image( $attachment_id, $sizes = array() ) {
    $default_sizes = array(
        'small'  => 480,
        'medium' => 768,
        'large'  => 1200,
    );
    
    $sizes = wp_parse_args( $sizes, $default_sizes );
    $srcset = array();
    
    foreach ( $sizes as $name => $width ) {
        $image = wp_get_attachment_image_src( $attachment_id, array( $width, 9999 ) );
        if ( $image ) {
            $srcset[] = $image[0] . ' ' . $width . 'w';
        }
    }
    
    $src = wp_get_attachment_image_url( $attachment_id, 'full' );
    $alt = get_post_meta( $attachment_id, '_wp_attachment_image_alt', true );
    
    echo '&lt;img src="' . esc_url( $src ) . '" ';
    echo 'srcset="' . esc_attr( implode( ', ', $srcset ) ) . '" ';
    echo 'sizes="(max-width: 480px) 100vw, (max-width: 768px) 50vw, 33vw" ';
    echo 'alt="' . esc_attr( $alt ) . '"&gt;';
}

/**
 * Get first image from post content
 */
function mytheme_get_first_image() {
    global $post;
    $first_img = '';
    
    preg_match_all( '/&lt;img.+src=[\'"]([^\'"]+)[\'"].*&gt;/i', $post->post_content, $matches );
    
    if ( isset( $matches[1][0] ) ) {
        $first_img = $matches[1][0];
    }
    
    if ( empty( $first_img ) ) {
        $first_img = get_template_directory_uri() . '/assets/images/default.jpg';
    }
    
    return $first_img;
}

/**
 * Lazy load images
 */
function mytheme_lazy_load_images( $content ) {
    if ( is_feed() || is_preview() ) {
        return $content;
    }
    
    $content = preg_replace( '/(&lt;img.*?)src=/i', '$1loading="lazy" src=', $content );
    return $content;
}
add_filter( 'the_content', 'mytheme_lazy_load_images' );</code></pre>
                                </div>
                            </section>

                            <!-- Navigation & Query Helpers -->
                            <section class="function-category">
                                <h3>Navigation & Query Helpers</h3>
                                
                                <div class="code-example">
                                    <h4>Custom Query Functions</h4>
                                    <pre><code class="language-php">&lt;?php
/**
 * Get related posts
 */
function mytheme_get_related_posts( $post_id = null, $number = 3 ) {
    if ( ! $post_id ) {
        $post_id = get_the_ID();
    }
    
    $categories = wp_get_post_categories( $post_id );
    
    $args = array(
        'category__in'        => $categories,
        'post__not_in'        => array( $post_id ),
        'posts_per_page'      => $number,
        'ignore_sticky_posts' => 1,
        'orderby'             => 'rand',
    );
    
    return new WP_Query( $args );
}

/**
 * Get popular posts by view count
 */
function mytheme_get_popular_posts( $number = 5 ) {
    $args = array(
        'posts_per_page'      => $number,
        'meta_key'            => 'post_views_count',
        'orderby'             => 'meta_value_num',
        'order'               => 'DESC',
        'ignore_sticky_posts' => 1,
    );
    
    return new WP_Query( $args );
}

/**
 * Track post views
 */
function mytheme_track_post_views( $post_id ) {
    if ( ! is_single() ) return;
    
    if ( empty( $post_id ) ) {
        global $post;
        $post_id = $post->ID;
    }
    
    $count_key = 'post_views_count';
    $count = get_post_meta( $post_id, $count_key, true );
    
    if ( $count == '' ) {
        $count = 0;
        delete_post_meta( $post_id, $count_key );
        add_post_meta( $post_id, $count_key, '0' );
    } else {
        $count++;
        update_post_meta( $post_id, $count_key, $count );
    }
}
add_action( 'wp_head', 'mytheme_track_post_views' );

/**
 * Custom breadcrumbs
 */
function mytheme_breadcrumbs() {
    $separator = ' &gt; ';
    $home = 'Home';
    
    echo '&lt;nav class="breadcrumbs"&gt;';
    echo '&lt;a href="' . home_url() . '"&gt;' . $home . '&lt;/a&gt;' . $separator;
    
    if ( is_category() || is_single() ) {
        the_category( ', ' );
        
        if ( is_single() ) {
            echo $separator;
            the_title();
        }
    } elseif ( is_page() ) {
        the_title();
    } elseif ( is_search() ) {
        echo 'Search Results for: ' . get_search_query();
    }
    
    echo '&lt;/nav&gt;';
}</code></pre>
                                </div>
                            </section>

                            <!-- AJAX Handler Functions -->
                            <section>
                                <div class="ajax-example">
                                    <h3>AJAX Handler Functions</h3>
                                    
                                    <div class="code-example">
                                        <h4>Load More Posts AJAX</h4>
                                        <pre><code class="language-php">&lt;?php
/**
 * AJAX Load More Posts Handler
 */
function mytheme_load_more_posts() {
    // Verify nonce
    if ( ! wp_verify_nonce( $_POST['nonce'], 'mytheme_load_more_nonce' ) ) {
        wp_die( 'Security check failed' );
    }
    
    $page = isset( $_POST['page'] ) ? intval( $_POST['page'] ) : 1;
    $posts_per_page = isset( $_POST['posts_per_page'] ) ? intval( $_POST['posts_per_page'] ) : 6;
    
    $args = array(
        'post_type'      => 'post',
        'posts_per_page' => $posts_per_page,
        'paged'          => $page,
        'post_status'    => 'publish',
    );
    
    $query = new WP_Query( $args );
    
    if ( $query->have_posts() ) {
        ob_start();
        
        while ( $query->have_posts() ) {
            $query->the_post();
            get_template_part( 'template-parts/content', 'card' );
        }
        
        $content = ob_get_clean();
        
        wp_send_json_success( array(
            'content' => $content,
            'max_pages' => $query->max_num_pages,
            'found_posts' => $query->found_posts,
        ) );
    } else {
        wp_send_json_error( 'No more posts found' );
    }
    
    wp_die();
}
add_action( 'wp_ajax_load_more_posts', 'mytheme_load_more_posts' );
add_action( 'wp_ajax_nopriv_load_more_posts', 'mytheme_load_more_posts' );

/**
 * AJAX Search
 */
function mytheme_ajax_search() {
    check_ajax_referer( 'mytheme_ajax_search_nonce', 'nonce' );
    
    $search_term = sanitize_text_field( $_POST['search'] );
    
    $args = array(
        's'              => $search_term,
        'post_type'      => 'post',
        'posts_per_page' => 5,
    );
    
    $query = new WP_Query( $args );
    
    if ( $query->have_posts() ) {
        $results = array();
        
        while ( $query->have_posts() ) {
            $query->the_post();
            $results[] = array(
                'title' => get_the_title(),
                'url'   => get_permalink(),
                'date'  => get_the_date(),
            );
        }
        
        wp_send_json_success( $results );
    } else {
        wp_send_json_error( 'No results found' );
    }
    
    wp_die();
}
add_action( 'wp_ajax_ajax_search', 'mytheme_ajax_search' );
add_action( 'wp_ajax_nopriv_ajax_search', 'mytheme_ajax_search' );</code></pre>
                                    </div>
                                </div>
                            </section>

                            <!-- Custom Shortcodes -->
                            <section class="function-category">
                                <h3>Custom Shortcodes</h3>
                                
                                <div class="code-example">
                                    <h4>Useful Shortcode Examples</h4>
                                    <pre><code class="language-php">&lt;?php
/**
 * Button shortcode
 * Usage: [button url="http://example.com" text="Click Me" color="primary"]
 */
function mytheme_button_shortcode( $atts ) {
    $atts = shortcode_atts( array(
        'url'    => '#',
        'text'   => 'Button',
        'color'  => 'primary',
        'target' => '_self',
    ), $atts );
    
    return sprintf(
        '&lt;a href="%s" class="btn btn-%s" target="%s"&gt;%s&lt;/a&gt;',
        esc_url( $atts['url'] ),
        esc_attr( $atts['color'] ),
        esc_attr( $atts['target'] ),
        esc_html( $atts['text'] )
    );
}
add_shortcode( 'button', 'mytheme_button_shortcode' );

/**
 * Current year shortcode
 * Usage: [year]
 */
function mytheme_year_shortcode() {
    return date( 'Y' );
}
add_shortcode( 'year', 'mytheme_year_shortcode' );

/**
 * Recent posts shortcode
 * Usage: [recent_posts number="3" category="news"]
 */
function mytheme_recent_posts_shortcode( $atts ) {
    $atts = shortcode_atts( array(
        'number'   => 5,
        'category' => '',
    ), $atts );
    
    $args = array(
        'posts_per_page' => intval( $atts['number'] ),
        'category_name'  => sanitize_text_field( $atts['category'] ),
    );
    
    $query = new WP_Query( $args );
    
    if ( ! $query->have_posts() ) {
        return 'No posts found';
    }
    
    $output = '&lt;ul class="shortcode-recent-posts"&gt;';
    
    while ( $query->have_posts() ) {
        $query->the_post();
        $output .= '&lt;li&gt;&lt;a href="' . get_permalink() . '"&gt;' . get_the_title() . '&lt;/a&gt;&lt;/li&gt;';
    }
    
    $output .= '&lt;/ul&gt;';
    
    wp_reset_postdata();
    
    return $output;
}
add_shortcode( 'recent_posts', 'mytheme_recent_posts_shortcode' );</code></pre>
                                </div>
                            </section>

                            <!-- Utility Functions -->
                            <section>
                                <div class="utility-showcase">
                                    <h3>General Utility Functions</h3>
                                    
                                    <div class="code-example">
                                        <h4>Useful Helper Functions</h4>
                                        <pre><code class="language-php">&lt;?php
/**
 * Check if current page is a blog page
 */
function mytheme_is_blog() {
    return ( is_archive() || is_author() || is_category() || is_home() || is_single() || is_tag() ) && 'post' == get_post_type();
}

/**
 * Get current page URL
 */
function mytheme_current_url() {
    global $wp;
    return home_url( add_query_arg( array(), $wp->request ) );
}

/**
 * Format phone number for tel: links
 */
function mytheme_format_phone( $phone ) {
    return preg_replace( '/[^0-9+]/', '', $phone );
}

/**
 * Get social share links
 */
function mytheme_social_share_links() {
    $url = urlencode( get_permalink() );
    $title = urlencode( get_the_title() );
    
    $links = array(
        'facebook'  => 'https://www.facebook.com/sharer/sharer.php?u=' . $url,
        'twitter'   => 'https://twitter.com/intent/tweet?url=' . $url . '&text=' . $title,
        'linkedin'  => 'https://www.linkedin.com/shareArticle?mini=true&url=' . $url . '&title=' . $title,
        'pinterest' => 'https://pinterest.com/pin/create/button/?url=' . $url . '&description=' . $title,
    );
    
    return $links;
}

/**
 * Get attachment ID from URL
 */
function mytheme_get_attachment_id_from_url( $url ) {
    $attachment_id = 0;
    $dir = wp_upload_dir();
    
    if ( false !== strpos( $url, $dir['baseurl'] . '/' ) ) {
        $file = basename( $url );
        
        $query_args = array(
            'post_type'   => 'attachment',
            'post_status' => 'inherit',
            'fields'      => 'ids',
            'meta_query'  => array(
                array(
                    'value'   => $file,
                    'compare' => 'LIKE',
                    'key'     => '_wp_attachment_metadata',
                ),
            )
        );
        
        $query = new WP_Query( $query_args );
        
        if ( $query->have_posts() ) {
            foreach ( $query->posts as $post_id ) {
                $meta = wp_get_attachment_metadata( $post_id );
                $original_file = basename( $meta['file'] );
                $cropped_image_files = wp_list_pluck( $meta['sizes'], 'file' );
                
                if ( $original_file === $file || in_array( $file, $cropped_image_files ) ) {
                    $attachment_id = $post_id;
                    break;
                }
            }
        }
    }
    
    return $attachment_id;
}

/**
 * Human-readable time difference
 */
function mytheme_time_ago() {
    return human_time_diff( get_the_time( 'U' ), current_time( 'timestamp' ) ) . ' ago';
}</code></pre>
                                    </div>
                                </div>
                            </section>

                            <!-- File Organization -->
                            <section>
                                <div class="organization-structure">
                                    <h3>Organizing Custom Functions</h3>
                                    <p>Keep your functions organized by splitting them into separate files:</p>
                                    
                                    <div class="file-tree">
                                        <ul>
                                            <li>theme-folder/
                                                <ul>
                                                    <li>functions.php</li>
                                                    <li>inc/
                                                        <ul>
                                                            <li>setup.php (theme setup functions)</li>
                                                            <li>assets.php (styles and scripts)</li>
                                                            <li>widgets.php (widget areas)</li>
                                                            <li>navigation.php (menu functions)</li>
                                                            <li>template-functions.php (template helpers)</li>
                                                            <li>customizer.php (customizer settings)</li>
                                                            <li>ajax-handlers.php (AJAX functions)</li>
                                                            <li>shortcodes.php (shortcode definitions)</li>
                                                            <li>helpers.php (utility functions)</li>
                                                        </ul>
                                                    </li>
                                                </ul>
                                            </li>
                                        </ul>
                                    </div>
                                    
                                    <div class="code-example">
                                        <h4>Including Files in functions.php</h4>
                                        <pre><code class="language-php">&lt;?php
/**
 * Theme functions and definitions
 */

// Define constants
define( 'MYTHEME_VERSION', '1.0.0' );
define( 'MYTHEME_DIR', get_template_directory() );
define( 'MYTHEME_URI', get_template_directory_uri() );

// Include function files
$mytheme_includes = array(
    '/inc/setup.php',           // Theme setup
    '/inc/assets.php',          // Scripts and styles
    '/inc/widgets.php',         // Widget areas
    '/inc/navigation.php',      // Custom navigation
    '/inc/template-functions.php', // Template helpers
    '/inc/customizer.php',      // Customizer additions
    '/inc/ajax-handlers.php',   // AJAX functions
    '/inc/shortcodes.php',      // Shortcodes
    '/inc/helpers.php',         // Helper functions
);

foreach ( $mytheme_includes as $file ) {
    $filepath = MYTHEME_DIR . $file;
    if ( file_exists( $filepath ) ) {
        require_once $filepath;
    }
}</code></pre>
                                    </div>
                                </div>
                            </section>

                            <!-- Security Best Practices -->
                            <section>
                                <h2>Security in Custom Functions</h2>
                                
                                <div class="best-practice">
                                    <h4>Security Best Practices</h4>
                                    <ul>
                                        <li><strong>Sanitize Input:</strong> Always sanitize user input with appropriate functions</li>
                                        <li><strong>Escape Output:</strong> Escape all dynamic output</li>
                                        <li><strong>Validate Data:</strong> Validate data before processing</li>
                                        <li><strong>Use Nonces:</strong> Implement nonces for forms and AJAX</li>
                                        <li><strong>Check Capabilities:</strong> Verify user permissions</li>
                                        <li><strong>Prefix Functions:</strong> Use unique prefixes to avoid conflicts</li>
                                        <li><strong>Use Prepared Statements:</strong> For database queries</li>
                                    </ul>
                                </div>

                                <div class="code-example">
                                    <h4>Security Examples</h4>
                                    <pre><code class="language-php">&lt;?php
/**
 * Secure custom function example
 */
function mytheme_secure_function() {
    // Check user capabilities
    if ( ! current_user_can( 'edit_posts' ) ) {
        wp_die( 'Unauthorized access' );
    }
    
    // Verify nonce
    if ( ! isset( $_POST['mytheme_nonce'] ) || 
         ! wp_verify_nonce( $_POST['mytheme_nonce'], 'mytheme_action' ) ) {
        wp_die( 'Security check failed' );
    }
    
    // Sanitize input
    $title = sanitize_text_field( $_POST['title'] );
    $content = wp_kses_post( $_POST['content'] );
    $url = esc_url_raw( $_POST['url'] );
    $number = intval( $_POST['number'] );
    
    // Validate data
    if ( empty( $title ) || strlen( $title ) > 100 ) {
        return new WP_Error( 'invalid_title', 'Invalid title provided' );
    }
    
    // Escape output
    echo '&lt;h2&gt;' . esc_html( $title ) . '&lt;/h2&gt;';
    echo '&lt;div&gt;' . wp_kses_post( $content ) . '&lt;/div&gt;';
    echo '&lt;a href="' . esc_url( $url ) . '"&gt;Link&lt;/a&gt;';
}</code></pre>
                                </div>
                            </section>

                            <!-- Snippet Library -->
                            <section>
                                <div class="snippet-library">
                                    <h3>Useful Code Snippets</h3>
                                    
                                    <div class="snippet-item">
                                        <h5>Disable Emojis</h5>
                                        <pre><code class="language-php">function mytheme_disable_emojis() {
    remove_action( 'wp_head', 'print_emoji_detection_script', 7 );
    remove_action( 'admin_print_scripts', 'print_emoji_detection_script' );
    remove_action( 'wp_print_styles', 'print_emoji_styles' );
    remove_action( 'admin_print_styles', 'print_emoji_styles' );
}
add_action( 'init', 'mytheme_disable_emojis' );</code></pre>
                                    </div>
                                    
                                    <div class="snippet-item">
                                        <h5>Custom Login Logo</h5>
                                        <pre><code class="language-php">function mytheme_login_logo() {
    echo '&lt;style&gt;
        #login h1 a {
            background-image: url(' . get_template_directory_uri() . '/logo.png);
            width: 200px;
            height: 80px;
            background-size: contain;
        }
    &lt;/style&gt;';
}
add_action( 'login_enqueue_scripts', 'mytheme_login_logo' );</code></pre>
                                    </div>
                                    
                                    <div class="snippet-item">
                                        <h5>Remove WordPress Version</h5>
                                        <pre><code class="language-php">remove_action( 'wp_head', 'wp_generator' );
add_filter( 'the_generator', '__return_empty_string' );</code></pre>
                                    </div>
                                </div>
                            </section>

                            <!-- Practice Exercise -->
                            <section>
                                <h2>Practice Exercise</h2>
                                <div class="alert alert-success">
                                    <div class="alert-icon">💻</div>
                                    <div class="alert-content">
                                        <div class="alert-title">Create Custom Function Library</div>
                                        <div class="alert-message">
                                            <p>Build a comprehensive set of custom functions including:</p>
                                            <ol>
                                                <li>Custom excerpt function with variable length</li>
                                                <li>Reading time calculator and display</li>
                                                <li>Related posts function with caching</li>
                                                <li>AJAX load more posts handler</li>
                                                <li>Social share buttons generator</li>
                                                <li>Custom breadcrumb navigation</li>
                                                <li>Image lazy loading implementation</li>
                                                <li>View counter for popular posts</li>
                                                <li>Three custom shortcodes</li>
                                                <li>Organize all functions into separate files</li>
                                            </ol>
                                        </div>
                                    </div>
                                </div>
                            </section>

                            <!-- Resources -->
                            <section class="resources">
                                <h2>Additional Resources</h2>
                                <ul>
                                    <li><a href="https://developer.wordpress.org/themes/basics/theme-functions/" target="_blank">Theme Functions Guide</a></li>
                                    <li><a href="https://developer.wordpress.org/plugins/shortcodes/" target="_blank">Shortcode API</a></li>
                                    <li><a href="https://developer.wordpress.org/plugins/javascript/ajax/" target="_blank">AJAX in WordPress</a></li>
                                    <li><a href="https://developer.wordpress.org/themes/theme-security/" target="_blank">Theme Security</a></li>
                                    <li><a href="https://codex.wordpress.org/Validating_Sanitizing_and_Escaping_User_Data" target="_blank">Data Validation</a></li>
                                    <li><a href="https://developer.wordpress.org/apis/" target="_blank">WordPress APIs</a></li>
                                </ul>
                            </section>
                        </div>

                        <!-- Lesson Navigation -->
                        <div class="lesson-navigation">
                            <a href="/05module/widget_areas_sidebars.html" class="lesson-nav-button prev">
                                <svg width="20" height="20" viewBox="0 0 20 20" fill="currentColor">
                                    <path d="M12.707 5.293a1 1 0 010 1.414L9.414 10l3.293 3.293a1 1 0 01-1.414 1.414l-4-4a1 1 0 010-1.414l4-4a1 1 0 011.414 0z"/>
                                </svg>
                                <span>
                                    <small>Previous</small><br>
                                    Widget Areas & Sidebars
                                </span>
                            </a>
                            
                            <button class="complete-lesson-btn">
                                Mark as Complete
                            </button>
                            
                            <a href="/05module/homework_complete_functions.html" class="lesson-nav-button next">
                                <span>
                                    <small>Next</small><br>
                                    Homework: Complete Functions
                                </span>
                                <svg width="20" height="20" viewBox="0 0 20 20" fill="currentColor">
                                    <path d="M7.293 14.707a1 1 0 010-1.414L10.586 10 7.293 6.707a1 1 0 011.414-1.414l4 4a1 1 0 010 1.414l-4 4a1 1 0 01-1.414 0z"/>
                                </svg>
                            </a>
                        </div>
                    </article>
                </div>
            </div>
        </main>

        <!-- Footer -->
        <footer class="site-footer" role="contentinfo">
            <div class="footer-container">
                <div class="footer-content">
                    <div class="footer-section footer-about">
                        <h3>PHP WordPress Development</h3>
                        <p>Complete Web Development Course</p>
                    </div>
                    
                    <div class="footer-section">
                        <h4>Quick Links</h4>
                        <ul class="footer-links">
                            <li><a href="/">Home</a></li>
                            <li><a href="/module5.html">Module 5</a></li>
                            <li><a href="/resources.html">Resources</a></li>
                        </ul>
                    </div>
                    
                    <div class="footer-section">
                        <h4>Support</h4>
                        <ul class="footer-links">
                            <li><a href="/about.html">About</a></li>
                            <li><a href="/contact.html">Contact</a></li>
                        </ul>
                    </div>
                </div>
                
                <div class="footer-bottom">
                    <p>&copy; 2024 PHP WordPress Course. All rights reserved.</p>
                    <p>This course material is for educational purposes only.</p>
                </div>
            </div>
        </footer>
    </div>
    
    <!-- JavaScript -->
    <script src="/assets/js/prism.js"></script>
    <script src="/assets/js/main.js"></script>
    <script src="/assets/js/sidebar-toggle.js"></script>
    <script src="/assets/js/progress-tracker.js"></script>
    <script src="/assets/js/search.js"></script>
    <script src="/assets/js/theme-toggle.js"></script>
    
    <script>
        // Tab functionality
        function showTab(evt, tabName) {
            const tabContents = document.querySelectorAll('.tab-content');
            tabContents.forEach(content => {
                content.classList.remove('active');
            });
            
            const tabButtons = document.querySelectorAll('.tab-button');
            tabButtons.forEach(button => {
                button.classList.remove('active');
            });
            
            document.getElementById(tabName).classList.add('active');
            evt.currentTarget.classList.add('active');
        }
    </script>
</body>
</html>