<!DOCTYPE html>
<html lang="en">
 <head>
  <meta charset="utf-8"/>
  <meta content="width=device-width, initial-scale=1.0" name="viewport"/>
  <meta content="ie=edge" http-equiv="X-UA-Compatible"/>
  <!-- SEO Meta Tags -->
  <title>SQL Aggregate Functions - COUNT, SUM, AVG, MIN, MAX - PHP WordPress Course</title>
  <meta content="Master SQL aggregate functions for data analysis - COUNT, SUM, AVG, MIN, MAX with GROUP BY and HAVING" name="description"/>
  <meta content="PHP, WordPress, MySQL, aggregate functions, COUNT, SUM, AVG, MIN, MAX, GROUP BY" name="keywords"/>
  <meta content="PHP WordPress Course" name="author"/>
  <link href="/assets/css/main.css" rel="stylesheet"/>
  <link href="/assets/css/sidebar-enhanced.css" rel="stylesheet"/>
  <link href="/assets/css/sidebar-toggle.css" rel="stylesheet"/>
  <!-- Favicon -->
  <link href="/favicon.png" rel="icon" type="image/png"/>
  <link href="/favicon.png" rel="apple-touch-icon"/>
  <!-- CSS -->
  <link href="/assets/css/sidebar-enhanced.css" rel="stylesheet"/>
  <link href="/assets/css/sidebar-toggle.css" rel="stylesheet"/>
 </head>
 <body>
  <!-- Skip to main content -->
  <a class="sr-only" href="#main-content">Skip to main content</a>
  <div class="page-wrapper">
   <!-- Header -->
   <header class="site-header" role="banner">
    <div class="header-container">
     <div class="site-branding">
      <a class="site-logo" href="/">
       <h1 class="site-title">PHP WordPress Development</h1>
      </a>
     </div>
     <nav aria-label="Main navigation" class="main-navigation" role="navigation">
      <button aria-expanded="false" aria-label="Toggle navigation" class="mobile-menu-btn">
       <span>
       </span>
       <span>
       </span>
       <span>
       </span>
      </button>
      <div class="nav-menu">
       <ul class="nav-list">
        <li class="nav-item">
         <a class="nav-link" href="/">Home</a>
        </li>
        <li class="nav-item dropdown">
         <button aria-haspopup="true" class="nav-link dropdown-toggle active">Modules</button>
         <div class="dropdown-menu">
          <a class="dropdown-item" href="/module1.html">Module 1: Web Fundamentals</a>
          <a class="dropdown-item" href="/module2.html">Module 2: PHP Fundamentals</a>
          <a class="dropdown-item active" href="/module3.html">Module 3: MySQL Database</a>
          <a class="dropdown-item" href="/module4.html">Module 4: WordPress &amp; Docker</a>
          <a class="dropdown-item" href="/module5.html">Module 5: Theme Development</a>
          <a class="dropdown-item" href="/module6.html">Module 6: Plugin Development</a>
          <a class="dropdown-item" href="/module7.html">Module 7: Advanced WordPress</a>
          <a class="dropdown-item" href="/module8.html">Module 8: Deployment</a>
          <a class="dropdown-item" href="/module9.html">Module 9: Final Project</a>
         </div>
        </li>
        <li class="nav-item">
         <a class="nav-link" href="/resources.html">Resources</a>
        </li>
        <li class="nav-item">
         <a class="nav-link" href="/about.html">About</a>
        </li>
       </ul>
      </div>
     </nav>
     <div class="search-container">
      <div class="search-input-wrapper">
       <svg class="search-icon" fill="currentColor" height="20" viewbox="0 0 20 20" width="20">
        <path clip-rule="evenodd" d="M8 4a4 4 0 100 8 4 4 0 000-8zM2 8a6 6 0 1110.89 3.476l4.817 4.817a1 1 0 01-1.414 1.414l-4.816-4.816A6 6 0 012 8z" fill-rule="evenodd">
        </path>
       </svg>
       <input aria-label="Search" class="search-input" placeholder="Search lessons..." type="search"/>
      </div>
      <div class="search-results">
      </div>
     </div>
    </div>
   </header>
   <!-- Progress Bar -->
   <div class="progress-container">
    <div class="progress-header">
     <h2 class="progress-title">Course Progress</h2>
     <span class="progress-text">Loading...</span>
    </div>
    <div class="progress-bar">
     <div class="progress-bar-fill">
      <span class="progress-bar-text">
      </span>
     </div>
    </div>
   </div>
   <!-- Breadcrumb -->
   <nav aria-label="Breadcrumb" class="breadcrumb container">
    <ol class="breadcrumb-list">
     <li class="breadcrumb-item">
      <a href="/">Home</a>
      <span class="breadcrumb-separator">/</span>
     </li>
     <li class="breadcrumb-item">
      <a href="/module3.html">Module 3</a>
      <span class="breadcrumb-separator">/</span>
     </li>
     <li class="breadcrumb-item">
      <span aria-current="page">Aggregate Functions</span>
     </li>
    </ol>
   </nav>
   <!-- Main Content -->
   <main class="main-content" id="main-content" role="main">
    <div class="container">
     <div class="content-with-sidebar">
      <!-- Sidebar -->
      <aside class="sidebar">
    <div class="sidebar-nav">
        <h3 class="sidebar-title">Module 3: MySQL Database</h3>
        <div class="sidebar-section">
            <h4 class="sidebar-section-title">Session 4: Advanced SQL</h4>
            <ul class="sidebar-menu">
                <li><a class="sidebar-link" href="/03module/sql_joins.html">Joins (INNER, LEFT, RIGHT, FULL)</a></li>
                <li class="active"><a class="sidebar-link active" href="/03module/aggregate_functions.html">Aggregating data (COUNT, SUM, AVG, MIN, MAX)</a></li>
                <li><a class="sidebar-link" href="/03module/group_by_having.html">Grouping data with GROUP BY</a></li>
                <li><a class="sidebar-link" href="/03module/having_deep_dive.html">Filtering groups with HAVING</a></li>
                <li><a class="sidebar-link" href="/03module/subqueries.html">Subqueries</a></li>
                <li><a class="sidebar-link" href="/03module/views.html">Views</a></li>
                <li><a class="sidebar-link" href="/03module/transactions.html">Transactions</a></li>
                <li><a class="sidebar-link" href="/03module/stored_procedures.html">Stored procedures and functions</a></li>
                <li><a class="sidebar-link" href="/03module/homework_sql_queries.html">Homework: Write complex SQL queries with joins and aggregations</a></li>
            </ul>
        </div>
        <div class="sidebar-section">
            <h4 class="sidebar-section-title">Quick Links</h4>
            <ul class="sidebar-menu">
                <li><a class="sidebar-link" href="/module3.html">Module Overview</a></li>
                <li><a class="sidebar-link prev-session" href="/03module/sql_syntax_conventions.html">‚Üê Prev: SQL Fundamentals</a></li>
                <li><a class="sidebar-link next-session" href="/03module/connecting_mysql.html">Next: Session 5 ‚Üí</a></li>
                <li><a class="sidebar-link" href="/">‚Üê Course Home</a></li>
                <li><a class="sidebar-link" href="/module4.html">Next Module ‚Üí</a></li>
                <li><a class="sidebar-link" href="/resources.html">Resources</a></li>
            </ul>
        </div>
    </div>
</aside>
      <!-- Main Lesson Content -->
      <article class="lesson-content">
       <header class="lesson-header">
        <h1>SQL Aggregate Functions</h1>
        <div class="lesson-meta">
         <div class="lesson-meta-item">
          <svg fill="currentColor" height="20" width="20">
           <path d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z">
           </path>
          </svg>
          <span>Duration: 85 minutes</span>
         </div>
         <div class="lesson-meta-item">
          <svg fill="currentColor" height="20" width="20">
           <path d="M12 14l9-5-9-5-9 5 9 5z">
           </path>
          </svg>
          <span>Module 3: Session 4</span>
         </div>
        </div>
       </header>
       <!-- Learning Objectives -->
       <div class="lesson-objectives">
        <h2>Learning Objectives</h2>
        <ul>
         <li>Master the five core aggregate functions</li>
         <li>Understand NULL handling in aggregates</li>
         <li>Use GROUP BY for data segmentation</li>
         <li>Apply HAVING for group filtering</li>
         <li>Combine aggregates with JOINs</li>
         <li>Use DISTINCT with aggregate functions</li>
         <li>Implement advanced aggregation patterns</li>
         <li>Optimize aggregate query performance</li>
        </ul>
       </div>
       <!-- Lesson Body -->
       <div class="lesson-body">
        <section>
         <h2>Understanding Aggregate Functions</h2>
         <p class="lead">Aggregate functions perform calculations on a set of values and return a single value. They're essential for data analysis and reporting! üìä</p>
         <canvas height="450" id="aggregateOverviewCanvas" width="600">
         </canvas>
         <script>const ctx = document.getElementById('aggregateOverviewCanvas').getContext('2d');
                                    
                                    // Title
                                    ctx.font = 'bold 18px Arial';
                                    ctx.fillStyle = '#1f2937';
                                    ctx.fillText('Aggregate Functions Overview', 180, 30);
                                    
                                    // Draw function boxes
                                    const functions = [
                                        {
                                            name: 'COUNT',
                                            desc: 'Counts rows',
                                            example: 'COUNT(*)',
                                            color: '#dbeafe',
                                            border: '#2563eb',
                                            x: 50, y: 60
                                        },
                                        {
                                            name: 'SUM',
                                            desc: 'Adds values',
                                            example: 'SUM(amount)',
                                            color: '#dcfce7',
                                            border: '#16a34a',
                                            x: 220, y: 60
                                        },
                                        {
                                            name: 'AVG',
                                            desc: 'Average value',
                                            example: 'AVG(price)',
                                            color: '#fef3c7',
                                            border: '#ca8a04',
                                            x: 390, y: 60
                                        },
                                        {
                                            name: 'MIN',
                                            desc: 'Minimum value',
                                            example: 'MIN(date)',
                                            color: '#fee2e2',
                                            border: '#dc2626',
                                            x: 50, y: 160
                                        },
                                        {
                                            name: 'MAX',
                                            desc: 'Maximum value',
                                            example: 'MAX(score)',
                                            color: '#e9d5ff',
                                            border: '#7c3aed',
                                            x: 220, y: 160
                                        }
                                    ];
                                    
                                    functions.forEach(func =>{
                                        ctx.fillStyle = func.color;
                                        ctx.fillRect(func.x, func.y, 150, 80);
                                        ctx.strokeStyle = func.border;
                                        ctx.lineWidth = 2;
                                        ctx.strokeRect(func.x, func.y, 150, 80);
                                        
                                        ctx.fillStyle = func.border;
                                        ctx.font = 'bold 14px Arial';
                                        ctx.fillText(func.name, func.x + 50, func.y + 25);
                                        
                                        ctx.fillStyle = '#374151';
                                        ctx.font = '11px Arial';
                                        ctx.fillText(func.desc, func.x + 10, func.y + 45);
                                        
                                        ctx.fillStyle = '#6b7280';
                                        ctx.font = '10px Courier';
                                        ctx.fillText(func.example, func.x + 10, func.y + 65);
                                    });
                                    
                                    // Additional functions box
                                    ctx.fillStyle = '#e0f2fe';
                                    ctx.fillRect(390, 160, 160, 80);
                                    ctx.strokeStyle = '#0891b2';
                                    ctx.strokeRect(390, 160, 160, 80);
                                    
                                    ctx.fillStyle = '#0c4a6e';
                                    ctx.font = 'bold 12px Arial';
                                    ctx.fillText('More Functions', 420, 180);
                                    
                                    ctx.fillStyle = '#374151';
                                    ctx.font = '10px Arial';
                                    ctx.fillText('‚Ä¢ GROUP_CONCAT', 400, 200);
                                    ctx.fillText('‚Ä¢ STD/STDDEV', 400, 215);
                                    ctx.fillText('‚Ä¢ VARIANCE', 400, 230);
                                    
                                    // Sample data visualization
                                    ctx.fillStyle = '#f3f4f6';
                                    ctx.fillRect(50, 260, 500, 170);
                                    ctx.strokeStyle = '#6b7280';
                                    ctx.strokeRect(50, 260, 500, 170);
                                    
                                    ctx.fillStyle = '#1f2937';
                                    ctx.font = 'bold 12px Arial';
                                    ctx.fillText('Sample Data: orders table', 60, 280);
                                    
                                    // Sample data
                                    ctx.font = '10px Courier';
                                    ctx.fillText('order_id | customer_id | amount', 60, 300);
                                    ctx.fillText('---------|-------------|--------', 60, 315);
                                    ctx.fillText('1        | 101         | 150.00', 60, 330);
                                    ctx.fillText('2        | 102         | 200.00', 60, 345);
                                    ctx.fillText('3        | 101         | 75.00', 60, 360);
                                    ctx.fillText('4        | 103         | 300.00', 60, 375);
                                    ctx.fillText('5        | 101         | 125.00', 60, 390);
                                    
                                    // Results
                                    ctx.fillStyle = '#059669';
                                    ctx.font = 'bold 11px Arial';
                                    ctx.fillText('Aggregate Results:', 300, 300);
                                    ctx.font = '10px Arial';
                                    ctx.fillText('COUNT(*) = 5', 300, 320);
                                    ctx.fillText('SUM(amount) = 850.00', 300, 335);
                                    ctx.fillText('AVG(amount) = 170.00', 300, 350);
                                    ctx.fillText('MIN(amount) = 75.00', 300, 365);
                                    ctx.fillText('MAX(amount) = 300.00', 300, 380);
                                    ctx.fillText('COUNT(DISTINCT customer_id) = 3', 300, 395);</script>
         <div class="alert alert-info">
          <div class="alert-icon">üí°</div>
          <div class="alert-content">
           <div class="alert-title">Key Points About Aggregates</div>
           <div class="alert-message">
            <ul>
             <li>Aggregate functions ignore NULL values (except COUNT(*))</li>
             <li>Cannot mix aggregate and non-aggregate columns without GROUP BY</li>
             <li>Use DISTINCT to aggregate unique values</li>
             <li>Aggregates can be used in SELECT, HAVING, and ORDER BY</li>
             <li>Performance depends on indexes and data volume</li>
            </ul>
           </div>
          </div>
         </div>
        </section>
        <section>
         <h2>COUNT Function - Counting Rows</h2>
         <div class="mermaid">graph TB
                                        COUNT[COUNT Function] --&gt; ALL[COUNT*]
                                        COUNT --&gt; COL[COUNT column]
                                        COUNT --&gt; DIST[COUNT DISTINCT]
                                        
                                        ALL --&gt; A1[Counts all rows]
                                        COL --&gt; C1[Counts non-NULL values]
                                        DIST --&gt; D1[Counts unique values]
                                        
                                        style COUNT fill:#dcfce7
                                        style ALL fill:#dbeafe
                                        style COL fill:#fef3c7
                                        style DIST fill:#fee2e2</div>
         <div class="real_world_example">
          <h3>COUNT Function Examples</h3>
          <pre><code class="language-sql">-- ========================================
-- COUNT VARIATIONS
-- ========================================

-- COUNT(*) - Counts all rows including NULLs
SELECT COUNT(*) AS total_orders
FROM orders;

-- COUNT(column) - Counts non-NULL values only
SELECT 
    COUNT(customer_id) AS customers_with_id,
    COUNT(phone) AS customers_with_phone,
    COUNT(*) AS total_customers
FROM customers;

-- COUNT(DISTINCT) - Counts unique values
SELECT 
    COUNT(DISTINCT customer_id) AS unique_customers,
    COUNT(DISTINCT product_id) AS unique_products,
    COUNT(DISTINCT DATE(order_date)) AS days_with_orders,
    COUNT(*) AS total_orders
FROM orders
WHERE order_date &gt;= '2024-01-01';

-- COUNT with conditions (using CASE)
SELECT 
    COUNT(*) AS total_orders,
    COUNT(CASE WHEN status = 'completed' THEN 1 END) AS completed_orders,
    COUNT(CASE WHEN status = 'pending' THEN 1 END) AS pending_orders,
    COUNT(CASE WHEN status = 'cancelled' THEN 1 END) AS cancelled_orders
FROM orders;

-- COUNT with IF (MySQL specific)
SELECT 
    COUNT(IF(amount &gt; 100, 1, NULL)) AS large_orders,
    COUNT(IF(amount &lt;= 100, 1, NULL)) AS small_orders
FROM orders;

-- ========================================
-- COUNT WITH GROUP BY
-- ========================================

-- Count orders per customer
SELECT 
    customer_id,
    COUNT(*) AS order_count
FROM orders
GROUP BY customer_id
ORDER BY order_count DESC;

-- Count products per category
SELECT 
    c.category_name,
    COUNT(p.product_id) AS product_count,
    COUNT(DISTINCT p.brand) AS brand_count
FROM categories c
LEFT JOIN products p ON c.category_id = p.category_id
GROUP BY c.category_id;

-- Count with multiple grouping
SELECT 
    YEAR(order_date) AS year,
    MONTH(order_date) AS month,
    status,
    COUNT(*) AS order_count
FROM orders
GROUP BY YEAR(order_date), MONTH(order_date), status
ORDER BY year DESC, month DESC, status;

-- ========================================
-- ADVANCED COUNT PATTERNS
-- ========================================

-- Running count with variable
SET @row_number = 0;
SELECT 
    (@row_number:=@row_number + 1) AS row_num,
    customer_name,
    email
FROM customers
ORDER BY customer_name;

-- Count with percentage
SELECT 
    status,
    COUNT(*) AS count,
    ROUND(COUNT(*) * 100.0 / (SELECT COUNT(*) FROM orders), 2) AS percentage
FROM orders
GROUP BY status;

-- Conditional counting for pivot
SELECT 
    customer_id,
    COUNT(CASE WHEN YEAR(order_date) = 2023 THEN 1 END) AS orders_2023,
    COUNT(CASE WHEN YEAR(order_date) = 2024 THEN 1 END) AS orders_2024,
    COUNT(*) AS total_orders
FROM orders
GROUP BY customer_id
HAVING total_orders &gt; 5;</code></pre>
         </div>
        </section>
        <section>
         <h2>SUM and AVG Functions</h2>
         <canvas height="350" id="sumAvgCanvas" width="600">
         </canvas>
         <script>const saCtx = document.getElementById('sumAvgCanvas').getContext('2d');
                                    
                                    // Title
                                    saCtx.font = 'bold 16px Arial';
                                    saCtx.fillStyle = '#1f2937';
                                    saCtx.fillText('SUM and AVG Behavior with NULL', 180, 30);
                                    
                                    // Sample data
                                    saCtx.fillStyle = '#f3f4f6';
                                    saCtx.fillRect(50, 60, 200, 150);
                                    saCtx.strokeStyle = '#6b7280';
                                    saCtx.strokeRect(50, 60, 200, 150);
                                    
                                    saCtx.fillStyle = '#1f2937';
                                    saCtx.font = 'bold 12px Arial';
                                    saCtx.fillText('Sample Data', 110, 80);
                                    
                                    saCtx.font = '11px Courier';
                                    saCtx.fillText('Values: 100, 200, NULL, 300', 60, 100);
                                    saCtx.fillText('------------------------', 60, 115);
                                    
                                    // SUM result
                                    saCtx.fillStyle = '#dcfce7';
                                    saCtx.fillRect(60, 130, 180, 30);
                                    saCtx.fillStyle = '#166534';
                                    saCtx.font = 'bold 11px Arial';
                                    saCtx.fillText('SUM = 600 (ignores NULL)', 70, 150);
                                    
                                    // AVG result
                                    saCtx.fillStyle = '#fef3c7';
                                    saCtx.fillRect(60, 170, 180, 30);
                                    saCtx.fillStyle = '#92400e';
                                    saCtx.fillText('AVG = 200 (600/3, not /4)', 70, 190);
                                    
                                    // Important note
                                    saCtx.fillStyle = '#fee2e2';
                                    saCtx.fillRect(280, 60, 270, 150);
                                    saCtx.strokeStyle = '#dc2626';
                                    saCtx.strokeRect(280, 60, 270, 150);
                                    
                                    saCtx.fillStyle = '#dc2626';
                                    saCtx.font = 'bold 12px Arial';
                                    saCtx.fillText('‚ö†Ô∏è NULL Handling', 360, 80);
                                    
                                    saCtx.fillStyle = '#374151';
                                    saCtx.font = '10px Arial';
                                    saCtx.fillText('‚Ä¢ NULL values are ignored', 290, 100);
                                    saCtx.fillText('‚Ä¢ AVG divides by non-NULL count', 290, 115);
                                    saCtx.fillText('‚Ä¢ Use COALESCE to treat NULL as 0', 290, 130);
                                    saCtx.fillText('‚Ä¢ Check with COUNT to verify', 290, 145);
                                    
                                    saCtx.font = '9px Courier';
                                    saCtx.fillText('AVG(COALESCE(value, 0)) = 150', 290, 170);
                                    saCtx.fillText('-- Includes NULL as 0: 600/4', 290, 185);
                                    
                                    // Visual representation
                                    saCtx.fillStyle = '#e5e7eb';
                                    saCtx.fillRect(50, 240, 500, 80);
                                    
                                    // Draw bars for values
                                    const values = [100, 200, 0, 300];
                                    const labels = ['100', '200', 'NULL', '300'];
                                    let x = 80;
                                    
                                    values.forEach((val, i) =>{
                                        if (i === 2) {
                                            // NULL bar (dashed)
                                            saCtx.strokeStyle = '#9ca3af';
                                            saCtx.setLineDash([5, 5]);
                                            saCtx.strokeRect(x, 310 - 50, 40, 50);
                                            saCtx.setLineDash([]);
                                        } else {
                                            // Regular bar
                                            const height = val / 3;
                                            saCtx.fillStyle = '#3b82f6';
                                            saCtx.fillRect(x, 310 - height, 40, height);
                                        }
                                        
                                        saCtx.fillStyle = '#374151';
                                        saCtx.font = '10px Arial';
                                        saCtx.fillText(labels[i], x + 10, 330);
                                        
                                        x += 120;
                                    });</script>
         <div class="best_practice">
          <h3>SUM and AVG Examples</h3>
          <pre><code class="language-sql">-- ========================================
-- SUM FUNCTION
-- ========================================

-- Basic SUM
SELECT 
    SUM(amount) AS total_sales,
    SUM(quantity) AS total_items_sold
FROM order_items;

-- SUM with conditions
SELECT 
    SUM(amount) AS total_revenue,
    SUM(CASE WHEN status = 'completed' THEN amount ELSE 0 END) AS completed_revenue,
    SUM(CASE WHEN status = 'refunded' THEN amount ELSE 0 END) AS refunded_amount
FROM orders;

-- SUM with GROUP BY
SELECT 
    c.category_name,
    SUM(oi.quantity) AS units_sold,
    SUM(oi.quantity * oi.unit_price) AS revenue,
    SUM(oi.quantity * (oi.unit_price - p.cost)) AS profit
FROM order_items oi
JOIN products p ON oi.product_id = p.product_id
JOIN categories c ON p.category_id = c.category_id
GROUP BY c.category_id
ORDER BY revenue DESC;

-- Running SUM (cumulative)
SELECT 
    order_date,
    amount,
    SUM(amount) OVER (ORDER BY order_date) AS running_total
FROM orders
WHERE customer_id = 123;

-- ========================================
-- AVG FUNCTION
-- ========================================

-- Basic AVG
SELECT 
    AVG(amount) AS avg_order_value,
    AVG(DISTINCT amount) AS avg_unique_amounts
FROM orders;

-- AVG with NULL handling
SELECT 
    AVG(rating) AS avg_rating_exclude_null,
    AVG(COALESCE(rating, 0)) AS avg_rating_null_as_zero,
    SUM(rating) / COUNT(*) AS manual_avg_with_nulls
FROM reviews;

-- Weighted average
SELECT 
    SUM(grade * credit_hours) / SUM(credit_hours) AS weighted_gpa
FROM courses
WHERE student_id = 123;

-- AVG with GROUP BY
SELECT 
    p.category_id,
    c.category_name,
    AVG(p.price) AS avg_price,
    ROUND(AVG(p.price), 2) AS avg_price_rounded,
    MIN(p.price) AS min_price,
    MAX(p.price) AS max_price,
    MAX(p.price) - MIN(p.price) AS price_range
FROM products p
JOIN categories c ON p.category_id = c.category_id
GROUP BY p.category_id
HAVING AVG(p.price) &gt; 50
ORDER BY avg_price DESC;

-- Moving average
SELECT 
    order_date,
    amount,
    AVG(amount) OVER (
        ORDER BY order_date 
        ROWS BETWEEN 6 PRECEDING AND CURRENT ROW
    ) AS moving_avg_7_days
FROM orders;

-- ========================================
-- COMBINED AGGREGATES
-- ========================================

-- Statistical summary
SELECT 
    COUNT(*) AS total_orders,
    SUM(amount) AS total_revenue,
    AVG(amount) AS mean_amount,
    MIN(amount) AS min_amount,
    MAX(amount) AS max_amount,
    MAX(amount) - MIN(amount) AS range_amount,
    STD(amount) AS std_deviation,
    VARIANCE(amount) AS variance
FROM orders
WHERE order_date &gt;= DATE_SUB(CURDATE(), INTERVAL 30 DAY);</code></pre>
         </div>
        </section>
        <section>
         <h2>MIN and MAX Functions</h2>
         <div class="real_world_example">
          <h3>MIN and MAX Applications</h3>
          <pre><code class="language-sql">-- ========================================
-- MIN FUNCTION
-- ========================================

-- Basic MIN
SELECT 
    MIN(price) AS lowest_price,
    MIN(created_at) AS first_order_date,
    MIN(product_name) AS first_alphabetically
FROM products;

-- MIN with GROUP BY
SELECT 
    category_id,
    MIN(price) AS starting_price,
    MIN(created_at) AS oldest_product
FROM products
GROUP BY category_id;

-- Find products with minimum price per category
SELECT 
    p1.*
FROM products p1
INNER JOIN (
    SELECT category_id, MIN(price) AS min_price
    FROM products
    GROUP BY category_id
) p2 ON p1.category_id = p2.category_id 
    AND p1.price = p2.min_price;

-- ========================================
-- MAX FUNCTION
-- ========================================

-- Basic MAX
SELECT 
    MAX(amount) AS highest_sale,
    MAX(order_date) AS most_recent_order
FROM orders;

-- MAX with conditions
SELECT 
    MAX(CASE WHEN status = 'completed' THEN amount END) AS max_completed,
    MAX(CASE WHEN status = 'pending' THEN amount END) AS max_pending
FROM orders;

-- Find latest record per group
SELECT 
    c.customer_id,
    c.customer_name,
    MAX(o.order_date) AS last_order_date,
    DATEDIFF(CURDATE(), MAX(o.order_date)) AS days_since_last_order
FROM customers c
LEFT JOIN orders o ON c.customer_id = o.customer_id
GROUP BY c.customer_id;

-- ========================================
-- MIN/MAX WITH STRINGS AND DATES
-- ========================================

-- String comparisons
SELECT 
    MIN(customer_name) AS first_customer,
    MAX(customer_name) AS last_customer,
    MIN(email) AS first_email,
    MAX(email) AS last_email
FROM customers;

-- Date ranges
SELECT 
    product_id,
    product_name,
    MIN(review_date) AS first_review,
    MAX(review_date) AS latest_review,
    DATEDIFF(MAX(review_date), MIN(review_date)) AS review_span_days
FROM reviews r
JOIN products p ON r.product_id = p.product_id
GROUP BY p.product_id
HAVING COUNT(*) &gt; 5;

-- ========================================
-- PRACTICAL MIN/MAX PATTERNS
-- ========================================

-- Find price range per brand
SELECT 
    brand,
    COUNT(*) AS product_count,
    MIN(price) AS min_price,
    MAX(price) AS max_price,
    CONCAT('$', MIN(price), ' - $', MAX(price)) AS price_range
FROM products
WHERE is_active = TRUE
GROUP BY brand
ORDER BY brand;

-- Identify outliers
SELECT 
    product_id,
    product_name,
    price,
    CASE 
        WHEN price = (SELECT MIN(price) FROM products) THEN 'Lowest'
        WHEN price = (SELECT MAX(price) FROM products) THEN 'Highest'
        ELSE 'Normal'
    END AS price_position
FROM products
WHERE price IN (
    (SELECT MIN(price) FROM products),
    (SELECT MAX(price) FROM products)
);

-- Session tracking
SELECT 
    user_id,
    MIN(login_time) AS session_start,
    MAX(activity_time) AS session_end,
    TIMEDIFF(MAX(activity_time), MIN(login_time)) AS session_duration
FROM user_activity
WHERE DATE(login_time) = CURDATE()
GROUP BY user_id, session_id;</code></pre>
         </div>
        </section>
        <section>
         <h2>Advanced Aggregate Patterns</h2>
         <div class="alert alert-success">
          <div class="alert-icon">üöÄ</div>
          <div class="alert-content">
           <div class="alert-title">Pro Aggregate Techniques</div>
           <div class="alert-message">Master these advanced patterns for complex data analysis!</div>
          </div>
         </div>
         <div class="homework">
          <h3>Advanced Aggregation Techniques</h3>
          <pre><code class="language-sql">-- ========================================
-- GROUP_CONCAT - Aggregate strings
-- ========================================

-- Concatenate values into a single string
SELECT 
    customer_id,
    GROUP_CONCAT(product_name) AS products_ordered,
    GROUP_CONCAT(product_name SEPARATOR ', ') AS products_comma_separated,
    GROUP_CONCAT(DISTINCT category ORDER BY category) AS categories
FROM orders o
JOIN order_items oi ON o.order_id = oi.order_id
JOIN products p ON oi.product_id = p.product_id
GROUP BY customer_id;

-- Custom formatting with GROUP_CONCAT
SELECT 
    category_id,
    GROUP_CONCAT(
        CONCAT(product_name, ' ($', price, ')')
        ORDER BY price DESC
        SEPARATOR ' | '
    ) AS product_list
FROM products
GROUP BY category_id;

-- ========================================
-- STATISTICAL AGGREGATES
-- ========================================

SELECT 
    product_id,
    COUNT(rating) AS review_count,
    AVG(rating) AS mean_rating,
    STD(rating) AS std_dev,
    VARIANCE(rating) AS variance,
    -- Median approximation
    SUBSTRING_INDEX(
        SUBSTRING_INDEX(
            GROUP_CONCAT(rating ORDER BY rating SEPARATOR ','),
            ',',
            CEIL(COUNT(*) / 2)
        ),
        ',',
        -1
    ) AS median_rating
FROM reviews
GROUP BY product_id
HAVING review_count &gt;= 10;

-- ========================================
-- CONDITIONAL AGGREGATES (Pivoting)
-- ========================================

-- Pivot table with conditional aggregates
SELECT 
    DATE(order_date) AS order_date,
    -- Revenue by status
    SUM(CASE WHEN status = 'completed' THEN amount ELSE 0 END) AS completed_revenue,
    SUM(CASE WHEN status = 'pending' THEN amount ELSE 0 END) AS pending_revenue,
    SUM(CASE WHEN status = 'cancelled' THEN amount ELSE 0 END) AS cancelled_revenue,
    -- Count by payment method
    COUNT(CASE WHEN payment_method = 'credit_card' THEN 1 END) AS credit_card_orders,
    COUNT(CASE WHEN payment_method = 'paypal' THEN 1 END) AS paypal_orders,
    COUNT(CASE WHEN payment_method = 'cash' THEN 1 END) AS cash_orders,
    -- Overall metrics
    COUNT(*) AS total_orders,
    SUM(amount) AS total_revenue
FROM orders
WHERE order_date &gt;= DATE_SUB(CURDATE(), INTERVAL 7 DAY)
GROUP BY DATE(order_date)
ORDER BY order_date DESC;

-- ========================================
-- ROLLUP and CUBE (Subtotals)
-- ========================================

-- ROLLUP for hierarchical subtotals
SELECT 
    COALESCE(category, 'TOTAL') AS category,
    COALESCE(brand, 'Subtotal') AS brand,
    COUNT(*) AS product_count,
    AVG(price) AS avg_price,
    SUM(stock_quantity * price) AS inventory_value
FROM products
GROUP BY category, brand WITH ROLLUP;

-- ========================================
-- Window Functions with Aggregates
-- ========================================

-- Ranking with aggregates
SELECT 
    customer_id,
    total_spent,
    RANK() OVER (ORDER BY total_spent DESC) AS spending_rank,
    NTILE(4) OVER (ORDER BY total_spent DESC) AS quartile,
    total_spent / SUM(total_spent) OVER () * 100 AS percentage_of_total
FROM (
    SELECT 
        customer_id,
        SUM(amount) AS total_spent
    FROM orders
    WHERE status = 'completed'
    GROUP BY customer_id
) customer_totals;

-- ========================================
-- AGGREGATE PERFORMANCE OPTIMIZATION
-- ========================================

-- Use indexes on GROUP BY columns
CREATE INDEX idx_order_customer_date ON orders(customer_id, order_date);

-- Pre-aggregate for performance
CREATE TABLE daily_sales_summary AS
SELECT 
    DATE(order_date) AS sale_date,
    COUNT(*) AS order_count,
    SUM(amount) AS total_revenue,
    AVG(amount) AS avg_order_value
FROM orders
GROUP BY DATE(order_date);

-- Use materialized view (if supported)
CREATE VIEW monthly_product_stats AS
SELECT 
    product_id,
    YEAR(order_date) AS year,
    MONTH(order_date) AS month,
    COUNT(DISTINCT o.order_id) AS order_count,
    SUM(oi.quantity) AS units_sold,
    SUM(oi.quantity * oi.unit_price) AS revenue
FROM orders o
JOIN order_items oi ON o.order_id = oi.order_id
GROUP BY product_id, YEAR(order_date), MONTH(order_date);</code></pre>
         </div>
        </section>
        <!-- Practice Exercise -->
        <section>
         <h2>Practice Exercise</h2>
         <div class="alert alert-success">
          <div class="alert-icon">üíª</div>
          <div class="alert-content">
           <div class="alert-title">Aggregate Function Challenges</div>
           <div class="alert-message">Solve these real-world aggregation problems:<ol>
             <li>Calculate the average order value per customer segment</li>
             <li>Find the top 3 selling products in each category</li>
             <li>Calculate month-over-month growth percentage</li>
             <li>Find customers whose average order exceeds overall average</li>
             <li>Create a summary report with multiple aggregates</li>
             <li>Calculate running totals and moving averages</li>
             <li>Find the median order value per category</li>
             <li>Build a customer lifetime value calculation</li>
            </ol>
           </div>
          </div>
         </div>
         <details>
          <summary>üí° Click for Solutions</summary>
          <pre><code class="language-sql">-- 1. Average order value per customer segment
SELECT 
    CASE 
        WHEN total_orders &lt; 3 THEN 'New'
        WHEN total_orders &lt; 10 THEN 'Regular'
        ELSE 'VIP'
    END AS customer_segment,
    COUNT(*) AS customer_count,
    AVG(avg_order_value) AS segment_avg_order_value,
    MIN(avg_order_value) AS min_avg_order,
    MAX(avg_order_value) AS max_avg_order
FROM (
    SELECT 
        customer_id,
        COUNT(*) AS total_orders,
        AVG(amount) AS avg_order_value
    FROM orders
    WHERE status = 'completed'
    GROUP BY customer_id
) customer_stats
GROUP BY customer_segment
ORDER BY segment_avg_order_value DESC;

-- 2. Top 3 products per category
WITH product_rankings AS (
    SELECT 
        p.category_id,
        c.category_name,
        p.product_id,
        p.product_name,
        SUM(oi.quantity) AS units_sold,
        SUM(oi.quantity * oi.unit_price) AS revenue,
        ROW_NUMBER() OVER (
            PARTITION BY p.category_id 
            ORDER BY SUM(oi.quantity * oi.unit_price) DESC
        ) AS rank_in_category
    FROM products p
    JOIN categories c ON p.category_id = c.category_id
    JOIN order_items oi ON p.product_id = oi.product_id
    JOIN orders o ON oi.order_id = o.order_id
    WHERE o.status = 'completed'
    GROUP BY p.category_id, p.product_id
)
SELECT *
FROM product_rankings
WHERE rank_in_category &lt;= 3
ORDER BY category_id, rank_in_category;

-- 3. Month-over-month growth
WITH monthly_sales AS (
    SELECT 
        DATE_FORMAT(order_date, '%Y-%m') AS month,
        SUM(amount) AS revenue
    FROM orders
    WHERE status = 'completed'
    GROUP BY DATE_FORMAT(order_date, '%Y-%m')
)
SELECT 
    month,
    revenue,
    LAG(revenue) OVER (ORDER BY month) AS prev_month_revenue,
    ROUND(
        (revenue - LAG(revenue) OVER (ORDER BY month)) / 
        LAG(revenue) OVER (ORDER BY month) * 100, 
        2
    ) AS growth_percentage
FROM monthly_sales
ORDER BY month;

-- 4. Customers above average
WITH overall_avg AS (
    SELECT AVG(amount) AS avg_order_value
    FROM orders
    WHERE status = 'completed'
)
SELECT 
    c.customer_id,
    c.customer_name,
    COUNT(o.order_id) AS order_count,
    AVG(o.amount) AS customer_avg_order,
    (SELECT avg_order_value FROM overall_avg) AS overall_average,
    AVG(o.amount) - (SELECT avg_order_value FROM overall_avg) AS difference
FROM customers c
JOIN orders o ON c.customer_id = o.customer_id
WHERE o.status = 'completed'
GROUP BY c.customer_id
HAVING AVG(o.amount) &gt; (SELECT avg_order_value FROM overall_avg)
ORDER BY customer_avg_order DESC;

-- 5. Comprehensive summary report
SELECT 
    'Overall Statistics' AS metric,
    COUNT(DISTINCT customer_id) AS unique_customers,
    COUNT(*) AS total_orders,
    SUM(amount) AS total_revenue,
    AVG(amount) AS avg_order_value,
    MIN(amount) AS min_order,
    MAX(amount) AS max_order,
    STD(amount) AS std_deviation
FROM orders
WHERE order_date &gt;= DATE_SUB(CURDATE(), INTERVAL 30 DAY)

UNION ALL

SELECT 
    CONCAT('Status: ', status) AS metric,
    COUNT(DISTINCT customer_id),
    COUNT(*),
    SUM(amount),
    AVG(amount),
    MIN(amount),
    MAX(amount),
    STD(amount)
FROM orders
WHERE order_date &gt;= DATE_SUB(CURDATE(), INTERVAL 30 DAY)
GROUP BY status;

-- 6. Running totals and moving averages
SELECT 
    order_date,
    amount,
    SUM(amount) OVER (ORDER BY order_date) AS running_total,
    AVG(amount) OVER (
        ORDER BY order_date 
        ROWS BETWEEN 6 PRECEDING AND CURRENT ROW
    ) AS moving_avg_7_days,
    COUNT(*) OVER (
        ORDER BY order_date 
        ROWS BETWEEN 6 PRECEDING AND CURRENT ROW
    ) AS orders_in_window
FROM orders
WHERE customer_id = 123
ORDER BY order_date;

-- 7. Median calculation
SELECT 
    category_id,
    AVG(price) AS mean_price,
    (
        SELECT AVG(price)
        FROM (
            SELECT price
            FROM products p2
            WHERE p2.category_id = p1.category_id
            ORDER BY price
            LIMIT 2 - (SELECT COUNT(*) FROM products p3 WHERE p3.category_id = p1.category_id) % 2
            OFFSET (SELECT (COUNT(*) - 1) / 2 FROM products p4 WHERE p4.category_id = p1.category_id)
        ) AS median_calc
    ) AS median_price
FROM products p1
GROUP BY category_id;

-- 8. Customer lifetime value
SELECT 
    c.customer_id,
    c.customer_name,
    DATE(c.created_at) AS acquisition_date,
    COUNT(DISTINCT o.order_id) AS total_orders,
    SUM(o.amount) AS lifetime_revenue,
    AVG(o.amount) AS avg_order_value,
    DATEDIFF(MAX(o.order_date), MIN(o.order_date)) AS customer_lifespan_days,
    SUM(o.amount) / GREATEST(DATEDIFF(CURDATE(), c.created_at), 1) AS daily_value,
    SUM(o.amount) / GREATEST(DATEDIFF(CURDATE(), c.created_at) / 30, 1) AS monthly_value
FROM customers c
LEFT JOIN orders o ON c.customer_id = o.customer_id 
    AND o.status = 'completed'
GROUP BY c.customer_id
ORDER BY lifetime_revenue DESC;</code></pre>
         </details>
        </section>
        <!-- Resources -->
        <section class="resources">
         <h2>Additional Resources</h2>
         <ul>
          <li>
           <a href="https://dev.mysql.com/doc/refman/8.0/en/aggregate-functions.html" target="_blank">MySQL Aggregate Functions Reference</a>
          </li>
          <li>
           <a href="https://www.mysqltutorial.org/mysql-aggregate-functions.aspx" target="_blank">MySQL Aggregate Functions Tutorial</a>
          </li>
          <li>
           <a href="https://dev.mysql.com/doc/refman/8.0/en/group-by-modifiers.html" target="_blank">GROUP BY Modifiers (ROLLUP, CUBE)</a>
          </li>
          <li>
           <a href="https://modern-sql.com/feature/grouping-sets" target="_blank">Advanced Grouping Sets</a>
          </li>
         </ul>
        </section>
       </div>
       <!-- Lesson Navigation -->
       <div class="lesson-navigation">
        <a class="lesson-nav-button prev" href="/03module/sql_joins.html">
         <svg fill="currentColor" height="20" viewbox="0 0 20 20" width="20">
          <path d="M12.707 5.293a1 1 0 010 1.414L9.414 10l3.293 3.293a1 1 0 01-1.414 1.414l-4-4a1 1 0 010-1.414l4-4a1 1 0 011.414 0z">
          </path>
         </svg>
         <span>
          <small>Previous</small>
          <br/>SQL JOINs</span>
        </a>
        <button class="complete-lesson-btn">Mark as Complete</button>
        <a class="lesson-nav-button next" href="/03module/group_by_having.html">
         <span>
          <small>Next</small>
          <br/>GROUP BY &amp; HAVING</span>
         <svg fill="currentColor" height="20" viewbox="0 0 20 20" width="20">
          <path d="M7.293 14.707a1 1 0 010-1.414L10.586 10 7.293 6.707a1 1 0 011.414-1.414l4 4a1 1 0 010 1.414l-4 4a1 1 0 01-1.414 0z">
          </path>
         </svg>
        </a>
       </div>
      </article>
     </div>
    </div>
   </main>
   <!-- Footer -->
   <footer class="site-footer" role="contentinfo">
    <div class="footer-container">
     <div class="footer-content">
      <div class="footer-section footer-about">
       <h3>PHP WordPress Development</h3>
       <p>Complete Web Development Course</p>
      </div>
      <div class="footer-section">
       <h4>Quick Links</h4>
       <ul class="footer-links">
        <li>
         <a href="/">Home</a>
        </li>
        <li>
         <a class="active" href="/module3.html">Module 3</a>
        </li>
        <li>
         <a href="/resources.html">Resources</a>
        </li>
       </ul>
      </div>
      <div class="footer-section">
       <h4>Support</h4>
       <ul class="footer-links">
        <li>
         <a href="/help.html">Help Center</a>
        </li>
        <li>
         <a href="/faq.html">FAQ</a>
        </li>
        <li>
         <a href="/contact.html">Contact</a>
        </li>
       </ul>
      </div>
     </div>
     <div class="footer-bottom">
      <div class="footer-bottom-content">
       <p class="copyright">¬© 2025 PHP WordPress Development Course</p>
       <nav class="footer-bottom-links">
        <a href="/privacy.html">Privacy</a>
        <span class="separator">|</span>
        <a href="/terms.html">Terms</a>
       </nav>
      </div>
     </div>
    </div>
   </footer>
  </div>
  <!-- Back to Top -->
  <button aria-label="Back to top" class="back-to-top" id="back-to-top">
   <svg fill="none" height="24" stroke="currentColor" stroke-width="2" viewbox="0 0 24 24" width="24">
    <path d="M12 19V5M12 5l-7 7M12 5l7 7">
    </path>
   </svg>
  </button>
  <!-- JavaScript -->
  <script src="/assets/js/navigation.js">
  </script>
  <script src="/assets/js/site-config.js">
  </script>
  <script src="/assets/js/sidebar-toggle.js">
  </script>
  <!-- Universal Mermaid Fix (Enhanced) -->
  <!-- Universal Mermaid Fix -->
  <script src="/assets/js/mermaid-universal-fix.js">
  </script>
 </body>
</html>
