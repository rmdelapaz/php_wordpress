<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    
    <!-- SEO Meta Tags -->
    <title>Advanced WHERE Filtering - MySQL Mastery - PHP WordPress Course</title>
    <meta name="description" content="Master advanced filtering techniques with WHERE clauses, complex conditions, and performance optimization">
    <meta name="keywords" content="PHP, WordPress, MySQL, WHERE clause, filtering, conditions, optimization">
    <meta name="author" content="PHP WordPress Course">
    
    <!-- Favicon -->
    <link rel="icon" type="image/png" href="/favicon.png">
    <link rel="apple-touch-icon" href="/favicon.png">
    
    <!-- CSS -->
    <link rel="stylesheet" href="/assets/css/main.css">
    
    <!-- Mermaid for diagrams -->
    <script type="module">
        import mermaid from 'https://cdn.jsdelivr.net/npm/mermaid@10/dist/mermaid.esm.min.mjs';
        mermaid.initialize({ startOnLoad: true });
    </script>
</head>
<body>
    <!-- Skip to main content -->
    <a href="#main-content" class="sr-only">Skip to main content</a>
    
    <div class="page-wrapper">
        <!-- Header -->
        <header class="site-header" role="banner">
            <div class="header-container">
                <div class="site-branding">
                    <a href="/" class="site-logo">
                        <h1 class="site-title">PHP WordPress Development</h1>
                    </a>
                </div>
                
                <nav class="main-navigation" role="navigation" aria-label="Main navigation">
                    <button class="mobile-menu-btn" aria-label="Toggle navigation" aria-expanded="false">
                        <span></span>
                        <span></span>
                        <span></span>
                    </button>
                    
                    <div class="nav-menu">
                        <ul class="nav-list">
                            <li class="nav-item"><a href="/" class="nav-link">Home</a></li>
                            <li class="nav-item dropdown">
                                <button class="nav-link dropdown-toggle active" aria-haspopup="true">Modules</button>
                                <div class="dropdown-menu">
                                    <a href="/module1.html" class="dropdown-item">Module 1: Web Fundamentals</a>
                                    <a href="/module2.html" class="dropdown-item">Module 2: PHP Fundamentals</a>
                                    <a href="/module3.html" class="dropdown-item active">Module 3: MySQL Database</a>
                                    <a href="/module4.html" class="dropdown-item">Module 4: WordPress & Docker</a>
                                    <a href="/module5.html" class="dropdown-item">Module 5: Theme Development</a>
                                    <a href="/module6.html" class="dropdown-item">Module 6: Plugin Development</a>
                                    <a href="/module7.html" class="dropdown-item">Module 7: Advanced WordPress</a>
                                    <a href="/module8.html" class="dropdown-item">Module 8: Deployment</a>
                                    <a href="/module9.html" class="dropdown-item">Module 9: Final Project</a>
                                </div>
                            </li>
                            <li class="nav-item"><a href="/resources.html" class="nav-link">Resources</a></li>
                            <li class="nav-item"><a href="/about.html" class="nav-link">About</a></li>
                        </ul>
                    </div>
                </nav>
                
                <div class="search-container">
                    <div class="search-input-wrapper">
                        <svg class="search-icon" width="20" height="20" viewBox="0 0 20 20" fill="currentColor">
                            <path fill-rule="evenodd" d="M8 4a4 4 0 100 8 4 4 0 000-8zM2 8a6 6 0 1110.89 3.476l4.817 4.817a1 1 0 01-1.414 1.414l-4.816-4.816A6 6 0 012 8z" clip-rule="evenodd" />
                        </svg>
                        <input type="search" class="search-input" placeholder="Search lessons..." aria-label="Search">
                    </div>
                    <div class="search-results"></div>
                </div>
            </div>
        </header>
        
        <!-- Progress Bar -->
        <div class="progress-container">
            <div class="progress-header">
                <h2 class="progress-title">Course Progress</h2>
                <span class="progress-text">Loading...</span>
            </div>
            <div class="progress-bar">
                <div class="progress-bar-fill">
                    <span class="progress-bar-text"></span>
                </div>
            </div>
        </div>
        
        <!-- Breadcrumb -->
        <nav class="breadcrumb container" aria-label="Breadcrumb">
            <ol class="breadcrumb-list">
                <li class="breadcrumb-item">
                    <a href="/">Home</a>
                    <span class="breadcrumb-separator">/</span>
                </li>
                <li class="breadcrumb-item">
                    <a href="/module3.html">Module 3</a>
                    <span class="breadcrumb-separator">/</span>
                </li>
                <li class="breadcrumb-item">
                    <span aria-current="page">Advanced WHERE Filtering</span>
                </li>
            </ol>
        </nav>
        
        <!-- Main Content -->
        <main id="main-content" class="main-content" role="main">
            <div class="container">
                <div class="content-with-sidebar">
                    <!-- Sidebar -->
                    <aside class="sidebar">
                        <div class="sidebar-nav">
                            <h3 class="sidebar-title">Module 3: Session 4</h3>
                            <div class="sidebar-section">
                                <h4 class="sidebar-section-title">Data Queries</h4>
                                <a href="/module3.html" class="sidebar-link">Module Overview</a>
                                <a href="/03module/select_queries.html" class="sidebar-link">SELECT Queries</a>
                                <a href="/03module/where_filtering.html" class="sidebar-link active">Advanced WHERE Filtering</a>
                                <a href="/03module/joins_relationships.html" class="sidebar-link">JOINs & Relationships</a>
                                <a href="/03module/aggregate_functions.html" class="sidebar-link">Aggregate Functions</a>
                                <a href="/03module/subqueries.html" class="sidebar-link">Subqueries</a>
                                <a href="/03module/indexes_performance.html" class="sidebar-link">Indexes & Performance</a>
                                <a href="/03module/homework_query_practice.html" class="sidebar-link">Homework</a>
                            </div>
                        </div>
                    </aside>
                    
                    <!-- Main Lesson Content -->
                    <article class="lesson-content">
                        <header class="lesson-header">
                            <h1>Advanced WHERE Clause Filtering</h1>
                            <div class="lesson-meta">
                                <div class="lesson-meta-item">
                                    <svg width="20" height="20" fill="currentColor">
                                        <path d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"/>
                                    </svg>
                                    <span>Duration: 80 minutes</span>
                                </div>
                                <div class="lesson-meta-item">
                                    <svg width="20" height="20" fill="currentColor">
                                        <path d="M12 14l9-5-9-5-9 5 9 5z"/>
                                    </svg>
                                    <span>Module 3: Advanced Filtering</span>
                                </div>
                            </div>
                        </header>

                        <!-- Learning Objectives -->
                        <div class="lesson-objectives">
                            <h2>Learning Objectives</h2>
                            <ul>
                                <li>Master complex conditional logic with WHERE</li>
                                <li>Optimize WHERE clauses for performance</li>
                                <li>Handle edge cases and NULL values properly</li>
                                <li>Use advanced pattern matching and regular expressions</li>
                                <li>Implement dynamic filtering strategies</li>
                                <li>Understand index usage in WHERE clauses</li>
                                <li>Apply real-world filtering patterns</li>
                            </ul>
                        </div>
                        
                        <!-- Lesson Body -->
                        <div class="lesson-body">
                            <section>
                                <h2>WHERE Clause Evaluation Order</h2>
                                <p class="lead">Understanding how MySQL evaluates WHERE conditions is crucial for writing efficient queries! ‚ö°</p>
                                
                                <canvas id="evaluationCanvas" width="600" height="400"></canvas>
                                <script>
                                    const ctx = document.getElementById('evaluationCanvas').getContext('2d');
                                    
                                    // Title
                                    ctx.font = 'bold 18px Arial';
                                    ctx.fillStyle = '#1f2937';
                                    ctx.fillText('WHERE Clause Evaluation Process', 160, 30);
                                    
                                    // Draw flow
                                    const steps = [
                                        { x: 50, y: 70, w: 500, h: 50, color: '#dbeafe', text: '1. MySQL retrieves rows from table(s)' },
                                        { x: 50, y: 130, w: 500, h: 50, color: '#dcfce7', text: '2. Applies WHERE conditions row by row' },
                                        { x: 50, y: 190, w: 500, h: 50, color: '#fef3c7', text: '3. Short-circuit evaluation (AND stops on false, OR stops on true)' },
                                        { x: 50, y: 250, w: 500, h: 50, color: '#fee2e2', text: '4. Index usage determined by optimizer' },
                                        { x: 50, y: 310, w: 500, h: 50, color: '#e9d5ff', text: '5. Result set created from matching rows' }
                                    ];
                                    
                                    steps.forEach((step, i) => {
                                        ctx.fillStyle = step.color;
                                        ctx.fillRect(step.x, step.y, step.w, step.h);
                                        ctx.strokeStyle = '#6b7280';
                                        ctx.strokeRect(step.x, step.y, step.w, step.h);
                                        
                                        ctx.fillStyle = '#1f2937';
                                        ctx.font = 'bold 12px Arial';
                                        ctx.fillText(step.text, step.x + 10, step.y + 30);
                                        
                                        // Arrow
                                        if (i < steps.length - 1) {
                                            ctx.strokeStyle = '#6b7280';
                                            ctx.beginPath();
                                            ctx.moveTo(300, step.y + step.h);
                                            ctx.lineTo(300, steps[i+1].y);
                                            ctx.stroke();
                                        }
                                    });
                                </script>
                                
                                <div class="alert alert-info">
                                    <div class="alert-icon">üí°</div>
                                    <div class="alert-content">
                                        <div class="alert-title">Short-Circuit Evaluation</div>
                                        <div class="alert-message">
                                            MySQL uses short-circuit evaluation:
                                            <ul>
                                                <li>For AND: If first condition is FALSE, second isn't evaluated</li>
                                                <li>For OR: If first condition is TRUE, second isn't evaluated</li>
                                                <li>Place most selective conditions first for better performance</li>
                                            </ul>
                                        </div>
                                    </div>
                                </div>
                            </section>

                            <section>
                                <h2>Complex Conditional Logic</h2>
                                
                                <div class="mermaid">
                                    graph TB
                                        WHERE[WHERE Clause] --> AND[AND Logic]
                                        WHERE --> OR[OR Logic]
                                        WHERE --> NOT[NOT Logic]
                                        WHERE --> XOR[XOR Logic]
                                        AND --> NESTED1[Nested Conditions]
                                        OR --> NESTED2[Nested Conditions]
                                        NESTED1 --> PARENS[Use Parentheses!]
                                        NESTED2 --> PARENS
                                        
                                        style WHERE fill:#dcfce7
                                        style AND fill:#dbeafe
                                        style OR fill:#fef3c7
                                        style NOT fill:#fee2e2
                                        style XOR fill:#e9d5ff
                                        style PARENS fill:#fce7f3,stroke:#ec4899,stroke-width:3px
                                </div>
                                
                                <div class="real_world_example">
                                    <h3>Advanced Conditional Logic Examples</h3>
                                    
                                    <pre><code class="language-sql">-- ========================================
-- COMPLEX AND/OR COMBINATIONS
-- ========================================

-- Wrong: Without parentheses (confusing precedence)
SELECT * FROM products 
WHERE category = 'Electronics' OR category = 'Computers' 
  AND price < 500;  -- AND has higher precedence!

-- Correct: With parentheses for clarity
SELECT * FROM products 
WHERE (category = 'Electronics' OR category = 'Computers')
  AND price < 500;

-- Multiple condition groups
SELECT * FROM orders 
WHERE 
    (status = 'pending' AND priority = 'high')
    OR (status = 'processing' AND created_at < DATE_SUB(NOW(), INTERVAL 2 DAY))
    OR (customer_type = 'VIP' AND total_amount > 1000);

-- ========================================
-- XOR (Exclusive OR) - One or the other, not both
-- ========================================

-- Find products that are either on sale OR featured, but not both
SELECT * FROM products 
WHERE is_on_sale XOR is_featured;

-- Manual XOR implementation
SELECT * FROM products 
WHERE (is_on_sale = TRUE AND is_featured = FALSE)
   OR (is_on_sale = FALSE AND is_featured = TRUE);

-- ========================================
-- NESTED CONDITIONS WITH SUBQUERIES
-- ========================================

SELECT * FROM customers 
WHERE 
    customer_id IN (
        SELECT customer_id FROM orders 
        WHERE total_amount > 500
    )
    AND NOT EXISTS (
        SELECT 1 FROM complaints 
        WHERE complaints.customer_id = customers.customer_id
    )
    AND (
        loyalty_points > 1000 
        OR registration_date < DATE_SUB(NOW(), INTERVAL 2 YEAR)
    );

-- ========================================
-- DYNAMIC CONDITION BUILDING
-- ========================================

-- Simulating optional filters (useful for application logic)
SELECT * FROM products 
WHERE 1=1  -- Always true, allows easy AND additions
    AND (@category IS NULL OR category = @category)
    AND (@min_price IS NULL OR price >= @min_price)
    AND (@max_price IS NULL OR price <= @max_price)
    AND (@search IS NULL OR name LIKE CONCAT('%', @search, '%'));

-- Using COALESCE for optional parameters
SELECT * FROM products 
WHERE category = COALESCE(@category, category)
  AND price >= COALESCE(@min_price, 0)
  AND price <= COALESCE(@max_price, 999999);

-- ========================================
-- COMPLEX DATE FILTERING
-- ========================================

-- Business hours filter (weekdays 9-5)
SELECT * FROM orders 
WHERE 
    DAYOFWEEK(order_date) BETWEEN 2 AND 6  -- Monday to Friday
    AND HOUR(order_time) BETWEEN 9 AND 17;

-- Seasonal filtering
SELECT * FROM sales 
WHERE 
    (MONTH(sale_date) IN (12, 1, 2) AND product_category = 'Winter Clothing')
    OR (MONTH(sale_date) IN (6, 7, 8) AND product_category = 'Summer Clothing');

-- Relative date ranges with complex logic
SELECT * FROM events 
WHERE 
    (
        -- Future events in next 30 days
        event_date BETWEEN CURDATE() AND DATE_ADD(CURDATE(), INTERVAL 30 DAY)
    )
    OR 
    (
        -- Recurring annual events
        MONTH(event_date) = MONTH(CURDATE()) 
        AND DAY(event_date) BETWEEN DAY(CURDATE()) AND DAY(DATE_ADD(CURDATE(), INTERVAL 7 DAY))
    );

-- ========================================
-- BITWISE OPERATIONS FOR FLAGS
-- ========================================

-- Permission flags using bitwise operations
-- 1 = Read, 2 = Write, 4 = Delete, 8 = Admin
SELECT * FROM users 
WHERE permissions & 1 = 1;  -- Has read permission

SELECT * FROM users 
WHERE permissions & 6 = 6;  -- Has both write AND delete (2 + 4)

SELECT * FROM users 
WHERE permissions & 8 = 8;  -- Is admin

-- Multiple permission check
SELECT 
    username,
    CASE 
        WHEN permissions & 8 = 8 THEN 'Admin'
        WHEN permissions & 6 = 6 THEN 'Editor'
        WHEN permissions & 1 = 1 THEN 'Viewer'
        ELSE 'No Access'
    END AS access_level
FROM users;</code></pre>
                                </div>
                            </section>

                            <section>
                                <h2>Advanced Pattern Matching</h2>
                                
                                <canvas id="patternCanvas" width="600" height="350"></canvas>
                                <script>
                                    const pCtx = document.getElementById('patternCanvas').getContext('2d');
                                    
                                    // Title
                                    pCtx.font = 'bold 16px Arial';
                                    pCtx.fillStyle = '#1f2937';
                                    pCtx.fillText('Pattern Matching Techniques', 190, 30);
                                    
                                    // LIKE patterns
                                    pCtx.fillStyle = '#dbeafe';
                                    pCtx.fillRect(50, 60, 270, 120);
                                    pCtx.strokeStyle = '#2563eb';
                                    pCtx.lineWidth = 2;
                                    pCtx.strokeRect(50, 60, 270, 120);
                                    pCtx.fillStyle = '#1e40af';
                                    pCtx.font = 'bold 12px Arial';
                                    pCtx.fillText('LIKE Patterns', 150, 80);
                                    
                                    pCtx.fillStyle = '#374151';
                                    pCtx.font = '10px Courier';
                                    pCtx.fillText('john%         Starts with john', 60, 100);
                                    pCtx.fillText('%smith        Ends with smith', 60, 115);
                                    pCtx.fillText('%admin%       Contains admin', 60, 130);
                                    pCtx.fillText('_____         Exactly 5 chars', 60, 145);
                                    pCtx.fillText('test\\_data   Contains underscore', 60, 160);
                                    
                                    // REGEXP patterns
                                    pCtx.fillStyle = '#dcfce7';
                                    pCtx.fillRect(330, 60, 250, 120);
                                    pCtx.strokeStyle = '#16a34a';
                                    pCtx.strokeRect(330, 60, 250, 120);
                                    pCtx.fillStyle = '#166534';
                                    pCtx.font = 'bold 12px Arial';
                                    pCtx.fillText('REGEXP Patterns', 420, 80);
                                    
                                    pCtx.fillStyle = '#374151';
                                    pCtx.font = '10px Courier';
                                    pCtx.fillText('^[A-Z]        Starts uppercase', 340, 100);
                                    pCtx.fillText('[0-9]+$       Ends with digits', 340, 115);
                                    pCtx.fillText('^[^@]+@       Email pattern', 340, 130);
                                    pCtx.fillText('(red|blue)    Either red or blue', 340, 145);
                                    pCtx.fillText('[a-z]{3,5}    3-5 lowercase', 340, 160);
                                    
                                    // Advanced patterns
                                    pCtx.fillStyle = '#fef3c7';
                                    pCtx.fillRect(50, 200, 530, 130);
                                    pCtx.strokeStyle = '#ca8a04';
                                    pCtx.strokeRect(50, 200, 530, 130);
                                    pCtx.fillStyle = '#92400e';
                                    pCtx.font = 'bold 12px Arial';
                                    pCtx.fillText('Advanced Pattern Examples', 250, 220);
                                    
                                    pCtx.fillStyle = '#374151';
                                    pCtx.font = '10px Arial';
                                    pCtx.fillText('Phone: ^\\+?[1-9][0-9]{7,14}$', 60, 245);
                                    pCtx.fillText('Email: ^[A-Za-z0-9._%+-]+@[A-Za-z0-9.-]+\\.[A-Za-z]{2,}$', 60, 260);
                                    pCtx.fillText('URL: ^https?://[^\\s/$.?#].[^\\s]*$', 60, 275);
                                    pCtx.fillText('IP: ^([0-9]{1,3}\\.){3}[0-9]{1,3}$', 60, 290);
                                    pCtx.fillText('UUID: ^[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}$', 60, 305);
                                    pCtx.fillText('Credit Card: ^[0-9]{13,19}$', 60, 320);
                                </script>
                                
                                <div class="best_practice">
                                    <h3>Advanced Pattern Matching</h3>
                                    
                                    <pre><code class="language-sql">-- ========================================
-- ADVANCED LIKE PATTERNS
-- ========================================

-- Case-sensitive LIKE (using BINARY)
SELECT * FROM users 
WHERE BINARY username LIKE 'John%';  -- Only 'John', not 'john'

-- Multiple LIKE conditions
SELECT * FROM products 
WHERE name LIKE '%laptop%' 
   OR name LIKE '%notebook%'
   OR name LIKE '%computer%';

-- LIKE with ESCAPE for special characters
SELECT * FROM files 
WHERE filename LIKE '%\_%' ESCAPE '\\';  -- Files with underscore

-- Negated patterns
SELECT * FROM emails 
WHERE address NOT LIKE '%@gmail.com' 
  AND address NOT LIKE '%@yahoo.com'
  AND address NOT LIKE '%@hotmail.com';

-- ========================================
-- REGULAR EXPRESSIONS (REGEXP/RLIKE)
-- ========================================

-- Email validation
SELECT * FROM users 
WHERE email REGEXP '^[A-Za-z0-9][A-Za-z0-9._%+-]{0,63}@(?:[A-Za-z0-9](?:[A-Za-z0-9-]{0,61}[A-Za-z0-9])?\\.)+[A-Za-z]{2,}$';

-- Phone number formats (multiple patterns)
SELECT * FROM contacts 
WHERE phone REGEXP '^(\\+1|1)?[-. ]?\\(?[0-9]{3}\\)?[-. ]?[0-9]{3}[-. ]?[0-9]{4}$';

-- URL validation
SELECT * FROM links 
WHERE url REGEXP '^https?://[a-zA-Z0-9][a-zA-Z0-9-]{0,61}[a-zA-Z0-9]?\\.[a-zA-Z]{2,}(/.*)?$';

-- Credit card patterns
SELECT 
    card_number,
    CASE 
        WHEN card_number REGEXP '^4[0-9]{12}(?:[0-9]{3})?$' THEN 'Visa'
        WHEN card_number REGEXP '^5[1-5][0-9]{14}$' THEN 'MasterCard'
        WHEN card_number REGEXP '^3[47][0-9]{13}$' THEN 'American Express'
        WHEN card_number REGEXP '^6(?:011|5[0-9]{2})[0-9]{12}$' THEN 'Discover'
        ELSE 'Unknown'
    END AS card_type
FROM payment_methods;

-- Word boundaries
SELECT * FROM articles 
WHERE content REGEXP '[[:<:]]MySQL[[:>:]]';  -- Whole word 'MySQL'

-- Multiple word search
SELECT * FROM posts 
WHERE content REGEXP '(marketing|sales|revenue|growth)';

-- ========================================
-- SOUNDS LIKE (SOUNDEX)
-- ========================================

-- Find similar sounding names
SELECT * FROM customers 
WHERE SOUNDEX(last_name) = SOUNDEX('Smith');  -- Finds Smith, Smythe, etc.

-- Find potential duplicates
SELECT 
    c1.customer_id,
    c1.first_name,
    c1.last_name,
    c2.customer_id AS possible_duplicate_id,
    c2.first_name AS dup_first_name,
    c2.last_name AS dup_last_name
FROM customers c1
JOIN customers c2 ON 
    c1.customer_id < c2.customer_id
    AND SOUNDEX(c1.last_name) = SOUNDEX(c2.last_name)
    AND SOUNDEX(c1.first_name) = SOUNDEX(c2.first_name);

-- ========================================
-- FULL-TEXT SEARCH
-- ========================================

-- Create full-text index first
ALTER TABLE articles ADD FULLTEXT(title, content);

-- Natural language search
SELECT * FROM articles 
WHERE MATCH(title, content) AGAINST('MySQL database' IN NATURAL LANGUAGE MODE);

-- Boolean mode search
SELECT * FROM articles 
WHERE MATCH(title, content) AGAINST('+MySQL -Oracle' IN BOOLEAN MODE);
-- + means must have, - means must not have

-- With relevance scoring
SELECT 
    article_id,
    title,
    MATCH(title, content) AGAINST('web development PHP MySQL') AS relevance
FROM articles 
WHERE MATCH(title, content) AGAINST('web development PHP MySQL')
ORDER BY relevance DESC;

-- Query expansion (finds related terms)
SELECT * FROM articles 
WHERE MATCH(title, content) 
AGAINST('database' WITH QUERY EXPANSION);</code></pre>
                                </div>
                            </section>

                            <section>
                                <h2>NULL Handling Strategies</h2>
                                
                                <div class="alert alert-warning">
                                    <div class="alert-icon">‚ö†Ô∏è</div>
                                    <div class="alert-content">
                                        <div class="alert-title">NULL is Special</div>
                                        <div class="alert-message">
                                            NULL represents unknown or missing data. Key points:
                                            <ul>
                                                <li>NULL != NULL (always false)</li>
                                                <li>Use IS NULL or IS NOT NULL for comparisons</li>
                                                <li>NULL in arithmetic = NULL</li>
                                                <li>NULL OR TRUE = TRUE, NULL AND FALSE = FALSE</li>
                                            </ul>
                                        </div>
                                    </div>
                                </div>
                                
                                <pre><code class="language-sql">-- ========================================
-- NULL HANDLING TECHNIQUES
-- ========================================

-- Basic NULL checks
SELECT * FROM users WHERE middle_name IS NULL;
SELECT * FROM users WHERE middle_name IS NOT NULL;

-- NULL-safe equality operator <=>
SELECT * FROM users WHERE middle_name <=> NULL;  -- Same as IS NULL
SELECT * FROM users WHERE middle_name <=> 'John';  -- NULL-safe equals

-- COALESCE - return first non-NULL value
SELECT 
    username,
    COALESCE(phone, email, 'No contact') AS primary_contact
FROM users;

-- IFNULL - replace NULL with value
SELECT 
    product_name,
    IFNULL(discount, 0) AS discount_amount
FROM products;

-- NULLIF - return NULL if values match
SELECT 
    username,
    NULLIF(status, 'inactive') AS active_status  -- NULL if inactive
FROM users;

-- ========================================
-- NULL IN CONDITIONS
-- ========================================

-- Three-valued logic with NULL
SELECT * FROM orders 
WHERE 
    -- This handles NULL properly
    (discount IS NULL OR discount < 10)
    AND status = 'active';

-- NOT IN with NULL (tricky!)
-- This returns NO rows if subquery contains NULL
SELECT * FROM products 
WHERE category_id NOT IN (
    SELECT category_id FROM discontinued_categories
    -- Add WHERE category_id IS NOT NULL to fix
);

-- Safe NOT IN
SELECT * FROM products p
WHERE NOT EXISTS (
    SELECT 1 FROM discontinued_categories dc
    WHERE dc.category_id = p.category_id
);

-- ========================================
-- NULL ORDERING
-- ========================================

-- Control NULL position in ORDER BY
SELECT * FROM products 
ORDER BY 
    discount IS NULL,  -- NULLs last
    discount DESC;

-- NULLs first
SELECT * FROM products 
ORDER BY 
    discount IS NOT NULL,
    discount DESC;

-- ========================================
-- AGGREGATE FUNCTIONS AND NULL
-- ========================================

-- Aggregates ignore NULL (except COUNT(*))
SELECT 
    COUNT(*) AS total_rows,
    COUNT(phone) AS rows_with_phone,
    AVG(age) AS avg_age_excluding_null,
    AVG(IFNULL(age, 0)) AS avg_age_null_as_zero
FROM users;

-- GROUP BY with NULL
SELECT 
    IFNULL(category, 'Uncategorized') AS category_name,
    COUNT(*) AS product_count
FROM products 
GROUP BY category;  -- NULL becomes its own group</code></pre>
                            </section>

                            <section>
                                <h2>Performance Optimization</h2>
                                
                                <div class="homework">
                                    <h3>WHERE Clause Performance Tips</h3>
                                    
                                    <pre><code class="language-sql">-- ========================================
-- INDEX-FRIENDLY WHERE CLAUSES
-- ========================================

-- Bad: Function on indexed column
SELECT * FROM users 
WHERE YEAR(created_at) = 2024;  -- Can't use index

-- Good: Range condition
SELECT * FROM users 
WHERE created_at >= '2024-01-01' 
  AND created_at < '2025-01-01';  -- Uses index

-- Bad: Leading wildcard
SELECT * FROM products 
WHERE name LIKE '%laptop';  -- Full table scan

-- Good: Trailing wildcard
SELECT * FROM products 
WHERE name LIKE 'laptop%';  -- Can use index

-- Bad: OR with different columns
SELECT * FROM users 
WHERE username = 'john' OR email = 'john@example.com';  -- Hard to optimize

-- Good: UNION for OR conditions
SELECT * FROM users WHERE username = 'john'
UNION
SELECT * FROM users WHERE email = 'john@example.com';

-- ========================================
-- SARGABLE PREDICATES
-- ========================================

-- Non-SARGable (Search ARGument ABLE)
SELECT * FROM orders 
WHERE total_amount + tax > 1000;  -- Can't use index

-- SARGable
SELECT * FROM orders 
WHERE total_amount > 1000 - tax;  -- Can use index

-- Non-SARGable: Implicit conversion
SELECT * FROM users 
WHERE CONCAT(first_name, ' ', last_name) = 'John Doe';

-- SARGable: Direct comparison
SELECT * FROM users 
WHERE first_name = 'John' AND last_name = 'Doe';

-- ========================================
-- OPTIMIZE COMPLEX CONDITIONS
-- ========================================

-- Put most selective condition first
SELECT * FROM orders 
WHERE 
    customer_id = 12345  -- Very selective
    AND status = 'completed'  -- Less selective
    AND order_date >= '2024-01-01';  -- Least selective

-- Use covering index
CREATE INDEX idx_covering 
ON orders(customer_id, status, order_date, total_amount);

SELECT customer_id, status, total_amount 
FROM orders 
WHERE customer_id = 12345 
  AND status = 'completed';  -- All from index

-- ========================================
-- EXPLAIN ANALYSIS
-- ========================================

-- Check query execution plan
EXPLAIN SELECT * FROM users WHERE email = 'user@example.com';

-- Extended explain
EXPLAIN EXTENDED 
SELECT * FROM orders o
JOIN customers c ON o.customer_id = c.customer_id
WHERE o.status = 'pending';

-- JSON format for detailed analysis
EXPLAIN FORMAT=JSON
SELECT * FROM products 
WHERE category_id = 5 
  AND price BETWEEN 100 AND 500;

-- ========================================
-- QUERY HINTS
-- ========================================

-- Force index usage
SELECT * FROM users USE INDEX (idx_email)
WHERE email = 'user@example.com';

-- Ignore specific index
SELECT * FROM users IGNORE INDEX (idx_created)
WHERE created_at > '2024-01-01';

-- Force index for ORDER BY
SELECT * FROM products 
FORCE INDEX FOR ORDER BY (idx_price)
WHERE category_id = 5
ORDER BY price;</code></pre>
                                </div>
                            </section>

                            <!-- Practice Exercise -->
                            <section>
                                <h2>Practice Exercise</h2>
                                
                                <div class="alert alert-success">
                                    <div class="alert-icon">üíª</div>
                                    <div class="alert-content">
                                        <div class="alert-title">Complex Filtering Challenge</div>
                                        <div class="alert-message">
                                            Write WHERE clauses for these scenarios:
                                            <ol>
                                                <li>Find orders placed on weekends with total > $500</li>
                                                <li>Find users with gmail/yahoo email, registered last year</li>
                                                <li>Products with 20% discount OR featured (not both)</li>
                                                <li>Find potential duplicate customers (same name sound)</li>
                                                <li>Orders with NULL discount or discount < 10%</li>
                                                <li>Find all variations of "McDonald" (McDonald's, Mcdonald, etc)</li>
                                                <li>Valid phone numbers in multiple formats</li>
                                                <li>Products without images or descriptions</li>
                                            </ol>
                                        </div>
                                    </div>
                                </div>
                                
                                <details>
                                    <summary>üí° Click for Solutions</summary>
                                    <pre><code class="language-sql">-- 1. Orders placed on weekends with total > $500
SELECT * FROM orders 
WHERE DAYOFWEEK(order_date) IN (1, 7)  -- Sunday = 1, Saturday = 7
  AND total_amount > 500;

-- 2. Gmail/Yahoo users registered last year
SELECT * FROM users 
WHERE (email LIKE '%@gmail.com' OR email LIKE '%@yahoo.com')
  AND YEAR(created_at) = YEAR(CURDATE()) - 1;

-- 3. Products with discount XOR featured
SELECT * FROM products 
WHERE (discount_percent >= 20) XOR (is_featured = TRUE);

-- Alternative XOR
SELECT * FROM products 
WHERE (discount_percent >= 20 AND is_featured = FALSE)
   OR (discount_percent < 20 AND is_featured = TRUE);

-- 4. Find potential duplicate customers
SELECT 
    c1.*,
    c2.customer_id AS potential_dup_id,
    c2.first_name AS dup_first,
    c2.last_name AS dup_last
FROM customers c1
JOIN customers c2 ON 
    c1.customer_id < c2.customer_id
    AND SOUNDEX(c1.first_name) = SOUNDEX(c2.first_name)
    AND SOUNDEX(c1.last_name) = SOUNDEX(c2.last_name);

-- 5. Orders with NULL discount or discount < 10%
SELECT * FROM orders 
WHERE discount_percent IS NULL 
   OR discount_percent < 10;

-- Using COALESCE
SELECT * FROM orders 
WHERE COALESCE(discount_percent, 0) < 10;

-- 6. Find variations of "McDonald"
SELECT * FROM customers 
WHERE last_name REGEXP '^M[cC]?[dD]onald[s\'']?$'
   OR SOUNDEX(last_name) = SOUNDEX('McDonald');

-- 7. Valid phone numbers (multiple formats)
SELECT * FROM contacts 
WHERE phone REGEXP '^(\\+?1[-. ]?)?\\(?[0-9]{3}\\)?[-. ]?[0-9]{3}[-. ]?[0-9]{4}$'
   OR phone REGEXP '^[0-9]{10}$'  -- Simple 10 digits
   OR phone REGEXP '^[0-9]{3}-[0-9]{3}-[0-9]{4}$';  -- 123-456-7890

-- 8. Products without images or descriptions
SELECT * FROM products 
WHERE (image_url IS NULL OR image_url = '')
   OR (description IS NULL OR TRIM(description) = '');

-- Alternative using COALESCE
SELECT * FROM products 
WHERE COALESCE(TRIM(image_url), '') = ''
   OR COALESCE(TRIM(description), '') = '';</code></pre>
                                </details>
                            </section>
                            
                            <!-- Resources -->
                            <section class="resources">
                                <h2>Additional Resources</h2>
                                <ul>
                                    <li><a href="https://dev.mysql.com/doc/refman/8.0/en/where-optimization.html" target="_blank">MySQL WHERE Optimization</a></li>
                                    <li><a href="https://dev.mysql.com/doc/refman/8.0/en/regexp.html" target="_blank">MySQL Regular Expressions</a></li>
                                    <li><a href="https://dev.mysql.com/doc/refman/8.0/en/fulltext-search.html" target="_blank">MySQL Full-Text Search</a></li>
                                    <li><a href="https://use-the-index-luke.com/sql/where-clause" target="_blank">SQL Performance Explained</a></li>
                                </ul>
                            </section>
                        </div>

                        <!-- Lesson Navigation -->
                        <div class="lesson-navigation">
                            <a href="/03module/select_queries.html" class="lesson-nav-button prev">
                                <svg width="20" height="20" viewBox="0 0 20 20" fill="currentColor">
                                    <path d="M12.707 5.293a1 1 0 010 1.414L9.414 10l3.293 3.293a1 1 0 01-1.414 1.414l-4-4a1 1 0 010-1.414l4-4a1 1 0 011.414 0z"/>
                                </svg>
                                <span>
                                    <small>Previous</small><br>
                                    SELECT Queries
                                </span>
                            </a>
                            
                            <button class="complete-lesson-btn">
                                Mark as Complete
                            </button>
                            
                            <a href="/03module/joins_relationships.html" class="lesson-nav-button next">
                                <span>
                                    <small>Next</small><br>
                                    JOINs & Relationships
                                </span>
                                <svg width="20" height="20" viewBox="0 0 20 20" fill="currentColor">
                                    <path d="M7.293 14.707a1 1 0 010-1.414L10.586 10 7.293 6.707a1 1 0 011.414-1.414l4 4a1 1 0 010 1.414l-4 4a1 1 0 01-1.414 0z"/>
                                </svg>
                            </a>
                        </div>
                    </article>
                </div>
            </div>
        </main>

        <!-- Footer -->
        <footer class="site-footer" role="contentinfo">
            <div class="footer-container">
                <div class="footer-content">
                    <div class="footer-section footer-about">
                        <h3>PHP WordPress Development</h3>
                        <p>Complete Web Development Course</p>
                    </div>
                    
                    <div class="footer-section">
                        <h4>Quick Links</h4>
                        <ul class="footer-links">
                            <li><a href="/">Home</a></li>
                            <li><a href="/module3.html">Module 3</a></li>
                            <li><a href="/resources.html">Resources</a></li>
                        </ul>
                    </div>
                    
                    <div class="footer-section">
                        <h4>Support</h4>
                        <ul class="footer-links">
                            <li><a href="/help.html">Help Center</a></li>
                            <li><a href="/faq.html">FAQ</a></li>
                            <li><a href="/contact.html">Contact</a></li>
                        </ul>
                    </div>
                </div>
                
                <div class="footer-bottom">
                    <div class="footer-bottom-content">
                        <p class="copyright">&copy; 2025 PHP WordPress Development Course</p>
                        <nav class="footer-bottom-links">
                            <a href="/privacy.html">Privacy</a>
                            <span class="separator">|</span>
                            <a href="/terms.html">Terms</a>
                        </nav>
                    </div>
                </div>
            </div>
        </footer>
    </div>

    <!-- Back to Top -->
    <button id="back-to-top" class="back-to-top" aria-label="Back to top">
        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M12 19V5M12 5l-7 7M12 5l7 7"/>
        </svg>
    </button>

    <!-- JavaScript -->
    <script src="/assets/js/navigation.js"></script>
    <script src="/assets/js/site-config.js"></script>
</body>
</html>