<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    
    <!-- SEO Meta Tags -->
    <title>Connecting to MySQL with PHP - Database Connection Guide - PHP WordPress Course</title>
    <meta name="description" content="Master MySQL database connections in PHP, connection configuration, pooling, character encoding, SSL setup, and best practices">
    <meta name="keywords" content="PHP, MySQL, database connection, PDO, MySQLi, connection pooling, SSL, configuration">
    <meta name="author" content="PHP WordPress Course">
    
    <!-- Favicon -->
    <link rel="icon" type="image/png" href="/favicon.png">
    <link rel="apple-touch-icon" href="/favicon.png">
    
    <!-- CSS -->
    <link rel="stylesheet" href="/assets/css/main.css">
    
    <!-- Mermaid for diagrams -->
    <script type="module">
        import mermaid from 'https://cdn.jsdelivr.net/npm/mermaid@10/dist/mermaid.esm.min.mjs';
        mermaid.initialize({ startOnLoad: true });
    </script>
</head>
<body>
    <!-- Skip to main content -->
    <a href="#main-content" class="sr-only">Skip to main content</a>
    
    <div class="page-wrapper">
        <!-- Header -->
        <header class="site-header" role="banner">
            <div class="header-container">
                <div class="site-branding">
                    <a href="/" class="site-logo">
                        <h1 class="site-title">PHP WordPress Development</h1>
                    </a>
                </div>
                
                <nav class="main-navigation" role="navigation" aria-label="Main navigation">
                    <button class="mobile-menu-btn" aria-label="Toggle navigation" aria-expanded="false">
                        <span></span>
                        <span></span>
                        <span></span>
                    </button>
                    
                    <div class="nav-menu">
                        <ul class="nav-list">
                            <li class="nav-item"><a href="/" class="nav-link">Home</a></li>
                            <li class="nav-item dropdown">
                                <button class="nav-link dropdown-toggle active" aria-haspopup="true">Modules</button>
                                <div class="dropdown-menu">
                                    <a href="/module1.html" class="dropdown-item">Module 1: Web Fundamentals</a>
                                    <a href="/module2.html" class="dropdown-item">Module 2: PHP Fundamentals</a>
                                    <a href="/module3.html" class="dropdown-item active">Module 3: MySQL Database</a>
                                    <a href="/module4.html" class="dropdown-item">Module 4: WordPress & Docker</a>
                                    <a href="/module5.html" class="dropdown-item">Module 5: Theme Development</a>
                                    <a href="/module6.html" class="dropdown-item">Module 6: Plugin Development</a>
                                    <a href="/module7.html" class="dropdown-item">Module 7: Advanced WordPress</a>
                                    <a href="/module8.html" class="dropdown-item">Module 8: Deployment</a>
                                    <a href="/module9.html" class="dropdown-item">Module 9: Final Project</a>
                                </div>
                            </li>
                            <li class="nav-item"><a href="/resources.html" class="nav-link">Resources</a></li>
                            <li class="nav-item"><a href="/about.html" class="nav-link">About</a></li>
                        </ul>
                    </div>
                </nav>
                
                <div class="search-container">
                    <div class="search-input-wrapper">
                        <svg class="search-icon" width="20" height="20" viewBox="0 0 20 20" fill="currentColor">
                            <path fill-rule="evenodd" d="M8 4a4 4 0 100 8 4 4 0 000-8zM2 8a6 6 0 1110.89 3.476l4.817 4.817a1 1 0 01-1.414 1.414l-4.816-4.816A6 6 0 012 8z" clip-rule="evenodd" />
                        </svg>
                        <input type="search" class="search-input" placeholder="Search lessons..." aria-label="Search">
                    </div>
                    <div class="search-results"></div>
                </div>
            </div>
        </header>
        
        <!-- Progress Bar -->
        <div class="progress-container">
            <div class="progress-header">
                <h2 class="progress-title">Course Progress</h2>
                <span class="progress-text">Loading...</span>
            </div>
            <div class="progress-bar">
                <div class="progress-bar-fill">
                    <span class="progress-bar-text"></span>
                </div>
            </div>
        </div>
        
        <!-- Breadcrumb -->
        <nav class="breadcrumb container" aria-label="Breadcrumb">
            <ol class="breadcrumb-list">
                <li class="breadcrumb-item">
                    <a href="/">Home</a>
                    <span class="breadcrumb-separator">/</span>
                </li>
                <li class="breadcrumb-item">
                    <a href="/module3.html">Module 3</a>
                    <span class="breadcrumb-separator">/</span>
                </li>
                <li class="breadcrumb-item">
                    <span aria-current="page">Connecting to MySQL</span>
                </li>
            </ol>
        </nav>
        
        <!-- Main Content -->
        <main id="main-content" class="main-content" role="main">
            <div class="container">
                <div class="content-with-sidebar">
                    <!-- Sidebar -->
                    <aside class="sidebar">
                        <div class="sidebar-nav">
                            <h3 class="sidebar-title">Module 3: Session 5</h3>
                            <div class="sidebar-section">
                                <h4 class="sidebar-section-title">PHP MySQL Integration</h4>
                                <a href="/module3.html" class="sidebar-link">Module Overview</a>
                                <a href="/03module/connecting_mysql.html" class="sidebar-link active">1. Connecting to MySQL</a>
                                <a href="/03module/pdo_vs_mysqli.html" class="sidebar-link">2. PDO vs MySQLi</a>
                                <a href="/03module/executing_queries.html" class="sidebar-link">3. Executing Queries</a>
                                <a href="/03module/prepared_statements.html" class="sidebar-link">4. Prepared Statements</a>
                                <a href="/03module/crud_operations.html" class="sidebar-link">5. CRUD Operations</a>
                                <a href="/03module/result_sets.html" class="sidebar-link">6. Result Sets</a>
                                <a href="/03module/error_debugging.html" class="sidebar-link">7. Error Handling</a>
                                <a href="/03module/final_project.html" class="sidebar-link">8. Final Project</a>
                            </div>
                        </div>
                    </aside>
                    
                    <!-- Main Lesson Content -->
                    <article class="lesson-content">
                        <header class="lesson-header">
                            <h1>Connecting to MySQL with PHP</h1>
                            <div class="lesson-meta">
                                <div class="lesson-meta-item">
                                    <svg width="20" height="20" fill="currentColor">
                                        <path d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"/>
                                    </svg>
                                    <span>Duration: 75 minutes</span>
                                </div>
                                <div class="lesson-meta-item">
                                    <svg width="20" height="20" fill="currentColor">
                                        <path d="M12 14l9-5-9-5-9 5 9 5z"/>
                                    </svg>
                                    <span>Lesson 1 of 8</span>
                                </div>
                            </div>
                        </header>

                        <!-- Learning Objectives -->
                        <div class="lesson-objectives">
                            <h2>Learning Objectives</h2>
                            <ul>
                                <li>Understand MySQL connection fundamentals</li>
                                <li>Configure database connections properly</li>
                                <li>Implement connection pooling strategies</li>
                                <li>Set up character encoding correctly</li>
                                <li>Configure SSL/TLS secure connections</li>
                                <li>Handle connection errors gracefully</li>
                                <li>Manage persistent vs non-persistent connections</li>
                                <li>Apply connection best practices</li>
                            </ul>
                        </div>
                        
                        <!-- Lesson Body -->
                        <div class="lesson-body">
                            <section>
                                <h2>Understanding Database Connections</h2>
                                <p class="lead">Establishing a reliable connection to MySQL is the foundation of any PHP database application. Let's master every aspect! ðŸ”Œ</p>
                                
                                <canvas id="connectionCanvas" width="600" height="450"></canvas>
                                <script>
                                    const ctx = document.getElementById('connectionCanvas').getContext('2d');
                                    
                                    // Title
                                    ctx.font = 'bold 18px Arial';
                                    ctx.fillStyle = '#1f2937';
                                    ctx.fillText('MySQL Connection Architecture', 170, 30);
                                    
                                    // PHP Application
                                    ctx.fillStyle = '#dbeafe';
                                    ctx.fillRect(50, 60, 200, 100);
                                    ctx.strokeStyle = '#2563eb';
                                    ctx.lineWidth = 2;
                                    ctx.strokeRect(50, 60, 200, 100);
                                    
                                    ctx.fillStyle = '#1e40af';
                                    ctx.font = 'bold 14px Arial';
                                    ctx.fillText('PHP Application', 105, 85);
                                    
                                    ctx.font = '11px Arial';
                                    ctx.fillStyle = '#374151';
                                    ctx.fillText('â€¢ Connection Request', 60, 105);
                                    ctx.fillText('â€¢ Credentials', 60, 120);
                                    ctx.fillText('â€¢ Configuration', 60, 135);
                                    ctx.fillText('â€¢ Error Handling', 60, 150);
                                    
                                    // Connection Methods
                                    ctx.fillStyle = '#dcfce7';
                                    ctx.fillRect(50, 190, 95, 80);
                                    ctx.strokeStyle = '#16a34a';
                                    ctx.strokeRect(50, 190, 95, 80);
                                    
                                    ctx.fillStyle = '#166534';
                                    ctx.font = 'bold 12px Arial';
                                    ctx.fillText('PDO', 85, 210);
                                    ctx.font = '10px Arial';
                                    ctx.fillStyle = '#374151';
                                    ctx.fillText('Multiple DBs', 60, 230);
                                    ctx.fillText('OOP only', 60, 245);
                                    ctx.fillText('Prepared', 60, 260);
                                    
                                    ctx.fillStyle = '#fef3c7';
                                    ctx.fillRect(155, 190, 95, 80);
                                    ctx.strokeStyle = '#ca8a04';
                                    ctx.strokeRect(155, 190, 95, 80);
                                    
                                    ctx.fillStyle = '#92400e';
                                    ctx.font = 'bold 12px Arial';
                                    ctx.fillText('MySQLi', 180, 210);
                                    ctx.font = '10px Arial';
                                    ctx.fillStyle = '#374151';
                                    ctx.fillText('MySQL only', 165, 230);
                                    ctx.fillText('OOP/Proc', 165, 245);
                                    ctx.fillText('Async', 165, 260);
                                    
                                    // MySQL Server
                                    ctx.fillStyle = '#e9d5ff';
                                    ctx.fillRect(350, 60, 200, 100);
                                    ctx.strokeStyle = '#7c3aed';
                                    ctx.strokeRect(350, 60, 200, 100);
                                    
                                    ctx.fillStyle = '#6b21a8';
                                    ctx.font = 'bold 14px Arial';
                                    ctx.fillText('MySQL Server', 410, 85);
                                    
                                    ctx.font = '11px Arial';
                                    ctx.fillStyle = '#374151';
                                    ctx.fillText('â€¢ Authentication', 360, 105);
                                    ctx.fillText('â€¢ Authorization', 360, 120);
                                    ctx.fillText('â€¢ Session Management', 360, 135);
                                    ctx.fillText('â€¢ Resource Allocation', 360, 150);
                                    
                                    // Connection Flow
                                    ctx.strokeStyle = '#6b7280';
                                    ctx.lineWidth = 2;
                                    ctx.setLineDash([5, 5]);
                                    
                                    // From PHP to methods
                                    ctx.beginPath();
                                    ctx.moveTo(150, 160);
                                    ctx.lineTo(97, 190);
                                    ctx.stroke();
                                    
                                    ctx.beginPath();
                                    ctx.moveTo(150, 160);
                                    ctx.lineTo(202, 190);
                                    ctx.stroke();
                                    
                                    // From methods to MySQL
                                    ctx.beginPath();
                                    ctx.moveTo(250, 230);
                                    ctx.lineTo(350, 110);
                                    ctx.stroke();
                                    
                                    ctx.setLineDash([]);
                                    
                                    // Connection States
                                    ctx.fillStyle = '#f3f4f6';
                                    ctx.fillRect(50, 300, 500, 120);
                                    ctx.strokeStyle = '#6b7280';
                                    ctx.strokeRect(50, 300, 500, 120);
                                    
                                    ctx.fillStyle = '#1f2937';
                                    ctx.font = 'bold 12px Arial';
                                    ctx.fillText('Connection Lifecycle', 240, 320);
                                    
                                    // States
                                    const states = [
                                        { text: '1. Initialize', x: 70, y: 350, color: '#dbeafe' },
                                        { text: '2. Connect', x: 170, y: 350, color: '#dcfce7' },
                                        { text: '3. Authenticate', x: 270, y: 350, color: '#fef3c7' },
                                        { text: '4. Execute', x: 380, y: 350, color: '#e0f2fe' },
                                        { text: '5. Close', x: 480, y: 350, color: '#fee2e2' }
                                    ];
                                    
                                    states.forEach(state => {
                                        ctx.fillStyle = state.color;
                                        ctx.fillRect(state.x - 15, state.y - 20, 60, 30);
                                        ctx.strokeStyle = '#6b7280';
                                        ctx.strokeRect(state.x - 15, state.y - 20, 60, 30);
                                        
                                        ctx.fillStyle = '#1f2937';
                                        ctx.font = '9px Arial';
                                        ctx.fillText(state.text, state.x - 10, state.y - 2);
                                    });
                                    
                                    // Arrows between states
                                    ctx.strokeStyle = '#6b7280';
                                    ctx.lineWidth = 1;
                                    for (let i = 0; i < states.length - 1; i++) {
                                        ctx.beginPath();
                                        ctx.moveTo(states[i].x + 45, states[i].y - 5);
                                        ctx.lineTo(states[i+1].x - 15, states[i].y - 5);
                                        ctx.stroke();
                                    }
                                    
                                    // Notes
                                    ctx.fillStyle = '#6b7280';
                                    ctx.font = '10px Arial';
                                    ctx.fillText('â€¢ Persistent connections reuse steps 1-3', 70, 390);
                                    ctx.fillText('â€¢ Connection pooling manages multiple connections', 70, 405);
                                    ctx.fillText('â€¢ SSL/TLS adds encryption layer', 330, 390);
                                    ctx.fillText('â€¢ Timeout settings prevent hanging', 330, 405);
                                </script>
                                
                                <div class="alert alert-info">
                                    <div class="alert-icon">ðŸ’¡</div>
                                    <div class="alert-content">
                                        <div class="alert-title">Connection Fundamentals</div>
                                        <div class="alert-message">
                                            <ul>
                                                <li><strong>Connection String:</strong> Specifies server, database, credentials</li>
                                                <li><strong>Character Encoding:</strong> Must match database encoding (utf8mb4 recommended)</li>
                                                <li><strong>Timeout Settings:</strong> Prevent hanging connections</li>
                                                <li><strong>Resource Management:</strong> Connections consume server resources</li>
                                                <li><strong>Security:</strong> Never hardcode credentials, use environment variables</li>
                                                <li><strong>Error Handling:</strong> Always handle connection failures gracefully</li>
                                            </ul>
                                        </div>
                                    </div>
                                </div>
                            </section>

                            <section>
                                <h2>Basic Connection Methods</h2>
                                
                                <div class="mermaid">
                                    graph TB
                                        APP[PHP Application] --> METHOD{Connection Method}
                                        
                                        METHOD --> PDO[PDO Connection]
                                        METHOD --> MYSQLI[MySQLi Connection]
                                        METHOD --> DEPRECATED[mysql_* Deprecated]
                                        
                                        PDO --> CONFIG1[DSN Configuration]
                                        MYSQLI --> CONFIG2[Host Configuration]
                                        
                                        CONFIG1 --> CONNECT1[Establish Connection]
                                        CONFIG2 --> CONNECT2[Establish Connection]
                                        
                                        CONNECT1 --> DB[(MySQL Database)]
                                        CONNECT2 --> DB
                                        
                                        style APP fill:#dbeafe
                                        style PDO fill:#dcfce7
                                        style MYSQLI fill:#fef3c7
                                        style DEPRECATED fill:#fee2e2
                                        style DB fill:#e9d5ff
                                </div>
                                
                                <div class="real_world_example">
                                    <h3>Connection Implementation Examples</h3>
                                    
                                    <pre><code class="language-php">&lt;?php
// ========================================
// METHOD 1: PDO CONNECTION
// ========================================

/**
 * PDO Connection with comprehensive configuration
 */
class PDOConnection {
    private $pdo;
    private $config;
    
    public function __construct() {
        $this->loadConfiguration();
        $this->connect();
    }
    
    /**
     * Load configuration from environment or config file
     */
    private function loadConfiguration() {
        // Best practice: Use environment variables
        $this->config = [
            'driver'   => $_ENV['DB_DRIVER'] ?? 'mysql',
            'host'     => $_ENV['DB_HOST'] ?? 'localhost',
            'port'     => $_ENV['DB_PORT'] ?? 3306,
            'database' => $_ENV['DB_DATABASE'] ?? 'testdb',
            'username' => $_ENV['DB_USERNAME'] ?? 'root',
            'password' => $_ENV['DB_PASSWORD'] ?? '',
            'charset'  => $_ENV['DB_CHARSET'] ?? 'utf8mb4',
            'collation' => $_ENV['DB_COLLATION'] ?? 'utf8mb4_unicode_ci',
            'options'  => [
                // Error handling
                PDO::ATTR_ERRMODE => PDO::ERRMODE_EXCEPTION,
                
                // Fetch mode
                PDO::ATTR_DEFAULT_FETCH_MODE => PDO::FETCH_ASSOC,
                
                // Prepare emulation (false for real prepared statements)
                PDO::ATTR_EMULATE_PREPARES => false,
                
                // Connection timeout (seconds)
                PDO::ATTR_TIMEOUT => 5,
                
                // Persistent connection
                PDO::ATTR_PERSISTENT => false,
                
                // MySQL specific: Use buffered queries
                PDO::MYSQL_ATTR_USE_BUFFERED_QUERY => true,
                
                // MySQL specific: Enable compression
                PDO::MYSQL_ATTR_COMPRESS => true,
                
                // MySQL specific: Init command
                PDO::MYSQL_ATTR_INIT_COMMAND => "SET NAMES utf8mb4 COLLATE utf8mb4_unicode_ci"
            ]
        ];
    }
    
    /**
     * Establish database connection
     */
    private function connect() {
        try {
            // Build DSN (Data Source Name)
            $dsn = $this->buildDSN();
            
            // Create PDO instance
            $this->pdo = new PDO(
                $dsn,
                $this->config['username'],
                $this->config['password'],
                $this->config['options']
            );
            
            // Additional configuration after connection
            $this->postConnectionSetup();
            
            echo "âœ… PDO Connection established successfully\n";
            
        } catch (PDOException $e) {
            $this->handleConnectionError($e);
        }
    }
    
    /**
     * Build DSN string
     */
    private function buildDSN() {
        $dsn = "{$this->config['driver']}:";
        
        // Add connection parameters
        $params = [];
        
        // Unix socket or TCP/IP
        if (isset($this->config['unix_socket'])) {
            $params[] = "unix_socket={$this->config['unix_socket']}";
        } else {
            $params[] = "host={$this->config['host']}";
            $params[] = "port={$this->config['port']}";
        }
        
        $params[] = "dbname={$this->config['database']}";
        $params[] = "charset={$this->config['charset']}";
        
        $dsn .= implode(';', $params);
        
        return $dsn;
    }
    
    /**
     * Post-connection configuration
     */
    private function postConnectionSetup() {
        // Set timezone
        $this->pdo->exec("SET time_zone = '+00:00'");
        
        // Set SQL mode for strict data handling
        $this->pdo->exec("SET sql_mode = 'STRICT_ALL_TABLES,ERROR_FOR_DIVISION_BY_ZERO,NO_AUTO_CREATE_USER'");
        
        // Set transaction isolation level
        $this->pdo->exec("SET SESSION TRANSACTION ISOLATION LEVEL READ COMMITTED");
    }
    
    /**
     * Handle connection errors
     */
    private function handleConnectionError(PDOException $e) {
        $errorInfo = [
            'message' => $e->getMessage(),
            'code' => $e->getCode(),
            'timestamp' => date('Y-m-d H:i:s'),
            'host' => $this->config['host'],
            'database' => $this->config['database']
        ];
        
        // Log error (don't expose passwords)
        error_log("PDO Connection Error: " . json_encode($errorInfo));
        
        // User-friendly error message
        if ($_ENV['APP_ENV'] === 'production') {
            die("Database connection error. Please try again later.");
        } else {
            die("Connection failed: " . $e->getMessage());
        }
    }
    
    /**
     * Get PDO instance
     */
    public function getConnection() {
        return $this->pdo;
    }
    
    /**
     * Test connection
     */
    public function testConnection() {
        try {
            $stmt = $this->pdo->query('SELECT 1');
            return $stmt !== false;
        } catch (PDOException $e) {
            return false;
        }
    }
    
    /**
     * Get connection info
     */
    public function getConnectionInfo() {
        return [
            'server_info' => $this->pdo->getAttribute(PDO::ATTR_SERVER_INFO),
            'server_version' => $this->pdo->getAttribute(PDO::ATTR_SERVER_VERSION),
            'client_version' => $this->pdo->getAttribute(PDO::ATTR_CLIENT_VERSION),
            'connection_status' => $this->pdo->getAttribute(PDO::ATTR_CONNECTION_STATUS),
            'driver_name' => $this->pdo->getAttribute(PDO::ATTR_DRIVER_NAME),
            'persistent' => $this->pdo->getAttribute(PDO::ATTR_PERSISTENT)
        ];
    }
}

// ========================================
// METHOD 2: MYSQLI CONNECTION
// ========================================

/**
 * MySQLi Connection with comprehensive configuration
 */
class MySQLiConnection {
    private $mysqli;
    private $config;
    
    public function __construct() {
        $this->loadConfiguration();
        $this->connect();
    }
    
    /**
     * Load configuration
     */
    private function loadConfiguration() {
        $this->config = [
            'host' => $_ENV['DB_HOST'] ?? 'localhost',
            'username' => $_ENV['DB_USERNAME'] ?? 'root',
            'password' => $_ENV['DB_PASSWORD'] ?? '',
            'database' => $_ENV['DB_DATABASE'] ?? 'testdb',
            'port' => $_ENV['DB_PORT'] ?? 3306,
            'socket' => $_ENV['DB_SOCKET'] ?? null,
            'charset' => $_ENV['DB_CHARSET'] ?? 'utf8mb4'
        ];
    }
    
    /**
     * Establish MySQLi connection
     */
    private function connect() {
        // Enable error reporting
        mysqli_report(MYSQLI_REPORT_ERROR | MYSQLI_REPORT_STRICT);
        
        try {
            // Initialize MySQLi
            $this->mysqli = new mysqli();
            
            // Set connection timeout
            $this->mysqli->options(MYSQLI_OPT_CONNECT_TIMEOUT, 5);
            
            // Enable compression
            $this->mysqli->options(MYSQLI_CLIENT_COMPRESS, true);
            
            // SSL Configuration (if needed)
            if (isset($this->config['ssl'])) {
                $this->configureSLL();
            }
            
            // Establish connection
            $this->mysqli->real_connect(
                $this->config['host'],
                $this->config['username'],
                $this->config['password'],
                $this->config['database'],
                $this->config['port'],
                $this->config['socket']
            );
            
            // Set charset
            $this->mysqli->set_charset($this->config['charset']);
            
            // Post-connection setup
            $this->postConnectionSetup();
            
            echo "âœ… MySQLi Connection established successfully\n";
            
        } catch (mysqli_sql_exception $e) {
            $this->handleConnectionError($e);
        }
    }
    
    /**
     * Configure SSL
     */
    private function configureSLL() {
        $this->mysqli->ssl_set(
            $this->config['ssl']['key'] ?? null,
            $this->config['ssl']['cert'] ?? null,
            $this->config['ssl']['ca'] ?? null,
            $this->config['ssl']['capath'] ?? null,
            $this->config['ssl']['cipher'] ?? null
        );
    }
    
    /**
     * Post-connection setup
     */
    private function postConnectionSetup() {
        // Set timezone
        $this->mysqli->query("SET time_zone = '+00:00'");
        
        // Set SQL mode
        $this->mysqli->query("SET sql_mode = 'STRICT_ALL_TABLES'");
        
        // Set names (backup for charset)
        $this->mysqli->query("SET NAMES '{$this->config['charset']}'");
    }
    
    /**
     * Handle connection errors
     */
    private function handleConnectionError($e) {
        $errorInfo = [
            'message' => $e->getMessage(),
            'code' => $e->getCode(),
            'timestamp' => date('Y-m-d H:i:s')
        ];
        
        error_log("MySQLi Connection Error: " . json_encode($errorInfo));
        
        if ($_ENV['APP_ENV'] === 'production') {
            die("Database connection error. Please try again later.");
        } else {
            die("Connection failed: " . $e->getMessage());
        }
    }
    
    /**
     * Get MySQLi instance
     */
    public function getConnection() {
        return $this->mysqli;
    }
    
    /**
     * Get connection stats
     */
    public function getStats() {
        return [
            'host_info' => $this->mysqli->host_info,
            'protocol_version' => $this->mysqli->protocol_version,
            'server_info' => $this->mysqli->server_info,
            'server_version' => $this->mysqli->server_version,
            'client_info' => $this->mysqli->client_info,
            'client_version' => $this->mysqli->client_version,
            'thread_id' => $this->mysqli->thread_id,
            'warning_count' => $this->mysqli->warning_count,
            'stat' => $this->mysqli->stat()
        ];
    }
}

// ========================================
// CONNECTION MANAGER (Singleton Pattern)
// ========================================

class ConnectionManager {
    private static $instances = [];
    private $connections = [];
    
    private function __construct() {}
    
    /**
     * Get singleton instance
     */
    public static function getInstance() {
        $class = static::class;
        if (!isset(self::$instances[$class])) {
            self::$instances[$class] = new static();
        }
        return self::$instances[$class];
    }
    
    /**
     * Get or create connection
     */
    public function getConnection($name = 'default', $type = 'pdo') {
        $key = "{$name}_{$type}";
        
        if (!isset($this->connections[$key])) {
            $this->connections[$key] = $this->createConnection($type);
        }
        
        return $this->connections[$key];
    }
    
    /**
     * Create new connection
     */
    private function createConnection($type) {
        switch ($type) {
            case 'pdo':
                $conn = new PDOConnection();
                return $conn->getConnection();
                
            case 'mysqli':
                $conn = new MySQLiConnection();
                return $conn->getConnection();
                
            default:
                throw new Exception("Unknown connection type: {$type}");
        }
    }
    
    /**
     * Close all connections
     */
    public function closeAll() {
        foreach ($this->connections as $key => $connection) {
            if ($connection instanceof PDO) {
                $connection = null;
            } elseif ($connection instanceof mysqli) {
                $connection->close();
            }
            unset($this->connections[$key]);
        }
    }
    
    // Prevent cloning
    private function __clone() {}
    
    // Prevent unserialization
    public function __wakeup() {
        throw new Exception("Cannot unserialize singleton");
    }
}

// ========================================
// USAGE EXAMPLES
// ========================================

// Example 1: Direct PDO connection
$pdoConn = new PDOConnection();
$pdo = $pdoConn->getConnection();
$stmt = $pdo->query("SELECT VERSION()");
echo "MySQL Version: " . $stmt->fetchColumn() . "\n";

// Example 2: Direct MySQLi connection
$mysqliConn = new MySQLiConnection();
$mysqli = $mysqliConn->getConnection();
$result = $mysqli->query("SELECT VERSION()");
$row = $result->fetch_row();
echo "MySQL Version: " . $row[0] . "\n";

// Example 3: Using Connection Manager
$manager = ConnectionManager::getInstance();
$pdo = $manager->getConnection('default', 'pdo');
$mysqli = $manager->getConnection('default', 'mysqli');

// Example 4: Testing connections
$pdoConn = new PDOConnection();
if ($pdoConn->testConnection()) {
    echo "PDO connection is active\n";
    print_r($pdoConn->getConnectionInfo());
}

$mysqliConn = new MySQLiConnection();
echo "MySQLi connection stats:\n";
print_r($mysqliConn->getStats());</code></pre>
                                </div>
                            </section>

                            <section>
                                <h2>Connection Configuration Best Practices</h2>
                                
                                <div class="best_practice">
                                    <h3>Environment-Based Configuration</h3>
                                    
                                    <pre><code class="language-php">&lt;?php
// ========================================
// CONFIGURATION MANAGEMENT
// ========================================

/**
 * Database configuration class
 */
class DatabaseConfig {
    private $environments = [];
    private $currentEnv;
    
    public function __construct() {
        $this->currentEnv = $_ENV['APP_ENV'] ?? 'development';
        $this->loadConfigurations();
    }
    
    /**
     * Load environment-specific configurations
     */
    private function loadConfigurations() {
        // Development configuration
        $this->environments['development'] = [
            'driver' => 'mysql',
            'host' => 'localhost',
            'port' => 3306,
            'database' => 'dev_database',
            'username' => 'dev_user',
            'password' => 'dev_password',
            'charset' => 'utf8mb4',
            'collation' => 'utf8mb4_unicode_ci',
            'prefix' => 'dev_',
            'strict' => true,
            'engine' => 'InnoDB',
            'options' => [
                PDO::ATTR_ERRMODE => PDO::ERRMODE_EXCEPTION,
                PDO::ATTR_DEFAULT_FETCH_MODE => PDO::FETCH_ASSOC,
                PDO::ATTR_EMULATE_PREPARES => false,
                PDO::ATTR_PERSISTENT => false
            ]
        ];
        
        // Testing configuration
        $this->environments['testing'] = [
            'driver' => 'mysql',
            'host' => 'localhost',
            'port' => 3307,
            'database' => 'test_database',
            'username' => 'test_user',
            'password' => 'test_password',
            'charset' => 'utf8mb4',
            'collation' => 'utf8mb4_unicode_ci',
            'prefix' => 'test_',
            'strict' => true,
            'engine' => 'InnoDB',
            'options' => [
                PDO::ATTR_ERRMODE => PDO::ERRMODE_EXCEPTION,
                PDO::ATTR_DEFAULT_FETCH_MODE => PDO::FETCH_ASSOC
            ]
        ];
        
        // Production configuration
        $this->environments['production'] = [
            'driver' => 'mysql',
            'host' => $_ENV['DB_HOST'],
            'port' => $_ENV['DB_PORT'] ?? 3306,
            'database' => $_ENV['DB_DATABASE'],
            'username' => $_ENV['DB_USERNAME'],
            'password' => $_ENV['DB_PASSWORD'],
            'charset' => 'utf8mb4',
            'collation' => 'utf8mb4_unicode_ci',
            'prefix' => '',
            'strict' => true,
            'engine' => 'InnoDB',
            'options' => [
                PDO::ATTR_ERRMODE => PDO::ERRMODE_EXCEPTION,
                PDO::ATTR_DEFAULT_FETCH_MODE => PDO::FETCH_ASSOC,
                PDO::ATTR_EMULATE_PREPARES => false,
                PDO::ATTR_PERSISTENT => true,
                PDO::ATTR_TIMEOUT => 10,
                PDO::MYSQL_ATTR_USE_BUFFERED_QUERY => true,
                PDO::MYSQL_ATTR_COMPRESS => true
            ],
            'ssl' => [
                'ca' => '/path/to/ca-cert.pem',
                'verify' => true
            ]
        ];
    }
    
    /**
     * Get current environment configuration
     */
    public function getConfig() {
        if (!isset($this->environments[$this->currentEnv])) {
            throw new Exception("Unknown environment: {$this->currentEnv}");
        }
        
        return $this->environments[$this->currentEnv];
    }
    
    /**
     * Get specific configuration value
     */
    public function get($key, $default = null) {
        $config = $this->getConfig();
        return $config[$key] ?? $default;
    }
}

// ========================================
// CONNECTION POOLING
// ========================================

/**
 * Connection pool implementation
 */
class ConnectionPool {
    private $pool = [];
    private $maxConnections = 10;
    private $minConnections = 2;
    private $currentConnections = 0;
    private $config;
    
    public function __construct(DatabaseConfig $config) {
        $this->config = $config->getConfig();
        $this->initializePool();
    }
    
    /**
     * Initialize connection pool
     */
    private function initializePool() {
        // Create minimum connections
        for ($i = 0; $i < $this->minConnections; $i++) {
            $this->createConnection();
        }
    }
    
    /**
     * Create new connection
     */
    private function createConnection() {
        if ($this->currentConnections >= $this->maxConnections) {
            throw new Exception("Maximum connection limit reached");
        }
        
        $dsn = "mysql:host={$this->config['host']};port={$this->config['port']};dbname={$this->config['database']};charset={$this->config['charset']}";
        
        $pdo = new PDO(
            $dsn,
            $this->config['username'],
            $this->config['password'],
            $this->config['options']
        );
        
        $connectionId = uniqid('conn_');
        
        $this->pool[$connectionId] = [
            'connection' => $pdo,
            'in_use' => false,
            'created_at' => time(),
            'last_used' => time()
        ];
        
        $this->currentConnections++;
        
        return $connectionId;
    }
    
    /**
     * Get available connection
     */
    public function getConnection() {
        // Find available connection
        foreach ($this->pool as $id => &$conn) {
            if (!$conn['in_use']) {
                $conn['in_use'] = true;
                $conn['last_used'] = time();
                return $conn['connection'];
            }
        }
        
        // Create new connection if under limit
        if ($this->currentConnections < $this->maxConnections) {
            $id = $this->createConnection();
            $this->pool[$id]['in_use'] = true;
            return $this->pool[$id]['connection'];
        }
        
        // Wait for available connection
        throw new Exception("No available connections in pool");
    }
    
    /**
     * Release connection back to pool
     */
    public function releaseConnection(PDO $connection) {
        foreach ($this->pool as &$conn) {
            if ($conn['connection'] === $connection) {
                $conn['in_use'] = false;
                $conn['last_used'] = time();
                return true;
            }
        }
        
        return false;
    }
    
    /**
     * Clean up idle connections
     */
    public function cleanup($maxIdleTime = 300) {
        $now = time();
        
        foreach ($this->pool as $id => $conn) {
            if (!$conn['in_use'] && 
                ($now - $conn['last_used']) > $maxIdleTime &&
                $this->currentConnections > $this->minConnections) {
                
                unset($this->pool[$id]);
                $this->currentConnections--;
            }
        }
    }
    
    /**
     * Get pool statistics
     */
    public function getStats() {
        $inUse = 0;
        $idle = 0;
        
        foreach ($this->pool as $conn) {
            if ($conn['in_use']) {
                $inUse++;
            } else {
                $idle++;
            }
        }
        
        return [
            'total' => $this->currentConnections,
            'in_use' => $inUse,
            'idle' => $idle,
            'max' => $this->maxConnections,
            'min' => $this->minConnections
        ];
    }
}

// ========================================
// SECURE CONNECTION WITH SSL
// ========================================

/**
 * Secure SSL/TLS connection
 */
class SecureConnection {
    private $pdo;
    
    public function __construct() {
        $this->connectWithSSL();
    }
    
    /**
     * Establish SSL connection
     */
    private function connectWithSSL() {
        $config = [
            'host' => $_ENV['DB_HOST'],
            'dbname' => $_ENV['DB_DATABASE'],
            'username' => $_ENV['DB_USERNAME'],
            'password' => $_ENV['DB_PASSWORD'],
            'charset' => 'utf8mb4'
        ];
        
        $dsn = "mysql:host={$config['host']};dbname={$config['dbname']};charset={$config['charset']}";
        
        $options = [
            PDO::ATTR_ERRMODE => PDO::ERRMODE_EXCEPTION,
            PDO::ATTR_DEFAULT_FETCH_MODE => PDO::FETCH_ASSOC,
            PDO::MYSQL_ATTR_SSL_CA => '/path/to/ca-cert.pem',
            PDO::MYSQL_ATTR_SSL_VERIFY_SERVER_CERT => true,
            PDO::MYSQL_ATTR_SSL_KEY => '/path/to/client-key.pem',
            PDO::MYSQL_ATTR_SSL_CERT => '/path/to/client-cert.pem'
        ];
        
        try {
            $this->pdo = new PDO($dsn, $config['username'], $config['password'], $options);
            
            // Verify SSL is active
            $stmt = $this->pdo->query("SHOW STATUS LIKE 'Ssl_cipher'");
            $result = $stmt->fetch();
            
            if (empty($result['Value'])) {
                throw new Exception("SSL connection not established");
            }
            
            echo "âœ… Secure SSL connection established\n";
            echo "SSL Cipher: " . $result['Value'] . "\n";
            
        } catch (PDOException $e) {
            die("SSL Connection failed: " . $e->getMessage());
        }
    }
    
    public function getConnection() {
        return $this->pdo;
    }
}

// ========================================
// USAGE EXAMPLES
// ========================================

// Example: Using configuration manager
$config = new DatabaseConfig();
$dbConfig = $config->getConfig();

// Example: Connection pooling
$pool = new ConnectionPool($config);
$conn = $pool->getConnection();
// Use connection...
$pool->releaseConnection($conn);
echo "Pool stats: ";
print_r($pool->getStats());

// Example: SSL connection
$secureConn = new SecureConnection();
$pdo = $secureConn->getConnection();</code></pre>
                                </div>
                            </section>
                            
                            <!-- Practice Exercise -->
                            <section>
                                <h2>Practice Exercise</h2>
                                
                                <div class="alert alert-success">
                                    <div class="alert-icon">ðŸ’»</div>
                                    <div class="alert-content">
                                        <div class="alert-title">Connection Challenges</div>
                                        <div class="alert-message">
                                            Complete these connection tasks:
                                            <ol>
                                                <li>Create a connection using environment variables</li>
                                                <li>Implement connection retry logic with exponential backoff</li>
                                                <li>Set up a connection pool with 5 connections</li>
                                                <li>Configure SSL/TLS secure connection</li>
                                                <li>Create a multi-database connection manager</li>
                                                <li>Implement connection health checks</li>
                                                <li>Set up read/write connection splitting</li>
                                                <li>Build connection monitoring system</li>
                                            </ol>
                                        </div>
                                    </div>
                                </div>
                            </section>
                            
                            <!-- Resources -->
                            <section class="resources">
                                <h2>Additional Resources</h2>
                                <ul>
                                    <li><a href="https://www.php.net/manual/en/pdo.connections.php" target="_blank">PDO Connections</a></li>
                                    <li><a href="https://www.php.net/manual/en/mysqli.quickstart.connections.php" target="_blank">MySQLi Connections</a></li>
                                    <li><a href="https://dev.mysql.com/doc/refman/8.0/en/encrypted-connections.html" target="_blank">MySQL SSL/TLS</a></li>
                                    <li><a href="https://www.php.net/manual/en/pdo.setattribute.php" target="_blank">PDO Attributes</a></li>
                                </ul>
                            </section>
                        </div>

                        <!-- Lesson Navigation -->
                        <div class="lesson-navigation">
                            <a href="/03module/error_debugging.html" class="lesson-nav-button prev">
                                <svg width="20" height="20" viewBox="0 0 20 20" fill="currentColor">
                                    <path d="M12.707 5.293a1 1 0 010 1.414L9.414 10l3.293 3.293a1 1 0 01-1.414 1.414l-4-4a1 1 0 010-1.414l4-4a1 1 0 011.414 0z"/>
                                </svg>
                                <span>
                                    <small>Previous Module</small><br>
                                    Error Handling
                                </span>
                            </a>
                            
                            <button class="complete-lesson-btn">
                                Mark as Complete
                            </button>
                            
                            <a href="/03module/pdo_vs_mysqli.html" class="lesson-nav-button next">
                                <span>
                                    <small>Next</small><br>
                                    PDO vs MySQLi
                                </span>
                                <svg width="20" height="20" viewBox="0 0 20 20" fill="currentColor">
                                    <path d="M7.293 14.707a1 1 0 010-1.414L10.586 10 7.293 6.707a1 1 0 011.414-1.414l4 4a1 1 0 010 1.414l-4 4a1 1 0 01-1.414 0z"/>
                                </svg>
                            </a>
                        </div>
                    </article>
                </div>
            </div>
        </main>

        <!-- Footer -->
        <footer class="site-footer" role="contentinfo">
            <div class="footer-container">
                <div class="footer-content">
                    <div class="footer-section footer-about">
                        <h3>PHP WordPress Development</h3>
                        <p>Complete Web Development Course</p>
                    </div>
                    
                    <div class="footer-section">
                        <h4>Quick Links</h4>
                        <ul class="footer-links">
                            <li><a href="/">Home</a></li>
                            <li><a href="/module3.html">Module 3</a></li>
                            <li><a href="/resources.html">Resources</a></li>
                        </ul>
                    </div>
                    
                    <div class="footer-section">
                        <h4>Support</h4>
                        <ul class="footer-links">
                            <li><a href="/help.html">Help Center</a></li>
                            <li><a href="/faq.html">FAQ</a></li>
                            <li><a href="/contact.html">Contact</a></li>
                        </ul>
                    </div>
                </div>
                
                <div class="footer-bottom">
                    <div class="footer-bottom-content">
                        <p class="copyright">&copy; 2025 PHP WordPress Development Course</p>
                        <nav class="footer-bottom-links">
                            <a href="/privacy.html">Privacy</a>
                            <span class="separator">|</span>
                            <a href="/terms.html">Terms</a>
                        </nav>
                    </div>
                </div>
            </div>
        </footer>
    </div>

    <!-- Back to Top -->
    <button id="back-to-top" class="back-to-top" aria-label="Back to top">
        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M12 19V5M12 5l-7 7M12 5l7 7"/>
        </svg>
    </button>

    <!-- JavaScript -->
    <script src="/assets/js/navigation.js"></script>
    <script src="/assets/js/site-config.js"></script>
</body>
</html>