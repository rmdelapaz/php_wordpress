<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    
    <!-- SEO Meta Tags -->
    <title>PHP MySQL Integration - PDO vs MySQLi - PHP WordPress Course</title>
    <meta name="description" content="Master PHP MySQL integration with PDO and MySQLi, prepared statements, security best practices, and connection management">
    <meta name="keywords" content="PHP, MySQL, PDO, MySQLi, prepared statements, SQL injection, database security">
    <meta name="author" content="PHP WordPress Course">
    
    <!-- Favicon -->
    <link rel="icon" type="image/png" href="/favicon.png">
    <link rel="apple-touch-icon" href="/favicon.png">
    
    <!-- CSS -->
    <link rel="stylesheet" href="/assets/css/main.css">
    
    <!-- Mermaid for diagrams -->
    <script type="module">
        import mermaid from 'https://cdn.jsdelivr.net/npm/mermaid@10/dist/mermaid.esm.min.mjs';
        mermaid.initialize({ startOnLoad: true });
    </script>
</head>
<body>
    <!-- Skip to main content -->
    <a href="#main-content" class="sr-only">Skip to main content</a>
    
    <div class="page-wrapper">
        <!-- Header -->
        <header class="site-header" role="banner">
            <div class="header-container">
                <div class="site-branding">
                    <a href="/" class="site-logo">
                        <h1 class="site-title">PHP WordPress Development</h1>
                    </a>
                </div>
                
                <nav class="main-navigation" role="navigation" aria-label="Main navigation">
                    <button class="mobile-menu-btn" aria-label="Toggle navigation" aria-expanded="false">
                        <span></span>
                        <span></span>
                        <span></span>
                    </button>
                    
                    <div class="nav-menu">
                        <ul class="nav-list">
                            <li class="nav-item"><a href="/" class="nav-link">Home</a></li>
                            <li class="nav-item dropdown">
                                <button class="nav-link dropdown-toggle active" aria-haspopup="true">Modules</button>
                                <div class="dropdown-menu">
                                    <a href="/module1.html" class="dropdown-item">Module 1: Web Fundamentals</a>
                                    <a href="/module2.html" class="dropdown-item">Module 2: PHP Fundamentals</a>
                                    <a href="/module3.html" class="dropdown-item active">Module 3: MySQL Database</a>
                                    <a href="/module4.html" class="dropdown-item">Module 4: WordPress & Docker</a>
                                    <a href="/module5.html" class="dropdown-item">Module 5: Theme Development</a>
                                    <a href="/module6.html" class="dropdown-item">Module 6: Plugin Development</a>
                                    <a href="/module7.html" class="dropdown-item">Module 7: Advanced WordPress</a>
                                    <a href="/module8.html" class="dropdown-item">Module 8: Deployment</a>
                                    <a href="/module9.html" class="dropdown-item">Module 9: Final Project</a>
                                </div>
                            </li>
                            <li class="nav-item"><a href="/resources.html" class="nav-link">Resources</a></li>
                            <li class="nav-item"><a href="/about.html" class="nav-link">About</a></li>
                        </ul>
                    </div>
                </nav>
                
                <div class="search-container">
                    <div class="search-input-wrapper">
                        <svg class="search-icon" width="20" height="20" viewBox="0 0 20 20" fill="currentColor">
                            <path fill-rule="evenodd" d="M8 4a4 4 0 100 8 4 4 0 000-8zM2 8a6 6 0 1110.89 3.476l4.817 4.817a1 1 0 01-1.414 1.414l-4.816-4.816A6 6 0 012 8z" clip-rule="evenodd" />
                        </svg>
                        <input type="search" class="search-input" placeholder="Search lessons..." aria-label="Search">
                    </div>
                    <div class="search-results"></div>
                </div>
            </div>
        </header>
        
        <!-- Progress Bar -->
        <div class="progress-container">
            <div class="progress-header">
                <h2 class="progress-title">Course Progress</h2>
                <span class="progress-text">Loading...</span>
            </div>
            <div class="progress-bar">
                <div class="progress-bar-fill">
                    <span class="progress-bar-text"></span>
                </div>
            </div>
        </div>
        
        <!-- Breadcrumb -->
        <nav class="breadcrumb container" aria-label="Breadcrumb">
            <ol class="breadcrumb-list">
                <li class="breadcrumb-item">
                    <a href="/">Home</a>
                    <span class="breadcrumb-separator">/</span>
                </li>
                <li class="breadcrumb-item">
                    <a href="/module3.html">Module 3</a>
                    <span class="breadcrumb-separator">/</span>
                </li>
                <li class="breadcrumb-item">
                    <span aria-current="page">PHP MySQL Integration</span>
                </li>
            </ol>
        </nav>
        
        <!-- Main Content -->
        <main id="main-content" class="main-content" role="main">
            <div class="container">
                <div class="content-with-sidebar">
                    <!-- Sidebar -->
                    <aside class="sidebar">
                        <div class="sidebar-nav">
                            <h3 class="sidebar-title">Module 3: Session 5</h3>
                            <div class="sidebar-section">
                                <h4 class="sidebar-section-title">PHP Integration</h4>
                                <a href="/module3.html" class="sidebar-link">Module Overview</a>
                                <a href="/03module/php_mysql_integration.html" class="sidebar-link active">PHP MySQL Integration</a>
                                <a href="/03module/pdo_basics.html" class="sidebar-link">PDO Basics</a>
                                <a href="/03module/mysqli_basics.html" class="sidebar-link">MySQLi Basics</a>
                                <a href="/03module/prepared_statements.html" class="sidebar-link">Prepared Statements</a>
                                <a href="/03module/security_best_practices.html" class="sidebar-link">Security Practices</a>
                                <a href="/03module/homework_final.html" class="sidebar-link">Final Homework</a>
                            </div>
                        </div>
                    </aside>
                    
                    <!-- Main Lesson Content -->
                    <article class="lesson-content">
                        <header class="lesson-header">
                            <h1>PHP and MySQL Integration</h1>
                            <div class="lesson-meta">
                                <div class="lesson-meta-item">
                                    <svg width="20" height="20" fill="currentColor">
                                        <path d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"/>
                                    </svg>
                                    <span>Duration: 95 minutes</span>
                                </div>
                                <div class="lesson-meta-item">
                                    <svg width="20" height="20" fill="currentColor">
                                        <path d="M12 14l9-5-9-5-9 5 9 5z"/>
                                    </svg>
                                    <span>Module 3: Session 5</span>
                                </div>
                            </div>
                        </header>

                        <!-- Learning Objectives -->
                        <div class="lesson-objectives">
                            <h2>Learning Objectives</h2>
                            <ul>
                                <li>Understand PDO vs MySQLi differences and use cases</li>
                                <li>Establish secure database connections</li>
                                <li>Execute queries safely with prepared statements</li>
                                <li>Handle database errors and exceptions</li>
                                <li>Implement transaction management in PHP</li>
                                <li>Prevent SQL injection attacks</li>
                                <li>Manage connection pooling and performance</li>
                                <li>Build database abstraction layers</li>
                            </ul>
                        </div>
                        
                        <!-- Lesson Body -->
                        <div class="lesson-body">
                            <section>
                                <h2>PDO vs MySQLi Comparison</h2>
                                <p class="lead">PHP offers two main ways to connect to MySQL: PDO (PHP Data Objects) and MySQLi. Let's understand their differences! üîå</p>
                                
                                <canvas id="comparisonCanvas" width="600" height="450"></canvas>
                                <script>
                                    const ctx = document.getElementById('comparisonCanvas').getContext('2d');
                                    
                                    // Title
                                    ctx.font = 'bold 18px Arial';
                                    ctx.fillStyle = '#1f2937';
                                    ctx.fillText('PDO vs MySQLi Comparison', 180, 30);
                                    
                                    // PDO box
                                    ctx.fillStyle = '#dbeafe';
                                    ctx.fillRect(50, 60, 250, 200);
                                    ctx.strokeStyle = '#2563eb';
                                    ctx.lineWidth = 2;
                                    ctx.strokeRect(50, 60, 250, 200);
                                    
                                    ctx.fillStyle = '#1e40af';
                                    ctx.font = 'bold 14px Arial';
                                    ctx.fillText('PDO', 160, 85);
                                    ctx.fillText('(PHP Data Objects)', 105, 100);
                                    
                                    ctx.fillStyle = '#059669';
                                    ctx.font = '11px Arial';
                                    ctx.fillText('‚úì Multiple databases', 60, 125);
                                    ctx.fillText('‚úì Named parameters', 60, 145);
                                    ctx.fillText('‚úì Object-oriented only', 60, 165);
                                    ctx.fillText('‚úì Better error handling', 60, 185);
                                    ctx.fillText('‚úì Prepared statements', 60, 205);
                                    ctx.fillText('‚úì Fetch into objects', 60, 225);
                                    ctx.fillStyle = '#dc2626';
                                    ctx.fillText('‚úó Slightly slower', 60, 245);
                                    
                                    // MySQLi box
                                    ctx.fillStyle = '#dcfce7';
                                    ctx.fillRect(320, 60, 250, 200);
                                    ctx.strokeStyle = '#16a34a';
                                    ctx.strokeRect(320, 60, 250, 200);
                                    
                                    ctx.fillStyle = '#166534';
                                    ctx.font = 'bold 14px Arial';
                                    ctx.fillText('MySQLi', 415, 85);
                                    ctx.fillText('(MySQL Improved)', 375, 100);
                                    
                                    ctx.fillStyle = '#059669';
                                    ctx.font = '11px Arial';
                                    ctx.fillText('‚úì MySQL specific', 330, 125);
                                    ctx.fillText('‚úì Slightly faster', 330, 145);
                                    ctx.fillText('‚úì Procedural & OOP', 330, 165);
                                    ctx.fillText('‚úì Async queries', 330, 185);
                                    ctx.fillText('‚úì Prepared statements', 330, 205);
                                    ctx.fillText('‚úì Store procedures', 330, 225);
                                    ctx.fillStyle = '#dc2626';
                                    ctx.fillText('‚úó MySQL only', 330, 245);
                                    
                                    // Recommendation box
                                    ctx.fillStyle = '#fef3c7';
                                    ctx.fillRect(50, 280, 520, 150);
                                    ctx.strokeStyle = '#ca8a04';
                                    ctx.strokeRect(50, 280, 520, 150);
                                    
                                    ctx.fillStyle = '#92400e';
                                    ctx.font = 'bold 14px Arial';
                                    ctx.fillText('Recommendations', 250, 305);
                                    
                                    ctx.fillStyle = '#374151';
                                    ctx.font = '11px Arial';
                                    
                                    ctx.fillText('Use PDO when:', 60, 330);
                                    ctx.fillText('‚Ä¢ You might switch databases', 60, 345);
                                    ctx.fillText('‚Ä¢ You prefer consistent API', 60, 360);
                                    ctx.fillText('‚Ä¢ Working with multiple databases', 60, 375);
                                    ctx.fillText('‚Ä¢ Building portable applications', 60, 390);
                                    
                                    ctx.fillText('Use MySQLi when:', 330, 330);
                                    ctx.fillText('‚Ä¢ MySQL-specific features needed', 330, 345);
                                    ctx.fillText('‚Ä¢ Performance is critical', 330, 360);
                                    ctx.fillText('‚Ä¢ Legacy code compatibility', 330, 375);
                                    ctx.fillText('‚Ä¢ Async operations required', 330, 390);
                                    
                                    ctx.fillStyle = '#dc2626';
                                    ctx.font = 'bold 12px Arial';
                                    ctx.fillText('‚ö†Ô∏è Never use deprecated mysql_* functions!', 150, 415);
                                </script>
                                
                                <div class="alert alert-info">
                                    <div class="alert-icon">üí°</div>
                                    <div class="alert-content">
                                        <div class="alert-title">Quick Decision Guide</div>
                                        <div class="alert-message">
                                            <ul>
                                                <li><strong>PDO:</strong> Better for new projects, portable code, multiple databases</li>
                                                <li><strong>MySQLi:</strong> Better for MySQL-specific features, slight performance edge</li>
                                                <li>Both support prepared statements (essential for security)</li>
                                                <li>WordPress uses its own $wpdb abstraction (based on MySQLi)</li>
                                            </ul>
                                        </div>
                                    </div>
                                </div>
                            </section>

                            <section>
                                <h2>PDO Connection and Basic Operations</h2>
                                
                                <div class="mermaid">
                                    graph TB
                                        CONNECT[Connect to DB] --> PREPARE[Prepare Statement]
                                        PREPARE --> BIND[Bind Parameters]
                                        BIND --> EXECUTE[Execute Query]
                                        EXECUTE --> FETCH[Fetch Results]
                                        FETCH --> CLOSE[Close Connection]
                                        
                                        EXECUTE --> ERROR[Handle Errors]
                                        ERROR --> LOG[Log Error]
                                        
                                        style CONNECT fill:#dcfce7
                                        style PREPARE fill:#dbeafe
                                        style EXECUTE fill:#fef3c7
                                        style ERROR fill:#fee2e2
                                </div>
                                
                                <div class="real_world_example">
                                    <h3>PDO Examples</h3>
                                    
                                    <pre><code class="language-php">&lt;?php
// ========================================
// PDO CONNECTION
// ========================================

// Configuration
$config = [
    'host' => 'localhost',
    'dbname' => 'myapp',
    'username' => 'dbuser',
    'password' => 'securepass123',
    'charset' => 'utf8mb4'
];

try {
    // Create connection
    $dsn = "mysql:host={$config['host']};dbname={$config['dbname']};charset={$config['charset']}";
    
    $options = [
        PDO::ATTR_ERRMODE => PDO::ERRMODE_EXCEPTION,
        PDO::ATTR_DEFAULT_FETCH_MODE => PDO::FETCH_ASSOC,
        PDO::ATTR_EMULATE_PREPARES => false,
    ];
    
    $pdo = new PDO($dsn, $config['username'], $config['password'], $options);
    
} catch (PDOException $e) {
    // Log error (don't expose details to users)
    error_log("Connection failed: " . $e->getMessage());
    die("Database connection error");
}

// ========================================
// SELECT QUERY WITH PREPARED STATEMENTS
// ========================================

try {
    // Prepare statement with named parameters
    $sql = "SELECT * FROM users WHERE email = :email AND status = :status";
    $stmt = $pdo->prepare($sql);
    
    // Bind and execute
    $stmt->execute([
        ':email' => 'user@example.com',
        ':status' => 'active'
    ]);
    
    // Fetch single row
    $user = $stmt->fetch();
    
    // Or fetch all rows
    $users = $stmt->fetchAll();
    
    // Fetch column
    $sql = "SELECT COUNT(*) FROM users WHERE status = :status";
    $stmt = $pdo->prepare($sql);
    $stmt->execute([':status' => 'active']);
    $count = $stmt->fetchColumn();
    
} catch (PDOException $e) {
    error_log("Query failed: " . $e->getMessage());
}

// ========================================
// INSERT WITH PREPARED STATEMENTS
// ========================================

try {
    $sql = "INSERT INTO users (username, email, password_hash, created_at) 
            VALUES (:username, :email, :password, NOW())";
    
    $stmt = $pdo->prepare($sql);
    
    $result = $stmt->execute([
        ':username' => 'johndoe',
        ':email' => 'john@example.com',
        ':password' => password_hash('secret123', PASSWORD_DEFAULT)
    ]);
    
    if ($result) {
        $userId = $pdo->lastInsertId();
        echo "User created with ID: " . $userId;
    }
    
} catch (PDOException $e) {
    error_log("Insert failed: " . $e->getMessage());
}

// ========================================
// UPDATE WITH PREPARED STATEMENTS
// ========================================

try {
    $sql = "UPDATE users 
            SET last_login = NOW(), login_count = login_count + 1 
            WHERE id = :id";
    
    $stmt = $pdo->prepare($sql);
    $stmt->execute([':id' => $userId]);
    
    $affectedRows = $stmt->rowCount();
    echo "Updated $affectedRows rows";
    
} catch (PDOException $e) {
    error_log("Update failed: " . $e->getMessage());
}

// ========================================
// TRANSACTIONS
// ========================================

try {
    $pdo->beginTransaction();
    
    // Debit account
    $stmt = $pdo->prepare("UPDATE accounts SET balance = balance - :amount WHERE id = :id");
    $stmt->execute([':amount' => 100, ':id' => 1]);
    
    // Credit account
    $stmt = $pdo->prepare("UPDATE accounts SET balance = balance + :amount WHERE id = :id");
    $stmt->execute([':amount' => 100, ':id' => 2]);
    
    // Log transaction
    $stmt = $pdo->prepare("INSERT INTO transactions (from_id, to_id, amount) VALUES (?, ?, ?)");
    $stmt->execute([1, 2, 100]);
    
    $pdo->commit();
    echo "Transaction successful";
    
} catch (Exception $e) {
    $pdo->rollBack();
    error_log("Transaction failed: " . $e->getMessage());
}

// ========================================
// FETCH MODES
// ========================================

// Fetch as object
$stmt = $pdo->prepare("SELECT * FROM users WHERE id = ?");
$stmt->execute([$userId]);
$user = $stmt->fetch(PDO::FETCH_OBJ);
echo $user->email;  // Object property access

// Fetch into class
class User {
    public $id;
    public $username;
    public $email;
}

$stmt->setFetchMode(PDO::FETCH_CLASS, 'User');
$user = $stmt->fetch();

// Fetch key-value pairs
$sql = "SELECT id, username FROM users";
$users = $pdo->query($sql)->fetchAll(PDO::FETCH_KEY_PAIR);</code></pre>
                                </div>
                            </section>

                            <section>
                                <h2>MySQLi Connection and Operations</h2>
                                
                                <div class="best_practice">
                                    <h3>MySQLi Examples</h3>
                                    
                                    <pre><code class="language-php">&lt;?php
// ========================================
// MYSQLI CONNECTION (OBJECT-ORIENTED)
// ========================================

$mysqli = new mysqli('localhost', 'username', 'password', 'database');

// Check connection
if ($mysqli->connect_error) {
    die("Connection failed: " . $mysqli->connect_error);
}

// Set charset
$mysqli->set_charset("utf8mb4");

// ========================================
// MYSQLI PREPARED STATEMENTS
// ========================================

// SELECT query
$sql = "SELECT id, username, email FROM users WHERE status = ? AND role = ?";
$stmt = $mysqli->prepare($sql);

if ($stmt) {
    // Bind parameters (s = string, i = integer, d = double, b = blob)
    $status = 'active';
    $role = 'admin';
    $stmt->bind_param("ss", $status, $role);
    
    // Execute
    $stmt->execute();
    
    // Bind result variables
    $stmt->bind_result($id, $username, $email);
    
    // Fetch results
    while ($stmt->fetch()) {
        echo "User: $username ($email)\n";
    }
    
    $stmt->close();
}

// ========================================
// INSERT WITH MYSQLI
// ========================================

$sql = "INSERT INTO users (username, email, password_hash) VALUES (?, ?, ?)";
$stmt = $mysqli->prepare($sql);

if ($stmt) {
    $username = 'johndoe';
    $email = 'john@example.com';
    $password = password_hash('secret123', PASSWORD_DEFAULT);
    
    $stmt->bind_param("sss", $username, $email, $password);
    
    if ($stmt->execute()) {
        $userId = $mysqli->insert_id;
        echo "User created with ID: " . $userId;
    } else {
        echo "Error: " . $stmt->error;
    }
    
    $stmt->close();
}

// ========================================
// MYSQLI TRANSACTIONS
// ========================================

// Start transaction
$mysqli->autocommit(FALSE);

try {
    // Multiple queries
    $mysqli->query("UPDATE accounts SET balance = balance - 100 WHERE id = 1");
    $mysqli->query("UPDATE accounts SET balance = balance + 100 WHERE id = 2");
    
    // Check for errors
    if ($mysqli->error) {
        throw new Exception($mysqli->error);
    }
    
    // Commit transaction
    $mysqli->commit();
    echo "Transaction successful";
    
} catch (Exception $e) {
    // Rollback on error
    $mysqli->rollback();
    echo "Transaction failed: " . $e->getMessage();
}

// Reset autocommit
$mysqli->autocommit(TRUE);

// ========================================
// PROCEDURAL STYLE
// ========================================

$connection = mysqli_connect('localhost', 'username', 'password', 'database');

if (!$connection) {
    die("Connection failed: " . mysqli_connect_error());
}

// Query
$result = mysqli_query($connection, "SELECT * FROM users");

// Fetch results
while ($row = mysqli_fetch_assoc($result)) {
    echo $row['username'] . "\n";
}

// Free result
mysqli_free_result($result);

// Close connection
mysqli_close($connection);

// ========================================
// CALLING STORED PROCEDURES
// ========================================

// Call procedure with OUT parameters
$stmt = $mysqli->prepare("CALL GetUserStats(?, @total_orders, @total_spent)");
$userId = 123;
$stmt->bind_param("i", $userId);
$stmt->execute();

// Get OUT parameters
$result = $mysqli->query("SELECT @total_orders, @total_spent");
$row = $result->fetch_row();
echo "Orders: {$row[0]}, Spent: {$row[1]}";

// ========================================
// MULTI-QUERY
// ========================================

$sql = "SELECT * FROM users; SELECT * FROM orders";

if ($mysqli->multi_query($sql)) {
    do {
        // Process result set
        if ($result = $mysqli->store_result()) {
            while ($row = $result->fetch_assoc()) {
                // Process row
            }
            $result->free();
        }
    } while ($mysqli->next_result());
}</code></pre>
                                </div>
                            </section>

                            <section>
                                <h2>Security Best Practices</h2>
                                
                                <canvas id="securityCanvas" width="600" height="400"></canvas>
                                <script>
                                    const sCtx = document.getElementById('securityCanvas').getContext('2d');
                                    
                                    // Title
                                    sCtx.font = 'bold 16px Arial';
                                    sCtx.fillStyle = '#1f2937';
                                    sCtx.fillText('SQL Injection Prevention', 220, 30);
                                    
                                    // Bad practice
                                    sCtx.fillStyle = '#fee2e2';
                                    sCtx.fillRect(50, 60, 250, 120);
                                    sCtx.strokeStyle = '#dc2626';
                                    sCtx.lineWidth = 2;
                                    sCtx.strokeRect(50, 60, 250, 120);
                                    
                                    sCtx.fillStyle = '#991b1b';
                                    sCtx.font = 'bold 12px Arial';
                                    sCtx.fillText('‚ùå NEVER DO THIS', 120, 80);
                                    
                                    sCtx.fillStyle = '#374151';
                                    sCtx.font = '10px Courier';
                                    sCtx.fillText('$id = $_GET["id"];', 60, 105);
                                    sCtx.fillText('$sql = "SELECT * FROM users', 60, 120);
                                    sCtx.fillText('        WHERE id = $id";', 60, 135);
                                    sCtx.fillText('// SQL Injection vulnerable!', 60, 155);
                                    
                                    // Good practice
                                    sCtx.fillStyle = '#dcfce7';
                                    sCtx.fillRect(320, 60, 250, 120);
                                    sCtx.strokeStyle = '#16a34a';
                                    sCtx.strokeRect(320, 60, 250, 120);
                                    
                                    sCtx.fillStyle = '#166534';
                                    sCtx.font = 'bold 12px Arial';
                                    sCtx.fillText('‚úÖ ALWAYS DO THIS', 380, 80);
                                    
                                    sCtx.fillStyle = '#374151';
                                    sCtx.font = '10px Courier';
                                    sCtx.fillText('$stmt = $pdo->prepare(', 330, 105);
                                    sCtx.fillText('  "SELECT * FROM users', 330, 120);
                                    sCtx.fillText('   WHERE id = :id");', 330, 135);
                                    sCtx.fillText('$stmt->execute(["id" => $id]);', 330, 155);
                                    
                                    // Security checklist
                                    sCtx.fillStyle = '#fef3c7';
                                    sCtx.fillRect(50, 200, 520, 180);
                                    sCtx.strokeStyle = '#ca8a04';
                                    sCtx.strokeRect(50, 200, 520, 180);
                                    
                                    sCtx.fillStyle = '#92400e';
                                    sCtx.font = 'bold 12px Arial';
                                    sCtx.fillText('Security Checklist', 250, 220);
                                    
                                    sCtx.fillStyle = '#374151';
                                    sCtx.font = '11px Arial';
                                    
                                    const checklist = [
                                        '‚úì Always use prepared statements',
                                        '‚úì Never concatenate user input into queries',
                                        '‚úì Validate and sanitize all input',
                                        '‚úì Use least privilege database users',
                                        '‚úì Store passwords hashed (password_hash())',
                                        '‚úì Use HTTPS for sensitive data',
                                        '‚úì Implement rate limiting',
                                        '‚úì Log suspicious activities',
                                        '‚úì Keep software updated',
                                        '‚úì Use parameterized stored procedures'
                                    ];
                                    
                                    checklist.forEach((item, i) => {
                                        const x = i < 5 ? 60 : 320;
                                        const y = 245 + ((i % 5) * 20);
                                        sCtx.fillText(item, x, y);
                                    });
                                </script>
                                
                                <div class="homework">
                                    <h3>Security Implementation</h3>
                                    
                                    <pre><code class="language-php">&lt;?php
// ========================================
// INPUT VALIDATION AND SANITIZATION
// ========================================

class DatabaseSecurity {
    private $pdo;
    
    public function __construct(PDO $pdo) {
        $this->pdo = $pdo;
    }
    
    /**
     * Safe user authentication
     */
    public function authenticateUser($email, $password) {
        // Validate email
        if (!filter_var($email, FILTER_VALIDATE_EMAIL)) {
            return false;
        }
        
        // Prepare statement
        $stmt = $this->pdo->prepare(
            "SELECT id, username, password_hash 
             FROM users 
             WHERE email = :email 
             AND status = 'active'
             LIMIT 1"
        );
        
        $stmt->execute([':email' => $email]);
        $user = $stmt->fetch();
        
        // Verify password
        if ($user && password_verify($password, $user['password_hash'])) {
            // Update last login
            $this->updateLastLogin($user['id']);
            
            // Return user data (exclude password)
            unset($user['password_hash']);
            return $user;
        }
        
        // Log failed attempt
        $this->logFailedLogin($email);
        return false;
    }
    
    /**
     * Prevent SQL injection in dynamic queries
     */
    public function safeSearch($searchTerm, $category = null) {
        // Base query
        $sql = "SELECT * FROM products WHERE 1=1";
        $params = [];
        
        // Add search condition
        if (!empty($searchTerm)) {
            // Sanitize for LIKE query
            $searchTerm = str_replace(['%', '_'], ['\%', '\_'], $searchTerm);
            $sql .= " AND (name LIKE :search OR description LIKE :search)";
            $params[':search'] = "%{$searchTerm}%";
        }
        
        // Add category filter
        if ($category !== null) {
            // Validate category is integer
            if (!is_numeric($category)) {
                throw new InvalidArgumentException("Invalid category");
            }
            $sql .= " AND category_id = :category";
            $params[':category'] = (int)$category;
        }
        
        // Execute safely
        $stmt = $this->pdo->prepare($sql);
        $stmt->execute($params);
        
        return $stmt->fetchAll();
    }
    
    /**
     * Safe dynamic ORDER BY
     */
    public function getUsers($orderBy = 'id', $direction = 'ASC') {
        // Whitelist allowed columns
        $allowedColumns = ['id', 'username', 'email', 'created_at'];
        $allowedDirections = ['ASC', 'DESC'];
        
        // Validate input
        if (!in_array($orderBy, $allowedColumns)) {
            $orderBy = 'id';
        }
        
        if (!in_array(strtoupper($direction), $allowedDirections)) {
            $direction = 'ASC';
        }
        
        // Safe to use now (not from user input directly)
        $sql = "SELECT * FROM users ORDER BY {$orderBy} {$direction}";
        
        return $this->pdo->query($sql)->fetchAll();
    }
    
    /**
     * Prevent mass assignment
     */
    public function updateUser($userId, array $data) {
        // Whitelist allowed fields
        $allowedFields = ['username', 'email', 'phone'];
        
        // Filter data
        $filtered = array_intersect_key(
            $data,
            array_flip($allowedFields)
        );
        
        // Build UPDATE query
        $fields = [];
        foreach ($filtered as $key => $value) {
            $fields[] = "{$key} = :{$key}";
        }
        
        if (empty($fields)) {
            return false;
        }
        
        $sql = "UPDATE users SET " . implode(', ', $fields) . 
               " WHERE id = :id";
        
        $filtered['id'] = $userId;
        
        $stmt = $this->pdo->prepare($sql);
        return $stmt->execute($filtered);
    }
    
    /**
     * Rate limiting
     */
    private function checkRateLimit($identifier) {
        $stmt = $this->pdo->prepare(
            "SELECT COUNT(*) FROM login_attempts 
             WHERE ip_address = :ip 
             AND attempted_at > DATE_SUB(NOW(), INTERVAL 15 MINUTE)"
        );
        
        $stmt->execute([':ip' => $identifier]);
        $attempts = $stmt->fetchColumn();
        
        if ($attempts > 5) {
            throw new Exception("Too many attempts. Please try later.");
        }
    }
    
    /**
     * Log security events
     */
    private function logSecurityEvent($event, $details) {
        $stmt = $this->pdo->prepare(
            "INSERT INTO security_log (event_type, details, ip_address, created_at)
             VALUES (:event, :details, :ip, NOW())"
        );
        
        $stmt->execute([
            ':event' => $event,
            ':details' => json_encode($details),
            ':ip' => $_SERVER['REMOTE_ADDR'] ?? 'unknown'
        ]);
    }
}

// ========================================
// CONNECTION SECURITY
// ========================================

// Store credentials outside web root
// config/database.php (above public_html)
return [
    'host' => getenv('DB_HOST'),
    'dbname' => getenv('DB_NAME'),
    'username' => getenv('DB_USER'),
    'password' => getenv('DB_PASS'),
    'options' => [
        PDO::ATTR_ERRMODE => PDO::ERRMODE_EXCEPTION,
        PDO::ATTR_DEFAULT_FETCH_MODE => PDO::FETCH_ASSOC,
        PDO::ATTR_EMULATE_PREPARES => false,
        PDO::MYSQL_ATTR_SSL_CA => '/path/to/ca-cert.pem',
    ]
];

// ========================================
// ERROR HANDLING
// ========================================

class DatabaseConnection {
    private static $instance = null;
    private $pdo;
    
    private function __construct() {
        try {
            $config = require '../config/database.php';
            
            $dsn = "mysql:host={$config['host']};dbname={$config['dbname']};charset=utf8mb4";
            
            $this->pdo = new PDO(
                $dsn,
                $config['username'],
                $config['password'],
                $config['options']
            );
            
        } catch (PDOException $e) {
            // Log error, don't expose details
            error_log("Database connection failed: " . $e->getMessage());
            
            // Show user-friendly error
            if (PHP_SAPI === 'cli') {
                die("Database connection error\n");
            } else {
                http_response_code(500);
                include '../templates/error-500.php';
                exit;
            }
        }
    }
    
    public static function getInstance() {
        if (self::$instance === null) {
            self::$instance = new self();
        }
        return self::$instance->pdo;
    }
    
    // Prevent cloning
    private function __clone() {}
    
    // Prevent unserialization
    public function __wakeup() {
        throw new Exception("Cannot unserialize singleton");
    }
}</code></pre>
                                </div>
                            </section>
                            
                            <!-- Practice Exercise -->
                            <section>
                                <h2>Practice Exercise</h2>
                                
                                <div class="alert alert-success">
                                    <div class="alert-icon">üíª</div>
                                    <div class="alert-content">
                                        <div class="alert-title">PHP MySQL Integration Challenges</div>
                                        <div class="alert-message">
                                            Build these PHP applications:
                                            <ol>
                                                <li>Create a secure user registration and login system</li>
                                                <li>Build a CRUD application with PDO</li>
                                                <li>Implement a shopping cart with transactions</li>
                                                <li>Create a search system with pagination</li>
                                                <li>Build an admin panel with role-based access</li>
                                                <li>Implement database backup and restore</li>
                                                <li>Create an API with database integration</li>
                                                <li>Build a database migration system</li>
                                            </ol>
                                        </div>
                                    </div>
                                </div>
                            </section>
                            
                            <!-- Resources -->
                            <section class="resources">
                                <h2>Additional Resources</h2>
                                <ul>
                                    <li><a href="https://www.php.net/manual/en/book.pdo.php" target="_blank">PHP PDO Documentation</a></li>
                                    <li><a href="https://www.php.net/manual/en/book.mysqli.php" target="_blank">PHP MySQLi Documentation</a></li>
                                    <li><a href="https://phpdelusions.net/pdo" target="_blank">PDO Tutorial</a></li>
                                    <li><a href="https://owasp.org/www-community/attacks/SQL_Injection" target="_blank">OWASP SQL Injection</a></li>
                                </ul>
                            </section>
                        </div>

                        <!-- Lesson Navigation -->
                        <div class="lesson-navigation">
                            <a href="/03module/stored_procedures.html" class="lesson-nav-button prev">
                                <svg width="20" height="20" viewBox="0 0 20 20" fill="currentColor">
                                    <path d="M12.707 5.293a1 1 0 010 1.414L9.414 10l3.293 3.293a1 1 0 01-1.414 1.414l-4-4a1 1 0 010-1.414l4-4a1 1 0 011.414 0z"/>
                                </svg>
                                <span>
                                    <small>Previous</small><br>
                                    Stored Procedures
                                </span>
                            </a>
                            
                            <button class="complete-lesson-btn">
                                Mark as Complete
                            </button>
                            
                            <a href="/module4.html" class="lesson-nav-button next">
                                <span>
                                    <small>Next Module</small><br>
                                    WordPress & Docker
                                </span>
                                <svg width="20" height="20" viewBox="0 0 20 20" fill="currentColor">
                                    <path d="M7.293 14.707a1 1 0 010-1.414L10.586 10 7.293 6.707a1 1 0 011.414-1.414l4 4a1 1 0 010 1.414l-4 4a1 1 0 01-1.414 0z"/>
                                </svg>
                            </a>
                        </div>
                    </article>
                </div>
            </div>
        </main>

        <!-- Footer -->
        <footer class="site-footer" role="contentinfo">
            <div class="footer-container">
                <div class="footer-content">
                    <div class="footer-section footer-about">
                        <h3>PHP WordPress Development</h3>
                        <p>Complete Web Development Course</p>
                    </div>
                    
                    <div class="footer-section">
                        <h4>Quick Links</h4>
                        <ul class="footer-links">
                            <li><a href="/">Home</a></li>
                            <li><a href="/module3.html">Module 3</a></li>
                            <li><a href="/resources.html">Resources</a></li>
                        </ul>
                    </div>
                    
                    <div class="footer-section">
                        <h4>Support</h4>
                        <ul class="footer-links">
                            <li><a href="/help.html">Help Center</a></li>
                            <li><a href="/faq.html">FAQ</a></li>
                            <li><a href="/contact.html">Contact</a></li>
                        </ul>
                    </div>
                </div>
                
                <div class="footer-bottom">
                    <div class="footer-bottom-content">
                        <p class="copyright">&copy; 2025 PHP WordPress Development Course</p>
                        <nav class="footer-bottom-links">
                            <a href="/privacy.html">Privacy</a>
                            <span class="separator">|</span>
                            <a href="/terms.html">Terms</a>
                        </nav>
                    </div>
                </div>
            </div>
        </footer>
    </div>

    <!-- Back to Top -->
    <button id="back-to-top" class="back-to-top" aria-label="Back to top">
        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M12 19V5M12 5l-7 7M12 5l7 7"/>
        </svg>
    </button>

    <!-- JavaScript -->
    <script src="/assets/js/navigation.js"></script>
    <script src="/assets/js/site-config.js"></script>
</body>
</html>