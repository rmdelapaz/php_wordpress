<!DOCTYPE html>

<html lang="en">
<head>
<meta charset="utf-8"/>
<meta content="width=device-width, initial-scale=1.0" name="viewport"/>
<meta content="ie=edge" http-equiv="X-UA-Compatible"/>
<!-- SEO Meta Tags -->
<title>GROUP BY - Master Data Grouping and Analysis - PHP WordPress Course</title>
<meta content="Master SQL GROUP BY for data segmentation, analysis with HAVING, ROLLUP, and complex grouping patterns" name="description"/>
<meta content="PHP, WordPress, MySQL, GROUP BY, HAVING, data grouping, aggregation, ROLLUP" name="keywords"/>
<meta content="PHP WordPress Course" name="author"/>
<!-- Favicon -->
<link href="/favicon.png" rel="icon" type="image/png"/>
<link href="/favicon.png" rel="apple-touch-icon"/>
<!-- CSS -->
<link href="/assets/css/main.css" rel="stylesheet"/><link href="/assets/css/sidebar-enhanced.css" rel="stylesheet"/><link href="/assets/css/sidebar-toggle.css" rel="stylesheet"/>
</head>
<body>
<!-- Skip to main content -->
<a class="sr-only" href="#main-content">Skip to main content</a>
<div class="page-wrapper">
<!-- Header -->
<header class="site-header" role="banner">
<div class="header-container">
<div class="site-branding">
<a class="site-logo" href="/">
<h1 class="site-title">PHP WordPress Development</h1>
</a>
</div>
<nav aria-label="Main navigation" class="main-navigation" role="navigation">
<button aria-expanded="false" aria-label="Toggle navigation" class="mobile-menu-btn">
<span></span>
<span></span>
<span></span>
</button>
<div class="nav-menu">
<ul class="nav-list">
<li class="nav-item"><a class="nav-link" href="/">Home</a></li>
<li class="nav-item dropdown">
<button aria-haspopup="true" class="nav-link dropdown-toggle active">Modules</button>
<div class="dropdown-menu">
<a class="dropdown-item" href="/module1.html">Module 1: Web Fundamentals</a>
<a class="dropdown-item" href="/module2.html">Module 2: PHP Fundamentals</a>
<a class="dropdown-item active" href="/module3.html">Module 3: MySQL Database</a>
<a class="dropdown-item" href="/module4.html">Module 4: WordPress &amp; Docker</a>
<a class="dropdown-item" href="/module5.html">Module 5: Theme Development</a>
<a class="dropdown-item" href="/module6.html">Module 6: Plugin Development</a>
<a class="dropdown-item" href="/module7.html">Module 7: Advanced WordPress</a>
<a class="dropdown-item" href="/module8.html">Module 8: Deployment</a>
<a class="dropdown-item" href="/module9.html">Module 9: Final Project</a>
</div>
</li>
<li class="nav-item"><a class="nav-link" href="/resources.html">Resources</a></li>
<li class="nav-item"><a class="nav-link" href="/about.html">About</a></li>
</ul>
</div>
</nav>
<div class="search-container">
<div class="search-input-wrapper">
<svg class="search-icon" fill="currentColor" height="20" viewbox="0 0 20 20" width="20">
<path clip-rule="evenodd" d="M8 4a4 4 0 100 8 4 4 0 000-8zM2 8a6 6 0 1110.89 3.476l4.817 4.817a1 1 0 01-1.414 1.414l-4.816-4.816A6 6 0 012 8z" fill-rule="evenodd"></path>
</svg>
<input aria-label="Search" class="search-input" placeholder="Search lessons..." type="search"/>
</div>
<div class="search-results"></div>
</div>
</div>
</header>
<!-- Progress Bar -->
<div class="progress-container">
<div class="progress-header">
<h2 class="progress-title">Course Progress</h2>
<span class="progress-text">Loading...</span>
</div>
<div class="progress-bar">
<div class="progress-bar-fill">
<span class="progress-bar-text"></span>
</div>
</div>
</div>
<!-- Breadcrumb -->
<nav aria-label="Breadcrumb" class="breadcrumb container">
<ol class="breadcrumb-list">
<li class="breadcrumb-item">
<a href="/">Home</a>
<span class="breadcrumb-separator">/</span>
</li>
<li class="breadcrumb-item">
<a href="/module3.html">Module 3</a>
<span class="breadcrumb-separator">/</span>
</li>
<li class="breadcrumb-item">
<span aria-current="page">GROUP BY &amp; HAVING</span>
</li>
</ol>
</nav>
<!-- Main Content -->
<main class="main-content" id="main-content" role="main">
<div class="container">
<div class="content-with-sidebar">
<!-- Sidebar -->
<aside class="sidebar">

<div class="sidebar-nav">
<h3 class="sidebar-title">Module 3: MySQL Database</h3>
<div class="sidebar-section">
<h4 class="sidebar-section-title">Session 4</h4>
<ul class="sidebar-menu">
<li><a class="sidebar-link" href="/03module/sql_joins.html">SQL Joins</a></li>
<li><a class="sidebar-link" href="/03module/aggregate_functions.html">Aggregate Functions</a></li>
<li class="active"><a class="sidebar-link active" href="/03module/group_by_having.html">GROUP BY</a></li>
<li><a class="sidebar-link" href="/03module/having_deep_dive.html">HAVING Clause</a></li>
<li><a class="sidebar-link" href="/03module/subqueries.html">Subqueries</a></li>
<li><a class="sidebar-link" href="/03module/views.html">Views</a></li>
<li><a class="sidebar-link" href="/03module/transactions.html">Transactions</a></li>
<li><a class="sidebar-link" href="/03module/stored_procedures.html">Stored Procedures</a></li>
<li><a class="sidebar-link" href="/03module/homework_advanced_sql.html">Homework: Advanced SQL</a></li>
</ul>
</div>
<div class="sidebar-section">
<h4 class="sidebar-section-title">Quick Links</h4>
<ul class="sidebar-menu">
<li><a class="sidebar-link" href="/module3.html">Module Overview</a></li>
<li><a class="sidebar-link prev-session" href="/03module/sql_syntax_conventions.html">‚Üê Prev: Session 3: SQL Basics</a></li>
<li><a class="sidebar-link next-session" href="/03module/connecting_mysql.html">Next: Session 5: PHP-MySQL ‚Üí</a></li>
<li><a class="sidebar-link" href="/module2.html">‚Üê Previous Module</a></li>
<li><a class="sidebar-link" href="/module4.html">Next Module ‚Üí</a></li>
<li><a class="sidebar-link" href="/resources.html">Resources</a></li>
</ul>
</div>
</div></aside>
<!-- Main Lesson Content -->
<article class="lesson-content">
<header class="lesson-header">
<h1>GROUP BY &amp; HAVING - Data Grouping Mastery</h1>
<div class="lesson-meta">
<div class="lesson-meta-item">
<svg fill="currentColor" height="20" width="20">
<path d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"></path>
</svg>
<span>Duration: 90 minutes</span>
</div>
<div class="lesson-meta-item">
<svg fill="currentColor" height="20" width="20">
<path d="M12 14l9-5-9-5-9 5 9 5z"></path>
</svg>
<span>Module 3: Session 4</span>
</div>
</div>
</header>
<!-- Learning Objectives -->
<div class="lesson-objectives">
<h2>Learning Objectives</h2>
<ul>
<li>Master GROUP BY fundamentals and execution order</li>
<li>Group by single and multiple columns</li>
<li>Understand the difference between WHERE and HAVING</li>
<li>Use GROUP BY with aggregate functions</li>
<li>Implement ROLLUP and CUBE for subtotals</li>
<li>Apply GROUPING SETS for flexible grouping</li>
<li>Handle NULL values in grouping</li>
<li>Optimize GROUP BY performance</li>
</ul>
</div>
<!-- Lesson Body -->
<div class="lesson-body">
<section>
<h2>Understanding GROUP BY</h2>
<p class="lead">GROUP BY transforms your data from individual rows into meaningful groups, enabling powerful data analysis and reporting! üìä</p>
<canvas height="500" id="groupByCanvas" width="600"></canvas>
<script>
                                    const ctx = document.getElementById('groupByCanvas').getContext('2d');
                                    
                                    // Title
                                    ctx.font = 'bold 18px Arial';
                                    ctx.fillStyle = '#1f2937';
                                    ctx.fillText('GROUP BY Processing Flow', 200, 30);
                                    
                                    // Original data
                                    ctx.fillStyle = '#f3f4f6';
                                    ctx.fillRect(50, 60, 220, 150);
                                    ctx.strokeStyle = '#6b7280';
                                    ctx.strokeRect(50, 60, 220, 150);
                                    
                                    ctx.fillStyle = '#1f2937';
                                    ctx.font = 'bold 12px Arial';
                                    ctx.fillText('Original Data', 120, 80);
                                    
                                    ctx.font = '10px Courier';
                                    ctx.fillText('customer | product  | amount', 60, 100);
                                    ctx.fillText('---------|----------|--------', 60, 115);
                                    ctx.fillText('John     | Laptop   | 1200', 60, 130);
                                    ctx.fillText('Jane     | Mouse    | 25', 60, 145);
                                    ctx.fillText('John     | Keyboard | 75', 60, 160);
                                    ctx.fillText('Bob      | Monitor  | 300', 60, 175);
                                    ctx.fillText('Jane     | Laptop   | 1100', 60, 190);
                                    
                                    // Arrow
                                    ctx.strokeStyle = '#6b7280';
                                    ctx.lineWidth = 2;
                                    ctx.beginPath();
                                    ctx.moveTo(280, 135);
                                    ctx.lineTo(320, 135);
                                    ctx.stroke();
                                    
                                    // Draw arrow head
                                    ctx.beginPath();
                                    ctx.moveTo(315, 130);
                                    ctx.lineTo(320, 135);
                                    ctx.lineTo(315, 140);
                                    ctx.stroke();
                                    
                                    // GROUP BY label
                                    ctx.fillStyle = '#16a34a';
                                    ctx.font = 'bold 11px Arial';
                                    ctx.fillText('GROUP BY', 275, 125);
                                    ctx.fillText('customer', 275, 140);
                                    
                                    // Grouped data
                                    ctx.fillStyle = '#dcfce7';
                                    ctx.fillRect(330, 60, 220, 150);
                                    ctx.strokeStyle = '#16a34a';
                                    ctx.strokeRect(330, 60, 220, 150);
                                    
                                    ctx.fillStyle = '#166534';
                                    ctx.font = 'bold 12px Arial';
                                    ctx.fillText('Grouped Result', 390, 80);
                                    
                                    ctx.fillStyle = '#1f2937';
                                    ctx.font = '10px Courier';
                                    ctx.fillText('customer | COUNT | SUM(amount)', 340, 100);
                                    ctx.fillText('---------|-------|------------', 340, 115);
                                    ctx.fillText('John     | 2     | 1275', 340, 130);
                                    ctx.fillText('Jane     | 2     | 1125', 340, 145);
                                    ctx.fillText('Bob      | 1     | 300', 340, 160);
                                    
                                    // Process explanation
                                    ctx.fillStyle = '#fef3c7';
                                    ctx.fillRect(50, 230, 500, 250);
                                    ctx.strokeStyle = '#ca8a04';
                                    ctx.strokeRect(50, 230, 500, 250);
                                    
                                    ctx.fillStyle = '#92400e';
                                    ctx.font = 'bold 14px Arial';
                                    ctx.fillText('GROUP BY Execution Order', 60, 255);
                                    
                                    // Steps
                                    const steps = [
                                        '1. FROM - Identify source tables',
                                        '2. WHERE - Filter individual rows',
                                        '3. GROUP BY - Create groups',
                                        '4. HAVING - Filter groups',
                                        '5. SELECT - Choose columns & aggregates',
                                        '6. ORDER BY - Sort results',
                                        '7. LIMIT - Restrict output'
                                    ];
                                    
                                    ctx.fillStyle = '#374151';
                                    ctx.font = '12px Arial';
                                    let y = 280;
                                    steps.forEach((step, index) => {
                                        if (index === 2) {
                                            ctx.fillStyle = '#16a34a';
                                            ctx.font = 'bold 12px Arial';
                                        } else {
                                            ctx.fillStyle = '#374151';
                                            ctx.font = '12px Arial';
                                        }
                                        ctx.fillText(step, 70, y);
                                        y += 25;
                                    });
                                    
                                    // Important note
                                    ctx.fillStyle = '#dc2626';
                                    ctx.font = 'bold 11px Arial';
                                    ctx.fillText('‚ö†Ô∏è WHERE filters BEFORE grouping, HAVING filters AFTER grouping!', 70, 460);
                                </script>
<div class="alert alert-info">
<div class="alert-icon">üí°</div>
<div class="alert-content">
<div class="alert-title">GROUP BY Golden Rules</div>
<div class="alert-message">
<ul>
<li>Every column in SELECT must be either in GROUP BY or an aggregate function</li>
<li>GROUP BY creates one row per unique group value</li>
<li>NULL values form their own group</li>
<li>Order of columns in GROUP BY matters for performance</li>
<li>Can group by expressions, not just columns</li>
</ul>
</div>
</div>
</div>
</section>
<section>
<h2>Basic GROUP BY Operations</h2>
<div class="mermaid">
                                    graph TB
                                        GROUP[GROUP BY] --&gt; SINGLE[Single Column]
                                        GROUP --&gt; MULTI[Multiple Columns]
                                        GROUP --&gt; EXPR[Expressions]
                                        GROUP --&gt; POS[Position]
                                        
                                        SINGLE --&gt; S1[Simple grouping]
                                        MULTI --&gt; M1[Hierarchical groups]
                                        EXPR --&gt; E1[Calculated groups]
                                        POS --&gt; P1[GROUP BY 1, 2]
                                        
                                        style GROUP fill:#dcfce7
                                        style SINGLE fill:#dbeafe
                                        style MULTI fill:#fef3c7
                                        style EXPR fill:#fee2e2
                                </div>
<div class="real_world_example">
<h3>GROUP BY Fundamentals</h3>
<pre><code class="language-sql">-- ========================================
-- SINGLE COLUMN GROUPING
-- ========================================

-- Basic GROUP BY with COUNT
SELECT 
    category,
    COUNT(*) AS product_count
FROM products
GROUP BY category;

-- GROUP BY with multiple aggregates
SELECT 
    customer_id,
    COUNT(*) AS order_count,
    SUM(amount) AS total_spent,
    AVG(amount) AS avg_order_value,
    MIN(order_date) AS first_order,
    MAX(order_date) AS last_order
FROM orders
GROUP BY customer_id;

-- GROUP BY with JOIN
SELECT 
    c.country,
    COUNT(DISTINCT c.customer_id) AS customers,
    COUNT(o.order_id) AS orders,
    SUM(o.amount) AS revenue
FROM customers c
LEFT JOIN orders o ON c.customer_id = o.customer_id
GROUP BY c.country
ORDER BY revenue DESC;

-- ========================================
-- MULTIPLE COLUMN GROUPING
-- ========================================

-- Hierarchical grouping
SELECT 
    YEAR(order_date) AS year,
    MONTH(order_date) AS month,
    category,
    COUNT(*) AS sales_count,
    SUM(amount) AS revenue
FROM orders o
JOIN order_items oi ON o.order_id = oi.order_id
JOIN products p ON oi.product_id = p.product_id
GROUP BY 
    YEAR(order_date),
    MONTH(order_date),
    category
ORDER BY year DESC, month DESC, revenue DESC;

-- Multi-level aggregation
SELECT 
    country,
    state,
    city,
    COUNT(*) AS customer_count,
    AVG(lifetime_value) AS avg_ltv
FROM customers
GROUP BY country, state, city
WITH ROLLUP;  -- Adds subtotals

-- ========================================
-- GROUP BY EXPRESSIONS
-- ========================================

-- Group by calculated values
SELECT 
    CASE 
        WHEN amount &lt; 100 THEN 'Small'
        WHEN amount &lt; 500 THEN 'Medium'
        WHEN amount &lt; 1000 THEN 'Large'
        ELSE 'Enterprise'
    END AS order_size,
    COUNT(*) AS order_count,
    AVG(amount) AS avg_amount
FROM orders
GROUP BY 
    CASE 
        WHEN amount &lt; 100 THEN 'Small'
        WHEN amount &lt; 500 THEN 'Medium'
        WHEN amount &lt; 1000 THEN 'Large'
        ELSE 'Enterprise'
    END;

-- Group by date parts
SELECT 
    DATE_FORMAT(order_date, '%Y-%m') AS month,
    DAYOFWEEK(order_date) AS day_of_week,
    CASE DAYOFWEEK(order_date)
        WHEN 1 THEN 'Sunday'
        WHEN 2 THEN 'Monday'
        WHEN 3 THEN 'Tuesday'
        WHEN 4 THEN 'Wednesday'
        WHEN 5 THEN 'Thursday'
        WHEN 6 THEN 'Friday'
        WHEN 7 THEN 'Saturday'
    END AS day_name,
    COUNT(*) AS orders,
    SUM(amount) AS revenue
FROM orders
GROUP BY 
    DATE_FORMAT(order_date, '%Y-%m'),
    DAYOFWEEK(order_date)
ORDER BY month, day_of_week;

-- ========================================
-- GROUP BY WITH NULL HANDLING
-- ========================================

-- NULLs form their own group
SELECT 
    COALESCE(category, 'Uncategorized') AS category_name,
    COUNT(*) AS product_count,
    AVG(price) AS avg_price
FROM products
GROUP BY category;  -- NULL category becomes a group

-- Exclude NULL groups
SELECT 
    category,
    COUNT(*) AS count
FROM products
WHERE category IS NOT NULL
GROUP BY category;

-- ========================================
-- GROUP BY POSITION (Less Readable)
-- ========================================

-- Group by column position
SELECT 
    category,
    brand,
    COUNT(*) AS count
FROM products
GROUP BY 1, 2;  -- Groups by first and second column

-- Better to use column names for clarity
SELECT 
    category,
    brand,
    COUNT(*) AS count
FROM products
GROUP BY category, brand;</code></pre>
</div>
</section>
<section>
<h2>HAVING Clause - Filtering Groups</h2>
<canvas height="400" id="havingCanvas" width="600"></canvas>
<script>
                                    const hCtx = document.getElementById('havingCanvas').getContext('2d');
                                    
                                    // Title
                                    hCtx.font = 'bold 16px Arial';
                                    hCtx.fillStyle = '#1f2937';
                                    hCtx.fillText('WHERE vs HAVING', 230, 30);
                                    
                                    // WHERE section
                                    hCtx.fillStyle = '#dbeafe';
                                    hCtx.fillRect(50, 60, 250, 150);
                                    hCtx.strokeStyle = '#2563eb';
                                    hCtx.lineWidth = 2;
                                    hCtx.strokeRect(50, 60, 250, 150);
                                    
                                    hCtx.fillStyle = '#1e40af';
                                    hCtx.font = 'bold 14px Arial';
                                    hCtx.fillText('WHERE Clause', 130, 85);
                                    
                                    hCtx.fillStyle = '#374151';
                                    hCtx.font = '11px Arial';
                                    hCtx.fillText('‚Ä¢ Filters individual rows', 60, 110);
                                    hCtx.fillText('‚Ä¢ Executes BEFORE GROUP BY', 60, 130);
                                    hCtx.fillText('‚Ä¢ Cannot use aggregates', 60, 150);
                                    hCtx.fillText('‚Ä¢ Example: WHERE price > 100', 60, 170);
                                    hCtx.fillText('‚Ä¢ More efficient', 60, 190);
                                    
                                    // HAVING section
                                    hCtx.fillStyle = '#dcfce7';
                                    hCtx.fillRect(320, 60, 250, 150);
                                    hCtx.strokeStyle = '#16a34a';
                                    hCtx.strokeRect(320, 60, 250, 150);
                                    
                                    hCtx.fillStyle = '#166534';
                                    hCtx.font = 'bold 14px Arial';
                                    hCtx.fillText('HAVING Clause', 390, 85);
                                    
                                    hCtx.fillStyle = '#374151';
                                    hCtx.font = '11px Arial';
                                    hCtx.fillText('‚Ä¢ Filters groups', 330, 110);
                                    hCtx.fillText('‚Ä¢ Executes AFTER GROUP BY', 330, 130);
                                    hCtx.fillText('‚Ä¢ Can use aggregates', 330, 150);
                                    hCtx.fillText('‚Ä¢ Example: HAVING COUNT(*) > 5', 330, 170);
                                    hCtx.fillText('‚Ä¢ Processes fewer rows', 330, 190);
                                    
                                    // Example flow
                                    hCtx.fillStyle = '#fef3c7';
                                    hCtx.fillRect(50, 230, 520, 150);
                                    hCtx.strokeStyle = '#ca8a04';
                                    hCtx.strokeRect(50, 230, 520, 150);
                                    
                                    hCtx.fillStyle = '#92400e';
                                    hCtx.font = 'bold 12px Arial';
                                    hCtx.fillText('Example Query Flow', 250, 250);
                                    
                                    hCtx.fillStyle = '#374151';
                                    hCtx.font = '10px Courier';
                                    hCtx.fillText('SELECT category, COUNT(*), AVG(price)', 60, 270);
                                    hCtx.fillText('FROM products', 60, 285);
                                    hCtx.fillText('WHERE is_active = TRUE        -- Filters active products first', 60, 300);
                                    hCtx.fillText('GROUP BY category              -- Groups remaining rows', 60, 315);
                                    hCtx.fillText('HAVING COUNT(*) > 10          -- Filters groups with >10 products', 60, 330);
                                    hCtx.fillText('   AND AVG(price) > 50        -- AND average price >50', 60, 345);
                                    hCtx.fillText('ORDER BY COUNT(*) DESC;        -- Sort the final results', 60, 360);
                                </script>
<div class="best_practice">
<h3>HAVING Clause Examples</h3>
<pre><code class="language-sql">-- ========================================
-- BASIC HAVING EXAMPLES
-- ========================================

-- Filter groups by count
SELECT 
    category,
    COUNT(*) AS product_count
FROM products
GROUP BY category
HAVING COUNT(*) &gt; 10;

-- Multiple conditions in HAVING
SELECT 
    customer_id,
    COUNT(*) AS order_count,
    SUM(amount) AS total_spent,
    AVG(amount) AS avg_order
FROM orders
GROUP BY customer_id
HAVING 
    COUNT(*) &gt;= 5
    AND SUM(amount) &gt; 1000
    AND AVG(amount) &gt; 100;

-- ========================================
-- WHERE AND HAVING TOGETHER
-- ========================================

-- Best practice: Filter early with WHERE
SELECT 
    c.country,
    COUNT(DISTINCT c.customer_id) AS customers,
    SUM(o.amount) AS revenue
FROM customers c
JOIN orders o ON c.customer_id = o.customer_id
WHERE 
    o.status = 'completed'  -- WHERE: filter individual orders
    AND o.order_date &gt;= '2024-01-01'
GROUP BY c.country
HAVING 
    COUNT(DISTINCT c.customer_id) &gt; 100  -- HAVING: filter country groups
    AND SUM(o.amount) &gt; 10000
ORDER BY revenue DESC;

-- ========================================
-- HAVING WITH AGGREGATE COMPARISONS
-- ========================================

-- Groups above average
SELECT 
    category,
    AVG(price) AS category_avg_price
FROM products
GROUP BY category
HAVING AVG(price) &gt; (
    SELECT AVG(price) FROM products
);

-- Relative comparisons
SELECT 
    salesperson_id,
    SUM(sale_amount) AS total_sales
FROM sales
WHERE YEAR(sale_date) = 2024
GROUP BY salesperson_id
HAVING SUM(sale_amount) &gt; (
    SELECT AVG(total_sales) * 1.2  -- 20% above average
    FROM (
        SELECT SUM(sale_amount) AS total_sales
        FROM sales
        WHERE YEAR(sale_date) = 2024
        GROUP BY salesperson_id
    ) AS avg_calc
);

-- ========================================
-- HAVING WITHOUT GROUP BY
-- ========================================

-- HAVING can be used without GROUP BY (treats all rows as one group)
SELECT 
    COUNT(*) AS total_products,
    AVG(price) AS avg_price
FROM products
HAVING AVG(price) &gt; 50;  -- Filters the single group

-- ========================================
-- COMPLEX HAVING PATTERNS
-- ========================================

-- Find duplicate records
SELECT 
    email,
    COUNT(*) AS duplicate_count
FROM customers
GROUP BY email
HAVING COUNT(*) &gt; 1;

-- Categories with diverse price ranges
SELECT 
    category,
    COUNT(*) AS products,
    MIN(price) AS min_price,
    MAX(price) AS max_price,
    MAX(price) - MIN(price) AS price_range
FROM products
GROUP BY category
HAVING 
    MAX(price) - MIN(price) &gt; 500
    AND COUNT(*) &gt; 5
ORDER BY price_range DESC;

-- Customers with irregular ordering patterns
SELECT 
    customer_id,
    COUNT(*) AS order_count,
    STD(amount) AS order_std_dev,
    AVG(amount) AS avg_amount
FROM orders
GROUP BY customer_id
HAVING 
    STD(amount) &gt; AVG(amount) * 0.5  -- High variation
    AND COUNT(*) &gt; 10;

-- Time-based group filtering
SELECT 
    DATE_FORMAT(order_date, '%Y-%m') AS month,
    COUNT(*) AS orders,
    SUM(amount) AS revenue
FROM orders
GROUP BY DATE_FORMAT(order_date, '%Y-%m')
HAVING 
    COUNT(*) &gt; (
        SELECT AVG(monthly_orders)
        FROM (
            SELECT COUNT(*) AS monthly_orders
            FROM orders
            GROUP BY DATE_FORMAT(order_date, '%Y-%m')
        ) AS monthly_avg
    );</code></pre>
</div>
</section>
<section>
<h2>Advanced Grouping: ROLLUP, CUBE, and GROUPING SETS</h2>
<div class="alert alert-warning">
<div class="alert-icon">‚ö†Ô∏è</div>
<div class="alert-content">
<div class="alert-title">MySQL Support Note</div>
<div class="alert-message">
                                            MySQL supports ROLLUP but not CUBE or GROUPING SETS. We'll show workarounds for missing features.
                                        </div>
</div>
</div>
<canvas height="350" id="rollupCanvas" width="600"></canvas>
<script>
                                    const rCtx = document.getElementById('rollupCanvas').getContext('2d');
                                    
                                    // Title
                                    rCtx.font = 'bold 16px Arial';
                                    rCtx.fillStyle = '#1f2937';
                                    rCtx.fillText('ROLLUP Creates Hierarchical Subtotals', 150, 30);
                                    
                                    // Sample ROLLUP result
                                    rCtx.fillStyle = '#f3f4f6';
                                    rCtx.fillRect(50, 60, 500, 270);
                                    rCtx.strokeStyle = '#6b7280';
                                    rCtx.strokeRect(50, 60, 500, 270);
                                    
                                    rCtx.fillStyle = '#1f2937';
                                    rCtx.font = 'bold 12px Arial';
                                    rCtx.fillText('GROUP BY year, month, category WITH ROLLUP', 150, 80);
                                    
                                    rCtx.font = '10px Courier';
                                    rCtx.fillText('year | month | category    | revenue', 60, 100);
                                    rCtx.fillText('-----|-------|-------------|--------', 60, 115);
                                    
                                    // Data rows
                                    const rows = [
                                        ['2024 | 01    | Electronics | 5000', '#ffffff'],
                                        ['2024 | 01    | Clothing    | 3000', '#ffffff'],
                                        ['2024 | 01    | NULL        | 8000', '#dbeafe'],  // Month subtotal
                                        ['2024 | 02    | Electronics | 5500', '#ffffff'],
                                        ['2024 | 02    | Clothing    | 3500', '#ffffff'],
                                        ['2024 | 02    | NULL        | 9000', '#dbeafe'],  // Month subtotal
                                        ['2024 | NULL  | NULL        | 17000', '#dcfce7'], // Year subtotal
                                        ['NULL | NULL  | NULL        | 17000', '#fef3c7']  // Grand total
                                    ];
                                    
                                    let y = 130;
                                    rows.forEach(([row, color]) => {
                                        if (color !== '#ffffff') {
                                            rCtx.fillStyle = color;
                                            rCtx.fillRect(55, y - 12, 490, 15);
                                        }
                                        rCtx.fillStyle = '#374151';
                                        rCtx.fillText(row, 60, y);
                                        y += 20;
                                    });
                                    
                                    // Legend
                                    rCtx.fillStyle = '#dbeafe';
                                    rCtx.fillRect(60, 300, 15, 15);
                                    rCtx.fillStyle = '#374151';
                                    rCtx.font = '10px Arial';
                                    rCtx.fillText('Month subtotals', 80, 310);
                                    
                                    rCtx.fillStyle = '#dcfce7';
                                    rCtx.fillRect(200, 300, 15, 15);
                                    rCtx.fillText('Year subtotal', 220, 310);
                                    
                                    rCtx.fillStyle = '#fef3c7';
                                    rCtx.fillRect(340, 300, 15, 15);
                                    rCtx.fillText('Grand total', 360, 310);
                                </script>
<div class="homework">
<h3>Advanced Grouping Techniques</h3>
<pre><code class="language-sql">-- ========================================
-- ROLLUP - Hierarchical Subtotals
-- ========================================

-- Simple ROLLUP
SELECT 
    category,
    COUNT(*) AS products,
    SUM(stock * price) AS inventory_value
FROM products
GROUP BY category WITH ROLLUP;

-- Multi-level ROLLUP
SELECT 
    COALESCE(YEAR(order_date), 'Grand Total') AS year,
    COALESCE(MONTH(order_date), 'Year Total') AS month,
    COALESCE(category, 'Month Total') AS category,
    COUNT(*) AS orders,
    SUM(amount) AS revenue
FROM orders o
JOIN order_items oi ON o.order_id = oi.order_id
JOIN products p ON oi.product_id = p.product_id
WHERE o.status = 'completed'
GROUP BY 
    YEAR(order_date),
    MONTH(order_date),
    category 
WITH ROLLUP;

-- ROLLUP with GROUPING() function
SELECT 
    category,
    brand,
    COUNT(*) AS count,
    SUM(price) AS total_price,
    CASE 
        WHEN GROUPING(category) = 1 THEN 'GRAND TOTAL'
        WHEN GROUPING(brand) = 1 THEN 'Category Subtotal'
        ELSE 'Detail'
    END AS level_type
FROM products
GROUP BY category, brand WITH ROLLUP;

-- ========================================
-- CUBE Alternative (MySQL doesn't support CUBE)
-- ========================================

-- Simulate CUBE with UNION
-- CUBE would give all possible grouping combinations

-- All combinations for (A, B)
-- 1. GROUP BY A, B
-- 2. GROUP BY A
-- 3. GROUP BY B
-- 4. Grand total

(SELECT 
    region,
    product_category,
    SUM(sales_amount) AS total_sales,
    'Region-Category' AS grouping_level
FROM sales
GROUP BY region, product_category)

UNION ALL

(SELECT 
    region,
    NULL AS product_category,
    SUM(sales_amount) AS total_sales,
    'Region Only' AS grouping_level
FROM sales
GROUP BY region)

UNION ALL

(SELECT 
    NULL AS region,
    product_category,
    SUM(sales_amount) AS total_sales,
    'Category Only' AS grouping_level
FROM sales
GROUP BY product_category)

UNION ALL

(SELECT 
    NULL AS region,
    NULL AS product_category,
    SUM(sales_amount) AS total_sales,
    'Grand Total' AS grouping_level
FROM sales)

ORDER BY 
    COALESCE(region, 'ZZZZZ'),
    COALESCE(product_category, 'ZZZZZ');

-- ========================================
-- GROUPING SETS Alternative (MySQL workaround)
-- ========================================

-- Simulate GROUPING SETS with UNION
-- Different grouping combinations as needed

(SELECT 
    'By Year-Month' AS group_type,
    YEAR(order_date) AS year,
    MONTH(order_date) AS month,
    NULL AS category,
    COUNT(*) AS orders,
    SUM(amount) AS revenue
FROM orders
GROUP BY YEAR(order_date), MONTH(order_date))

UNION ALL

(SELECT 
    'By Category' AS group_type,
    NULL AS year,
    NULL AS month,
    category,
    COUNT(*) AS orders,
    SUM(amount) AS revenue
FROM orders o
JOIN order_items oi ON o.order_id = oi.order_id
JOIN products p ON oi.product_id = p.product_id
GROUP BY category)

UNION ALL

(SELECT 
    'Grand Total' AS group_type,
    NULL AS year,
    NULL AS month,
    NULL AS category,
    COUNT(*) AS orders,
    SUM(amount) AS revenue
FROM orders)

ORDER BY group_type, year, month, category;

-- ========================================
-- Practical ROLLUP Applications
-- ========================================

-- Sales hierarchy report
SELECT 
    COALESCE(region, 'ALL REGIONS') AS region,
    COALESCE(country, 'All Countries') AS country,
    COALESCE(state, 'All States') AS state,
    COUNT(DISTINCT customer_id) AS customers,
    COUNT(order_id) AS orders,
    FORMAT(SUM(amount), 2) AS revenue,
    FORMAT(AVG(amount), 2) AS avg_order_value
FROM orders o
JOIN customers c ON o.customer_id = c.customer_id
WHERE o.status = 'completed'
GROUP BY region, country, state WITH ROLLUP
HAVING region IS NOT NULL OR (region IS NULL AND country IS NULL AND state IS NULL);

-- Inventory summary with subtotals
SELECT 
    COALESCE(warehouse, 'ALL WAREHOUSES') AS warehouse,
    COALESCE(category, 'All Categories') AS category,
    COUNT(DISTINCT product_id) AS products,
    SUM(quantity_on_hand) AS total_units,
    FORMAT(SUM(quantity_on_hand * unit_cost), 2) AS inventory_value,
    CASE 
        WHEN GROUPING(warehouse) = 1 THEN '*** GRAND TOTAL ***'
        WHEN GROUPING(category) = 1 THEN '** Warehouse Total **'
        ELSE ''
    END AS summary_level
FROM inventory
GROUP BY warehouse, category WITH ROLLUP;</code></pre>
</div>
</section>
<section>
<h2>GROUP BY Performance Optimization</h2>
<div class="real_world_example">
<h3>Optimizing GROUP BY Queries</h3>
<pre><code class="language-sql">-- ========================================
-- INDEX OPTIMIZATION FOR GROUP BY
-- ========================================

-- Create index for GROUP BY columns
CREATE INDEX idx_groupby ON orders(customer_id, status, order_date);

-- Query uses index for grouping
EXPLAIN SELECT 
    customer_id,
    status,
    COUNT(*),
    SUM(amount)
FROM orders
GROUP BY customer_id, status;

-- Covering index includes all needed columns
CREATE INDEX idx_covering ON orders(
    customer_id, 
    status, 
    amount
);

-- ========================================
-- OPTIMIZE GROUP BY ORDER
-- ========================================

-- Match GROUP BY order to index order
-- Good: Matches index (customer_id, status, order_date)
SELECT customer_id, status, DATE(order_date), COUNT(*)
FROM orders
GROUP BY customer_id, status, DATE(order_date);

-- Bad: Different order than index
SELECT DATE(order_date), customer_id, status, COUNT(*)
FROM orders
GROUP BY DATE(order_date), customer_id, status;

-- ========================================
-- REDUCE GROUPED DATA VOLUME
-- ========================================

-- Filter before grouping (use WHERE not HAVING when possible)
-- Efficient:
SELECT category, COUNT(*)
FROM products
WHERE price &gt; 100  -- Filters first
GROUP BY category;

-- Inefficient:
SELECT category, COUNT(*)
FROM products
GROUP BY category
HAVING AVG(price) &gt; 100;  -- Filters after grouping

-- ========================================
-- SUMMARY TABLES FOR PERFORMANCE
-- ========================================

-- Create materialized summary table
CREATE TABLE daily_sales_summary (
    sale_date DATE PRIMARY KEY,
    total_orders INT,
    total_revenue DECIMAL(10,2),
    unique_customers INT,
    INDEX idx_date (sale_date)
);

-- Populate summary table (run periodically)
INSERT INTO daily_sales_summary
SELECT 
    DATE(order_date),
    COUNT(*),
    SUM(amount),
    COUNT(DISTINCT customer_id)
FROM orders
WHERE DATE(order_date) = CURDATE() - INTERVAL 1 DAY
GROUP BY DATE(order_date)
ON DUPLICATE KEY UPDATE
    total_orders = VALUES(total_orders),
    total_revenue = VALUES(total_revenue),
    unique_customers = VALUES(unique_customers);

-- ========================================
-- PARTITION OPTIMIZATION
-- ========================================

-- Partition large tables for better GROUP BY performance
ALTER TABLE orders
PARTITION BY RANGE (YEAR(order_date)) (
    PARTITION p2022 VALUES LESS THAN (2023),
    PARTITION p2023 VALUES LESS THAN (2024),
    PARTITION p2024 VALUES LESS THAN (2025),
    PARTITION p_future VALUES LESS THAN MAXVALUE
);

-- ========================================
-- MONITORING GROUP BY PERFORMANCE
-- ========================================

-- Check temporary table usage
SHOW STATUS LIKE 'Created_tmp%';

-- Analyze slow GROUP BY queries
EXPLAIN FORMAT=JSON
SELECT 
    customer_id,
    YEAR(order_date) AS year,
    COUNT(*) AS orders,
    SUM(amount) AS revenue
FROM orders
GROUP BY customer_id, YEAR(order_date)
HAVING orders &gt; 10;</code></pre>
</div>
</section>
<!-- Practice Exercise -->
<section>
<h2>Practice Exercise</h2>
<div class="alert alert-success">
<div class="alert-icon">üíª</div>
<div class="alert-content">
<div class="alert-title">GROUP BY Challenges</div>
<div class="alert-message">
                                            Solve these real-world grouping scenarios:
                                            <ol>
<li>Find the top 3 customers by revenue in each country</li>
<li>Calculate year-over-year growth by category</li>
<li>Identify products that sell better on weekends</li>
<li>Create a cohort analysis by customer signup month</li>
<li>Find categories where all products are above average price</li>
<li>Generate a P&amp;L summary with subtotals using ROLLUP</li>
<li>Detect seasonal patterns in sales data</li>
<li>Build a customer segmentation based on purchase behavior</li>
</ol>
</div>
</div>
</div>
<details>
<summary>üí° Click for Solutions</summary>
<pre><code class="language-sql">-- 1. Top 3 customers by revenue in each country
WITH customer_rankings AS (
    SELECT 
        c.country,
        c.customer_id,
        c.customer_name,
        SUM(o.amount) AS total_revenue,
        ROW_NUMBER() OVER (
            PARTITION BY c.country 
            ORDER BY SUM(o.amount) DESC
        ) AS rank_in_country
    FROM customers c
    JOIN orders o ON c.customer_id = o.customer_id
    WHERE o.status = 'completed'
    GROUP BY c.country, c.customer_id
)
SELECT *
FROM customer_rankings
WHERE rank_in_country &lt;= 3
ORDER BY country, rank_in_country;

-- 2. Year-over-year growth by category
WITH yearly_sales AS (
    SELECT 
        p.category,
        YEAR(o.order_date) AS year,
        SUM(oi.quantity * oi.unit_price) AS revenue
    FROM orders o
    JOIN order_items oi ON o.order_id = oi.order_id
    JOIN products p ON oi.product_id = p.product_id
    WHERE o.status = 'completed'
    GROUP BY p.category, YEAR(o.order_date)
)
SELECT 
    category,
    year,
    revenue,
    LAG(revenue) OVER (PARTITION BY category ORDER BY year) AS prev_year_revenue,
    ROUND(
        (revenue - LAG(revenue) OVER (PARTITION BY category ORDER BY year)) / 
        LAG(revenue) OVER (PARTITION BY category ORDER BY year) * 100, 
        2
    ) AS yoy_growth_percent
FROM yearly_sales
ORDER BY category, year;

-- 3. Products that sell better on weekends
SELECT 
    p.product_id,
    p.product_name,
    SUM(CASE WHEN DAYOFWEEK(o.order_date) IN (1, 7) THEN oi.quantity ELSE 0 END) AS weekend_sales,
    SUM(CASE WHEN DAYOFWEEK(o.order_date) NOT IN (1, 7) THEN oi.quantity ELSE 0 END) AS weekday_sales,
    ROUND(
        SUM(CASE WHEN DAYOFWEEK(o.order_date) IN (1, 7) THEN oi.quantity ELSE 0 END) * 100.0 /
        SUM(oi.quantity), 2
    ) AS weekend_percentage
FROM products p
JOIN order_items oi ON p.product_id = oi.product_id
JOIN orders o ON oi.order_id = o.order_id
GROUP BY p.product_id
HAVING weekend_percentage &gt; 40  -- More than 40% of sales on weekends
ORDER BY weekend_percentage DESC;

-- 4. Cohort analysis by signup month
SELECT 
    DATE_FORMAT(c.created_at, '%Y-%m') AS cohort_month,
    DATE_FORMAT(o.order_date, '%Y-%m') AS order_month,
    PERIOD_DIFF(
        DATE_FORMAT(o.order_date, '%Y%m'),
        DATE_FORMAT(c.created_at, '%Y%m')
    ) AS months_since_signup,
    COUNT(DISTINCT c.customer_id) AS customers,
    COUNT(o.order_id) AS orders,
    SUM(o.amount) AS revenue
FROM customers c
LEFT JOIN orders o ON c.customer_id = o.customer_id
GROUP BY cohort_month, order_month
ORDER BY cohort_month, months_since_signup;

-- 5. Categories where all products are above average
SELECT 
    category,
    COUNT(*) AS product_count,
    MIN(price) AS min_price,
    AVG(price) AS avg_price
FROM products
GROUP BY category
HAVING MIN(price) &gt; (SELECT AVG(price) FROM products);

-- 6. P&amp;L summary with ROLLUP
SELECT 
    COALESCE(YEAR(order_date), 'TOTAL') AS year,
    COALESCE(QUARTER(order_date), 'Year Total') AS quarter,
    COALESCE(MONTH(order_date), 'Quarter Total') AS month,
    COUNT(*) AS transactions,
    SUM(revenue) AS gross_revenue,
    SUM(cost) AS total_cost,
    SUM(revenue - cost) AS gross_profit,
    ROUND(SUM(revenue - cost) / SUM(revenue) * 100, 2) AS margin_percent
FROM (
    SELECT 
        o.order_date,
        oi.quantity * oi.unit_price AS revenue,
        oi.quantity * p.cost AS cost
    FROM orders o
    JOIN order_items oi ON o.order_id = oi.order_id
    JOIN products p ON oi.product_id = p.product_id
    WHERE o.status = 'completed'
) AS order_details
GROUP BY YEAR(order_date), QUARTER(order_date), MONTH(order_date) WITH ROLLUP;

-- 7. Seasonal patterns
SELECT 
    MONTH(order_date) AS month_num,
    MONTHNAME(order_date) AS month_name,
    COUNT(*) AS total_orders,
    AVG(amount) AS avg_order_value,
    SUM(amount) AS total_revenue,
    ROUND(
        SUM(amount) * 100.0 / SUM(SUM(amount)) OVER (), 
        2
    ) AS percent_of_annual
FROM orders
WHERE status = 'completed'
GROUP BY MONTH(order_date), MONTHNAME(order_date)
ORDER BY month_num;

-- 8. Customer segmentation
SELECT 
    CASE 
        WHEN rfm_score &gt;= 9 THEN 'Champions'
        WHEN rfm_score &gt;= 7 THEN 'Loyal Customers'
        WHEN rfm_score &gt;= 5 THEN 'Potential Loyalists'
        WHEN rfm_score &gt;= 3 THEN 'At Risk'
        ELSE 'Lost'
    END AS segment,
    COUNT(*) AS customers,
    AVG(total_orders) AS avg_orders,
    AVG(total_spent) AS avg_revenue,
    AVG(days_since_last) AS avg_recency
FROM (
    SELECT 
        customer_id,
        COUNT(*) AS total_orders,
        SUM(amount) AS total_spent,
        DATEDIFF(CURDATE(), MAX(order_date)) AS days_since_last,
        NTILE(3) OVER (ORDER BY DATEDIFF(CURDATE(), MAX(order_date))) AS recency_score,
        NTILE(3) OVER (ORDER BY COUNT(*)) AS frequency_score,
        NTILE(3) OVER (ORDER BY SUM(amount)) AS monetary_score,
        NTILE(3) OVER (ORDER BY DATEDIFF(CURDATE(), MAX(order_date))) +
        NTILE(3) OVER (ORDER BY COUNT(*)) +
        NTILE(3) OVER (ORDER BY SUM(amount)) AS rfm_score
    FROM orders
    WHERE status = 'completed'
    GROUP BY customer_id
) AS customer_rfm
GROUP BY segment
ORDER BY rfm_score DESC;</code></pre>
</details>
</section>
<!-- Resources -->
<section class="resources">
<h2>Additional Resources</h2>
<ul>
<li><a href="https://dev.mysql.com/doc/refman/8.0/en/group-by-handling.html" target="_blank">MySQL GROUP BY Documentation</a></li>
<li><a href="https://dev.mysql.com/doc/refman/8.0/en/group-by-modifiers.html" target="_blank">GROUP BY Modifiers (ROLLUP)</a></li>
<li><a href="https://www.mysqltutorial.org/mysql-group-by.aspx" target="_blank">MySQL GROUP BY Tutorial</a></li>
<li><a href="https://modern-sql.com/feature/grouping-sets" target="_blank">SQL Grouping Sets (Standard SQL)</a></li>
<li><a href="https://use-the-index-luke.com/sql/sorting-grouping" target="_blank">Indexing for GROUP BY</a></li>
</ul>
</section>
</div>
<!-- Lesson Navigation -->
<div class="lesson-navigation">
<a class="lesson-nav-button prev" href="/03module/aggregate_functions.html">
<svg fill="currentColor" height="20" viewbox="0 0 20 20" width="20">
<path d="M12.707 5.293a1 1 0 010 1.414L9.414 10l3.293 3.293a1 1 0 01-1.414 1.414l-4-4a1 1 0 010-1.414l4-4a1 1 0 011.414 0z"></path>
</svg>
<span>
<small>Previous</small><br/>
                                    Aggregate Functions
                                </span>
</a>
<button class="complete-lesson-btn">
                                Mark as Complete
                            </button>
<a class="lesson-nav-button next" href="/03module/subqueries.html">
<span>
<small>Next</small><br/>
                                    Subqueries
                                </span>
<svg fill="currentColor" height="20" viewbox="0 0 20 20" width="20">
<path d="M7.293 14.707a1 1 0 010-1.414L10.586 10 7.293 6.707a1 1 0 011.414-1.414l4 4a1 1 0 010 1.414l-4 4a1 1 0 01-1.414 0z"></path>
</svg>
</a>
</div>
</article>
</div>
</div>
</main>
<!-- Footer -->
<footer class="site-footer" role="contentinfo">
<div class="footer-container">
<div class="footer-content">
<div class="footer-section footer-about">
<h3>PHP WordPress Development</h3>
<p>Complete Web Development Course</p>
</div>
<div class="footer-section">
<h4>Quick Links</h4>
<ul class="footer-links">
<li><a href="/">Home</a></li>
<li><a href="/module3.html">Module 3</a></li>
<li><a href="/resources.html">Resources</a></li>
</ul>
</div>
<div class="footer-section">
<h4>Support</h4>
<ul class="footer-links">
<li><a href="/help.html">Help Center</a></li>
<li><a href="/faq.html">FAQ</a></li>
<li><a href="/contact.html">Contact</a></li>
</ul>
</div>
</div>
<div class="footer-bottom">
<div class="footer-bottom-content">
<p class="copyright">¬© 2025 PHP WordPress Development Course</p>
<nav class="footer-bottom-links">
<a href="/privacy.html">Privacy</a>
<span class="separator">|</span>
<a href="/terms.html">Terms</a>
</nav>
</div>
</div>
</div>
</footer>
</div>
<!-- Back to Top -->
<button aria-label="Back to top" class="back-to-top" id="back-to-top">
<svg fill="none" height="24" stroke="currentColor" stroke-width="2" viewbox="0 0 24 24" width="24">
<path d="M12 19V5M12 5l-7 7M12 5l7 7"></path>
</svg>
</button>
<!-- JavaScript -->
<script src="/assets/js/navigation.js"></script>
<script src="/assets/js/site-config.js"></script>
<script src="/assets/js/sidebar-toggle.js"></script>
<!-- Universal Mermaid Fix (Enhanced) -->

<!-- Universal Mermaid Fix -->
<script src="/assets/js/mermaid-universal-fix.js"></script>
</body>
</html>