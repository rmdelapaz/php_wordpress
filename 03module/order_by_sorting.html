<!DOCTYPE html>
<html lang="en">
 <head>
  <meta charset="utf-8"/>
  <meta content="width=device-width, initial-scale=1.0" name="viewport"/>
  <meta content="ie=edge" http-equiv="X-UA-Compatible"/>
  <!-- SEO Meta Tags -->
  <title>ORDER BY - Advanced Sorting Techniques - PHP WordPress Course</title>
  <meta content="Master MySQL ORDER BY - sorting, custom ordering, performance optimization, and complex sorting scenarios" name="description"/>
  <meta content="PHP, WordPress, MySQL, ORDER BY, sorting, optimization, custom ordering" name="keywords"/>
  <meta content="PHP WordPress Course" name="author"/>
  <link href="/assets/css/main.css" rel="stylesheet"/>
  <link href="/assets/css/sidebar-enhanced.css" rel="stylesheet"/>
  <link href="/assets/css/sidebar-toggle.css" rel="stylesheet"/>
  <!-- Favicon -->
  <link href="/favicon.png" rel="icon" type="image/png"/>
  <link href="/favicon.png" rel="apple-touch-icon"/>
  <!-- CSS -->
  <link href="/assets/css/sidebar-enhanced.css" rel="stylesheet"/>
  <link href="/assets/css/sidebar-toggle.css" rel="stylesheet"/>
 </head>
 <body>
  <!-- Skip to main content -->
  <a class="sr-only" href="#main-content">Skip to main content</a>
  <div class="page-wrapper">
   <!-- Header -->
   <header class="site-header" role="banner">
    <div class="header-container">
     <div class="site-branding">
      <a class="site-logo" href="/">
       <h1 class="site-title">PHP WordPress Development</h1>
      </a>
     </div>
     <nav aria-label="Main navigation" class="main-navigation" role="navigation">
      <button aria-expanded="false" aria-label="Toggle navigation" class="mobile-menu-btn">
       <span>
       </span>
       <span>
       </span>
       <span>
       </span>
      </button>
      <div class="nav-menu">
       <ul class="nav-list">
        <li class="nav-item">
         <a class="nav-link" href="/">Home</a>
        </li>
        <li class="nav-item dropdown">
         <button aria-haspopup="true" class="nav-link dropdown-toggle active">Modules</button>
         <div class="dropdown-menu">
          <a class="dropdown-item" href="/module1.html">Module 1: Web Fundamentals</a>
          <a class="dropdown-item" href="/module2.html">Module 2: PHP Fundamentals</a>
          <a class="dropdown-item active" href="/module3.html">Module 3: MySQL Database</a>
          <a class="dropdown-item" href="/module4.html">Module 4: WordPress &amp; Docker</a>
          <a class="dropdown-item" href="/module5.html">Module 5: Theme Development</a>
          <a class="dropdown-item" href="/module6.html">Module 6: Plugin Development</a>
          <a class="dropdown-item" href="/module7.html">Module 7: Advanced WordPress</a>
          <a class="dropdown-item" href="/module8.html">Module 8: Deployment</a>
          <a class="dropdown-item" href="/module9.html">Module 9: Final Project</a>
         </div>
        </li>
        <li class="nav-item">
         <a class="nav-link" href="/resources.html">Resources</a>
        </li>
        <li class="nav-item">
         <a class="nav-link" href="/about.html">About</a>
        </li>
       </ul>
      </div>
     </nav>
     <div class="search-container">
      <div class="search-input-wrapper">
       <svg class="search-icon" fill="currentColor" height="20" viewbox="0 0 20 20" width="20">
        <path clip-rule="evenodd" d="M8 4a4 4 0 100 8 4 4 0 000-8zM2 8a6 6 0 1110.89 3.476l4.817 4.817a1 1 0 01-1.414 1.414l-4.816-4.816A6 6 0 012 8z" fill-rule="evenodd">
        </path>
       </svg>
       <input aria-label="Search" class="search-input" placeholder="Search lessons..." type="search"/>
      </div>
      <div class="search-results">
      </div>
     </div>
    </div>
   </header>
   <!-- Progress Bar -->
   <div class="progress-container">
    <div class="progress-header">
     <h2 class="progress-title">Course Progress</h2>
     <span class="progress-text">Loading...</span>
    </div>
    <div class="progress-bar">
     <div class="progress-bar-fill">
      <span class="progress-bar-text">
      </span>
     </div>
    </div>
   </div>
   <!-- Breadcrumb -->
   <nav aria-label="Breadcrumb" class="breadcrumb container">
    <ol class="breadcrumb-list">
     <li class="breadcrumb-item">
      <a href="/">Home</a>
      <span class="breadcrumb-separator">/</span>
     </li>
     <li class="breadcrumb-item">
      <a href="/module3.html">Module 3</a>
      <span class="breadcrumb-separator">/</span>
     </li>
     <li class="breadcrumb-item">
      <span aria-current="page">ORDER BY Sorting</span>
     </li>
    </ol>
   </nav>
   <!-- Main Content -->
   <main class="main-content" id="main-content" role="main">
    <div class="container">
     <div class="content-with-sidebar">
      <!-- Sidebar -->
      <aside class="sidebar">
    <div class="sidebar-nav">
        <h3 class="sidebar-title">Module 3: MySQL Database</h3>
        <div class="sidebar-section">
            <h4 class="sidebar-section-title">Session 3: SQL Fundamentals</h4>
            <ul class="sidebar-menu">
                <li><a class="sidebar-link" href="/03module/sql_syntax_conventions.html">SQL syntax and conventions</a></li>
                <li><a class="sidebar-link" href="/03module/mysql_data_types.html">Data types in MySQL</a></li>
                <li><a class="sidebar-link" href="/03module/database_structure_ddl.html">Creating and modifying database structures (CREATE, ALTER, DROP)</a></li>
                <li><a class="sidebar-link" href="/03module/insert_update_delete.html">Basic data manipulation (INSERT, UPDATE, DELETE)</a></li>
                <li><a class="sidebar-link" href="/03module/select_queries.html">Simple queries with SELECT</a></li>
                <li><a class="sidebar-link" href="/03module/where_filtering.html">Filtering data with WHERE</a></li>
                <li class="active"><a class="sidebar-link active" href="/03module/order_by_sorting.html">Sorting results with ORDER BY</a></li>
                <li><a class="sidebar-link" href="/03module/homework_sql_queries.html">Homework: Write SQL queries to manipulate data in your database</a></li>
            </ul>
        </div>
        <div class="sidebar-section">
            <h4 class="sidebar-section-title">Quick Links</h4>
            <ul class="sidebar-menu">
                <li><a class="sidebar-link" href="/module3.html">Module Overview</a></li>
                <li><a class="sidebar-link prev-session" href="/03module/data_modeling_concepts.html">‚Üê Prev: Database Design</a></li>
                <li><a class="sidebar-link next-session" href="/03module/sql_joins.html">Next: Advanced SQL ‚Üí</a></li>
                <li><a class="sidebar-link" href="/">‚Üê Course Home</a></li>
                <li><a class="sidebar-link" href="/module4.html">Next Module ‚Üí</a></li>
                <li><a class="sidebar-link" href="/resources.html">Resources</a></li>
            </ul>
        </div>
    </div>
</aside>
      <!-- Main Lesson Content -->
      <article class="lesson-content">
       <header class="lesson-header">
        <h1>Mastering ORDER BY - Sorting Results</h1>
        <div class="lesson-meta">
         <div class="lesson-meta-item">
          <svg fill="currentColor" height="20" width="20">
           <path d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z">
           </path>
          </svg>
          <span>Duration: 75 minutes</span>
         </div>
         <div class="lesson-meta-item">
          <svg fill="currentColor" height="20" width="20">
           <path d="M12 14l9-5-9-5-9 5 9 5z">
           </path>
          </svg>
          <span>Module 3: Session 5</span>
         </div>
        </div>
       </header>
       <!-- Learning Objectives -->
       <div class="lesson-objectives">
        <h2>Learning Objectives</h2>
        <ul>
         <li>Master single and multi-column sorting</li>
         <li>Implement custom sort orders and collations</li>
         <li>Handle NULL values in sorting</li>
         <li>Optimize ORDER BY performance with indexes</li>
         <li>Use advanced sorting techniques and expressions</li>
         <li>Understand sorting with GROUP BY and aggregates</li>
         <li>Apply real-world sorting patterns</li>
        </ul>
       </div>
       <!-- Lesson Body -->
       <div class="lesson-body">
        <section>
         <h2>ORDER BY Fundamentals</h2>
         <p class="lead">ORDER BY determines the sequence of rows in your result set. Master it to present data meaningfully! üìä</p>
         <canvas height="400" id="orderByCanvas" width="600">
         </canvas>
         <script>const ctx = document.getElementById('orderByCanvas').getContext('2d');
                                    
                                    // Title
                                    ctx.font = 'bold 18px Arial';
                                    ctx.fillStyle = '#1f2937';
                                    ctx.fillText('ORDER BY Processing Flow', 190, 30);
                                    
                                    // Draw flow
                                    const steps = [
                                        { text: '1. FROM clause identifies tables', color: '#dbeafe' },
                                        { text: '2. WHERE filters rows', color: '#dcfce7' },
                                        { text: '3. GROUP BY groups rows', color: '#fef3c7' },
                                        { text: '4. HAVING filters groups', color: '#fee2e2' },
                                        { text: '5. SELECT chooses columns', color: '#e9d5ff' },
                                        { text: '6. ORDER BY sorts results', color: '#e0f2fe', highlight: true },
                                        { text: '7. LIMIT restricts rows', color: '#fce7f3' }
                                    ];
                                    
                                    let y = 60;
                                    steps.forEach(step =>{
                                        // Box
                                        ctx.fillStyle = step.color;
                                        ctx.fillRect(150, y, 300, 40);
                                        
                                        if (step.highlight) {
                                            ctx.strokeStyle = '#0891b2';
                                            ctx.lineWidth = 3;
                                        } else {
                                            ctx.strokeStyle = '#6b7280';
                                            ctx.lineWidth = 1;
                                        }
                                        ctx.strokeRect(150, y, 300, 40);
                                        
                                        // Text
                                        ctx.fillStyle = step.highlight ? '#0c4a6e' : '#374151';
                                        ctx.font = step.highlight ? 'bold 12px Arial' : '11px Arial';
                                        ctx.fillText(step.text, 160, y + 25);
                                        
                                        y += 50;
                                    });
                                    
                                    // Note
                                    ctx.fillStyle = '#f59e0b';
                                    ctx.font = 'bold 11px Arial';
                                    ctx.fillText('‚ö° ORDER BY happens AFTER filtering and grouping!', 150, 390);</script>
         <div class="alert alert-info">
          <div class="alert-icon">üí°</div>
          <div class="alert-content">
           <div class="alert-title">Key ORDER BY Facts</div>
           <div class="alert-message">
            <ul>
             <li>Default sort order is ASC (ascending)</li>
             <li>NULL values sort first in ASC, last in DESC (MySQL default)</li>
             <li>Sorting happens after WHERE, GROUP BY, and HAVING</li>
             <li>Can sort by columns not in SELECT list</li>
             <li>Multiple columns create hierarchical sorting</li>
            </ul>
           </div>
          </div>
         </div>
        </section>
        <section>
         <h2>Basic and Multi-Column Sorting</h2>
         <div class="mermaid">graph TB
                                        ORDER[ORDER BY] --&gt; SINGLE[Single Column]
                                        ORDER --&gt; MULTI[Multiple Columns]
                                        ORDER --&gt; EXPR[Expressions]
                                        ORDER --&gt; POS[Position]
                                        
                                        SINGLE --&gt; ASC[ASC/Ascending]
                                        SINGLE --&gt; DESC[DESC/Descending]
                                        
                                        MULTI --&gt; HIER[Hierarchical Sort]
                                        MULTI --&gt; MIX[Mixed Directions]
                                        
                                        EXPR --&gt; CALC[Calculations]
                                        EXPR --&gt; FUNC[Functions]
                                        EXPR --&gt; CASE[CASE Statements]
                                        
                                        style ORDER fill:#dcfce7
                                        style ASC fill:#dbeafe
                                        style DESC fill:#fee2e2
                                        style HIER fill:#fef3c7</div>
         <div class="real_world_example">
          <h3>Comprehensive ORDER BY Examples</h3>
          <pre><code class="language-sql">-- ========================================
-- BASIC SORTING
-- ========================================

-- Simple ascending (default)
SELECT * FROM products 
ORDER BY price;

-- Explicit ascending
SELECT * FROM products 
ORDER BY price ASC;

-- Descending order
SELECT * FROM products 
ORDER BY price DESC;

-- Sort by column not in SELECT
SELECT product_name, price 
FROM products 
ORDER BY stock_quantity DESC;  -- Valid!

-- ========================================
-- MULTI-COLUMN SORTING
-- ========================================

-- Hierarchical sorting
SELECT * FROM users 
ORDER BY 
    country,      -- First by country
    state,        -- Then by state within country
    city,         -- Then by city within state
    last_name,    -- Then by last name
    first_name;   -- Finally by first name

-- Mixed directions
SELECT * FROM products 
ORDER BY 
    category ASC,       -- Categories A-Z
    price DESC,         -- Expensive first within category
    product_name ASC;   -- Alphabetical for same price

-- Real-world example: E-commerce listing
SELECT 
    product_id,
    product_name,
    category,
    price,
    rating,
    review_count
FROM products 
WHERE status = 'active'
ORDER BY 
    is_featured DESC,   -- Featured products first
    rating DESC,        -- Highest rated next
    review_count DESC,  -- Most reviewed next
    price ASC;          -- Cheapest last

-- ========================================
-- SORTING BY POSITION
-- ========================================

-- Sort by column position (not recommended)
SELECT username, email, created_at 
FROM users 
ORDER BY 3 DESC;  -- Sort by 3rd column (created_at)

-- Multiple positions
SELECT category, product_name, price 
FROM products 
ORDER BY 1, 3 DESC;  -- By category, then price DESC

-- ========================================
-- SORTING WITH EXPRESSIONS
-- ========================================

-- Sort by calculated value
SELECT 
    product_name,
    price,
    discount_percent,
    price * (1 - discount_percent/100) AS final_price
FROM products 
ORDER BY final_price;

-- Sort by expression not in SELECT
SELECT product_name, price 
FROM products 
ORDER BY (price * stock_quantity) DESC;  -- By inventory value

-- Sort by string manipulation
SELECT * FROM users 
ORDER BY 
    LENGTH(username),           -- Shortest usernames first
    SUBSTRING(email, 1, 3);     -- Then by first 3 chars of email

-- Sort by date parts
SELECT * FROM orders 
ORDER BY 
    YEAR(order_date) DESC,
    MONTH(order_date),
    DAY(order_date);

-- ========================================
-- CONDITIONAL SORTING
-- ========================================

-- CASE in ORDER BY
SELECT * FROM orders 
ORDER BY 
    CASE status
        WHEN 'urgent' THEN 1
        WHEN 'high' THEN 2
        WHEN 'normal' THEN 3
        WHEN 'low' THEN 4
        ELSE 5
    END,
    created_at ASC;

-- Different sort based on condition
SELECT * FROM products 
ORDER BY 
    CASE 
        WHEN category = 'Electronics' THEN price DESC
        WHEN category = 'Books' THEN title ASC
        ELSE created_at DESC
    END;

-- Sort by boolean conditions
SELECT * FROM users 
ORDER BY 
    (subscription_type = 'premium') DESC,  -- Premium users first
    (last_login &gt; DATE_SUB(NOW(), INTERVAL 7 DAY)) DESC,  -- Active users
    registration_date ASC;  -- Oldest users

-- ========================================
-- COLLATION AND CASE SENSITIVITY
-- ========================================

-- Case-insensitive sort (default)
SELECT * FROM users 
ORDER BY username;  -- 'Apple' and 'apple' treated same

-- Case-sensitive sort using BINARY
SELECT * FROM users 
ORDER BY BINARY username;  -- 'Apple' before 'apple'

-- Specific collation
SELECT * FROM products 
ORDER BY product_name COLLATE utf8mb4_unicode_ci;

-- Language-specific sorting
SELECT * FROM customers 
ORDER BY last_name COLLATE utf8mb4_german2_ci;  -- German sort rules</code></pre>
         </div>
        </section>
        <section>
         <h2>NULL Handling in ORDER BY</h2>
         <canvas height="300" id="nullSortCanvas" width="600">
         </canvas>
         <script>const nCtx = document.getElementById('nullSortCanvas').getContext('2d');
                                    
                                    // Title
                                    nCtx.font = 'bold 16px Arial';
                                    nCtx.fillStyle = '#1f2937';
                                    nCtx.fillText('NULL Sorting Behavior', 220, 30);
                                    
                                    // ASC with NULL
                                    nCtx.fillStyle = '#dbeafe';
                                    nCtx.fillRect(50, 60, 250, 100);
                                    nCtx.strokeStyle = '#2563eb';
                                    nCtx.lineWidth = 2;
                                    nCtx.strokeRect(50, 60, 250, 100);
                                    
                                    nCtx.fillStyle = '#1e40af';
                                    nCtx.font = 'bold 12px Arial';
                                    nCtx.fillText('ORDER BY column ASC', 120, 80);
                                    
                                    nCtx.fillStyle = '#374151';
                                    nCtx.font = '11px Arial';
                                    nCtx.fillText('NULL', 60, 100);
                                    nCtx.fillText('NULL', 60, 115);
                                    nCtx.fillText('1', 60, 130);
                                    nCtx.fillText('2', 60, 145);
                                    
                                    nCtx.fillStyle = '#16a34a';
                                    nCtx.fillText('‚Üê NULLs first (MySQL default)', 90, 107);
                                    
                                    // DESC with NULL
                                    nCtx.fillStyle = '#fee2e2';
                                    nCtx.fillRect(320, 60, 250, 100);
                                    nCtx.strokeStyle = '#dc2626';
                                    nCtx.strokeRect(320, 60, 250, 100);
                                    
                                    nCtx.fillStyle = '#991b1b';
                                    nCtx.font = 'bold 12px Arial';
                                    nCtx.fillText('ORDER BY column DESC', 385, 80);
                                    
                                    nCtx.fillStyle = '#374151';
                                    nCtx.font = '11px Arial';
                                    nCtx.fillText('2', 330, 100);
                                    nCtx.fillText('1', 330, 115);
                                    nCtx.fillText('NULL', 330, 130);
                                    nCtx.fillText('NULL', 330, 145);
                                    
                                    nCtx.fillStyle = '#16a34a';
                                    nCtx.fillText('‚Üê NULLs last', 360, 137);
                                    
                                    // Custom NULL handling
                                    nCtx.fillStyle = '#fef3c7';
                                    nCtx.fillRect(50, 180, 520, 100);
                                    nCtx.strokeStyle = '#ca8a04';
                                    nCtx.strokeRect(50, 180, 520, 100);
                                    
                                    nCtx.fillStyle = '#92400e';
                                    nCtx.font = 'bold 12px Arial';
                                    nCtx.fillText('Custom NULL Positioning', 230, 200);
                                    
                                    nCtx.fillStyle = '#374151';
                                    nCtx.font = '10px Courier';
                                    nCtx.fillText('NULLs last in ASC:  ORDER BY column IS NULL, column ASC', 60, 220);
                                    nCtx.fillText('NULLs first in DESC: ORDER BY column IS NOT NULL, column DESC', 60, 240);
                                    nCtx.fillText('NULLs as zero:      ORDER BY COALESCE(column, 0)', 60, 260);</script>
         <div class="best_practice">
          <h3>Advanced NULL Handling</h3>
          <pre><code class="language-sql">-- ========================================
-- NULL POSITIONING CONTROL
-- ========================================

-- Default MySQL behavior
SELECT * FROM products ORDER BY discount ASC;   -- NULLs first
SELECT * FROM products ORDER BY discount DESC;  -- NULLs last

-- Force NULLs last in ascending order
SELECT * FROM products 
ORDER BY 
    discount IS NULL,  -- FALSE (0) for non-NULL, TRUE (1) for NULL
    discount ASC;

-- Force NULLs first in descending order
SELECT * FROM products 
ORDER BY 
    discount IS NOT NULL,  -- FALSE (0) for NULL, TRUE (1) for non-NULL
    discount DESC;

-- Treat NULL as specific value
SELECT * FROM products 
ORDER BY COALESCE(discount, 0) DESC;  -- NULL treated as 0

SELECT * FROM products 
ORDER BY IFNULL(discount, 999) ASC;  -- NULL treated as 999

-- ========================================
-- COMPLEX NULL HANDLING
-- ========================================

-- Multi-column with different NULL handling
SELECT 
    product_name,
    category,
    discount,
    rating
FROM products 
ORDER BY 
    category ASC,                    -- Normal sort
    discount IS NULL,                 -- Non-NULL discounts first
    discount DESC,                    -- Highest discount first
    COALESCE(rating, 0) DESC;        -- NULL ratings as 0

-- Conditional NULL handling
SELECT * FROM users 
ORDER BY 
    CASE 
        WHEN last_login IS NULL THEN '1900-01-01'  -- Never logged in
        ELSE last_login 
    END DESC;

-- NULL priority in business logic
SELECT 
    task_id,
    task_name,
    due_date,
    priority
FROM tasks 
ORDER BY 
    -- Overdue tasks first
    (due_date &lt; NOW() AND status != 'completed') DESC,
    -- Then by priority (NULL = lowest)
    CASE 
        WHEN priority IS NULL THEN 999
        ELSE priority 
    END ASC,
    -- Then by due date (NULL = no deadline = last)
    due_date IS NULL,
    due_date ASC;

-- ========================================
-- NULL IN EXPRESSIONS
-- ========================================

-- Sorting by expression with NULL handling
SELECT 
    product_name,
    price,
    discount,
    price * (1 - COALESCE(discount, 0)/100) AS final_price
FROM products 
ORDER BY 
    final_price ASC;

-- NULL-safe comparison in ORDER BY
SELECT * FROM products 
ORDER BY 
    price &lt;=&gt; 100;  -- NULL-safe equals operator</code></pre>
         </div>
        </section>
        <section>
         <h2>Custom Ordering Techniques</h2>
         <div class="real_world_example">
          <h3>Custom Sort Orders</h3>
          <pre><code class="language-sql">-- ========================================
-- FIELD() FUNCTION FOR CUSTOM ORDER
-- ========================================

-- Specific value order
SELECT * FROM orders 
ORDER BY FIELD(status, 
    'urgent',
    'pending',
    'processing',
    'shipped',
    'delivered',
    'cancelled'
);

-- Day of week custom order (Monday first)
SELECT * FROM schedules 
ORDER BY FIELD(day_name,
    'Monday',
    'Tuesday',
    'Wednesday',
    'Thursday',
    'Friday',
    'Saturday',
    'Sunday'
);

-- Size ordering (not alphabetical)
SELECT * FROM products 
WHERE category = 'Clothing'
ORDER BY FIELD(size, 'XS', 'S', 'M', 'L', 'XL', 'XXL');

-- ========================================
-- ENUM NATURAL ORDERING
-- ========================================

-- If using ENUM type, it sorts by index
CREATE TABLE products_enum (
    size ENUM('XS', 'S', 'M', 'L', 'XL', 'XXL')
);

-- Sorts by ENUM index (1=XS, 2=S, etc.)
SELECT * FROM products_enum ORDER BY size;

-- ========================================
-- WEIGHTED SORTING
-- ========================================

-- Sort by relevance score
SELECT 
    product_id,
    product_name,
    (
        (name LIKE '%laptop%') * 10 +
        (description LIKE '%laptop%') * 5 +
        (category = 'Computers') * 3
    ) AS relevance_score
FROM products 
WHERE 
    name LIKE '%laptop%' 
    OR description LIKE '%laptop%'
    OR category = 'Computers'
ORDER BY relevance_score DESC;

-- Multi-factor sorting algorithm
SELECT 
    product_id,
    product_name,
    price,
    rating,
    review_count,
    -- Calculate sort score
    (
        (rating / 5) * 40 +                           -- 40% weight to rating
        (LEAST(review_count, 100) / 100) * 30 +       -- 30% to reviews (capped)
        ((1000 - LEAST(price, 1000)) / 1000) * 20 +   -- 20% to price (inverse)
        (is_featured * 10)                            -- 10% bonus if featured
    ) AS sort_score
FROM products 
WHERE category = 'Electronics'
ORDER BY sort_score DESC;

-- ========================================
-- DYNAMIC SORTING (Application Logic)
-- ========================================

-- Prepare for dynamic sort column
SET @sort_column = 'price';
SET @sort_direction = 'DESC';

-- Using CASE for dynamic sorting
SELECT * FROM products 
ORDER BY 
    CASE @sort_column
        WHEN 'name' THEN product_name
        WHEN 'price' THEN CAST(price AS CHAR)
        WHEN 'date' THEN CAST(created_at AS CHAR)
        ELSE product_id
    END,
    CASE @sort_direction
        WHEN 'DESC' THEN -1
        ELSE 1
    END;

-- ========================================
-- RANDOM ORDERING
-- ========================================

-- Random order (inefficient for large tables)
SELECT * FROM products 
ORDER BY RAND() 
LIMIT 10;

-- Better random selection for large tables
SELECT * FROM products 
WHERE RAND() &lt; (10 / (SELECT COUNT(*) FROM products))
ORDER BY RAND()
LIMIT 10;

-- Reproducible random order (with seed)
SELECT * FROM products 
ORDER BY RAND(12345)  -- Same order every time with same seed
LIMIT 10;

-- ========================================
-- NATURAL SORTING (Alphanumeric)
-- ========================================

-- Problem: '10' sorts before '2' in strings
-- Solution: Natural sort

-- Extract numbers for natural sorting
SELECT 
    product_code
FROM products 
ORDER BY 
    CAST(product_code AS UNSIGNED),  -- Numeric part
    product_code;                     -- Then alphabetic

-- More complex natural sort
SELECT 
    filename
FROM files 
ORDER BY 
    LENGTH(filename),
    filename;

-- Using REGEXP for natural sort
SELECT 
    item_code
FROM inventory
ORDER BY 
    REGEXP_REPLACE(item_code, '[^0-9]', ''),  -- Numbers only
    REGEXP_REPLACE(item_code, '[0-9]', '');   -- Letters only</code></pre>
         </div>
        </section>
        <section>
         <h2>Performance Optimization</h2>
         <canvas height="350" id="performanceCanvas" width="600">
         </canvas>
         <script>const pCtx = document.getElementById('performanceCanvas').getContext('2d');
                                    
                                    // Title
                                    pCtx.font = 'bold 16px Arial';
                                    pCtx.fillStyle = '#1f2937';
                                    pCtx.fillText('ORDER BY Performance Impact', 180, 30);
                                    
                                    // With Index
                                    pCtx.fillStyle = '#dcfce7';
                                    pCtx.fillRect(50, 60, 250, 120);
                                    pCtx.strokeStyle = '#16a34a';
                                    pCtx.lineWidth = 2;
                                    pCtx.strokeRect(50, 60, 250, 120);
                                    
                                    pCtx.fillStyle = '#166534';
                                    pCtx.font = 'bold 12px Arial';
                                    pCtx.fillText('‚úÖ With Index', 130, 80);
                                    
                                    pCtx.fillStyle = '#374151';
                                    pCtx.font = '10px Arial';
                                    pCtx.fillText('‚Ä¢ Pre-sorted data', 60, 100);
                                    pCtx.fillText('‚Ä¢ No filesort needed', 60, 115);
                                    pCtx.fillText('‚Ä¢ Fast execution', 60, 130);
                                    pCtx.fillText('‚Ä¢ Minimal memory', 60, 145);
                                    pCtx.fillText('‚Ä¢ Scales well', 60, 160);
                                    
                                    // Without Index
                                    pCtx.fillStyle = '#fee2e2';
                                    pCtx.fillRect(320, 60, 250, 120);
                                    pCtx.strokeStyle = '#dc2626';
                                    pCtx.strokeRect(320, 60, 250, 120);
                                    
                                    pCtx.fillStyle = '#991b1b';
                                    pCtx.font = 'bold 12px Arial';
                                    pCtx.fillText('‚ùå Without Index', 390, 80);
                                    
                                    pCtx.fillStyle = '#374151';
                                    pCtx.font = '10px Arial';
                                    pCtx.fillText('‚Ä¢ Filesort required', 330, 100);
                                    pCtx.fillText('‚Ä¢ Temporary table', 330, 115);
                                    pCtx.fillText('‚Ä¢ Slow on large data', 330, 130);
                                    pCtx.fillText('‚Ä¢ High memory usage', 330, 145);
                                    pCtx.fillText('‚Ä¢ Poor scalability', 330, 160);
                                    
                                    // Optimization tips
                                    pCtx.fillStyle = '#fef3c7';
                                    pCtx.fillRect(50, 200, 520, 130);
                                    pCtx.strokeStyle = '#ca8a04';
                                    pCtx.strokeRect(50, 200, 520, 130);
                                    
                                    pCtx.fillStyle = '#92400e';
                                    pCtx.font = 'bold 12px Arial';
                                    pCtx.fillText('üöÄ Optimization Strategies', 230, 220);
                                    
                                    pCtx.fillStyle = '#374151';
                                    pCtx.font = '10px Arial';
                                    pCtx.fillText('1. Create indexes on ORDER BY columns', 60, 245);
                                    pCtx.fillText('2. Use covering indexes for SELECT + ORDER BY', 60, 260);
                                    pCtx.fillText('3. Limit result set with WHERE before sorting', 60, 275);
                                    pCtx.fillText('4. Avoid ORDER BY RAND() on large tables', 60, 290);
                                    pCtx.fillText('5. Use LIMIT with ORDER BY when possible', 60, 305);
                                    pCtx.fillText('6. Consider denormalization for complex sorts', 60, 320);</script>
         <div class="homework">
          <h3>ORDER BY Performance Optimization</h3>
          <pre><code class="language-sql">-- ========================================
-- INDEX OPTIMIZATION FOR ORDER BY
-- ========================================

-- Create index for single column sort
CREATE INDEX idx_price ON products(price);
SELECT * FROM products ORDER BY price;  -- Uses index

-- Composite index for multi-column sort
CREATE INDEX idx_category_price ON products(category, price);
SELECT * FROM products 
ORDER BY category, price;  -- Uses index

-- Index for WHERE + ORDER BY
CREATE INDEX idx_status_date ON orders(status, order_date);
SELECT * FROM orders 
WHERE status = 'pending'
ORDER BY order_date DESC;  -- Uses index

-- Covering index (includes all needed columns)
CREATE INDEX idx_covering 
ON products(category, price, product_name, product_id);

SELECT product_id, product_name, price 
FROM products 
WHERE category = 'Electronics'
ORDER BY price;  -- All data from index!

-- ========================================
-- EXPLAIN ANALYSIS
-- ========================================

-- Check if filesort is used
EXPLAIN SELECT * FROM products ORDER BY price;
-- Look for "Using filesort" in Extra column

-- Analyze complex query
EXPLAIN FORMAT=JSON
SELECT 
    p.product_name,
    c.category_name,
    p.price
FROM products p
JOIN categories c ON p.category_id = c.category_id
WHERE p.status = 'active'
ORDER BY c.category_name, p.price DESC;

-- ========================================
-- OPTIMIZING COMPLEX SORTS
-- ========================================

-- Bad: Function in ORDER BY prevents index use
SELECT * FROM orders 
ORDER BY YEAR(order_date), MONTH(order_date);

-- Good: Use columns directly
SELECT * FROM orders 
ORDER BY order_date;

-- Bad: Sorting large result set
SELECT * FROM huge_table 
ORDER BY some_column;

-- Good: Limit before sorting
SELECT * FROM (
    SELECT * FROM huge_table 
    WHERE conditions 
    LIMIT 10000
) AS subset 
ORDER BY some_column;

-- ========================================
-- PAGINATION OPTIMIZATION
-- ========================================

-- Inefficient for large offsets
SELECT * FROM products 
ORDER BY product_id 
LIMIT 10000, 10;  -- Scans 10010 rows!

-- Better: Seek method
SELECT * FROM products 
WHERE product_id &gt; 10000  -- Last ID from previous page
ORDER BY product_id 
LIMIT 10;

-- Best: Keyset pagination
SELECT * FROM products 
WHERE (category, product_id) &gt; ('Electronics', 1234)
ORDER BY category, product_id 
LIMIT 10;

-- ========================================
-- AVOIDING FILESORT
-- ========================================

-- Force index usage
SELECT * FROM products 
FORCE INDEX (idx_price)
ORDER BY price;

-- Check sort buffer size
SHOW VARIABLES LIKE 'sort_buffer_size';

-- Increase for large sorts (session level)
SET SESSION sort_buffer_size = 8388608;  -- 8MB

-- Monitor sort performance
SHOW STATUS LIKE 'Sort%';

-- ========================================
-- DENORMALIZATION FOR SORTING
-- ========================================

-- Add computed column for complex sorts
ALTER TABLE products 
ADD COLUMN sort_score INT GENERATED ALWAYS AS (
    (rating * 100) + review_count
) STORED,
ADD INDEX idx_sort_score (sort_score);

-- Now sorting is fast
SELECT * FROM products 
ORDER BY sort_score DESC;</code></pre>
         </div>
        </section>
        <!-- Practice Exercise -->
        <section>
         <h2>Practice Exercise</h2>
         <div class="alert alert-success">
          <div class="alert-icon">üíª</div>
          <div class="alert-content">
           <div class="alert-title">Advanced Sorting Challenges</div>
           <div class="alert-message">Write ORDER BY queries for these scenarios:<ol>
             <li>Sort products by popularity (rating √ó reviews)</li>
             <li>List users by last name, but "Smith" always first</li>
             <li>Sort orders by custom priority: urgent‚Üítoday‚Üítomorrow‚Üírest</li>
             <li>Natural sort for item codes (ITEM1, ITEM10, ITEM2)</li>
             <li>Sort with NULLs in middle (not first or last)</li>
             <li>Random featured product, then by price</li>
             <li>Sort by distance from a point (geospatial)</li>
             <li>Pagination with consistent ordering</li>
            </ol>
           </div>
          </div>
         </div>
         <details>
          <summary>üí° Click for Solutions</summary>
          <pre><code class="language-sql">-- 1. Sort by popularity (rating √ó reviews)
SELECT 
    product_id,
    product_name,
    rating,
    review_count,
    (rating * review_count) AS popularity_score
FROM products 
WHERE status = 'active'
ORDER BY 
    popularity_score DESC,
    rating DESC,  -- Tie breaker
    product_name ASC;

-- 2. "Smith" always first, then alphabetical
SELECT * FROM users 
ORDER BY 
    CASE 
        WHEN last_name = 'Smith' THEN 0
        ELSE 1
    END,
    last_name ASC,
    first_name ASC;

-- Alternative using FIELD()
SELECT * FROM users 
ORDER BY 
    FIELD(last_name, 'Smith') DESC,  -- Returns 1 for Smith, 0 for others
    last_name,
    first_name;

-- 3. Custom priority order
SELECT * FROM orders 
ORDER BY 
    CASE 
        WHEN priority = 'urgent' THEN 1
        WHEN DATE(due_date) = CURDATE() THEN 2  -- Today
        WHEN DATE(due_date) = DATE_ADD(CURDATE(), INTERVAL 1 DAY) THEN 3  -- Tomorrow
        ELSE 4  -- Everything else
    END,
    due_date ASC,
    created_at ASC;

-- 4. Natural sort for item codes
SELECT 
    item_code
FROM inventory
ORDER BY 
    -- Extract and sort by numeric part
    CAST(REGEXP_SUBSTR(item_code, '[0-9]+') AS UNSIGNED),
    -- Then by full code for items with same number
    item_code;

-- Alternative for MySQL &lt; 8.0
SELECT 
    item_code
FROM inventory
ORDER BY 
    LENGTH(item_code),  -- Shorter codes first
    item_code;          -- Then alphabetically

-- 5. NULLs in middle
SELECT * FROM products 
ORDER BY 
    CASE 
        WHEN discount IS NULL THEN 1  -- Middle
        WHEN discount = 0 THEN 0      -- First
        ELSE 2                         -- Last
    END,
    discount DESC;

-- 6. Random featured, then by price
SELECT * FROM products 
WHERE category = 'Electronics'
ORDER BY 
    is_featured DESC,                           -- Featured first
    CASE WHEN is_featured = 1 THEN RAND() END,  -- Random if featured
    price ASC;                                   -- Price if not featured

-- 7. Sort by distance (geospatial)
-- Assuming you have latitude and longitude
SET @user_lat = 37.7749;
SET @user_lng = -122.4194;

SELECT 
    store_id,
    store_name,
    latitude,
    longitude,
    (
        6371 * acos(
            cos(radians(@user_lat)) * 
            cos(radians(latitude)) * 
            cos(radians(longitude) - radians(@user_lng)) + 
            sin(radians(@user_lat)) * 
            sin(radians(latitude))
        )
    ) AS distance_km
FROM stores
ORDER BY distance_km ASC
LIMIT 10;

-- Using ST_Distance for spatial data types
SELECT 
    store_id,
    store_name,
    ST_Distance_Sphere(
        location,
        ST_GeomFromText('POINT(-122.4194 37.7749)')
    ) / 1000 AS distance_km
FROM stores_spatial
ORDER BY distance_km
LIMIT 10;

-- 8. Pagination with consistent ordering
-- Page 1
SELECT * FROM products 
WHERE status = 'active'
ORDER BY created_at DESC, product_id DESC
LIMIT 20;

-- Page 2 (using last values from page 1)
SELECT * FROM products 
WHERE status = 'active'
  AND (created_at &lt; '2024-01-15 10:30:00' 
       OR (created_at = '2024-01-15 10:30:00' AND product_id &lt; 1234))
ORDER BY created_at DESC, product_id DESC
LIMIT 20;</code></pre>
         </details>
        </section>
        <!-- Resources -->
        <section class="resources">
         <h2>Additional Resources</h2>
         <ul>
          <li>
           <a href="https://dev.mysql.com/doc/refman/8.0/en/order-by-optimization.html" target="_blank">MySQL ORDER BY Optimization</a>
          </li>
          <li>
           <a href="https://dev.mysql.com/doc/refman/8.0/en/sorting-rows.html" target="_blank">Sorting Rows Documentation</a>
          </li>
          <li>
           <a href="https://use-the-index-luke.com/sql/sorting-grouping/indexed-order-by" target="_blank">Indexed ORDER BY</a>
          </li>
          <li>
           <a href="https://www.percona.com/blog/2014/05/09/indexing-order-by-expressions-in-mysql/" target="_blank">Advanced ORDER BY Techniques</a>
          </li>
         </ul>
        </section>
       </div>
       <!-- Lesson Navigation -->
       <div class="lesson-navigation">
        <a class="lesson-nav-button prev" href="/03module/where_filtering.html">
         <svg fill="currentColor" height="20" viewbox="0 0 20 20" width="20">
          <path d="M12.707 5.293a1 1 0 010 1.414L9.414 10l3.293 3.293a1 1 0 01-1.414 1.414l-4-4a1 1 0 010-1.414l4-4a1 1 0 011.414 0z">
          </path>
         </svg>
         <span>
          <small>Previous</small>
          <br/>WHERE Filtering</span>
        </a>
        <button class="complete-lesson-btn">Mark as Complete</button>
        <a class="lesson-nav-button next" href="/03module/group_by_having.html">
         <span>
          <small>Next</small>
          <br/>GROUP BY &amp; HAVING</span>
         <svg fill="currentColor" height="20" viewbox="0 0 20 20" width="20">
          <path d="M7.293 14.707a1 1 0 010-1.414L10.586 10 7.293 6.707a1 1 0 011.414-1.414l4 4a1 1 0 010 1.414l-4 4a1 1 0 01-1.414 0z">
          </path>
         </svg>
        </a>
       </div>
      </article>
     </div>
    </div>
   </main>
   <!-- Footer -->
   <footer class="site-footer" role="contentinfo">
    <div class="footer-container">
     <div class="footer-content">
      <div class="footer-section footer-about">
       <h3>PHP WordPress Development</h3>
       <p>Complete Web Development Course</p>
      </div>
      <div class="footer-section">
       <h4>Quick Links</h4>
       <ul class="footer-links">
        <li>
         <a href="/">Home</a>
        </li>
        <li>
         <a class="active" href="/module3.html">Module 3</a>
        </li>
        <li>
         <a href="/resources.html">Resources</a>
        </li>
       </ul>
      </div>
      <div class="footer-section">
       <h4>Support</h4>
       <ul class="footer-links">
        <li>
         <a href="/help.html">Help Center</a>
        </li>
        <li>
         <a href="/faq.html">FAQ</a>
        </li>
        <li>
         <a href="/contact.html">Contact</a>
        </li>
       </ul>
      </div>
     </div>
     <div class="footer-bottom">
      <div class="footer-bottom-content">
       <p class="copyright">¬© 2025 PHP WordPress Development Course</p>
       <nav class="footer-bottom-links">
        <a href="/privacy.html">Privacy</a>
        <span class="separator">|</span>
        <a href="/terms.html">Terms</a>
       </nav>
      </div>
     </div>
    </div>
   </footer>
  </div>
  <!-- Back to Top -->
  <button aria-label="Back to top" class="back-to-top" id="back-to-top">
   <svg fill="none" height="24" stroke="currentColor" stroke-width="2" viewbox="0 0 24 24" width="24">
    <path d="M12 19V5M12 5l-7 7M12 5l7 7">
    </path>
   </svg>
  </button>
  <!-- JavaScript -->
  <script src="/assets/js/navigation.js">
  </script>
  <script src="/assets/js/site-config.js">
  </script>
  <script src="/assets/js/sidebar-toggle.js">
  </script>
  <!-- Universal Mermaid Fix (Enhanced) -->
  <!-- Universal Mermaid Fix -->
  <script src="/assets/js/mermaid-universal-fix.js">
  </script>
 </body>
</html>
