<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    
    <!-- SEO Meta Tags -->
    <title>CRUD Operations in PHP - Complete Guide - PHP WordPress Course</title>
    <meta name="description" content="Master CRUD operations in PHP with MySQL, build complete data-driven applications with create, read, update, and delete functionality">
    <meta name="keywords" content="PHP, MySQL, CRUD, database operations, PHP applications, data management">
    <meta name="author" content="PHP WordPress Course">
    
    <!-- Favicon -->
    <link rel="icon" type="image/png" href="/favicon.png">
    <link rel="apple-touch-icon" href="/favicon.png">
    
    <!-- CSS -->
    <link rel="stylesheet" href="/assets/css/main.css">
    
    <!-- Mermaid for diagrams -->
    <script type="module">
        import mermaid from 'https://cdn.jsdelivr.net/npm/mermaid@10/dist/mermaid.esm.min.mjs';
        mermaid.initialize({ startOnLoad: true });
    </script>
</head>
<body>
    <!-- Skip to main content -->
    <a href="#main-content" class="sr-only">Skip to main content</a>
    
    <div class="page-wrapper">
        <!-- Header -->
        <header class="site-header" role="banner">
            <div class="header-container">
                <div class="site-branding">
                    <a href="/" class="site-logo">
                        <h1 class="site-title">PHP WordPress Development</h1>
                    </a>
                </div>
                
                <nav class="main-navigation" role="navigation" aria-label="Main navigation">
                    <button class="mobile-menu-btn" aria-label="Toggle navigation" aria-expanded="false">
                        <span></span>
                        <span></span>
                        <span></span>
                    </button>
                    
                    <div class="nav-menu">
                        <ul class="nav-list">
                            <li class="nav-item"><a href="/" class="nav-link">Home</a></li>
                            <li class="nav-item dropdown">
                                <button class="nav-link dropdown-toggle active" aria-haspopup="true">Modules</button>
                                <div class="dropdown-menu">
                                    <a href="/module1.html" class="dropdown-item">Module 1: Web Fundamentals</a>
                                    <a href="/module2.html" class="dropdown-item">Module 2: PHP Fundamentals</a>
                                    <a href="/module3.html" class="dropdown-item active">Module 3: MySQL Database</a>
                                    <a href="/module4.html" class="dropdown-item">Module 4: WordPress & Docker</a>
                                    <a href="/module5.html" class="dropdown-item">Module 5: Theme Development</a>
                                    <a href="/module6.html" class="dropdown-item">Module 6: Plugin Development</a>
                                    <a href="/module7.html" class="dropdown-item">Module 7: Advanced WordPress</a>
                                    <a href="/module8.html" class="dropdown-item">Module 8: Deployment</a>
                                    <a href="/module9.html" class="dropdown-item">Module 9: Final Project</a>
                                </div>
                            </li>
                            <li class="nav-item"><a href="/resources.html" class="nav-link">Resources</a></li>
                            <li class="nav-item"><a href="/about.html" class="nav-link">About</a></li>
                        </ul>
                    </div>
                </nav>
                
                <div class="search-container">
                    <div class="search-input-wrapper">
                        <svg class="search-icon" width="20" height="20" viewBox="0 0 20 20" fill="currentColor">
                            <path fill-rule="evenodd" d="M8 4a4 4 0 100 8 4 4 0 000-8zM2 8a6 6 0 1110.89 3.476l4.817 4.817a1 1 0 01-1.414 1.414l-4.816-4.816A6 6 0 012 8z" clip-rule="evenodd" />
                        </svg>
                        <input type="search" class="search-input" placeholder="Search lessons..." aria-label="Search">
                    </div>
                    <div class="search-results"></div>
                </div>
            </div>
        </header>
        
        <!-- Progress Bar -->
        <div class="progress-container">
            <div class="progress-header">
                <h2 class="progress-title">Course Progress</h2>
                <span class="progress-text">Loading...</span>
            </div>
            <div class="progress-bar">
                <div class="progress-bar-fill">
                    <span class="progress-bar-text"></span>
                </div>
            </div>
        </div>
        
        <!-- Breadcrumb -->
        <nav class="breadcrumb container" aria-label="Breadcrumb">
            <ol class="breadcrumb-list">
                <li class="breadcrumb-item">
                    <a href="/">Home</a>
                    <span class="breadcrumb-separator">/</span>
                </li>
                <li class="breadcrumb-item">
                    <a href="/module3.html">Module 3</a>
                    <span class="breadcrumb-separator">/</span>
                </li>
                <li class="breadcrumb-item">
                    <span aria-current="page">CRUD Operations</span>
                </li>
            </ol>
        </nav>
        
        <!-- Main Content -->
        <main id="main-content" class="main-content" role="main">
            <div class="container">
                <div class="content-with-sidebar">
                    <!-- Sidebar -->
                    <aside class="sidebar">
                        <div class="sidebar-nav">
                            <h3 class="sidebar-title">Module 3: Session 5</h3>
                            <div class="sidebar-section">
                                <h4 class="sidebar-section-title">PHP MySQL Integration</h4>
                                <a href="/module3.html" class="sidebar-link">Module Overview</a>
                                <a href="/03module/php_mysql_integration.html" class="sidebar-link">PHP MySQL Basics</a>
                                <a href="/03module/crud_operations.html" class="sidebar-link active">CRUD Operations</a>
                                <a href="/03module/result_sets.html" class="sidebar-link">Handling Result Sets</a>
                                <a href="/03module/error_debugging.html" class="sidebar-link">Error Handling</a>
                                <a href="/03module/final_project.html" class="sidebar-link">Final Project</a>
                            </div>
                        </div>
                    </aside>
                    
                    <!-- Main Lesson Content -->
                    <article class="lesson-content">
                        <header class="lesson-header">
                            <h1>CRUD Operations in PHP Applications</h1>
                            <div class="lesson-meta">
                                <div class="lesson-meta-item">
                                    <svg width="20" height="20" fill="currentColor">
                                        <path d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"/>
                                    </svg>
                                    <span>Duration: 100 minutes</span>
                                </div>
                                <div class="lesson-meta-item">
                                    <svg width="20" height="20" fill="currentColor">
                                        <path d="M12 14l9-5-9-5-9 5 9 5z"/>
                                    </svg>
                                    <span>Module 3: PHP Integration</span>
                                </div>
                            </div>
                        </header>

                        <!-- Learning Objectives -->
                        <div class="lesson-objectives">
                            <h2>Learning Objectives</h2>
                            <ul>
                                <li>Build complete CRUD functionality with PHP and MySQL</li>
                                <li>Implement data validation and sanitization</li>
                                <li>Create user interfaces for data management</li>
                                <li>Handle file uploads and storage</li>
                                <li>Implement search and filtering</li>
                                <li>Add pagination to result sets</li>
                                <li>Build relationships between entities</li>
                                <li>Apply MVC patterns to PHP applications</li>
                            </ul>
                        </div>
                        
                        <!-- Lesson Body -->
                        <div class="lesson-body">
                            <section>
                                <h2>Understanding CRUD Operations</h2>
                                <p class="lead">CRUD (Create, Read, Update, Delete) operations form the foundation of data-driven applications. Let's build a complete system! ðŸš€</p>
                                
                                <canvas id="crudCanvas" width="600" height="400"></canvas>
                                <script>
                                    const ctx = document.getElementById('crudCanvas').getContext('2d');
                                    
                                    // Title
                                    ctx.font = 'bold 18px Arial';
                                    ctx.fillStyle = '#1f2937';
                                    ctx.fillText('CRUD Operations Flow', 200, 30);
                                    
                                    // CRUD boxes
                                    const operations = [
                                        { letter: 'C', name: 'Create', color: '#dcfce7', border: '#16a34a', x: 50, y: 60 },
                                        { letter: 'R', name: 'Read', color: '#dbeafe', border: '#2563eb', x: 320, y: 60 },
                                        { letter: 'U', name: 'Update', color: '#fef3c7', border: '#ca8a04', x: 50, y: 200 },
                                        { letter: 'D', name: 'Delete', color: '#fee2e2', border: '#dc2626', x: 320, y: 200 }
                                    ];
                                    
                                    operations.forEach(op => {
                                        // Box
                                        ctx.fillStyle = op.color;
                                        ctx.fillRect(op.x, op.y, 230, 120);
                                        ctx.strokeStyle = op.border;
                                        ctx.lineWidth = 2;
                                        ctx.strokeRect(op.x, op.y, 230, 120);
                                        
                                        // Letter and name
                                        ctx.fillStyle = op.border;
                                        ctx.font = 'bold 24px Arial';
                                        ctx.fillText(op.letter, op.x + 10, op.y + 35);
                                        
                                        ctx.font = 'bold 14px Arial';
                                        ctx.fillText(op.name, op.x + 50, op.y + 30);
                                        
                                        // Details
                                        ctx.fillStyle = '#374151';
                                        ctx.font = '10px Arial';
                                        
                                        if (op.letter === 'C') {
                                            ctx.fillText('â€¢ INSERT INTO statement', op.x + 10, op.y + 55);
                                            ctx.fillText('â€¢ Form validation', op.x + 10, op.y + 70);
                                            ctx.fillText('â€¢ Data sanitization', op.x + 10, op.y + 85);
                                            ctx.fillText('â€¢ Success/error feedback', op.x + 10, op.y + 100);
                                        } else if (op.letter === 'R') {
                                            ctx.fillText('â€¢ SELECT statement', op.x + 10, op.y + 55);
                                            ctx.fillText('â€¢ Display in tables/lists', op.x + 10, op.y + 70);
                                            ctx.fillText('â€¢ Search and filtering', op.x + 10, op.y + 85);
                                            ctx.fillText('â€¢ Pagination support', op.x + 10, op.y + 100);
                                        } else if (op.letter === 'U') {
                                            ctx.fillText('â€¢ UPDATE statement', op.x + 10, op.y + 55);
                                            ctx.fillText('â€¢ Pre-populate forms', op.x + 10, op.y + 70);
                                            ctx.fillText('â€¢ Validation rules', op.x + 10, op.y + 85);
                                            ctx.fillText('â€¢ Change tracking', op.x + 10, op.y + 100);
                                        } else if (op.letter === 'D') {
                                            ctx.fillText('â€¢ DELETE statement', op.x + 10, op.y + 55);
                                            ctx.fillText('â€¢ Confirmation dialogs', op.x + 10, op.y + 70);
                                            ctx.fillText('â€¢ Soft delete option', op.x + 10, op.y + 85);
                                            ctx.fillText('â€¢ Cascade handling', op.x + 10, op.y + 100);
                                        }
                                    });
                                    
                                    // Center database icon
                                    ctx.fillStyle = '#e9d5ff';
                                    ctx.fillRect(250, 340, 100, 40);
                                    ctx.strokeStyle = '#7c3aed';
                                    ctx.strokeRect(250, 340, 100, 40);
                                    
                                    ctx.fillStyle = '#7c3aed';
                                    ctx.font = 'bold 12px Arial';
                                    ctx.fillText('MySQL DB', 270, 365);
                                    
                                    // Arrows to database
                                    ctx.strokeStyle = '#6b7280';
                                    ctx.setLineDash([5, 5]);
                                    
                                    // From each CRUD box to DB
                                    [[165, 180], [435, 180], [165, 320], [435, 320]].forEach(([x, y]) => {
                                        ctx.beginPath();
                                        ctx.moveTo(x, y);
                                        ctx.lineTo(300, 340);
                                        ctx.stroke();
                                    });
                                    
                                    ctx.setLineDash([]);
                                </script>
                                
                                <div class="alert alert-info">
                                    <div class="alert-icon">ðŸ’¡</div>
                                    <div class="alert-content">
                                        <div class="alert-title">CRUD Best Practices</div>
                                        <div class="alert-message">
                                            <ul>
                                                <li>Always use prepared statements to prevent SQL injection</li>
                                                <li>Validate data on both client and server side</li>
                                                <li>Implement proper error handling and user feedback</li>
                                                <li>Use transactions for related operations</li>
                                                <li>Consider soft deletes for important data</li>
                                                <li>Log all CRUD operations for audit trails</li>
                                            </ul>
                                        </div>
                                    </div>
                                </div>
                            </section>

                            <section>
                                <h2>Complete CRUD Implementation</h2>
                                
                                <div class="mermaid">
                                    graph TB
                                        USER[User Interface] --> CONTROLLER[Controller]
                                        CONTROLLER --> MODEL[Model/Database]
                                        MODEL --> DB[(MySQL)]
                                        
                                        CONTROLLER --> VALIDATE[Validation]
                                        VALIDATE --> SANITIZE[Sanitization]
                                        SANITIZE --> MODEL
                                        
                                        MODEL --> RESULT[Result]
                                        RESULT --> VIEW[View/Template]
                                        VIEW --> USER
                                        
                                        style USER fill:#dcfce7
                                        style CONTROLLER fill:#dbeafe
                                        style MODEL fill:#fef3c7
                                        style DB fill:#e9d5ff
                                </div>
                                
                                <div class="real_world_example">
                                    <h3>Complete Product Management System</h3>
                                    
                                    <pre><code class="language-php">&lt;?php
// ========================================
// DATABASE CONNECTION CLASS
// ========================================

class Database {
    private static $instance = null;
    private $pdo;
    
    private function __construct() {
        $config = [
            'host' => 'localhost',
            'dbname' => 'shop',
            'username' => 'root',
            'password' => '',
            'charset' => 'utf8mb4'
        ];
        
        try {
            $dsn = "mysql:host={$config['host']};dbname={$config['dbname']};charset={$config['charset']}";
            
            $this->pdo = new PDO($dsn, $config['username'], $config['password'], [
                PDO::ATTR_ERRMODE => PDO::ERRMODE_EXCEPTION,
                PDO::ATTR_DEFAULT_FETCH_MODE => PDO::FETCH_ASSOC,
                PDO::ATTR_EMULATE_PREPARES => false
            ]);
        } catch (PDOException $e) {
            die("Connection failed: " . $e->getMessage());
        }
    }
    
    public static function getInstance() {
        if (self::$instance === null) {
            self::$instance = new self();
        }
        return self::$instance;
    }
    
    public function getConnection() {
        return $this->pdo;
    }
}

// ========================================
// PRODUCT MODEL CLASS
// ========================================

class Product {
    private $db;
    private $table = 'products';
    
    public function __construct() {
        $this->db = Database::getInstance()->getConnection();
    }
    
    /**
     * CREATE - Add new product
     */
    public function create($data) {
        try {
            // Validate required fields
            $required = ['name', 'price', 'category_id'];
            foreach ($required as $field) {
                if (empty($data[$field])) {
                    throw new Exception("Field '$field' is required");
                }
            }
            
            // Sanitize data
            $data = $this->sanitizeData($data);
            
            // Prepare SQL
            $sql = "INSERT INTO {$this->table} 
                    (name, description, price, category_id, stock_quantity, sku, created_at) 
                    VALUES 
                    (:name, :description, :price, :category_id, :stock_quantity, :sku, NOW())";
            
            $stmt = $this->db->prepare($sql);
            
            // Bind parameters
            $stmt->bindParam(':name', $data['name']);
            $stmt->bindParam(':description', $data['description']);
            $stmt->bindParam(':price', $data['price']);
            $stmt->bindParam(':category_id', $data['category_id']);
            $stmt->bindParam(':stock_quantity', $data['stock_quantity']);
            $stmt->bindParam(':sku', $data['sku']);
            
            // Execute
            if ($stmt->execute()) {
                return [
                    'success' => true,
                    'id' => $this->db->lastInsertId(),
                    'message' => 'Product created successfully'
                ];
            }
            
            return ['success' => false, 'message' => 'Failed to create product'];
            
        } catch (Exception $e) {
            return ['success' => false, 'message' => $e->getMessage()];
        }
    }
    
    /**
     * READ - Get products with pagination and filtering
     */
    public function read($params = []) {
        try {
            // Base query
            $sql = "SELECT p.*, c.name as category_name 
                    FROM {$this->table} p 
                    LEFT JOIN categories c ON p.category_id = c.id 
                    WHERE 1=1";
            
            $bindings = [];
            
            // Add search filter
            if (!empty($params['search'])) {
                $sql .= " AND (p.name LIKE :search OR p.description LIKE :search)";
                $bindings[':search'] = '%' . $params['search'] . '%';
            }
            
            // Add category filter
            if (!empty($params['category'])) {
                $sql .= " AND p.category_id = :category";
                $bindings[':category'] = $params['category'];
            }
            
            // Add price range filter
            if (!empty($params['min_price'])) {
                $sql .= " AND p.price >= :min_price";
                $bindings[':min_price'] = $params['min_price'];
            }
            
            if (!empty($params['max_price'])) {
                $sql .= " AND p.price <= :max_price";
                $bindings[':max_price'] = $params['max_price'];
            }
            
            // Count total records
            $countSql = "SELECT COUNT(*) as total FROM ({$sql}) as count_table";
            $countStmt = $this->db->prepare($countSql);
            $countStmt->execute($bindings);
            $total = $countStmt->fetch()['total'];
            
            // Add sorting
            $sortColumn = $params['sort'] ?? 'name';
            $sortOrder = $params['order'] ?? 'ASC';
            $allowedColumns = ['name', 'price', 'stock_quantity', 'created_at'];
            
            if (in_array($sortColumn, $allowedColumns)) {
                $sql .= " ORDER BY p.{$sortColumn} {$sortOrder}";
            }
            
            // Add pagination
            $page = max(1, $params['page'] ?? 1);
            $perPage = $params['per_page'] ?? 10;
            $offset = ($page - 1) * $perPage;
            
            $sql .= " LIMIT :limit OFFSET :offset";
            
            // Prepare and execute
            $stmt = $this->db->prepare($sql);
            foreach ($bindings as $key => $value) {
                $stmt->bindValue($key, $value);
            }
            $stmt->bindValue(':limit', $perPage, PDO::PARAM_INT);
            $stmt->bindValue(':offset', $offset, PDO::PARAM_INT);
            
            $stmt->execute();
            
            return [
                'success' => true,
                'data' => $stmt->fetchAll(),
                'pagination' => [
                    'total' => $total,
                    'per_page' => $perPage,
                    'current_page' => $page,
                    'total_pages' => ceil($total / $perPage)
                ]
            ];
            
        } catch (Exception $e) {
            return ['success' => false, 'message' => $e->getMessage()];
        }
    }
    
    /**
     * READ - Get single product
     */
    public function findById($id) {
        try {
            $sql = "SELECT p.*, c.name as category_name 
                    FROM {$this->table} p 
                    LEFT JOIN categories c ON p.category_id = c.id 
                    WHERE p.id = :id";
            
            $stmt = $this->db->prepare($sql);
            $stmt->execute([':id' => $id]);
            
            $product = $stmt->fetch();
            
            if ($product) {
                return ['success' => true, 'data' => $product];
            }
            
            return ['success' => false, 'message' => 'Product not found'];
            
        } catch (Exception $e) {
            return ['success' => false, 'message' => $e->getMessage()];
        }
    }
    
    /**
     * UPDATE - Update product
     */
    public function update($id, $data) {
        try {
            // Check if product exists
            $existing = $this->findById($id);
            if (!$existing['success']) {
                return ['success' => false, 'message' => 'Product not found'];
            }
            
            // Sanitize data
            $data = $this->sanitizeData($data);
            
            // Build update query dynamically
            $fields = [];
            $bindings = [':id' => $id];
            
            foreach (['name', 'description', 'price', 'category_id', 'stock_quantity', 'sku'] as $field) {
                if (isset($data[$field])) {
                    $fields[] = "{$field} = :{$field}";
                    $bindings[":{$field}"] = $data[$field];
                }
            }
            
            if (empty($fields)) {
                return ['success' => false, 'message' => 'No fields to update'];
            }
            
            // Add updated_at
            $fields[] = "updated_at = NOW()";
            
            $sql = "UPDATE {$this->table} SET " . implode(', ', $fields) . " WHERE id = :id";
            
            $stmt = $this->db->prepare($sql);
            
            if ($stmt->execute($bindings)) {
                return [
                    'success' => true,
                    'message' => 'Product updated successfully',
                    'affected_rows' => $stmt->rowCount()
                ];
            }
            
            return ['success' => false, 'message' => 'Failed to update product'];
            
        } catch (Exception $e) {
            return ['success' => false, 'message' => $e->getMessage()];
        }
    }
    
    /**
     * DELETE - Delete product (with soft delete option)
     */
    public function delete($id, $soft = true) {
        try {
            if ($soft) {
                // Soft delete - mark as deleted
                $sql = "UPDATE {$this->table} 
                        SET deleted_at = NOW() 
                        WHERE id = :id AND deleted_at IS NULL";
            } else {
                // Hard delete - remove from database
                $sql = "DELETE FROM {$this->table} WHERE id = :id";
            }
            
            $stmt = $this->db->prepare($sql);
            $stmt->execute([':id' => $id]);
            
            if ($stmt->rowCount() > 0) {
                return [
                    'success' => true,
                    'message' => 'Product deleted successfully'
                ];
            }
            
            return ['success' => false, 'message' => 'Product not found or already deleted'];
            
        } catch (Exception $e) {
            return ['success' => false, 'message' => $e->getMessage()];
        }
    }
    
    /**
     * Bulk operations
     */
    public function bulkDelete($ids) {
        try {
            $placeholders = str_repeat('?,', count($ids) - 1) . '?';
            $sql = "UPDATE {$this->table} 
                    SET deleted_at = NOW() 
                    WHERE id IN ($placeholders)";
            
            $stmt = $this->db->prepare($sql);
            $stmt->execute($ids);
            
            return [
                'success' => true,
                'message' => $stmt->rowCount() . ' products deleted'
            ];
            
        } catch (Exception $e) {
            return ['success' => false, 'message' => $e->getMessage()];
        }
    }
    
    /**
     * Data sanitization
     */
    private function sanitizeData($data) {
        $sanitized = [];
        
        foreach ($data as $key => $value) {
            switch ($key) {
                case 'name':
                case 'description':
                case 'sku':
                    $sanitized[$key] = htmlspecialchars(trim($value), ENT_QUOTES, 'UTF-8');
                    break;
                    
                case 'price':
                    $sanitized[$key] = filter_var($value, FILTER_VALIDATE_FLOAT);
                    break;
                    
                case 'category_id':
                case 'stock_quantity':
                    $sanitized[$key] = filter_var($value, FILTER_VALIDATE_INT);
                    break;
                    
                default:
                    $sanitized[$key] = $value;
            }
        }
        
        return $sanitized;
    }
}</code></pre>
                                </div>
                            </section>

                            <section>
                                <h2>User Interface for CRUD Operations</h2>
                                
                                <div class="best_practice">
                                    <h3>HTML Forms and UI Components</h3>
                                    
                                    <pre><code class="language-php">&lt;?php
// ========================================
// PRODUCT CONTROLLER
// ========================================

class ProductController {
    private $model;
    
    public function __construct() {
        $this->model = new Product();
    }
    
    /**
     * Display products list
     */
    public function index() {
        // Get parameters from request
        $params = [
            'search' => $_GET['search'] ?? '',
            'category' => $_GET['category'] ?? '',
            'page' => $_GET['page'] ?? 1,
            'sort' => $_GET['sort'] ?? 'name',
            'order' => $_GET['order'] ?? 'ASC'
        ];
        
        $result = $this->model->read($params);
        
        if ($result['success']) {
            $products = $result['data'];
            $pagination = $result['pagination'];
            include 'views/products/index.php';
        } else {
            $error = $result['message'];
            include 'views/error.php';
        }
    }
    
    /**
     * Show create form
     */
    public function create() {
        include 'views/products/create.php';
    }
    
    /**
     * Store new product
     */
    public function store() {
        if ($_SERVER['REQUEST_METHOD'] !== 'POST') {
            header('Location: /products');
            exit;
        }
        
        // CSRF token validation
        if (!$this->validateCSRFToken($_POST['csrf_token'] ?? '')) {
            $_SESSION['error'] = 'Invalid request';
            header('Location: /products/create');
            exit;
        }
        
        $result = $this->model->create($_POST);
        
        if ($result['success']) {
            $_SESSION['success'] = $result['message'];
            header('Location: /products');
        } else {
            $_SESSION['error'] = $result['message'];
            $_SESSION['old_input'] = $_POST;
            header('Location: /products/create');
        }
        exit;
    }
    
    /**
     * Show edit form
     */
    public function edit($id) {
        $result = $this->model->findById($id);
        
        if ($result['success']) {
            $product = $result['data'];
            include 'views/products/edit.php';
        } else {
            $_SESSION['error'] = 'Product not found';
            header('Location: /products');
            exit;
        }
    }
    
    /**
     * Update product
     */
    public function update($id) {
        if ($_SERVER['REQUEST_METHOD'] !== 'POST') {
            header('Location: /products');
            exit;
        }
        
        // CSRF validation
        if (!$this->validateCSRFToken($_POST['csrf_token'] ?? '')) {
            $_SESSION['error'] = 'Invalid request';
            header("Location: /products/{$id}/edit");
            exit;
        }
        
        $result = $this->model->update($id, $_POST);
        
        if ($result['success']) {
            $_SESSION['success'] = $result['message'];
            header('Location: /products');
        } else {
            $_SESSION['error'] = $result['message'];
            $_SESSION['old_input'] = $_POST;
            header("Location: /products/{$id}/edit");
        }
        exit;
    }
    
    /**
     * Delete product
     */
    public function destroy($id) {
        if ($_SERVER['REQUEST_METHOD'] !== 'POST') {
            header('Location: /products');
            exit;
        }
        
        // CSRF validation
        if (!$this->validateCSRFToken($_POST['csrf_token'] ?? '')) {
            $_SESSION['error'] = 'Invalid request';
            header('Location: /products');
            exit;
        }
        
        $result = $this->model->delete($id);
        
        if ($result['success']) {
            $_SESSION['success'] = $result['message'];
        } else {
            $_SESSION['error'] = $result['message'];
        }
        
        header('Location: /products');
        exit;
    }
    
    /**
     * Generate CSRF token
     */
    public function generateCSRFToken() {
        if (empty($_SESSION['csrf_token'])) {
            $_SESSION['csrf_token'] = bin2hex(random_bytes(32));
        }
        return $_SESSION['csrf_token'];
    }
    
    /**
     * Validate CSRF token
     */
    private function validateCSRFToken($token) {
        return isset($_SESSION['csrf_token']) && 
               hash_equals($_SESSION['csrf_token'], $token);
    }
}

// ========================================
// VIEW: products/index.php
// ========================================
?&gt;

&lt;!DOCTYPE html&gt;
&lt;html&gt;
&lt;head&gt;
    &lt;title&gt;Product Management&lt;/title&gt;
    &lt;link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet"&gt;
&lt;/head&gt;
&lt;body&gt;
    &lt;div class="container mt-5"&gt;
        &lt;h1&gt;Products&lt;/h1&gt;
        
        &lt;!-- Success/Error Messages --&gt;
        &lt;?php if (isset($_SESSION['success'])): ?&gt;
            &lt;div class="alert alert-success alert-dismissible fade show"&gt;
                &lt;?= htmlspecialchars($_SESSION['success']) ?&gt;
                &lt;button type="button" class="btn-close" data-bs-dismiss="alert"&gt;&lt;/button&gt;
            &lt;/div&gt;
            &lt;?php unset($_SESSION['success']); ?&gt;
        &lt;?php endif; ?&gt;
        
        &lt;!-- Search and Filter Form --&gt;
        &lt;form method="GET" action="/products" class="row g-3 mb-4"&gt;
            &lt;div class="col-md-4"&gt;
                &lt;input type="text" name="search" class="form-control" 
                       placeholder="Search products..." 
                       value="&lt;?= htmlspecialchars($params['search']) ?&gt;"&gt;
            &lt;/div&gt;
            &lt;div class="col-md-3"&gt;
                &lt;select name="category" class="form-control"&gt;
                    &lt;option value=""&gt;All Categories&lt;/option&gt;
                    &lt;!-- Categories would be loaded dynamically --&gt;
                &lt;/select&gt;
            &lt;/div&gt;
            &lt;div class="col-md-2"&gt;
                &lt;button type="submit" class="btn btn-primary"&gt;Search&lt;/button&gt;
            &lt;/div&gt;
            &lt;div class="col-md-3 text-end"&gt;
                &lt;a href="/products/create" class="btn btn-success"&gt;Add New Product&lt;/a&gt;
            &lt;/div&gt;
        &lt;/form&gt;
        
        &lt;!-- Products Table --&gt;
        &lt;table class="table table-striped"&gt;
            &lt;thead&gt;
                &lt;tr&gt;
                    &lt;th&gt;&lt;a href="?sort=id&order=&lt;?= $params['order'] === 'ASC' ? 'DESC' : 'ASC' ?&gt;"&gt;ID&lt;/a&gt;&lt;/th&gt;
                    &lt;th&gt;&lt;a href="?sort=name&order=&lt;?= $params['order'] === 'ASC' ? 'DESC' : 'ASC' ?&gt;"&gt;Name&lt;/a&gt;&lt;/th&gt;
                    &lt;th&gt;Category&lt;/th&gt;
                    &lt;th&gt;&lt;a href="?sort=price&order=&lt;?= $params['order'] === 'ASC' ? 'DESC' : 'ASC' ?&gt;"&gt;Price&lt;/a&gt;&lt;/th&gt;
                    &lt;th&gt;Stock&lt;/th&gt;
                    &lt;th&gt;Actions&lt;/th&gt;
                &lt;/tr&gt;
            &lt;/thead&gt;
            &lt;tbody&gt;
                &lt;?php foreach ($products as $product): ?&gt;
                &lt;tr&gt;
                    &lt;td&gt;&lt;?= $product['id'] ?&gt;&lt;/td&gt;
                    &lt;td&gt;&lt;?= htmlspecialchars($product['name']) ?&gt;&lt;/td&gt;
                    &lt;td&gt;&lt;?= htmlspecialchars($product['category_name']) ?&gt;&lt;/td&gt;
                    &lt;td&gt;$&lt;?= number_format($product['price'], 2) ?&gt;&lt;/td&gt;
                    &lt;td&gt;
                        &lt;span class="badge &lt;?= $product['stock_quantity'] > 10 ? 'bg-success' : 'bg-warning' ?&gt;"&gt;
                            &lt;?= $product['stock_quantity'] ?&gt;
                        &lt;/span&gt;
                    &lt;/td&gt;
                    &lt;td&gt;
                        &lt;a href="/products/&lt;?= $product['id'] ?&gt;" class="btn btn-sm btn-info"&gt;View&lt;/a&gt;
                        &lt;a href="/products/&lt;?= $product['id'] ?&gt;/edit" class="btn btn-sm btn-warning"&gt;Edit&lt;/a&gt;
                        &lt;form method="POST" action="/products/&lt;?= $product['id'] ?&gt;/delete" 
                              style="display:inline;" onsubmit="return confirm('Are you sure?')"&gt;
                            &lt;input type="hidden" name="csrf_token" value="&lt;?= $controller->generateCSRFToken() ?&gt;"&gt;
                            &lt;button type="submit" class="btn btn-sm btn-danger"&gt;Delete&lt;/button&gt;
                        &lt;/form&gt;
                    &lt;/td&gt;
                &lt;/tr&gt;
                &lt;?php endforeach; ?&gt;
            &lt;/tbody&gt;
        &lt;/table&gt;
        
        &lt;!-- Pagination --&gt;
        &lt;?php if ($pagination['total_pages'] > 1): ?&gt;
        &lt;nav&gt;
            &lt;ul class="pagination"&gt;
                &lt;?php for ($i = 1; $i <= $pagination['total_pages']; $i++): ?&gt;
                    &lt;li class="page-item &lt;?= $i === $pagination['current_page'] ? 'active' : '' ?&gt;"&gt;
                        &lt;a class="page-link" href="?page=&lt;?= $i ?&gt;&amp;search=&lt;?= urlencode($params['search']) ?&gt;"&gt;
                            &lt;?= $i ?&gt;
                        &lt;/a&gt;
                    &lt;/li&gt;
                &lt;?php endfor; ?&gt;
            &lt;/ul&gt;
        &lt;/nav&gt;
        &lt;?php endif; ?&gt;
    &lt;/div&gt;
&lt;/body&gt;
&lt;/html&gt;</code></pre>
                                </div>
                            </section>
                            
                            <!-- Practice Exercise -->
                            <section>
                                <h2>Practice Exercise</h2>
                                
                                <div class="alert alert-success">
                                    <div class="alert-icon">ðŸ’»</div>
                                    <div class="alert-content">
                                        <div class="alert-title">CRUD Implementation Challenges</div>
                                        <div class="alert-message">
                                            Build these CRUD features:
                                            <ol>
                                                <li>Create a complete User Management System</li>
                                                <li>Implement Category CRUD with hierarchy</li>
                                                <li>Build an Order Management System</li>
                                                <li>Create a Blog Post system with comments</li>
                                                <li>Implement file upload for products</li>
                                                <li>Add bulk import/export functionality</li>
                                                <li>Create an audit log for all CRUD operations</li>
                                                <li>Build REST API endpoints for CRUD</li>
                                            </ol>
                                        </div>
                                    </div>
                                </div>
                            </section>
                        </div>

                        <!-- Lesson Navigation -->
                        <div class="lesson-navigation">
                            <a href="/03module/php_mysql_integration.html" class="lesson-nav-button prev">
                                <svg width="20" height="20" viewBox="0 0 20 20" fill="currentColor">
                                    <path d="M12.707 5.293a1 1 0 010 1.414L9.414 10l3.293 3.293a1 1 0 01-1.414 1.414l-4-4a1 1 0 010-1.414l4-4a1 1 0 011.414 0z"/>
                                </svg>
                                <span>
                                    <small>Previous</small><br>
                                    PHP MySQL Basics
                                </span>
                            </a>
                            
                            <button class="complete-lesson-btn">
                                Mark as Complete
                            </button>
                            
                            <a href="/03module/result_sets.html" class="lesson-nav-button next">
                                <span>
                                    <small>Next</small><br>
                                    Handling Result Sets
                                </span>
                                <svg width="20" height="20" viewBox="0 0 20 20" fill="currentColor">
                                    <path d="M7.293 14.707a1 1 0 010-1.414L10.586 10 7.293 6.707a1 1 0 011.414-1.414l4 4a1 1 0 010 1.414l-4 4a1 1 0 01-1.414 0z"/>
                                </svg>
                            </a>
                        </div>
                    </article>
                </div>
            </div>
        </main>

        <!-- Footer -->
        <footer class="site-footer" role="contentinfo">
            <div class="footer-container">
                <div class="footer-content">
                    <div class="footer-section footer-about">
                        <h3>PHP WordPress Development</h3>
                        <p>Complete Web Development Course</p>
                    </div>
                    
                    <div class="footer-section">
                        <h4>Quick Links</h4>
                        <ul class="footer-links">
                            <li><a href="/">Home</a></li>
                            <li><a href="/module3.html">Module 3</a></li>
                            <li><a href="/resources.html">Resources</a></li>
                        </ul>
                    </div>
                    
                    <div class="footer-section">
                        <h4>Support</h4>
                        <ul class="footer-links">
                            <li><a href="/help.html">Help Center</a></li>
                            <li><a href="/faq.html">FAQ</a></li>
                            <li><a href="/contact.html">Contact</a></li>
                        </ul>
                    </div>
                </div>
                
                <div class="footer-bottom">
                    <div class="footer-bottom-content">
                        <p class="copyright">&copy; 2025 PHP WordPress Development Course</p>
                        <nav class="footer-bottom-links">
                            <a href="/privacy.html">Privacy</a>
                            <span class="separator">|</span>
                            <a href="/terms.html">Terms</a>
                        </nav>
                    </div>
                </div>
            </div>
        </footer>
    </div>

    <!-- Back to Top -->
    <button id="back-to-top" class="back-to-top" aria-label="Back to top">
        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M12 19V5M12 5l-7 7M12 5l7 7"/>
        </svg>
    </button>

    <!-- JavaScript -->
    <script src="/assets/js/navigation.js"></script>
    <script src="/assets/js/site-config.js"></script>
</body>
</html>